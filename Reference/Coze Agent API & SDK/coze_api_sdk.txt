
============================================================
# API 介绍
来源: https://www.coze.cn/open/docs/developer_guides/coze_api_overview
============================================================

API 介绍

扣子编程

是新一代一站式 AI 智能体开发平台。无论你是否有编程基础，都可以在平台上快速搭建基于 AI 模型的各类问答智能体。而且你可以将搭建的智能体发布到各类社交平台和通讯软件上，让更多的用户与你搭建的智能体聊天。

​

扣子编程

支持将 AI 智能体和扣子应用发布为 API 服务，你可以通过 HTTP 方式与其进行交互。

​

费用说明

​

个人免费版

：免费使用

扣子编程

API，但有一定的额度限制。

​

个人付费版（进阶版、高阶版、旗舰版）、企业版（企业标准版、企业旗舰版）

：涉及大模型处理的 API 会产生模型费用，

音视频的 API 也有对应功能的计费方式。

​

限制说明

​

限流策略

​

扣子编程

API 限流策略分为以下两个维度，且不同用户类型的限流策略不同。

​

​

限流策略

​

个人免费版

​

个人付费版

​

企业标准版

​

企业旗舰版

​

​

发起对话

API 的流控

​

20 QPS

​

100 QPS

​

200 QPS

​

500 QPS

​

以下关键 API 的流控：

​

​

执行工作流

​

​

执行工作流（流式响应）

​

​

执行对话流

​

​

查询工作流异步运行结果

​

​

查询输出节点的执行结果

​

50 QPS

​

100 QPS

​

200 QPS

​

500 QPS

​

企业超级管理员或管理员可以扩容 API 的 QPS，具体步骤请参见

​

购买扩容服务

。

​

​

上传文件

API 的流控

​

10 QPS

​

10 QPS

​

20 QPS

​

20 QPS

​

模型流控。

​

调用

​

发起对话

、

​

执行工作流

、

​

执行工作流（流式响应）

、

​

执行对话流

等涉及模型处理的 API 时，每个用户使用模型的流控。

​

模型每分钟请求数（RPM）为 300。

​

模型每分钟请求数（RPM）为 1000。

​

模型每分钟请求数（RPM）为 5000。

​

​

​

模型每分钟请求数（RPM）为 12000。

​

API调用量

​

累计 500 次免费额度。

​

说明

一旦累计调用次数超过免费额度，此账号将无法继续使用任何

扣子编程

API。API 免费额度不适用于通过

扣子编程

、其他发布渠道或 SDK 产生的请求。

​

​

不限

​

不限

​

不限

​

​

请求体限制

​

API 请求体大小限制如下：

​

工作流相关的 API 请求体大小限制为 20MB。

​

其他类类别的 API 请求体大小限制为 15MB。

​

发送请求

​

将以下命令粘贴到终端中以运行你的第一个 API 请求。

​

在发送请求前，请将示例中的以下参数值替换成真实数据：

​

Authorization

：生成的

个人访问令牌

。线上环境注意替换为 OAuth 访问密钥，详情参考

​

OAuth 应用管理

。

​

bot_id

：智能体ID。进入智能体的开发页面，开发页面 URL 中

bot

参数后的数字就是智能体ID。例如

https://www.coze.cn/space/341****/bot/73428668*****

，

bot_id

为

73428668*****

。

​

说明

确保智能体已发布为 API 服务。详情参考

​

准备工作

。

​

​

user_id

：标识当前与智能体交互的用户。调试时可将此参数固定为一个任意字符串，例如

123

。

​

content

：发送的消息内容。

​

​

Shell

复制

curl --location --request POST 'https://api.coze.c

n

/v3/chat'

\

​

--header 'Authorization: Bearer

pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****

'

\

​

--header 'Content-Type: application/json'

\

​

--data-raw '

{

​

"bot_id": "

73428668*****

"

,

​

"user_id": "

123123***

"

,

​

"stream": false

,

​

"auto_save_history":true

,

​

"additional_messages":

[

​

{

​

"role":"user"

,

​

"content":"

早上好

"

,

​

"content_type":"text

"

​

}

​

]

​

}

'

​

​

说明

如果需要通过火山引擎私有网络访问扣子编程 API ，请参见

​

通过私网连接访问扣子 API

。

​

​

基础概念

​

​

名词

​

说明

​

会话（Conversation）

​

智能体和用户之间的一段问答交互。一个会话包含一条或多条消息，并且能够自动处理截断，以适应模型的上下文内容。

​

消息（Message）

​

一条由用户或智能体创建的消息，消息内容可以包括文本、图片或文件。消息以列表的形式储存在对话中。

​

对话（Chat）

​

在会话中对智能体的一次调用。智能体收到请求后，结合用户输入、通过预设的一系列工作流等配置来调用模型或工具执行指定任务。每个对话都是会话的一部分，智能体会将对话中产生的消息添加到会话中。

​

你可以直接发起对话，与智能体进行一次交互；也可以创建会话和消息，并在指定会话中发起对话，会话中的其他消息会作为历史消息传递给大模型。

​

上下文段落（Section）

​

在智能体对话管理中，Section 是一个独立的上下文段落，用于分隔不同的对话阶段或主题。创建会话时会生成一个 Section，Section 中包含上下文消息，当用户清除上下文时，系统会创建一个新的 Section，从而确保新的对话不受历史消息的影响。

​

会话、消息和上下文段落的关系如下图所示。

​

​

​

​

​

​

​

​

下一篇

更新日志
============================================================
# 更新日志
来源: https://www.coze.cn/open/docs/developer_guides/changelog
============================================================

更新日志

2025年11月

​

​

API

​

发布时间

​

变更类型

​

说明

​

​

创建智能体

​

​

更新智能体

​

2025年11月25日

​

新增参数

​

新增

api_mode

参数，用于指定智能体与模型交互时使用的 API 协议，包括

chat_api

和

responses_api

。具体支持的模型请参见

模型能力差异

。

​

当

api_mode

为

responses_api

时，

parameters

参数支持配置前缀缓存、存储和存储时长。

​

​

语音合成

​

2025年11月21日

​

新增参数

​

新增

context_texts

参数，用于配置豆包语音合成大模型 2.0 音色的辅助信息，控制合成语音的整体情绪（如悲伤、生气）、方言（如四川话、北京话）、语气（如撒娇、暧昧、吵架、夹子音）、语速（快慢）及音调（高低）等。

​

​

双向流式语音合成事件

​

​

双向流式对话上行事件

​

​

Realtime 上行事件

​

2025年11月21日

​

新增参数

​

新增

data.tts_config.context_texts

参数，用于配置豆包语音合成大模型 2.0 音色的辅助信息，控制合成语音的整体情绪（如悲伤、生气）、方言（如四川话、北京话）、语气（如撒娇、暧昧、吵架、夹子音）、语速（快慢）及音调（高低）等。

​

​

恢复运行工作流

​

2025年11月18日

​

新增接口

​

当调用

执行工作流

API 执行包含问答节点、输入节点的工作流时，智能体会以指定问题向用户提问，并等待用户回答。此时工作流为中断状态，开发者需要调用此 API 恢复运行工作流。

​

​

执行工作流

​

​

查询工作流异步运行结果

​

2025年11月18日

​

新增参数

​

新增

interrupt_data

参数，返回中断事件的详细信息，包含中断控制内容、中断类型和事件 ID 等信息。

​

​

修改企业员工的角色

​

2025年11月3日

​

新增接口

​

修改企业员工的角色。

​

​

创建组织

​

2025年11月3日

​

新增接口

​

在指定的企业中创建组织。

​

​

查询组织列表

​

2025年11月3日

​

新增接口

​

查询指定企业中的组织列表。

​

​

添加组织成员

​

2025年11月3日

​

新增接口

​

用户加入企业时将自动加入默认组织。

创建组织

后，你可以调用本 API 将员工和访客加入对应组织。

​

​

查询组织成员列表

​

2025年11月3日

​

新增接口

​

查询指定组织中的成员列表。

​

​

修改组织成员角色

​

2025年11月3日

​

新增接口

​

修改组织成员的角色。

​

​

2025年10月

​

​

API

​

发布时间

​

变更类型

​

说明

​

​

修改组织基本信息

​

2025年10月27日

​

新增接口

​

修改组织的名称和描述。

​

​

修改工作空间基本信息

​

2025年10月27日

​

新增接口

​

修改工作空间的名称和描述。

​

​

查询套餐权益

​

2025年10月24日

​

新增接口

​

查询当前账号所属的套餐类型、扩容管理页面中 API 扩容的信息、通过 MCP 方式调用付费插件的次数限制。

​

​

批量查询插件信息

​

2025年10月24日

​

新增接口

​

批量查询插件的详细信息，支持查询官方插件、三方插件和资源库插件。

​

​

查询插件详情

​

2025年10月24日

​

新增参数

​

返回参数中新增

data.name_for_model

、

data.icon_url

、

data.is_call_available

、

data.created_at

、

data.updated_at

。

​

​

查询付费插件列表

​

2025年10月24日

​

新增参数

​

Query 参数中新增

category_ids

。

​

​

添加企业成员

​

2025年10月21日

​

新增接口

​

在火山引擎创建用户后，你可以调用本 API 将用户添加至企业。

​

​

移除组织成员

​

2025年10月21日

​

新增接口

​

如果成员因离职或换部门等场景需要调整归属的组织时，你可以调用本 API 将其移出组织。

​

​

移除企业成员

​

2025年10月21日

​

新增接口

​

移除企业成员，并指定资源接收人。

​

​

双向流式对话上行事件

​

​

双向流式对话下行事件

​

​

Realtime 上行事件

​

​

Realtime 下行事件

​

2025年10月16日

​

新增参数

​

企业旗舰版

新增支持降噪配置，支持两种模式：

​

data.voice_processing_config.enable_ans

：主动噪声抑制。自动识别并过滤掉背景环境中的各种噪音（如键盘声、空调声、街道嘈杂声），让说话者的声音更清晰。

​

data.voice_processing_config.enable_pdns

：声纹降噪。专门针对

特定说话人

的声音进行优化，能更精准地保留目标人声。

​

​

双向流式对话上行事件

​

​

双向流式对话下行事件

​

​

Realtime 上行事件

​

​

Realtime 下行事件

​

​

创建房间

​

2025年10月16日

​

新增参数

​

企业旗舰版

新增支持语义判停的自由对话模式（

data.turn_detection.type=semantic_vad

） 。新增

data.turn_detection.semantic_vad_config

参数，用于配置判定语音停止的语义检测策略。

​

​

双向流式对话上行事件

​

​

双向流式对话下行事件

​

​

2025年10月15日

​

新增参数

​

data.output_audio.codec

输出音频编码新增支持 mp3 格式。新增

data.output_audio.mp3_config

参数，用于配置 mp3 编码参数。

​

​

​

2025年9月

​

​

API

​

发布时间

​

变更类型

​

说明

​

​

查询付费插件列表

​

2025年9月29日

​

新增接口

​

查询插件商店中的付费插件列表，包括扣子官方插件和三方插件，或通过关键词模糊搜索相关插件。

​

​

查询插件分类

​

2025年9月29日

​

新增接口

​

获取插件的分类 ID，后续调用

查询插件列表

API 查询指定分类下的插件。

​

​

查询插件详情

​

2025年9月29日

​

新增接口

​

查询指定插件的详细信息，包括插件工具列表（工具名称、描述、输入参数和返回参数），以及 MCP Server 的配置信息，以便在 Trae 等外部平台配置 MCP 服务，并调用插件工具。

​

​

调用插件工具

​

2025年9月29日

​

新增接口

​

调用指定付费插件中的工具。

​

​

创建房间

​

2025年9月17日

​

新增参数

​

新增

turn_detection

参数，语音检测类型新增支持按键说话模式。

​

​

Realtime 上行事件

​

​

Realtime 下行事件

​

2025年9月17日

​

新增事件

​

为支持按键说话模式，新增如下事件：

​

input_audio_buffer.start

：用户开始说话。

​

input_audio_buffer.complete

：用户结束说话。

​

​

创建房间

​

​

双向流式语音对话

​

2025年9月15日

​

参数下线

​

请求参数中的 workflow id 参数下线，存量 API 不受影响仍可正常使用。

​

如需为对话流中的自定义参数赋值， 请参见

​

为自定义参数赋值

。

​

​

申请插件扩容回调事件

​

​

插件扩容到期回调事件

​

2025年9月12日

​

新增接口

​

如果三方付费插件支持扩容，插件开发者可以订阅插件扩容回调事件。当用户申请插件扩容、扩容申请到期或用户主动取消扩容时，扣子开发平台会向指定的回调地址推送回调消息。

​

​

复制资源

​

2025年9月9日

​

新增接口

​

同工作空间或跨工作空间复制智能体、扣子应用或工作流。

​

​

查询资源复制的结果

​

2025年9月9日

​

新增接口

​

查询资源复制的结果。

​

​

Realtime 上行事件

​

​

Realtime 下行事件

​

2025年9月8日

​

新增参数

​

新增如下参数：

​

data.asr_config.enable_nostream

：是否开启

二次识别模式

，开启后会实时返回逐字识别的文本；当一句话结束时，会结合整句音频进行上下文分析并重新识别，生成优化后的识别结果并返回。

​

data.asr_config.enable_emotion

：是否开启识别说话人的情绪。

​

data.asr_config.enable_gender

：是否开启识别说话人的性别（male/female）。

​

data.asr_config.sensitive_words_filter

：配置敏感词过滤功能，支持以下 3 种过滤方式：

​

过滤系统敏感词，并替换为

*

。

​

过滤自定义敏感词，并替换为空。

​

过滤自定义敏感词，并替换为

*

。

​

​

查询工作流基本信息

​

2025年9月4日

​

新增参数

​

返回参数中新增

input

和

output

参数，用于返回工作流开始节点的输入参数的结构体、结束节点的输出参数的结构体。

​

​

查询工作流的版本列表

​

2025年9月4日

​

新增参数

​

返回参数中新增

input

和

output

参数，用于返回工作流开始节点的输入参数的结构体、结束节点的输出参数的结构体。

​

​

双向流式对话上行事件

​

​

双向流式语音合成事件

​

2025年9月4日

​

新增参数

​

新增

data.output_audio.loudness_rate

参数，用于配置输出音频的音量。

​

​

Realtime 上行事件

​

​

语音合成

​

2025年9月4日

​

新增参数

​

新增

data.loudness_rate

参数，用于配置输入音频的音量。

​

​

查看智能体版本列表

​

2025年9月3日

​

新增接口

​

查询某个智能体的版本列表，支持查询已发布版本或未发布版本的版本号、版本创建者信息、创建时间等。

​

​

创建工作空间

​

2025年9月3日

​

新增接口

​

创建工作空间

​

​

开启或关闭智能体多人协作

​

2025年9月3日

​

新增接口

​

开启或关闭智能体多人协作模式。

​

​

开启或关闭工作流多人协作

​

2025年9月3日

​

新增接口

​

开启或关闭工作流多人协作模式。

​

​

2025年8月

​

​

API

​

发布时间

​

变更类型

​

说明

​

​

添加智能体的协作者

​

2025年8月29日

​

新增接口

​

添加智能体的协作者。

​

​

添加应用的协作者

​

2025年8月29日

​

新增接口

​

添加应用的协作者。

​

​

删除智能体的协作者

​

2025年8月29日

​

新增接口

​

删除智能体的协作者。

​

​

删除应用的协作者

​

2025年8月29日

​

新增接口

​

删除应用的协作者。

​

​

添加工作流协作者

​

2025年8月29日

​

新增接口

​

添加工作流的协作者。

​

​

删除工作流协作者

​

2025年8月29日

​

新增接口

​

删除工作流的协作者。

​

​

发起对话

​

2025年8月29日

​

新增参数

​

新增

publish_status

和

bot_version

参数。

​

publish_status

：用于指定与已发布版本或草稿版本的智能体对话。

​

bot_version

：用于指定与某个特定版本的智能体对话。

​

​

绑定设备

​

2025年8月21日

​

新增接口

​

硬件厂商可以调用本 API 将企业内的硬件设备与企业的自定义渠道绑定，当开发者发布智能体到该自定义渠道时，在发布配置页面的设备列表中选择对应的设备，即可快速发布到对应设备。

​

​

发布智能体

​

2025年8月21日

​

新增参数

​

新增

connectors

参数，智能体发布自定义渠道时，你可以通过该参数传递自定义参数给渠道。例如，设置将智能体发布到指定设备。

​

​

更新会话名称

​

2025年8月4日

​

新增接口

​

会话创建者可以更新指定会话的会话名，以便更好地识别和管理会话。

​

​

删除会话

​

2025年8月4日

​

新增接口

​

会话创建者可以删除指定的会话。

​

​

创建会话

​

2025年8月4日

​

新增参数

​

请求参数新增

name

参数，用于指定会话的名称。

​

返回参数新增

creator_id

和

connector_id

，返回会话的创建者 ID、会话在哪个渠道创建。

​

​

查看会话信息

​

2025年8月4日

​

新增参数

​

返回参数新增

name

、

creator_id

和

connector_id

，返回会话的名称、会话的创建者 ID、会话在哪个渠道创建。

​

​

语音合成

​

2025年8月4日

​

新增参数

​

请求参数新增

emotion

和

emotion_scale

，用于设置多情感音色的情感类型和情感值。

​

​

双向流式语音合成事件

​

2025年8月4日

​

新增参数

​

更新语音合成配置上行事件中，新增

data.output_audio.emotion_config

参数，用于设置多情感音色的情感类型和情感值。

​

​

双向流式对话上行事件

​

2025年8月4日

​

新增参数

​

更新对话配置上行事件中，新增

data.output_audio.emotion_config

参数，用于设置多情感音色的情感类型和情感值。

​

​

Realtime 上行事件

​

2025年8月4日

​

新增参数

​

更新房间配置上行事件中，新增

data.tts_config

参数，用于设置多情感音色的情感类型和情感值。

​

​

2025年7月

​

​

API

​

发布时间

​

变更类型

​

说明

​

​

下架智能体

​

2025年7月25日

​

新增接口

​

智能体发布后，你可以调用本 API 从扣子官方渠道及自定义渠道下架智能体。

​

​

查询工作流列表

​

2025年7月24日

​

新增接口

​

查询指定工作空间中的工作流列表及其基本信息。

​

​

查询工作流基本信息

​

2025年7月24日

​

新增接口

​

查询工作流的基本信息，包括工作流名称、描述、创建者信息等。

​

​

查询工作流的版本列表

​

2025年7月24日

​

新增接口

​

查询某个工作流的所有历史版本记录，包括版本号、版本描述、操作者和发布时间。

​

​

执行工作流

​

​

执行工作流（流式响应）

​

​

查询工作流异步运行结果

​

2025年7月24日

​

新增参数

​

返回参数中新增

Usage

参数，返回本次 API 调用消耗的 Token 数量等信息。

​

​

创建回调应用

​

2025年7月22日

​

新增接口

​

创建回调应用，支持创建普通回调应用和渠道回调应用。订阅扣子回调功能时需要创建回调应用。

​

​

修改回调应用

​

2025年7月22日

​

新增接口

​

修改回调应用的名称和回调地址。

​

​

查询回调应用列表

​

2025年7月22日

​

新增接口

​

查询回调应用列表。

​

​

删除回调应用

​

2025年7月22日

​

新增接口

​

如果不再需要接收扣子回调，可以删除回调应用。一旦删除，该回调应用所订阅的所有回调事件触发时，将不再向该回调应用推送通知。

​

​

订阅回调事件

​

2025年7月22日

​

新增接口

​

订阅回调事件。

​

​

查询已订阅的事件

​

2025年7月22日

​

新增接口

​

查询回调应用中已订阅的事件。

​

​

取消订阅事件

​

2025年7月22日

​

新增接口

​

如果不再需要订阅某个回调事件，可以取消订阅。一旦取消订阅，对应回调事件触发时，将不再向该回调地址推送通知。

​

​

提交消息评价

​

2025年7月10日

​

新增接口

​

会话创建者可以对智能体或应用回复的消息提交评价，包括点赞、点踩和反馈详细的评论。

​

​

删除消息评价

​

2025年7月10日

​

新增接口

​

删除指定消息的评价。

​

​

查询文件夹列表

​

2025年7月8日

​

新增接口

​

工作空间中的用户可以查询工作空间中的文件夹列表。

​

​

查询文件夹详情

​

2025年7月8日

​

新增接口

​

工作空间中的用户可以查询工作空间中指定文件夹的详情，包括文件夹的名称、描述、所属工作空间、文件夹创建者的 UID等。

​

​

2025年6月

​

​

API

​

发布时间

​

变更类型

​

说明

​

​

发起对话

​

2025年6月26日

​

新增参数

​

Body 中新增

enable_card

参数，用于设置问答节点返回的内容是否为卡片形式。

​

​

查看智能体列表

​

2025年6月18日

​

新增接口

​

查看指定空间的智能体列表，包含草稿状态的智能体和已发布的智能体。

​

​

查看智能体配置

​

2025年6月18日

​

新增接口

​

查看指定智能体的配置信息，包括草稿状态和已发布的智能体。

​

​

查看应用列表

​

2025年6月18日

​

新增接口

​

查看指定空间的应用列表。

​

​

查看空间成员列表

​

2025年6月18日

​

新增接口

​

查看指定空间的成员列表。

​

​

批量邀请用户加入空间

​

2025年6月18日

​

新增接口

​

批量邀请用户加入空间，并设置用户是空间管理员或空间成员。

​

​

批量移除空间中的用户

​

2025年6月18日

​

新增接口

​

将用户从指定的工作空间中移除。

​

​

查看空间列表

​

2025年6月18日

​

新增参数

​

在

Query

中新增

user_id

和

coze_account_id

参数，可以查看指定用户在指定组织下加入的工作空间。

​

​

查询输出节点的执行结果

​

2025年6月18日

​

新增接口

​

根据工作流的执行 ID 以及

查询工作流异步执行结果

中返回的节点执行 uuid， 逐一查询节点每次执行的输出内容。

​

​

查询工作流异步运行结果

​

2025年6月18日

​

新增参数

​

新增

node_execute_status

参数，返回输出节点的运行情况。当输出节点的输出内容超过 1MB 时，会返回该字段。

​

​

2025年5月

​

​

API

​

发布时间

​

变更类型

​

说明

​

更新对话配置

​

2025年5月07日

​

新增参数

​

新增

data.asr_config.enable_ddc

参数，用于设置是否开启语义顺滑功能。开启后，系统在语音处理时会自动去除识别结果中的 “啊”“嗯” 等语气词，使输出文本语义更流畅。

​

新增

data.asr_config.enable_itn

参数，用于设置在语音转文本时，是否进行文本纠错。

​

新增

data.asr_config.enable_punc

参数，用于设置在语音转文本时，是否给文本加上标点符号。

​

​

2025年4月

​

​

API

​

发布时间

​

变更类型

​

说明

​

​

设置用户变量的值

​

2025年4月22日

​

新增接口

​

设置智能体或应用中的用户变量的值。

​

​

获取用户变量的值

​

2025年4月22日

​

新增接口

​

获取智能体或应用中设置的用户变量的值。

​

​

发起对话

​

2025年4月18日

​

新增参数

​

新增

parameters

参数传入自定义参数的值。如果在对话流开始节点的输入参数中设置自定义参数，调用本接口发起对话时，可以通过

parameters

参数传入对应的值等。

​

​

获取已发布智能体的配置（即将下线）

​

2025年4月17日

​

新增参数

​

新增

voice_info_list

参数，获取智能体的音色。

​

新增

background_image_info

参数，获取智能体背景的图片信息。

​

​

双向流式对话上行事件

​

2025年4月10日

​

新增参数

​

chat.update

事件新增 interrupt_config 配置，支持语音指定关键词打断能力。

​

chat.update

事件中的 asr_config 配置新增 user_language 配置，支持设置用户说话语种。

​

chat.update

事件中新增 prologue_content 自定义开场白。

​

​

双向流式对话上行事件

​

2025年4月2日

​

新增参数

​

chat.update

事件新增 asr_config 配置，支持配置热词等。

​

​

2025年3月

​

​

​

双向流式对话上行事件

​

2025年3月24日

​

新增音频编码

​

输入的音频格式支持

g711

格式。

​

​

创建会话

​

2025年3月21日

​

新增参数

​

创建会话时支持指定 bot_id，便于后续查看指定智能体的会话。

​

​

查看消息列表

​

2025年3月21日

​

新增参数

​

新增请求参数 order、chat_id、before_id、after_id 和 limit，用于筛选符合要求的消息。

​

​

清除上下文

​

2025年3月21日

​

新增 API

​

用于清除指定会话中存储的上下文消息。

​

​

查看会话列表

​

2025年3月21日

​

新增 API

​

查看用户与指定智能体的所有会话记录。

​

​

双向流式对话上行事件

​

​

2025年3月21日

​

新增事件

​

新增

input_audio_buffer.speech_started

事件，表示服务端识别到用户正在说话。

​

新增

input_audio_buffer.speech_stopped

事件，表示服务端识别到用户已停止说话。

​

​

2025年3月21日

​

新增参数

​

chat.update

事件新增

data.turn_detection

参数，用于配置对话中语音检测的相关参数，包括检测模式、检测到语音前收录的前置音频时长和持续静音时停止检测的时长。

​

新增 server_vad 能力。

​

​

2025年3月20日

​

新增参数

​

chat.update

事件新增

data.need_play_prologue

参数，用于配置是否播放开场白。

​

​

2025年3月19日

​

新增参数

​

chat.update

事件新增

data.event_subscriptions

参数，用于配置订阅下行事件。

​

​

2025年3月18日

​

新增参数

​

chat.update

事件新增

​

data.output_audio.pcm_config. frame_size_ms

参数，用于配置输出每包 pcm 音频的时长大小。

​

新增

data.output_audio.pcm_config. limit_config

参数，用于配置输出音频限流，包括周期时长和周期内最大返回的 pcm 包数量。

​

​

Realtime 上行事件

​

2025年3月18日

​

新增事件

​

新增

mode.update

事件，更新房间模式和对话设置。

​

​

Realtime 下行事件

​

2025年3月18日

​

新增事件

​

新增

mode.updated

事件，当房间模式更新成功后，返回最新的房间模式设置。

​

​

​

2025年2月

​

​

API

​

发布时间

​

变更类型

​

说明

​

​

添加发布平台

​

2025年3月3日

​

新增 API

​

为指定空间添加一个发布渠道。添加渠道后，空间中的每个开发者都可以将自己的 AI 项目发布到这些渠道中。

​

​

2025年2月

​

​

API

​

发布时间

​

变更类型

​

说明

​

​

发起对话

与消息管理相关 API

​

2025年2月20日

​

新增参数

​

以下 API 新增 reasoning_content 参数，表示 DeepSeek R1 模型的思维链。

​

​

发起对话

​

​

查看消息详情

​

​

查看消息列表

​

​

查看对话消息详情

​

​

上传文件

​

2025年2月19日

​

参数变更

​

支持上传多种文件格式，包括音频、视频、压缩文件等。

​

工作流相关 API

​

2025年2月10日

​

新增参数

​

​

执行工作流

和

​

执行工作流（流式响应）

支持使用扣子的文件 ID 作为入参。

​

语音相关 API

​

2025年2月7日

​

新增 API

​

新增

​

语音识别

，支持将语音文件转为文字。

​

​

语音合成

API 正式开放，无需申请白名单。

​

​

创建智能体

等智能体相关 API

​

2025年2月7日

​

新增参数

​

更新以下智能体相关 API，支持为智能体绑定工作流、插件和模型。

​

​

创建智能体

​

​

更新智能体

​

​

获取已发布智能体的配置（即将下线）

​

​

发起对话

​

2025年2月7日

​

新增参数

​

object_string object 支持音频内容，对话时可输入语音文件或 URL。

​

新增参数 shortcut_command，支持 API 方式执行快捷指令。

​

​

2025年1月

​

​

API

​

发布时间

​

变更类型

​

说明

​

​

更新审核结果

​

2025年1月9日

​

新增 API

​

更新智能体发布到自定义渠道的审核结果。

​

​

2024年12月

​

​

API

​

发布时间

​

变更类型

​

说明

​

​

复刻音色

等语音相关 API

​

2024年12月24日

​

新增 API

​

新增语音相关 API，用于智能语音通话场景。

​

​

复刻音色

​

​

查看音色列表

​

​

创建房间

​

​

语音合成

​

说明

体验智能语音功能之前，需要先

申请公测

。

​

​

​

创建知识库文件

​

2024年12月16日

​

新增参数

​

新增 source_file_id 参数，向图片知识库中上传文件。

​

​

创建文本知识库

等知识库 API

​

2024年12月16日

​

新增 API

​

新增知识库管理 API，包括创建知识库、查看知识库列表等。

​

​

创建文本知识库

​

​

查看知识库列表

​

​

修改知识库信息

​

​

删除知识库

​

​

查看知识库文件上传进度

​

​

更新知识库图片描述

​

​

查看知识库图片列表

​

​

执行对话流

​

2024年12月11日

​

新增 API

​

执行已发布的对话流。对话流是基于对话场景的特殊工作流，关于对话流的详细说明可参考

​

工作流与对话流

。

​

​

2024年10月

​

​

API

​

发布时间

​

变更类型

​

说明

​

​

执行工作流

​

2024年10月30日

​

新增参数

​

扣子专业版用户调用此接口时，支持通过

is_async

参数异步运行工作流，适用于工作流执行耗时较长，导致运行超时的情况。异步运行时，工作流整体超时时间限制由 3 分钟延长至 24 小时，LLM 节点由 3 分钟延长至 5 分钟。

​

​

查询工作流异步运行结果

​

2024年10月30日

​

新增 API

​

调用接口

​

执行工作流

时，如果选择异步执行工作流，响应信息中会返回 execute_id，开发者可以通过本接口查询指定事件的执行结果。

​

涉及所有 API 接口

​

2024年10月15日

​

修改 PAT 有效期

​

2024年10月16日开始，新创建的

个人访问密钥（PAT）

，有效期最长可设置为 30天。在此之前已创建的个人访问密钥有效期不受影响。

​

​

2024年9月

​

​

API

​

发布时间

​

变更类型

​

说明

​

​

查看空间列表

​

2024年9月24日

​

新增 API

​

此 API 用于查看当前账号加入的空间列表。

​

​

删除消息

​

2024年9月2日

​

新增 API

​

此 API 用于删除指定会话中的消息。

​

​

发起对话

​

2024年9月2日

​

新增参数

​

​

发起对话

接口增加请求参数 extra_params，通常用于特殊场景下指定一些必要参数供模型判断，例如指定经纬度，并询问智能体此位置的天气。

​

​

获取已发布智能体的配置（即将下线）

​

2024年9月2日

​

新增参数

​

​

获取已发布智能体的配置（即将下线）

接口增加返回参数 knowledge，查看智能体详细配置时可查看智能体绑定的知识库列表。

​

消息相关 API：

​

创建消息

、

​

查看消息列表

、

​

查看消息详情

和

​

修改消息

​

文件相关 API：

​

上传文件

、

​

查看文件详情

​

会话相关 API：

​

创建会话

、

​

查看会话信息

​

对话相关 API：

​

查看对话详情

、

​

提交工具执行结果

​

2024年9月2日

​

修改权限点

​

对于2024年9月2号之后创建的 Access Token（包括个人访问密钥 PAT 和 OAuth 2.0 密钥），调用 API 之前必须根据 API 最新的权限要求完成授权，9月1日及之前创建的 Access Token，建议在10月1日之前添加新的权限点，以免影响 API 的正常使用。各个 API 的最新权限要求，可参考 API 文档中

基础信息

部分。

​

​

2024年8月

​

​

API

​

发布时间

​

变更类型

​

说明

​

​

执行工作流（流式响应）

​

2024年8月21日

​

新增 API

​

此 API 用于执行包含流式节点的工作流，例如消息节点、结束节点等。接口响应方式为流式响应，开发者需要从流式事件中获取并拼接工作流的输出信息。

​

​

恢复运行工作流（流式响应）

​

2024年8月21日

​

新增 API

​

当执行到问答节点时，工作流会中断运行并发起询问，此时需要调用

​

恢复运行工作流（流式响应）

API 回复 Bot，并继续运行工作流。

​

​

创建智能体

​

​

更新智能体

​

​

发布智能体

​

2024年8月20日

​

新增 API

​

发布智能体管理相关接口，开发者可通过 API 方式创建 Bot、更新 Bot、发布智能体为 API 服务。

​

​

执行工作流

​

2024年8月16日

​

新增 API

​

此 API 用于执行一个已发布的工作流，接口响应方式为非流式响应。

​

​

取消进行中的对话

​

2024年8月7日

​

新增 API

​

调用

​

发起对话

接口时，如果对话触发了复杂的工作流、图像流，或模型处理数据量大时，对话可能耗时较久。对话进行中时，用户无法在此会话中发起新的对话。此时可以调用此接口取消正在进行中的对话，取消后，对话转为已取消状态（status=canceled），你可以在会话中创建新的对话。

​

​

​

上一篇

API 介绍

下一篇

准备工作
============================================================
# 准备工作
来源: https://www.coze.cn/open/docs/developer_guides/preparation
============================================================

准备工作

在调用

扣子

API  前，确保你已经将低代码智能体发布为了 API 服务，并通过不同的授权方式获取了访问令牌。

​

发布低代码智能体为 API 服务

​

低代码智能体发布为 API 服务之后，才能通过调用 API 的方式使用这个智能体，例如查看智能体的基本设置、发起一个智能体对话等。

​

操作步骤如下：

​

1.

登录

扣子编程

。

​

2.

在页面顶部空间列表中选择目标工作空间。

​

3.

在

项目开发

页面，选择低代码智能体。

​

4.

在页面右上角，单击

发布

。

​

5.

在

发布

页面，选择

API

选项，然后单击

发布

。

​

​

​

​

​

​

获取访问令牌

​

调用

扣子

API 时，你需要在 Header 中通过 Authorization 参数指定访问令牌（Access token），

扣子

服务端会根据访问令牌验证调用方的操作权限。调用 API 之前，你需要先获得访问令牌。

​

扣子

编程支持以下三种访问令牌，详细说明可参考

​

鉴权方式概述

。

​

个人访问令牌

：通过控制台生成的访问令牌，有效期一天以上，使用简单便捷，适用于测试场景。你可以随时调整令牌权限和有效期，到期后需要重新生成。

​

服务访问令牌

：通过控制台生成的访问令牌，是以服务身份创建的访问凭证，可长期有效访问扣子编程资源，通常用于服务/应用程序的身份验证和授权。SAT 与 OAuth JWT 鉴权方式相比，具有更长的有效期（可设置为永久有效），操作简单，能够有效简化授权流程。

​

OAuth 访问令牌

：通过 OAuth 2.0 授权流程生成的访问令牌，有效期为分钟级别，安全性较高，适用于线上生产环境。获取 OAuth 访问令牌的方式和流程可参考

​

OAuth 应用管理

。

​

本文档以生成个人访问令牌为例，演示获取访问令牌的方式。

​

1.

登录

扣子编程

。

​

2.

在左侧导航栏选择

API & SDK

。

​

3.

在

扣子

API

页面的顶部单击

授权

>

个人访问令牌

页签。

​

​

​

​

​

​

4.

在右上角单击

添加

。

​

5.

在

添加新的个人访问令牌

页面完成以下配置，然后单击

确定

。

​

​

配置项

​

说明

​

名称

​

个人访问令牌的名称。

​

过期时间

​

个人访问令牌的有效期时长。令牌过期后将会失效，无法继续用它来调用

扣子

API。

​

生成令牌后，无法修改过期时间。

​

权限

​

个人访问令牌的权限。

​

调用 API 时，个人访问令牌应具备对应的 API 权限，否则报错 4101。

​

访问团队空间

​

可以使用该令牌的空间。

​

说明

扣子企业版（企业标准版、企业旗舰版）

：成员可以选择本组织中，本人创建或加入的某个工作空间，或目前和将来创建或加入的所有工作空间。超级管理员和管理员可以选择本组织中所有工作空间。

​

扣子个人版

：仅支持选择你作为空间

所有者

的工作空间，或目前和将来创建的所有工作空间，不支持选择你作为成员加入的空间。

​

​

​

6.

复制并妥善保存个人访问令牌。

​

生成的令牌仅在此时展示一次，请即刻复制并保存。

​

上一篇

更新日志

下一篇

API Playground
============================================================
# API Playground
来源: https://www.coze.cn/open/docs/developer_guides/api_playground
============================================================

API Playground

API Playground 是扣子编程提供的在线 API 调试工具，集成了扣子编程所有 OpenAPI，支持可视化调试 API、查看帮助文档、示例代码，帮助开发者快速体验扣子编程 OpenAPI 的基本能力。

​

说明

API Playground

使用真实的线上数据，通过

Playground

调用创建、修改或删除数据的 API 时，请务必谨慎操作。

​

扣子付费套餐用户调用

​

发起对话

等涉及模型处理的 API 时，会产生一定的费用。关于费用的详细说明可参考

​

计费概述

。

​

​

工具介绍

​

扣子编程 API Playground 主要提供以下功能：

​

可视化调试 API

：支持在线可视化调试 API。只需根据页面提示填入必选参数，即可快速构建一个有效的 API 请求。API Playground 可以在线运行这个请求，并展示 API 的响应信息。

​

API 文档

：开发者可以在  API Playground 中快速查看 API 文档，文档中可视化展示 API 接口说明、请求参数说明，便于开发者理解参数结构。

​

示例代码

：扣子编程支持 Python、JavaScript 等多种主流开发语言的 SDK，可简单便捷地调用扣子编程 OpenAPI。对于

​

发起对话

和工作流相关 API，扣子编程提供多语言 SDK 示例代码供开发者参考，提高编程效率。

​

模块介绍

​

API Playground 工具的各个模块如下：

​

​

​

​

​

​

各区域说明如下：

​

​

编号

​

区域

​

说明

​

①

​

OpenAPI 列表

​

扣子编程 OpenAPI 列表。

​

单击 OpenAPI 名称，可直接跳转到对应的调试页面。

​

②

​

OpenAPI 基本信息

​

指定 OpenAPI 的基本信息，包括 OpenAPI 名称、请求方式、接口说明及注意事项。

​

③

​

请求参数

​

展示此 API 的请求参数，其中标记星号（

*

）的参数为必选参数。具体的参数说明可以单击

展开全部

来查看。

​

其中，token 是必填的 Header 请求参数。测试或调试场景下，可以使用个人访问令牌快速发起一个 API 请求，详细说明可参考

​

添加个人访问令牌

；正式线上环境建议使用 OAuth 鉴权方式，详细说明可参考

​

OAuth 应用管理

。

​

​

返回参数

​

展示此 API 的返回参数。具体的参数说明可以单击

展开

按钮来查看。

​

​

运行记录

​

展示所在套餐的版本内，最近 7 天近 5 条的 Playground 运行记录。

​

④

​

示例代码

​

OpenAPI 对应的示例代码。

​

填写参数后，单击

运行

。扣子编程对你填写的 token 进行鉴权后，会向该接口发起一个真实的线上请求，同时展示请求结构、响应内容等相关信息。

​

对于

​

发起对话

和工作流相关接口，你还可以查看和复制各种语言版本下的示例代码，快速接入更语言的 SDK。

​

​

探索 API Playground

​

说明

执行以下操作前，请确认你已获取了一个生效中的访问令牌。

API Playground 支持

个人访问令牌或 OAuth Token。

​

​

1.

登录

API Playground

。

​

2.

在左侧 OpenAPI 列表中，选择需要调用的 OpenAPI。

​

说明

API 目录树默认为隐藏状态，当鼠标悬停在左侧导航栏与 Playground 页面的接缝处时，会自动显示 API 目录树。

​

若需固定显示 API 目录树，单击目录右侧的

固定

，将其固定在 Playground 页面的左侧。

​

​

​

​

​

​

​

3.

在请求参数区域填写必选的请求参数。

​

​

​

​

​

​

4.

在右侧示例代码区域，单击

运行

。

​

​

​

​

​

​

5.

在页面右下角查看返回结果。

​

​

​

​

​

​

体验 SDK

​

你可以在 Playground 中体验 Chat SDK、Web SDK、Real-time Chat SDK 的能力。本文以 Chat SDK 为例，介绍具体的操作步骤。Real-time Chat SDK的详细步骤和参数说明请参见

​

体验智能音视频 Demo

。

​

1.

登录

API Playground

。

​

2.

在左侧导航栏中选择

SDK

>

Chat SDK

。

​

3.

在

请求配置

或

代码编辑区

配置相关参数，详细的参数说明请参见

​

安装并使用 Chat SDK

，单击

运行

。单击右下角的悬浮球。

​

​

​

​

​

​

4.

在聊天窗口中体验智能体或扣子应用的功能。

​

​

​

​

​

​

常见问题

​

API Playground

是否收费？

​

API Playground 免收 Playground 的功能使用费。但是如果账号调用了涉及模型处理的 API，则会产生费用。例如用户通过 API Playground 调用

​

发起对话

API，会收取智能体调用次数的费用、火山方舟 Token 的费用。关于费用的详细说明可参考

​

计费概述

。

​

API Playground 免收 Playground 的功能使用费。但是如果你调用了涉及模型处理或收费插件的 API，则会消耗 Coze 账号中的 Coze Token。关于费用的详细说明可参考

​

计费概述

。

​

为什么看不到 Python 等语言的示例代码？

​

目前仅以下接口支持查看 Python 等场景开发语言的示例代码。

​

​

发起对话

​

​

执行工作流

​

​

执行工作流（流式响应）

​

对于

​

发起对话

接口，API Playground 提供流式响应、非流式响应、涉及端插件的响应等多种场景的示例代码供开发者参考和复制。

​

中国大陆以外的地区可以访问扣子 API 吗

​

api.coze.cn

是扣子编程 OpenAPI 的统一访问域名，支持全球各个地区访问，在中国大陆以外的国家或者地区访问

api.coze.cn

的时候，扣子编程会提供一条高速通道，将这些用户的请求快速回源到中国大陆服务器。

​

目前支持将请求快速回源到中国大陆的国家或者地区有：美国、新加坡、香港。

​

上一篇

准备工作

下一篇

鉴权方式概述
============================================================
# 鉴权方式概述
来源: https://www.coze.cn/open/docs/developer_guides/authentication
============================================================

鉴权方式概述

扣子编程 API 通过访问令牌进行 API 请求的鉴权。

​

鉴权方式

​

扣子编程 API 通过访问令牌（Access Token）进行 API 请求的鉴权。所有的 API 请求都必须在请求头的

Authorization

参数中包含你的访问令牌（Access Token）。

​

​

Shell

复制

Authorization: Bearer

$Access_Token

​

​

其中，

$Access_Token

分为以下三种：

​

​

鉴权方式

​

说明

​

个人访问令牌

​

Personal Access Token，简称 PAT。扣子编程中生成的个人访问令牌。每个令牌可以关联多个空间，并开通指定的接口权限。生成方式可参考

​

添加个人访问令牌

。

​

注意

虽然 PAT 生成和使用便捷，但其本质上是一种预授权的明文令牌。如果保管不当，极易导致令牌泄露，进而被黑灰产盗用，引发安全风险。

​

建议仅在测试环境、调试场景中使用 PAT，并严格限制其使用范围和有效期。

​

在生产环境中应谨慎使用 PAT，优先考虑更安全的认证方式 OAuth。

​

​

服务访问令牌

​

Service Access Token（简称 SAT）是以服务身份创建的访问凭证，可长期有效访问扣子编程资源，通常用于服务/应用程序的身份验证和授权。SAT 与 OAuth JWT 鉴权方式相比，具有更长的有效期（可设置为永久有效），操作简单，能够有效简化授权流程。

​

OAuth 访问令牌

​

OAuth Access Token，通过

OAuth 2.0

鉴权方式生成的 OAuth 访问令牌。该鉴权方式通常用于应用程序的身份验证和授权，和 PAT 鉴权方式相比，令牌有效期短，安全性更高，适用于线上生产环境。

​

扣子编程目前支持

授权码（Authorization Code Grant）、JWT

模式（JSON Web Tokens）

等多种 OAuth 授权类型，详细说明请参见下文中的

​

OAuth 授权方式说明

。

​

​

你可以参考下图选择合适的鉴权方式。

​

​

​

​

​

​

OAuth 授权方式说明

​

扣子

编程

API 支持以下 OAuth 2.0 授权方式，提供标准的 OAuth 2.0 鉴权流程与方案，精细化的鉴权策略，便于开发者和渠道快速接入。OAuth 授权适用于应用程序以 API 方式集成

扣子

编程

的某些功能，应用程序以

扣子

用户的身份调用

扣子

编程

API。

​

​

授权方式

​

适用场景

​

应用设置

​

参考文档

​

授权码授权

​

（Authorization Code Flow）

​

有显著前后端之分的应用程序授权场景。前端模块负责与用户交互，后端服务处理前端请求，与

扣子

授权服务器和 OpenAPI 交互。

​

应用类型：

普通

​

客户端类型：

Web 后端应用

​

​

OAuth 授权码授权

​

​

OAuth 授权（多人协作场景）

​

PKCE 授权

​

（Authorization Code Flow with PKCE）

​

无后端服务的应用程序，所有操作发生在应用程序的前端。

​

应用类型：

普通

​

客户端类型：

移动端/PC 桌面端/单页面应用

​

​

OAuth PKCE

​

​

OAuth 授权（多人协作场景）

​

设备码授权

​

（Device Code Flow）

​

应用程序无后端服务，所有操作都发生在应用程序的 Command Line，且 Command Line 无法提供“同意授权”的操作。

​

应用类型：

普通

​

客户端类型：

TV端/设备应用/类命令行程序

​

​

OAuth 设备授权

​

​

OAuth 授权（多人协作场景）

​

JWT 授权

​

（JWT Flow）

​

应用程序服务端直接调用 Coze OpenAPI。

​

应用类型：

普通

​

客户端类型：

服务类应用

​

​

OAuth JWT 授权（开发者）

​

​

第三方渠道中的应用程序后端服务代理其终端用户获取访问令牌，终端用户基于访问令牌直接访问扣子编程 OpenAPI。

​

应用类型：

渠道

​

客户端类型：

服务类应用

​

​

OAuth JWT 授权（渠道场景）

​

​

应用程序服务端获取企业级资源的访问令牌，统筹管理企业成员、账单、组织和工作空间。

​

应用类型：企业特权应用

​

客户端类型：

服务类应用

​

​

OAuth JWT 授权（企业特权应用）

​

​

说明

在

扣子

编程中，所有 OAuth 应用的相关操作，均可能存在数秒的延迟，这是由于系统设计为保证高可用和高性能引入的缓存机制导致，如果您发现操作未生效，请等待一段期间后重试。

​

​

鉴权示例代码

​

扣子编程提供了多语言的鉴权示例代码，包括个人访问令牌（PAT）和 OAuth 认证等多种鉴权方式，鉴权示例代码的地址如下表所示。您可以根据具体需求选择合适的示例代码，实现不同鉴权方式的集成。

​

​

授权方式

​

Python

​

Node.js

​

Java

​

Go

​

个人访问令牌

​

examples/

auth_pat.py

​

auth/auth-pat.ts

​

TokenAuthExample.java

​

pat_example.go

​

OAuth 授权码

​

examples/

auth_oauth_web.py

​

auth/auth-oauth-web.ts

​

WebOAuthExample.java

​

web_oauth_example.go

​

OAuth JWT

​

examples/

auth_oauth_jwt.py

​

auth/auth-oauth-jwt.ts

​

auth/auth-oauth-jwt-channel.ts

​

JWTsOauthExample.java

​

jwt_example.go

​

OAuth PKCE

​

examples/

auth_oauth_pkce.py

​

auth/auth-oauth-pkce.ts

​

PKCEOauthExample.java

​

pkce_example.go

​

OAuth 设备码

​

examples/

auth_oauth_device.py

​

auth/auth-oauth-device.ts

​

DeviceOAuthExample.java

​

device_example.go

​

​

你也可以在

OAuth 应用

页面下载对应鉴权方式的示例代码。

​

​

​

​

​

​

角色与权限说明

​

不同扣子套餐支持的鉴权方式，以及各角色的操作权限如下表所示。✔️ 表示具备权限，- 表示没有权限。

​

​

​

鉴权方式

​

个人版

​

企业版

​

（企业标准版、企业旗舰版）

​

​

​

​

超级管理员、管理员

​

员工

​

个人访问令牌（PAT）

​

✔️

​

✔️

​

✔️

​

服务访问令牌（SAT）

​

✔️

​

✔️

​

-

​

OAuth 授权码授权

​

✔️

​

✔️

​

-

​

OAuth PKCE

​

✔️

​

✔️

​

-

​

OAuth 设备授权

​

✔️

​

✔️

​

-

​

OAuth 授权（多人协作）

​

-

​

✔️

​

-

​

OAuth JWT 授权（开发者）

​

✔️

​

✔️

​

-

​

OAuth JWT 授权（渠道）

​

✔️

​

✔️

​

-

​

OAuth JWT 授权（企业特权应用）

​

-

​

✔️

​

-

​

​

说明

扣子企业版中的成员不支持创建组织级别的 OAuth 应用，仅超级管理员和管理员支持创建组织级别的 OAuth 应用。成员只支持创建个人版的 OAuth 应用。

​

​

权限层级

​

扣子编程资源的权限点分为三个层级，各层级对应不同的生效范围，你可以在权限点右侧查看该权限点对应的层级。

​

权限层级查看入口

​

​

​

​

​

​

权限层级示意图

​

​

​

​

​

​

​

​

企业级别

：权限点的生效范围为整个企业，例如查询企业下的

账单文件、管理设备的权益额度等

。仅企业的超级管理员和管理员能被授权该级别的权限，扣子个人账号或企业中的员工不支持授权企业层级的权限点。

​

账号级别

：权限点的生效范围为当前账号

。用户可通过

Access Token 管理账号下的会话、文件、音色等资源，例如查询当前账号下的所有会话。

​

工作空间级别

：权限点的生效范围为你创建或加入的工作空间，授权时需要设置该 Access Token 可访问的工作空间，以便管理该工作空间中的

智能体、工作流、应用等资源，例如在工作空间中创建智能体。

​

​

​

上一篇

API Playground

下一篇

添加个人访问令牌
============================================================
# 添加个人访问令牌
来源: https://www.coze.cn/open/docs/developer_guides/pat
============================================================

添加个人访问令牌

个人访问令牌是

扣子

编程提供的短效令牌，用于 API 请求鉴权。你可以在

扣子

编程中生成个人访问令牌，并为其授予本人拥有的指定空间、指定操作的权限。通过此令牌可以对空间中的资源进行某些已授权的操作，例如与空间中所有智能体进行对话，或编辑空间中的所有知识库。

​

注意

虽然 PAT 生成和使用便捷，但其本质上是一种预授权的明文令牌。如果保管不当，极易导致令牌泄露，进而被黑灰产盗用，引发安全风险。因此，建议仅在测试环境、调试场景中使用 PAT，并严格限制其使用范围和有效期。在生产环境中请勿使用 PAT，选择更安全的认证方式 OAuth。

​

​

说明

不要与他人共享你的个人访问令牌，也不要在浏览器或其他客户端代码中暴露个人访问令牌信息。

​

个人访问令牌有效期可设置为 1~30 天，生成后不支持修改过期时间，过期后应重新申请。

​

创建个人访问令牌之后，转移空间所有权会导致该空间已申请的个人访问令牌失效，请慎重转移所有权。

​

​

使用限制

​

扣子个人版中，每个用户最多创建 10 个个人访问令牌。

​

扣子企业版（企业标准版、企业旗舰版）中，一个企业下最多创建 1000 个个人访问令牌，每个用户最多创建 20 个个人访问令牌。

​

操作步骤

​

生成个人访问令牌的操作步骤如下：

​

1.

登录

扣子编程

。

​

2.

在左侧导航栏选择

API & SDK。

​

3.

在顶部单击

授权

页签，单击

个人访问令牌

页签。

​

4.

在右上角单击

添加

。在

添加新的个人访问

令牌页面完成以下配置，然后单击

确定

。

​

​

配置项

​

说明

​

名称

​

个人访问令牌的名称。

​

过期时间

​

个人访问令牌的有效期时长。令牌过期后将会失效，无法继续用它来调用

扣子

API。

​

生成令牌后，无法修改过期时间。

​

权限

​

个人访问令牌的权限。不同层级权限的生效范围请参见

​

权限层级

。

​

调用 API 时，个人访问令牌应具备对应的 API 权限，否则报错 4101。

​

访问工作空间

​

可以使用该令牌的空间。

​

说明

扣子企业版：成员可以选择本组织中，本人创建或加入的某个工作空间，或目前和将来创建或加入的所有工作空间。超级管理员和管理员可以选择本组织中所有工作空间。

​

扣子个人版：仅支持选择你作为空间

所有者

的工作空间。

​

​

​

5.

复制并妥善保存个人访问令牌。

​

生成的令牌仅在此时展示一次，请即刻复制并保存。

​

常见问题

​

可以通过个人访问令牌调用其他人的智能体吗？

​

在扣子企业版中，如果你已加入某个智能体所在的空间，申请个人访问令牌时可以选择该空间。

此令牌能与该空间下所有智能体进行会话消息等读操作，但无法编辑其他人的智能体，只有智能体的所有者和协作者能编辑智能体。

​

在

扣子个人版中

，如果其他人的智能体位于你拥有的工作空间中，申请个人访问令牌时可以选择该工作空间，此令牌将拥有该空间下所有智能体的操作权限。如果智能体或知识库等资源位于其他人拥有的工作空间中，你创建的个人访问令牌无法调用这些资源，建议将该工作空间的所有权转移至你名下，然后由你重新申请访问令牌。

​

为什么创建个人访问令牌时无法选择我加入的空间？

​

在扣子企业版中，创建个人令牌时可以选择在该企业下，你加入的空间。

​

在扣子

个人版中，仅

空间的所有者可以为该空间创建个人访问令牌。如果你是空间的成员但不是所有者，则无法为该空间创建访问令牌，所以无法选择该空间。

​

个人访问令牌的有效期可以设置为永久吗？

​

不可以。

​

根据扣子编程的安全策略，个人访问令牌的有效期最长可设置为 30 天，不能设置为永久有效。这一限制是为了增强安全性，确保即使令牌泄露也只能在有限的时间内被滥用。过期后，你需要重新生成新的令牌以继续使用相关 API 功能。

​

上一篇

鉴权方式概述

下一篇

添加服务访问令牌
============================================================
# 添加服务访问令牌
来源: https://www.coze.cn/open/docs/developer_guides/service_token
============================================================

添加服务访问令牌

本文介绍如何在扣子编程创建服务访问令牌。

​

功能简介

​

服务访问令牌（Service Access Token，简称 SAT）是以服务身份创建的长效令牌，用于服务/应用程序的身份验证和授权。服务访问令牌的有效期可设置为永久，适合需要长期稳定身份验证的场景，例如企业应用集成和服务间 API 调用。

​

你可以在

扣子

编程中生成服务访问令牌，并为其授予指定空间、指定操作的权限。通过服务访问令牌，服务或应用程序可以对授权空间中的资源执行一系列操作，例如与空间中的所有智能体进行对话，或编辑空间中的所有知识库。

​

说明

不要与他人共享你的服务访问令牌，也不要在浏览器或其他客户端代码中暴露服务访问令牌信息。

​

扣子个人版中，创建服务访问令牌之后，转移空间所有权会导致该空间已申请的服务访问令牌失效，请慎重转移所有权。

​

​

使

用限制

​

扣子企业版（企业标准版、企业旗舰版）中，仅企业的

超级

管理员和管理员支持创建服务访问令牌。

​

一个企业下最多创建 100 个服务访问令牌。

​

扣子个人版中，每个用户最多创建 10 个服务访问令牌。

​

操作步骤

​

生成服务访问令牌的操作步骤如下：

​

1.

（可选）在

扣子编程

左下角单击个人头像，切换到企业版。

​

仅扣子企业版需要执行该操作。

​

​

​

​

​

​

3.

在左侧导航栏选择

API & SDK。

​

4.

在顶部单击

授权

页签，单击

服务身份凭证

页签。

​

​

​

​

​

​

5.

在右上角单击

添加

，配置名称、过期时间、权限、访问工作空间等参数，单击

确定

。

​

​

​

​

​

​

​

配置项

​

说明

​

名称

​

服务访问令牌的名称。

​

过期时间

​

服务访问令牌的有效期时长。支持设置为 1 天、30 天、 90 天、180 天、长期有效或自定义。

​

令牌过期后将会失效，无法继续用它来调用

扣子

API。

​

生成令牌后，你可以编辑并修改过期时间。

​

权限

​

服务访问令牌的权限。不同层级权限的生效范围请参见

​

权限层级

。

​

调用 API 时，服务访问令牌应具备对应的 API 权限，否则报错 4101。

​

访问工作空间

​

可以使用该令牌的工作空间，你可以根据需要选择其中一种：

​

说明

扣子个人版：仅支持选择你作为

空间所有者

的工作空间，或目前和将来创建的所有工作空间，不支持选择你作为成员加入的空间。

​

扣子企业版：超级管理员和管理员可以选择企业中，本人创建或加入的指定工作空间，或目前和将来创建的所有工作空间。

​

​

​

6.

复制并妥善保存服务访问令牌。

​

生成的令牌仅在此时展示一次，

请即刻复制并保存。

​

​

​

​

​

​

常见问题

​

切换为服务访问令牌后，对线上业务有影响吗？

​

如果之前使用个人访问令牌或普通 JWT 访问令牌，切换为服务访问令牌后，对线上业务的影响如下：

​

扣子企业版用户

：切换后对线上业务无影响，之前已创建的会话仍能正常访问。但如果之前使用 JWT 实现了会话隔离，切换为服务访问令牌后，会话隔离功能将失效，因为服务访问令牌不支持会话隔离功能。

​

从个人版升级到企业版

：原个人账号下的会话将无法访问，且不支持通过

个人账号资源授权

，授予企业账号的访问令牌访问原个人账号中的会话等资源。

​

可以通过服务访问令牌调用其他人的智能体吗？

​

在扣子个人版中，如果其他人的智能体位于你拥有的工作空间中，申请服务访问令牌时可以选择该工作空间，此令牌将拥有该空间下所有智能体的操作权限。如果智能体或知识库等资源位于其他人拥有的工作空间中，你创建的服务访问令牌无法调用这些资源，建议将该工作空间的所有权转移至你名下，然后由你重新申请访问令牌。

​

在扣子企业版中，如果你已加入某个智能体所在的空间，申请服务访问令牌时可以选择该空间。此令牌能与该空间下所有智能体进行会话消息等读操作，但无法编辑其他人的智能体，只有智能体的所有者和协作者能编辑智能体。

​

为什么创建服务访问令牌时无法选择我加入的空间？

​

在扣子个人版中，仅空间的所有者可以为该空间创建服务访问令牌。如果你是空间的成员但不是所有者，则无法为该空间创建服务访问令牌，所以无法选择该空间。

​

在扣子企业版中，创建服务令牌时可以选择在该企业下，你加入的空间。

​

​

上一篇

添加个人访问令牌

下一篇

OAuth 应用管理
============================================================
# OAuth 应用管理
来源: https://www.coze.cn/open/docs/developer_guides/oauth_apps
============================================================

OAuth 应用管理

本文介绍如何管理 OAuth 应用，包括安装、卸载、启用、禁用、编辑和删除 OAuth 应用等。

​

说明

角色限制

：在扣子企业版（企业标准版、企业旗舰版）中，仅

超级管理员

和

管理员

有权限管理 OAuth 应用，包括创建、编辑、删除、启用、禁用、安装和卸载 OAuth 应用，以及对应用进行授权操作。

​

数量限制

：扣子个人版中，每个用户最多创建 10 个 OAuth 应用。扣子企业版中，一个企业下最多创建 100 个 OAuth 应用。

​

​

基本概念

​

AppAuth 授权：应用以自身身份去访问扣子编程的资源。例如，一个后端服务需要从扣子编程获取数据。

​

OBO 授权: 应用以用户的身份去访问扣子编程的资源。例如，在跨企业协作场景中，外部应用需要访问本企业的资源时，OBO 应用可以确保这些操作是以用户身份进行的，保护企业数据的安全。

​

不同的扣子 OAuth 授权对应的授权类型和适用的客户端类型如下表所示。

​

​

授权类型

​

授权方式

​

客户端类型

​

OBO 授权

​

​

OAuth 授权码授权

​

Web 后端应用

​

OBO 授权

​

​

OAuth PKCE

​

移动端/PC 桌面端/单页面应用

​

OBO 授权

​

​

OAuth 设备授权

​

TV端/设备应用/类命令行程序

​

AppAuth 授权

​

​

OAuth JWT 授权（开发者）

​

服务类应用

​

​

安装和卸载应用

​

以下操作仅适用于扣子企业版，

且只企业超级管理员和管理员有权限安装和卸载应用。

​

在

应用安装管理

页面，你可以查看企业下已安装的应用，并处理 OBO 应用的安装申请。

​

注意

卸载应用后，将删除 OAuth 应用当前正在使用的所有访问令牌。此操作会导致应用程序无法正常访问

扣子

API，请谨慎操作。

​

​

1.

登录

扣子编程

。

​

2.

在左侧导航栏选择

API & SDK。

​

3.

在顶部单击

授权

页签 ，单击

应用安装管理

页签。

​

​

​

​

​

​

4.

在

应用安装管理

页面，超级管理员可以查看已安装的应用，安装状态说明如下：

​

已安装 AppAuth

：表示该 OAuth 应用已创建并完成授权。

​

已安装 OBO

：表示该 OAuth 应用已完成授权，且已获得访问本企业资源的权限。

​

未安装 OBO

：用户已发起 OAuth 应用的安装申请，但超级管理员尚未同意安装。

​

说明

在应用安装管理页面展示的应用包括：

​

已完成 OAuth 授权的服务类应用。

​

曾获取过访问令牌的 OBO 应用，包括 Web 后端应用、TV端/设备应用/类命令行程序、移动端/PC 桌面端/单页面应用。

​

​

5.

安装和卸载应用。

​

对于未安装的 OBO 应用，超级管理员可以单击

操作

列中的

安装

，授权 OAuth 应用。

​

对于已安装的应用，超级管理员单击

操作

列中的

卸载

，可以取消 OAuth 应用的授权。

​

卸载的应用将不在

应用安装管理

页面展示。

​

查看已授权的应用

​

以下操作仅适用于扣子个人版。

​

在

已授权的应用

页签下，可查看已授权的应用列表。

​

说明

对于后端应用，此处展示已完成 OAuth 授权的应用列表。

​

对于 Web 应用，此处展示曾获取过访问令牌的应用列表。

​

​

撤销应用授权

​

以下操作仅适用于扣子个人版。

​

在

已授权的应用

页签下，单击

撤销授权

，可以删除此应用的访问令牌。

​

说明

撤销授权将删除 OAuth 应用当前正在使用的所有访问令牌。此操作导致应用程序无法正常访问

扣子

API，请谨慎使用此功能。

​

​

​

​

​

​

​

启用或禁用 OAuth 应用

​

创建 OAuth 应用后，此应用默认为启用状态。禁用应用操作将暂时禁用当前应用所有的访问令牌，您的应用在禁用期间将无法正常访问扣子 API。重新启用应用后，访问令牌将恢复扣子 API 的访问权限。

​

​

​

​

​

​

编辑应用

​

你可以在

授权

>

OAuth 应用

页面中找到待编辑的应用，并在

操作

列单击修改图标，修改已创建的 OAuth 应用。暂不支持修改应用类型。

​

​

​

​

​

​

删除应用

​

如果某个应用后续不再使用，你可以删除应用。注意，删除应用后，数据将无法恢复，请谨慎操作。

​

1.

在

授权

>

OAuth 应用

页面的应用列表中找到目标应用。

​

2.

在

操作

列单击删除，删除 OAuth 应用。

​

删除 OAuth 应用会同时撤销所有相关的授权。

​

​

​

​

​

​

​

上一篇

添加服务访问令牌

下一篇

通过示例文件体验 OAuth 授权流程
============================================================
# 通过示例文件体验 OAuth 授权流程
来源: https://www.coze.cn/open/docs/developer_guides/ouath_demo
============================================================

通过示例文件体验 OAuth 授权流程

扣子编程提供 OAuth 配置的示例文件，帮助开发者在测试验证阶段快速了解和体验 OAuth Token 的生成与授权流程。示例文件中包括客户端私钥等 OAuth 应用的配置信息，并提供 Python、

JavaScript

、Go 和 Java 四种语言类型的启动脚本，此外还附上了扣子编程 OpenAPI 的请求示例，开发者运行脚本并获取 OAuth Token 后即可成功发起 OpenAPI 请求。

​

扣子编程支持的所有 OAuth 授权方式均提供示例文件以供体验。本文档以 Python 语言、授权码授权方式为例，演示下载示例文件并运行脚本获取 OAuth Token 的完整过程。

​

说明

此方式仅用于测试验证阶段快速了解和体验 OAuth 授权流程，为了安全起见，获取的 OAuth Token 不建议应用在线上生产环境。线上环境可使用扣子编程提供的各种语言 SDK，参考各个 SDK 的鉴权示例，详细说明可参考

​

示例代码

。

​

OAuth Token 存在有效期限制，你可以根据页面提示刷新 Token。

​

​

步骤一：下载示例文件

​

在扣子编程中找到 OAuth 应用，并下载目标语言的配置示例文件。操作步骤如下：

​

1.

登录

扣子编程

。

​

2.

在左侧导航栏选择

API 管理

，在顶部选择

授权

>

OAuth 应用

页面。

​

3.

找到目标 OAuth 应用，并在其对应的

操作

列单击下载图标。

​

授权码授权方式对应的客户端类型为 Web 后端应用。

​

​

​

​

​

​

4.

预览配置信息，并选择配置语言。

​

预览 client_id 等配置信息，确认无误后选择配置语言。扣子编程提供 Python、

JavaScript

、Go 和 Java 四种语言类型的示例文件，此处我们选择默认的 Python。

​

5.

单击

下载

。

​

​

​

​

​

​

步骤二：本地运行脚本

​

本地运行脚本后，通过浏览器访问本地地址，即可根据页面提示获取 OAuth Token。

​

说明

运行脚本之前，应确认本地已安装了对应开发语言的运行环境。各个语言的版本要求如下：

​

Python：3.7 及后续版本。

​

JavaScript

： Node 14 及后续版本。

​

Go：1.18 及后续版本。

​

Java：Java 8、Java 11 或 Java 17。

​

请确保本地主机的 8080 端口未被占用。

​

​

1.

解压缩示例文件到本地目录。

​

2.

在解压缩后的目录下执行命令，运行启动脚本。

​

Linux 或 macOS：

​

​

Bash

复制

bash bootstrap.sh

​

​

Windows：

​

​

Bash

复制

.\bootstrap.ps1

​

​

3.

浏览器访问本地主机的

8080 端口

http://127.0.0.1:8080

。

​

​

​

​

​

​

4.

根据页面提示完成授权流程、查看或复制 OAuth Token。

​

注意

此示例项目仅用于体验授权流程，生成的 Token 虽然是一个真实有效的 OAuth Token，可以在 API Playground 中在线调试 OpenAPI，但不建议用于线上生产环境。

​

OAuth Token 存在有效期限制，使用前需要注意过期时间。

​

​

​

​

​

​

​

步骤三：发起 OpenAPI 请求

​

授权成功后，后端会根据这个 Token 调用一个显示授权用户基本信息的 API。如果 API 请求成功，授权示例页面会显示 Authorization Successful，顶部会同时显示授权用户的基本信息，包括用户 ID、昵称等。

​

​

​

​

​

​

JWT

授权方式下，授权示例页面不会自动调用这个示例 API，只会展示生成的 Token。如需验证 Token 有效性，你可以复制 OAuth Token 之后，前往

API Playground

，通过这个 Token 快速发起一个扣子 OpenAPI 请求。

​

在 API Playground 中找到要调用的 API，在 Header 区域填写 OAuth Token ，并在右侧的 Shell 区域单击

运行

，即可发起一个 OpenAPI 请求。

​

说明

需要注意的是，这个 OAuth Token 必须已被授予对应 OpenAPI 的权限，否则 Playground 调试时会报错 Token 无权限。你需要在下载示例文件之前在 OAuth 应用中选择正确的权限。

​

通过示例项目生成的 Token 均可在 API Playground 中使用。

​

​

​

​

​

​

​

​

上一篇

OAuth 应用管理

下一篇

OAuth 授权码授权
============================================================
# OAuth 授权码授权
来源: https://www.coze.cn/open/docs/developer_guides/oauth_code
============================================================

OAuth 授权码授权

扣子编程支持应用程序通过 OAuth 授权码授权（Authorization Code Grant）的方式调用扣子编程 API。用户通过浏览器访问包含扣子编程功能的 Web 应用程序时，Web 应用程序重定向用户到扣子编程服务端以获取授权码（code），然后使用授权码向扣子编程服务端交换访问令牌。例如 Web 应用程序通过扣子编程 API 封装了扣子编程的查看 Bot 的详细信息和指定 Bot 对话等功能，用户使用这些功能之前，需要经由扣子编程服务端鉴权。

​

说明

通过 OAuth 授权码方式授权时，应用程序需要拥有可通过 Web 访问的前端页面，否则无法实现重定向等一系列授权流程；同时应有稳定的后端架构，可处理前端请求、安全存储客户端密钥（Client Secret），与 OAuth 授权服务器和 OpenAPI 交互。

​

​

授权流程

​

Web 应用程序授权流程如下图所示。

​

​

​

​

​

​

具体流程说明如下：

​

1.

在扣子编程创建 OAuth 应用。

​

2.

应用程序调用 API

​

获取授权页面 URL

和

​

获取 OAuth Access Token

，获取 OAuth 访问令牌。

​

3.

应用程序根据访问令牌调用扣子编程 API。

​

详细步骤如下：

​

1 创建 OAuth 应用

​

说明

在扣子企业版（企业标准版、企业旗舰版）中，仅

超级管理员

和

管理员

有权

限创建、编辑、

删除 OAuth 应用，以及对应用进行授权操作。

​

​

1.

登录

扣子编程

。

​

2.

在左侧导航栏选择

API & SDK。

​

3.

在顶部单击

授权

>

OAuth 应用

页签。

​

4.

在 OAuth 应用页面右上角单击

创建新应用

，填写应用的基本信息。

​

​

配置

​

说明

​

应用类型

​

应用的类型，此处设置为

普通

。

​

客户端类型

​

客户端类型，此处设置为

Web 后端应用

。

​

应用名称

​

应用的名称，在扣子编程中全局唯一。

​

描述

​

应用的基本描述信息。

​

​

5.

填写 App 的配置信息。

​

​

配置

​

说明

​

权限

​

应用程序调用扣子 API 时需要的权限范围。

​

说明

此处配置旨在于划定应用的权限范围，并未完成授权操作。创建 Oauth 应用后还需要参考后续操作完成授权。

​

​

重定向 URL

​

重定向的 URL 地址。用户完成授权后，扣子编程的授权服务器将通过重定向 URL 返回授权相关的凭据。最多可添加 3 个不同的 URL 地址。

​

重定向 URL 仅支持 HTTP 和 HTTPs。为了保证数据传输安全，请勿在生产环境使用HTTP 协议地址。

​

对于测试场景，您可以指定引用本地机器的 URL，例如

http://localhost:8080

。

​

客户端 ID 和客户端密钥

​

​

客户端 ID 和客户端密钥均由扣子编程自动生成并配置。单击生成客户端密钥，并复制系统自动生成的客户端密钥。

​

客户端 ID：即 client id，是应用程序的公共标识符。

​

客户端密钥：即 client secret，仅应用程序和授权服务器有权访问的密钥。用于获取已登录用户的访问令牌。

​

说明

此客户端密钥仅显示一次。请将其保存到安全且易于访问的地方。不要与他人分享，或在其他环境中暴露。

​

支持生成多个客户端密钥，当您发现密钥泄露时，可以通过此方法进行密钥轮转。

​

扣子编程在任何时候都不会存储您的客户端密钥，扣子服务端仅存储符合行业规范的密钥摘要值。

​

​

​

6.

单击

确定

，完成配置。

​

2 获取访问令牌

​

1.

终端用户在 Web 应用程序中触发授权操作，例如点击和 Bot 对话的按钮。该动作对应扣子发起对话 API，应用程序需要获得扣子账号的授权。

​

2.

Web 应用程序重定向用户到授权服务器以获取 code。

​

应用程序通过302重定向方式发起

​

获取授权页面 URL

API 请求。

​

请求中携带 OAuth 应用的客户端 ID 和客户端密钥 、重定向 URL 等信息。请求示例如下：

​

​

Response Header 中的 location 字段中为跳转链接。例如

https://www.coze.cn/oauth/consent?authorize_key=JacVeqTW93ps5m5N9n349bEBgIsWrnNp

。浏览器跳转到此 URL，引导用户完成扣子账号授权。授权页面示例如下：

​

​

​

​

​

​

​

3.

扣子服务端会在 API 的响应中返回 code。

​

从重定向的 URL 地址中获取 code，例如本示例中 code 为

code_WZmPRDcjJhfwHD****

。

​

​

4.

使用授权码交换访问令牌。

​

应用程序向扣子服务端发起

​

获取 OAuth Access Token

请求，请求中携带 code，扣子服务端会在 API 的响应中返回 access_token 和 refresh_token。其中：

​

access_token 即访问令牌，用于发起扣子 API 请求时鉴权，有效期为 15 分钟。

​

refresh_token 用于刷新 access_token，有效期为 30 天。refresh_token 到期前可以多次调用

​

刷新 OAuth Access Token

接口获取新的 refresh_token 和 access_token。

​

接口示例如下：

​

​

3 发起扣子 API 请求

​

在 API 请求头中通过

Authorization=Bearer

$Access_Token

指定访问令牌，发起扣子 API 请求。每个接口对应的权限点不同。

​

以

​

获取已发布智能体的配置（即将下线）

API 为例，完整的 API 请求如下：

​

​

获取授权页面 URL

​

Web

应用程序可调用此 API 获取 OAuth 授权页面 URL 地址。

​

基础信息

​

​

​

Path 参数

​

​

Query

​

​

返回结果

​

返回结果的 Http code 为 302，且 Response Header 中的 location 字段中为跳转链接。例如

https://www.coze.cn/oauth/consent?authorize_key=JacVeqTW93ps5m5N9n349bEBgIsWrn****

。浏览器跳转到此 URL，引导用户完成 Coze 账号授权。

​

示例

​

请求示例

​

​

返回示例

​

​

获取 OAuth Access Token

​

通过授权码（OAuth code）获取 OAuth Access Token。

​

基础信息

​

​

Header

​

​

Body

​

​

返回结果

​

​

示例

​

请求示例

​

​

返回示例

​

​

刷新 OAuth Access Token

​

根据 refresh_token 获取新的 OAuth Access Token。

​

调用

​

获取 OAuth Access Token

API 获取的 OAuth Access Token 有效期为 15 分钟，refresh_token 有效期为 30 天。refresh_token 有效期内可以调用此 API 获取新的 OAuth Access Token。

​

接口调用成功后，入参中指定的 refresh_token 失效。

​

基础信息

​

​

Header

​

​

Body

​

​

返回结果

​

​

示例

​

请求示例

​

​

返回示例

​

​

错误码

​

​

常见问题

​

如何处理 OAuth 授权码授权失败，提示“OAuth 错误/请求参数错误”？

​

请检查回调地址中的特殊字符是否已正确转义。例如，回调地址中的

#

需要转义为

%23

。确保所有特殊字符都已按照URL 编码规则进行转义，然后重新尝试授权。

​

​

上一篇

通过示例文件体验 OAuth 授权流程

下一篇

OAuth PKCE
============================================================
# OAuth PKCE
来源: https://www.coze.cn/open/docs/developer_guides/oauth_pkce
============================================================

OAuth PKCE

对于移动设备、本地应用、单页应用等公开客户端，授权码授权模式存在一定安全风险，例如授权码拦截攻击等。对于此类应用，推荐使用 PKCE 扩展协议增强授权码流程的安全性。

​

背景信息

​

在移动设备、本地应用、单页应用等公开客户端授权场景下，使用授权码模式授权时，Client ID 和 Client Secret 可能意外泄露或被恶意窃取，造成访问密钥泄露，影响数据安全。对于公开客户端，推荐使用 PKCE 扩展协议增强授权码流程的安全性。PKCE（Proof Key for Code Exchange）是一个 OAuth 2.0 的扩展协议，PKCE 授权流程中引入了客户端生成的随机字符串（code_verifier）作为临时密钥，防止授权码被拦截和滥用，提高了授权流程的安全性。

​

PKCE 授权流程如下：

​

1.

应用程序引导用户发起授权请求，携带临时密钥。

​

2.

用户同意授权后，扣子 OAuth Server 返回授权码。

​

3.

应用程序通过临时密钥和授权码获取 OAuth 访问令牌。

​

4.

扣子 OAuth Server 验证临时密钥和授权码，返回 Access Token。

​

准备工作

​

在应用程序启动授权流程之前，开发者应在扣子编程中创建 Oauth 应用，获取客户端 ID。

​

说明

在扣子企业版（企业标准版、企业旗舰版）中，仅

超级管理员

和

管理员

有权限创建

、编辑、删

除 OAuth 应用，以及对应用进行授权操作。

​

​

1.

登录

扣子编程

。

​

2.

在左侧导航栏选择

API & SDK。

​

3.

在顶部单击

授权

>

OAuth 应用

页签。

​

4.

在 OAuth 应用页面右上角单击

创建新应用

，填写应用的基本信息，并单击

创建并继续

。

​

​

配置

​

说明

​

应用类型

​

OAuth 应用的类型，此处设置为

普通

。

​

客户端类型

​

客户端类型，此处设置为

移动端/PC 桌面端/单页面应用

。

​

应用名称

​

应用的名称，在扣子编程中全局唯一。

​

描述

​

应用的基本描述信息。

​

​

5.

填写 App 的配置信息，并单击

确定

。

​

​

配置

​

说明

​

权限

​

应用程序调用扣子 API 时需要的权限范围。

​

说明

此处配置旨在于划定应用的权限范围，并未完成授权操作。授权操作可参考

授权流程

部分。

​

​

重定向 URL

​

重定向的 URL 地址。用户完成授权后，扣子编程的授权服务器将通过重定向 URL 返回授权相关的凭据。最多可添加 3 个不同的 URL 地址。

​

重定向 URL 仅支持 HTTP 和 HTTPs。为了保证数据传输安全，请勿在生产环境使用HTTP 协议地址。

​

对于测试场景，您可以指定引用本地机器的 URL，例如

http://localhost:8080

。

​

客户端 ID

​

客户端 ID，即 client id，是应用程序的公共标识符。 由扣子编程自动生成。

​

​

授权流程

​

PKCE 协议的授权流程如下：

​

​

​

​

​

​

步骤一：发起授权请求

​

1.

终端用户在 Web 应用程序中触发授权操作。

​

例如点击和 Bot 对话的按钮。该动作对应扣子

发起对话

API，应用程序需要获得扣子账号的授权。

​

2.

应用程序生成一个临时密钥。

​

客户端生成一个随机值 code_verifier，并根据指定算法将其转换为 code_challenge。其中转换算法为 code_challenge_method，转换通常使用 SHA-256 算法，并进行 Base64URL 编码，即

code_challenge = BASE64URL-ENCODE(SHA256(ASCII(code_verifier)))

。

​

3.

应用程序重定向用户到授权服务器。

​

应用程序通过 302 重定向方式发起

​

获取授权页面 URL

API 请求。请求中携带 OAuth 应用的客户端 ID、重定向 URL、临时密钥 code_challenge、转换算法 code_challenge_method 等信息。请求示例如下：

​

​

​

步骤二：获取授权码

​

1.

终端用户在授权页面单击

授权

。

​

Response Header 中的 location 字段中为跳转链接。例如

https://www.coze.cn/oauth/consent?authorize_key=JacVeqTW93ps5m5N9n34

***

rnNp

。浏览器跳转到此 URL，引导用户完成扣子账号授权。授权页面示例如下：

​

​

​

​

​

​

​

2.

扣子 OAuth Server 在 API 的响应中返回授权码 code。

​

从重定向的 URL 地址中获取 code，例如本示例中 code 为

code_WZmPRDcjJhfwHD****

。

​

​

步骤三：请求令牌

​

应用程序向扣子服务端发起

​

获取 OAuth Access Token

请求，请求中携带授权码 code 和临时密钥转换前的原始随机值 code_verifier。

​

​

获取 OAuth Access Token

的请求示例如下：

​

​

步骤四：获取令牌

​

1.

收到请求后，扣子 OAuth Server 将对以下三个参数进行对比验证。

​

原始的随机值 code_verifier

​

转换算法 code_challenge_method

​

临时密钥 code_challenge

​

2.

验证通过后，扣子 OAuth Server 将通过

​

获取 OAuth Access Token

API 响应的方式颁发令牌。

​

其中：

​

access_token 即访问令牌，用于发起扣子 API 请求时鉴权，有效期为 15 分钟。

​

refresh_token 用于刷新 access_token，有效期为 30 天。refresh_token 到期前可以多次调用

​

刷新 OAuth Access Token

接口获取新的 refresh_token 和 access_token。

​

​

获取 OAuth Access Token

的响应示例如下：

​

​

后续操作

​

应用程序可以在 API 请求头中通过

Authorization=Bearer

$Access_Token

指定访问令牌，发起扣子 API 请求。每个接口对应的权限点不同。

​

以

​

获取已发布智能体的配置（即将下线）

API 为例，完整的 API 请求如下：

​

​

API 参考

​

获取授权页面 URL

​

Web 应用程序可调用此 API 获取 OAuth 授权页面 URL 地址。

​

基础信息

​

​

​

Path 参数

​

​

Query

​

​

返回结果

​

返回结果的 Http code 为 302，其中包含授权页地址

https://www.coze.cn/oauth2/authorize

。

​

如果当前用户未合法登录态，则 302 重定向至授权页

https://www.coze.cn/oauth2/authorize?authorize_key=1234gdaskljgflan

。

​

如果当前用户未登录，则 302 重定向至登录页，登录页重定向至授权页

https://www.coze.cn/sign?redirect=https://www.coze.cn/oauth2/authorize?authorize_key=1234gdaskljgflan

。

​

示例

​

请求示例

​

​

返回示例

​

​

获取 OAuth Access Token

​

通过授权码（OAuth code）获取 OAuth Access Token。

​

基础信息

​

​

Header

​

​

Body

​

​

返回结果

​

​

示例

​

请求示例

​

​

返回示例

​

​

刷新 OAuth Access Token

​

根据 refresh_token 获取新的 OAuth Access Token。

​

调用

​

获取 OAuth Access Token

API 获取的 OAuth Access Token 有效期为 15 分钟，refresh_token 有效期为 30 天。refresh_token 有效期内可以调用此 API 获取新的 OAuth Access Token。

​

接口调用成功后，入参中指定的 refresh_token 失效。

​

基础信息

​

​

Header

​

​

Body

​

​

返回结果

​

​

示例

​

请求示例

​

​

返回示例

​

​

​

上一篇

OAuth 授权码授权

下一篇

OAuth 设备授权
============================================================
# OAuth 设备授权
来源: https://www.coze.cn/open/docs/developer_guides/oauth_device_code
============================================================

OAuth 设备授权

背景信息

​

设备授权模式（Device Authorization Grant）是 OAuth 2.0 的一个扩展，它允许那些没有浏览器或输入能力受限的设备获得访问令牌。这种模式特别适用于智能电视、游戏机、打印机等设备，这些设备可能没有方便的用户界面或输入方法来执行传统的用户代理（如浏览器）基础的授权流程。

​

在设备授权模式中，设备首先向授权服务器请求一个设备代码、用户代码和验证地址。设备代码用于设备随后向授权服务器申请令牌时的验证，而用户代码和验证 URI 则用于用户在另一台设备（如智能手机或电脑）上的浏览器中完成授权步骤。用户访问验证 URI 并输入用户代码，以批准设备的访问请求。一旦用户完成授权，设备就可以使用设备代码来获取访问令牌和刷新令牌。

​

这种模式的优势在于它不需要设备和用户代理之间有双向通信，使得那些无法运行完整 OAuth 流程的设备能够安全地获得访问令牌。RFC 8628 定义了设备授权模式的具体规范和流程。

​

准备工作

​

在应用程序启动授权流程之前，开发者应在

扣子

编程中创建 Oauth 应用，获取客户端 ID。

​

说明

在扣子企业版（企业标准版、企业旗舰版）中，仅

超级管理员

和

管理员

有权限创建、编辑、删除 OAuth 应用，以及对应用进行授权操作。

​

​

1.

登录

扣子编程

。

​

2.

在左侧导航栏选择

API & SDK。

​

3.

在顶部单击

授权

>

OAuth 应用

页签。

​

4.

在 OAuth 应用页面右上角单击

创建新应用

，填写应用的基本信息，并单击

创建并继续

。

​

​

配置

​

说明

​

应用类型

​

OAuth 应用的类型，此处设置为

普通

。

​

客户端类型

​

客户端类型，此处设置为

TV端/设备应用/类命令行程序

。

​

应用名称

​

应用的名称，在

扣子

编程中全局唯一。

​

描述

​

应用的基本描述信息。

​

​

5.

填写 App 的配置信息，单击

确定

。

​

​

配置

​

说明

​

权限

​

应用程序调用

扣子

API 时需要的权限范围。

​

说明

此处配置旨在于划定应用的权限范围，并未完成授权操作。授权操作可参考

授权流程

部分。

​

​

客户端 ID

​

客户端 ID，即 client id，是应用程序的公共标识符。 由

扣子

编程自动生成。

​

​

授权流程

​

​

​

​

​

​

设备码授权流程如下：

​

1.

设备客户端向授权服务器的设备授权端点发送请求（

​

Device Authorization

），获取设备验证码（device_code）和用户验证码（user_code）。

​

说明

扣子

编程支持多人协作场景下跨账号的 OAuth 授权，发起

API 请求时如果指定空间 ID，空间协作者也可以为应用程序授予团队空间中的资源权限。详细说明可参考

​

OAuth 授权（多人协作场景）

。

​

​

2.

设备客户端将用户验证码和验证 URI 展示给用户，指导用户在另一台设备上输入这些信息以完成授权。

​

3.

用户在浏览器中输入验证 URI 和用户验证码，完成授权流程。

​

4.

设备客户端定期轮询授权服务器的令牌端点

​

Token

，使用设备代码来获取访问令牌。

​

5.

一旦用户授权成功，授权服务器响应设备客户端的令牌请求，并返回访问令牌和刷新令牌。

​

API 参考

​

Device Authorization

​

获取设备验证码。

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

普通授权场景：

https://

api.coze.cn

/api/permission/oauth2

/device/code

​

多人协作场景：

https://

api.coze.cn

/api/permission/oauth2/workspace_id/

${workspace_id}

/device/code

​

​

说明

仅扣子企业版支持多人协作场景，扣子个人版不支持多人协作场景。

​

​

Path

​

​

字段

​

类型

​

是否必选

​

说明

​

workspace_id

​

String

​

可选

​

空间 ID。多人协作场景下必选。

​

请求的 Path 中不指定空间 ID 时，授予 Access Token 当前登录账号拥有的所有空间权限；如果指定了空间 ID，表示授予 Access Token 指定空间的权限。资源范围为此空间下的所有资源，包括智能体、知识库、工作流等资源。详细说明可参考

​

OAuth 授权（多人协作场景）

。

​

​

Header

​

​

参数

​

取值

​

说明

​

Content-Type

​

application/json

​

请求正文的方式。

​

​

Body

​

​

字段

​

类型

​

是否必选

​

说明

​

client_id

​

String

​

必选

​

客户端 ID。创建 OAuth 应用时获取的客户端 ID。

​

​

Response

​

​

字段

​

类型

​

说明

​

device_code

​

String

​

设备验证码

​

user_code

​

Integer

​

用户验证码

​

verification_uri

​

String

​

验证页面地址

​

expires_in

​

Integer

​

device_code 和 user_code 可用时间，单位：秒，默认返回300秒；

​

interval

​

​

Integer

​

客户端轮询Token请求的最短间隔时间，单位：秒， 默认为5秒。

​

​

示例

​

请求示例

​

​

Shell

复制

POST /device_authorization HTTP/1.1

​

Host: server.example.com

​

Content-Type: application/json

​

​

{

​

"client_id": "1406020730"

​

}

​

​

返回示例

​

​

Shell

复制

HTTP/1.1 200 OK

​

Content-Type: application/json

​

​

{

​

"device_code": "GmRhmhcxhwAzkoEqiMEg_DnyEysNkuNhszIyS****",

​

"user_code": "WDJB-MJHT",

​

"verification_uri": "https://example.com/device",

​

"expires_in": 1800,

​

"interval": 5

​

}

​

​

Token

​

获取 Token。

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

https://

api.coze.cn

/api/permission/oauth2/token

​

​

Header

​

​

参数

​

取值

​

说明

​

Content-Type

​

application/json

​

请求正文的方式。

​

​

Body

​

​

字段

​

类型

​

是否必选

​

说明

​

client_id

​

String

​

必选

​

创建 OAuth 应用时获取的客户端 ID。

​

grant_type

​

String

​

必选

​

固定值，"urn:ietf:params:oauth:grant-type:device_code"

​

device_code

​

​

String

​

必选

​

设备验证码，从 Device Authorization API response 中获取

​

​

返回结果

​

​

字段

​

类型

​

说明

​

access_token

​

String

​

访问令牌。

​

expires_in

​

Integer

​

访问令牌过期时间，秒级时间戳。

​

refresh_token

​

String

​

新的 refresh_token，用于重新获取 OAuth Access Token。

​

error

​

String

​

错误码：

​

authorization_pending：用户还未完成授权，请稍后重试

​

slow_down：请求太频繁，请稍后重试

​

access_denied：用户已拒绝授权请求

​

expired_token：“device_code”已过期

​

error_description

​

String

​

错误详细描述

​

​

​

上一篇

OAuth PKCE

下一篇

OAuth JWT 授权（开发者）
============================================================
# OAuth JWT 授权（开发者）
来源: https://www.coze.cn/open/docs/developer_guides/oauth_jwt
============================================================

OAuth JWT 授权（开发者）

纯后端应用通常不包含任何用户界面元素，用户无法直接与之交互。该场景下建议使用

JWT

（JSON Web Token）模式，扣子账号直接永久授予 OAuth App 权限，OAuth App 随时可以通过后端应用签发的 JWT 获取访问令牌，以后端应用的身份请求扣子 API。

​

说明

OAuth 授权码授权、PKCE 授权、设备授权模式下，扣子编程支持多人协作场景下跨账号的 OAuth 授权，详细说明可参考

​

OAuth 授权（多人协作场景）

。

​

​

示例项目源码

​

使用 JWT 进行鉴权的步骤较为复杂，扣子编程提供了 Python 等多语言 SDK，能够有效简化鉴权流程，支持扣子编程的各种鉴权模式。推荐使用扣子 SDK 实现鉴权。以下是基于扣子 SDK 的 OAuth JWT 授权的示例代码，供参考：

​

​

Python

​

Node.js

​

Java

​

Go

​

examples/

auth_oauth_jwt.py

​

auth/auth-oauth-jwt.ts

​

auth/auth-oauth-jwt-channel.ts

​

JWTOauthExample.java

​

jwt_example.go

​

​

授权流程

​

授权流程如下：

​

1.

在扣子编程创建 OAuth 应用并完成授权。

​

2.

应用程序通过公钥和私钥签署 JWT。

​

3.

应用程序通过 API，获取访问令牌，具体请参见

​

通过 JWT 获取 Oauth Access Token

。

​

4.

应用程序根据访问令牌调用扣子 API。

​

详细步骤如下：

​

1 创建 Oauth 应用并授权

​

你需要在扣子编程中创建 OAuth 应用。

​

说明

在扣子企业版（企业标准版、企业旗舰版）中

，仅

组织超级管理

员

和

管理员

有权限创建、编辑、删除 OAuth 应用，以及对应用进行授权操作。

​

扣子企业旗舰版多组织场景中，创建的 OAuth 应用默认只有本组织资源的访问权限。如果要访问其他组织的资源，可以将 OAuth 应用的授权链接分享给目标组织的超级管理员或管理员，对方确认授权后才能访问，具体操作请参见

​

2 分享授权链接并授权

。

​

​

1.

登录

扣子编程

。

​

2.

在左侧导航栏选择

API & SDK。

​

3.

在顶部单击

授权

>

OAuth 应用

页签。

​

4.

在 OAuth 应用页面右上角单击

创建新应用

，填写应用的基本信息，并单击

创建并继续

。

​

​

配置

​

说明

​

应用类型

​

应用的类型，此处应指定为

普通

。

​

客户端类型

​

客户端类型，此处设置为

服务类应用

。

​

应用名称

​

应用的名称，在扣子编程中全局唯一。

​

描述

​

应用的基本描述信息。

​

​

5.

填写应用的配置信息。

​

​

​

​

​

​

​

配置

​

说明

​

公钥和私钥

​

用于应用程序客户端身份认证的非对称密钥。

​

单击

创建 Key

，页面将自动创建一对公钥和私钥，公钥自动配置在扣子中，私钥以

private_key.pem

文件格式由网页自动下载至本地

Downloads

目录下。支持创建最多三对公钥和私钥。

​

说明

建议将

private_key.pem

文件安全地存储在只有您的应用可以访问的位置。

​

扣子编程使用符合行业标准的 WebCrypto 加密标准，在浏览器前端创建非对称密钥，密钥强度符合行业标准。扣子编程任何时候都不会上传私钥到后端。请您放心使用。

​

​

权限

​

应用程序调用扣子 API 时需要的权限范围。不同层级权限的生效范围请参见

​

权限层级

。

​

说明

此处配置旨在于划定应用的权限范围，并未完成授权操作。创建 OAuth 应用后还需要参考后续操作完成授权。

​

​

​

6.

单击

确定

，完成配置。

​

7.

在弹出的对话框中，确认权限等信息无误后，单击

授权

。

​

​

​

​

​

​

2 签署 JWT

​

扣子编程的

JWT

生成方式及部分参数定义沿用业界统一流程规范，但 JWT 中 Header 和 Payload 部分由扣子编程自行定义。

​

在

JWT

（JSON Web Tokens）的流程中，通常使用私钥来签署（sign）token。

JWT 包含三部分，即 Header、Payload 和 signature，其中 header 和 payload 由参数拼接而成，signature 根据指定的签名算法和私钥对 Header 和 Payload 自动计算生成。三部分之间用点（.）分隔。详细的签署方式可参考

JWT 官方文档

。

​

Header 和 Payload

​

扣子编程对 Header 和 Payload 的定义如下：

​

Header

​

Header 部分的参数定义如下：

​

​

参数

​

类型

​

是否必选

​

说明

​

alg

​

String

​

必选

​

签名使用的加密算法，固定为

RS256

。

​

RS256

是一种基于非对称加密的签名算法，它结合了 RSA 加密和 SHA-256 哈希算法。

​

typ

​

String

​

必选

​

固定为 JWT。

​

kid

​

String

​

必选

​

OAuth 应用的

公钥指纹

，可以在

OAuth 应用

页面找到这个应用，在

操作

列单击编辑图标，进入

配置

页面查看公钥指纹。

​

​

​

​

​

​

​

Header 示例如下：

​

​

JSON

复制

{

​

"alg"

:

"RS256"

,

// 固定为RS256

​

"typ"

:

"JWT"

,

// 固定为 JWT

​

"kid"

:

"gdehvaDegW....."

// OAuth 应用的公钥指纹

​

}

​

​

Payload：

​

Payload 部分的参数定义如下：

​

​

参数

​

类型

​

是否必选

​

说明

​

iss

​

String

​

必选

​

OAuth 应用的 ID，可以在

OAuth 应用

页面查看。

​

aud

​

String

​

必选

​

扣子 API 的 Endpoint，即

api.coze.cn

。

​

iat

​

Integer

​

必选

​

JWT 开始生效的时间，Unixtime 时间戳格式，精确到秒。一般为当前时刻。

​

exp

​

Integer

​

必选

​

JWT 过期的时间，Unixtime 时间戳格式，精确到秒。必须晚于 iat。

​

jti

​

String

​

必选

​

随机字符串，用于防止重放攻击。建议长度大于 32 字节。每次签署 JWT 时应指定为不同的字符串。

​

session_name

​

String

​

可选

​

访问令牌的会话标识。目前仅限在会话隔离场景下使用，即将 session_name 指定为用户在业务侧的 UID，以此区分不同业务侧用户的对话历史。

​

若未指定 session_name，不同用户的对话历史可能会掺杂在一起。

​

说明

会话隔离的详细实现方法请参见

​

如何实现会话隔离

。

​

​

session_context

​

Object

​

可选

​

会话上下文信息，包含设备相关信息等。

​

​

session_context.device_info

​

Object

​

可选

​

用于配置设备相关信息，扣子编程基于该部分信息对设备做用量管控以及账单记录。

​

说明

仅扣子企业旗舰版支持该参数。硬件设备用量管控的具体操作可参考

​

终端用户用量查询和配额管控

。

​

session_context.device_info.device_id

​

String

​

可选

​

IoT 等硬件设备 ID，一个设备对应一个唯一的设备号。

​

当需要记录设备用量或对设备用量进行管控时，需要填写该参数，否则，无法对设备进行用量管控，用量统计页面对应的设备 ID 将显示为 N/A。

​

session_context.device_info.custom_consumer

​

​

String

​

可选

​

自定义维度的实体 ID，你可以根据业务需要进行设置，例如 APP 上的用户名等。

​

当需要记录设备用量或对设备用量进行管控，需要填写该参数，否则，无法对设备进行用量管控，用量统计页面对应的自定义 ID 将显示为 N/A。

​

说明

device_id

和

custom_consumer

建议选择其中一个即可。

​

custom_consumer

参数用于设备用量管控，与对话等 API 传入的

user_id

无关，

user_id

主要用于上下文、数据库隔离等场景。

​

出于数据隐私及信息安全等方面的考虑，不建议使用业务系统中定义的用户敏感标识（如手机号等）作为

custom_consumer

的值。

​

​

​

Payload 示例如下：

​

​

JSON

复制

{

​

"iss"

:

"310000000002"

,

// OAuth 应用的 ID

​

"aud"

:

"api.coze.cn"

,

// 扣子 API 的 Endpoint

​

"iat"

:

1516239022

,

// JWT 开始生效的时间，秒级时间戳

​

"exp"

:

1516259022

,

// JWT 过期时间，秒级时间戳

​

"jti"

:

"fhjashjgkhalskj"

,

// 随机字符串，防止重放攻击

​

"session_name"

:

"user_2222"

,

//用户在业务侧的 UID

​

"session_context"

:

{

​

"device_info"

:

{

​

"device_id"

:

"1234567890"

// IoT 等硬件设备的唯一标识 ID

​

}

​

}

​

}

​

​

示例代码

​

你可以直接参考以下示例代码签署 JWT。

​

​

Python

复制

# You must run `

pip install PyJWT cryptography

` to install the PyJWT and the cryptography packages in order to use this script.

​

​

#!/usr/bin/env python3

​

import

sys

​

import

time

​

import

uuid

​

​

import

jwt

​

​

# 替换为你的实际 Coze App 私钥

​

signing_key =

'''

​

-----BEGIN PRIVATE KEY-----

​

xxxxxxxxxxxxxxxxxx

​

-----END PRIVATE KEY-----

​

'''

​

​

payload = {

​

'iat'

:

int

(time.time()),

​

'exp'

:

int

(time.time()) +

600

,

​

"jti"

:

str

(uuid.uuid4()),

​

'aud'

:

'api.coze.cn'

,

# 替换为实际的coze api domain

​

'iss'

:

'1127900106117'

# 替换为你的实际 Coze App ID

​

}

​

​

headers = {

​

'kid'

:

'_v0VjcMlLdQc3tRTD3jC5Xz29TUnKQOhtuD5k-gpyf4'

# 替换为你的实际 Coze App 公钥指纹

​

}

​

​

# Create JWT with headers

​

encoded_jwt = jwt.encode(payload, signing_key, algorithm=

'RS256'

, headers=headers)

​

​

print

(

f"JWT:

{encoded_jwt}

"

)

​

​

最终生成的 JWT 示例如下：

​

​

Plain Text

复制

eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InZZd2ZsdFR1OWZBbWtwWFhSdnR5UmREc3RONVMzZWNFcDFqVzB6dVQyRE****.eyJpc3MiOiIzMTAwMDAwMDAwMDIiLCJhdWQiOiJhcGkuY296ZS5jb20iLCJpYXQiOjE1MTYyMzkwMjIsImV4cCI6MTkxNjI1OTAyMiwianRpIjoiZmhqaGFsc2tqZmFkc2pld3F****.CuoiCCF-nHFyGmu2EKlwFoyd3uDyKQ3Drc1CrXQyMVySTzZlZd2M7zKWsziB3AktwbUZiRJlQ1HbghR05CW2YRHwKL4-dlJ4koR3onU7iQAO5DkPCaIxbAuTsQobtCAdkkZTg8gav9EnN1QN_1xq0w8BzuuhS7wCeY8UbaskkTK9GnO4eU9tEINmVw-2CrfB-kNbEHlEDwXfcrb4YPpkw3GhmuPShenNLObfSWS0CqIyakXL8qD5AgXLoB-SejAsRdzloSUInNXENJHfSVMkThxRhJy7yEjX3BmculC54fMKENRfLElBqwJyLLUjeRHsYnaru2ca4W8_yaPJ7F***

*

​

​

3 获取访问令牌

​

应用程序调用

​

通过 JWT 获取 Oauth Access Token

API ，请求 Header 中携带 JWT，扣子服务端会在响应中通过  access_token 字段返回访问令牌。

​

请求示例如下：

​

扣子个人版和企业标准版

扣子企业旗舰版多组织

​

Shell

复制

curl --location --request POST '

https://

api.coze.cn

/api/

permission/oauth2/token' \

​

--header 'Content-Type: application/json' \

​

--header 'Authorization: Bearer eyJhbGciOiJSUzI1NiIyRE****.eyJpc3MiOiIzMTAwMDAwMDAwMDIiLCJhdWQiOiJhcGkuY296ZS5jb20iLCJpYXQiOjE1MTYyMzkwMjIsImV4cCI6MTkxNjI1OTAyMiwianRpIjoiZmhqaGFsc2tqZmFkc2pld3F****.CuoiCCF-nHFyGmu2EKlwFoyd3uDyKQ3Drc1CrXQyMVySTzZlZd2M7zKWsziB3AktwbUZiRJlQ1HbghR05CW2YRHwKL4-dlJ4koR3onU7iQAO5DkPCaIxbAuXfcrb4YPpkw3GhmuPShenNLObfSWS0CqIyakXL8qD5AgXLoB-SejAsRdzloSUInNXENJHfSVMkThxRhJy7yEjX3BmculC54fMKENRfLElBqwJyLLUjeRHsYnaru2ca4W8_yaPJ7F****' \

​

--data '{

​

"duration_seconds": 86399,

​

"grant_type": "urn:ietf:params:oauth:grant-type:jwt-bearer"

​

}'

​

​

​

返回示例如下：

​

​

JSON

复制

{

​

"access_token"

:

"czs_RQOhsc7vmUzK4bNgb7hn4wqOgRBYAO6xvpFHNbnl6RiQJX3cSXSguIhFDzgy****"

,

​

"expires_in"

:

1721135859

​

}

​

​

4 发起扣子 API 请求

​

在 API 请求头中通过

Authorization=Bearer

$Access_Token

指定访问令牌，发起扣子 API 请求。每个接口对应的权限点不同。

​

以

​

查看智能体配置

API 为例，完整的 API 请求如下：

​

​

Shell

复制

curl --location --request GET 'https://api.coze.cn/v1/bots/73428668*****?is_published=true' \

​

--header 'Authorization: Bearer czu_UEE2mJn66h0fMHxLCVv9uQ7HAoNNS8DmF6N6grjWmkHX2jPm8SR0tJcKop8v****' \

​

​

通过 JWT 获取 Oauth Access Token

​

通过 JWT 获取 Oauth Access Token。

​

说明

JWT 仅能使用一次，如需再次申请 OAuth Access Token，必须重新生成一个 JWT。

​

OAuth Access Token 的有效期默认为 15 分钟，不支持刷新。如需获取新的 Access Token，你需要再次生成一个 JWT，并调用此接口。

​

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

扣子个人版和企业标准版：

https://api.coze.cn/api/permission/oauth2/token

​

扣子企业旗舰版多组织：

https://api.coze.cn/api/permission

/oauth2/account/{account_id}/token

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Content-Type

​

application/json

​

请求正文的方式。

​

Authorization

​

Bearer

$JWT

​

使用应用的客户端私钥签署的 JWT。生成方式可参考

​

2 签署 JWT

。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

说明

​

account_id

​

String

​

可选

​

在扣子企业旗舰版中，如果需要在指定组织下获取 Token，需要在 Path 中填写组织 ID。组织 ID 的获取方式如下：

​

组织超级管理员或管理员可以在

组织设置

页面查看对应的组织 ID。

​

​

​

​

​

​

​

Body

​

​

参数

​

类型

​

是否必选

​

说明

​

grant_type

​

String

​

必选

​

固定为

urn:ietf:params:oauth:grant-type:jwt-bearer

。

​

duration_seconds

​

Integer

​

可选

​

申请的 AccessToken 有效期，单位为秒，默认 900 秒，即 15 分钟。最大可设置为 86399 秒，即 24 小时。

​

​

返回参数

​

​

参数

​

类型

​

说明

​

access_token

​

String

​

OAuth Access Token。

​

expires_in

​

Integer

​

OAuth Access Token 的过期时间，Unixtime 时间戳格式，单位为秒。

​

​

示例

​

请求示例

​

​

Shell

复制

curl --location 'https://api.coze.cn/api/permission/oauth2/token' \

​

--header 'Content-Type: application/json' \

​

--header 'Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InZZd2ZsdFR1OWZBbWtwWFhSdnR5UmREc3RONVMzZWNFcDFqVzB6dVQyRE****.eyJpc3MiOiIzMTAwMDAwMDAwMDIiLCJhdWQiOiJhcGkuY296ZS5jb20iLCJpYXQiOjE1MTYyMzkwMjIsImV4cCI6MTkxNjI1OTAyMiwianRpIjoiZmhqaGFsc2tqZmFkc2pld3F****.CuoiCCF-nHFyGmu2EKlwFoyd3uDyKQ3Drc1CrXQyMVySTzZlZd2M7zKWsziB3AktwbUZiRJlQ1HbghR05CW2YRHwKL4-dlJ4koR3onU7iQAO5DkPCaIxbAuTsQobtCAdkkZTg8gav9EnN1QN_1xq0w8BzuuhS7wCeY8UbaskkTK9GnO4eU9tEINmVw-2CrfB-kNbEHlEDwXfcrb4YPpkw3GhmuPShenNLObfSWS0CqIyakXL8qD5AgXLoB-SejAsRdzloSUInNXENJHfSVMkThxRhJy7yEjX3BmculC54fMKENRfLElBqwJyLLUjeRHsYnaru2ca4W8_yaPJ7F****' \

​

--data '{

​

"duration_seconds": 86399,

​

"grant_type": "urn:ietf:params:oauth:grant-type:jwt-bearer"

​

}'

​

​

返回示例

​

​

JSON

复制

{

​

"access_token"

:

"czs_RQOhsc7vmUzK4bNgb7hn4wqOgRBYAO6xvpFHNbnl6RiQJX3cSXSguIhFDzgy****"

,

​

"expires_in"

:

1721135859

​

}

​

​

错误码

​

​

error_code

​

error_message

​

说明

​

invalid_request

​

invalid request: {parameter}

​

​

原因：请求参数 {parameter} 错误。

​

解决方案：请参考 API 文档查看参数说明。

​

invalid_client

​

/

​

原因：客户端凭证（JWT Token 或者 Client Secret）无效。

​

解决方案：请校验您的客户端凭证。

​

unsupported_grant_type

​

not supported grant type: {grant type}

​

原因：不支持的授权类型 {grant type}。

​

解决方案：请参考 API 文档指定正确的授权类型。

​

access_deny

​

app: {app name} is currently deactivated by the owner

​

原因：OAuth 应用已被禁用。

​

解决方案：在

扣子

编程中启用 OAuth 应用。

​

​

invalid app type

​

原因：应用类型错误。

​

解决方案：渠道应用暂不支持授权码模式。

​

​

login session invalid

​

原因：登录态无效。

​

解决方案：用户需要重新登录

扣子

编程。

​

internal_error

​

Service internal error.

​

原因：服务内部错误。

​

解决方案：建议稍后重试。

​

​

​

​

上一篇

OAuth 设备授权

下一篇

OAuth JWT 授权（渠道场景）
============================================================
# OAuth JWT 授权（渠道场景）
来源: https://www.coze.cn/open/docs/developer_guides/oauth_jwt_channel
============================================================

OAuth JWT 授权（渠道场景）

扣子

编程提供标准的生态对接方式和多种对接方案，支持网站、App、应用市场、手机等硬件厂商作为第三方渠道入驻。渠道入驻场景下，渠道侧需要通过 JWT 授权流程获取渠道的 OAuth Access Token。智能体发布到第三方渠道后，可以使用此渠道专属的 OAuth Access Token 调用

扣子

OpenAPI，例如查看智能体信息、和智能体对话等。

​

说明

关于发布到自定义渠道的详细说明及步骤，可参考

​

渠道入驻概述

。

​

​

示例项目源码

​

使用 JWT 进行鉴权的步骤较为复杂，扣子编程提供了 Python 等多语言 SDK，能够有效简化鉴权流程，支持扣子编程的各种鉴权模式。推荐使用扣子 SDK 实现鉴权。以下是基于扣子 SDK 的 OAuth JWT 授权的示例代码，供参考：

​

​

Python

​

Node.js

​

Java

​

Go

​

examples/

auth_oauth_jwt.py

​

auth/auth-oauth-jwt.ts

​

auth/auth-oauth-jwt-channel.ts

​

JWTsOauthExample.java

​

jwt_example.go

​

​

准备工作

​

创建一个渠道类型的 OAuth 应用，并在渠道侧实现 JWT 的授权流程、具备获取 OAuth Access Token 的能力。

​

说明

在扣子企业版（企业标准版、企业旗舰版）

中

，仅

超级管理员

和

管理员

有权限创建、编辑、删除 OAuth 应用，以及对应用进行授权操作。

​

​

1.

创建渠道类型的 OAuth 应用。

​

a.

登录

扣子编程

。

​

b.

在左侧导航栏选择

API & SDK。

​

c.

在顶部单击

授权

>

OAuth 应用

页签。

​

d.

在 OAuth 应用页面右上角单击

创建新应用

，填写应用的基本信息，并单击

创建并继续

。

​

​

配置

​

说明

​

应用类型

​

应用的类型，此处应指定为

渠道

。

​

客户端类型

​

客户端类型，此处设置为

服务类应用

。

​

应用名称

​

应用的名称，在

扣子

编程中全局唯一。

​

描述

​

应用的基本描述信息。

​

​

e.

填写应用的配置信息。

​

​

配置

​

说明

​

公钥和私钥

​

用于应用程序客户端身份认证的非对称密钥。

​

单击

创建 Key

，页面将自动创建一对公钥和私钥，公钥自动配置在扣子编程中，私钥以

private_key.pem

文件格式由网页自动下载至本地

Downloads

目录下。支持创建最多三对公钥和私钥。

​

建议将

private_key.pem

文件安全地存储在只有您的应用可以访问的位置。

​

扣子编程使用符合行业标准的 WebCrypto 加密标准，在浏览器前端创建非对称密钥，密钥强度符合行业标准。扣子编程任何时候都不会上传私钥到后端。请您放心使用。

​

权限

​

应用程序调用扣子 API 时需要的权限范围。不同层级权限的生效范围请参见

​

权限层级

。

​

说明

此处配置旨在于划定应用的权限范围，并未完成授权操作。创建 OAuth 应用后还需要参考后续操作完成授权。

​

​

f.

单击

确定

，完成配置。

​

2.

完成 OAuth 应用授权。

​

授权后，此 OAuth 应用生成的 OAuth Access Token 将具备 OAuth 应用指定的操作权限，例如调用查看智能体信息等 OpenAPI。后续还需要为应用绑定自定义发布渠道，此 OAuth Access Token 将具备所有发布到这个渠道中的智能体的操作权限，例如调用查看智能体信息 API 接口，查看指定智能体的信息。

​

b.

在

授权

>

OAuth 应用

页面找到需要授权的应用。

​

c.

在对应的操作列单击编辑图标。

​

d.

在编辑应用页面左下角单击

授权

。

​

授权页将显示应用名称、权限列表等重要信息，请务必认真核对信息，确认无误后单击

授权

。

​

授权流程

​

你需要在渠道的服务端中实现 JWT 授权流程，通过 OAuth 应用的私钥签署 JWT，并获取 Oauth Access Token。

扣子

编程的

JWT

生成方式及各部分参数定义沿用业界统一流程规范。

​

授权流程如下：

​

1.

应用程序通过公钥和私钥签署 JWT。

​

2.

应用程序通过

​

API：通过 JWT 获取 Oauth Access Token

API，获取访问令牌。

​

3.

应用程序根据访问令牌调用

扣子

API。

​

详细步骤如下：

​

1 签署 JWT

​

扣子编程的

JWT

生成方式及部分参数定义沿用业界统一流程规范，但 JWT 中 Header 和 Payload 部分由扣子编程自行定义。

​

在

JWT

（JSON Web Tokens）的流程中，通常使用私钥来签署（sign）token。JWT 包含三部分，即 Header、Payload 和 signature，其中 header 和 payload 由参数拼接而成，signature 根据指定的签名算法和私钥对 Header 和 Payload 自动计算生成。三部分之间用点（.）分隔。详细的签署方式可参考

JWT 官方文档

。

​

Header 和 Payload

​

扣子编程对 Header 和 Payload 的定义如下：

​

Header

​

Header 部分的参数定义如下：

​

​

参数

​

类型

​

是否必选

​

说明

​

alg

​

String

​

必选

​

签名使用的加密算法。固定为 RS256，即非对称加密算法，一种基于 RSA（非对称加密算法）+ SHA256（安全哈希函数）的签名算法，该算法使用私钥进行签名，公钥进行验证。

​

typ

​

String

​

必选

​

固定为 JWT。

​

kid

​

String

​

必选

​

OAuth 应用的

公钥指纹

，可以在

OAuth 应用

页面找到这个应用，在

操作

列单击编辑图标，进入

配置

页面查看公钥指纹。

​

​

Header 示例如下：

​

​

JSON

复制

{

​

"alg"

:

"RS256"

,

// 固定为RS256

​

"typ"

:

"JWT"

,

// 固定为 JWT

​

"kid"

:

"gdehvaDegW....."

// OAuth 应用的公钥指纹

​

}

​

​

Payload：

​

Payload 部分的参数定义如下：

​

​

参数

​

类型

​

是否必选

​

说明

​

iss

​

String

​

必选

​

OAuth 应用的 ID，可以在

OAuth 应用

页面查看。

​

aud

​

String

​

必选

​

扣子 API 的 Endpoint，即

api.coze.cn

。

​

iat

​

Integer

​

必选

​

JWT 开始生效的时间，Unixtime 时间戳格式，精确到秒。一般为当前时刻。

​

exp

​

Integer

​

必选

​

JWT 过期的时间，Unixtime 时间戳格式，精确到秒。必须晚于 iat。

​

jti

​

String

​

必选

​

随机字符串，用于防止重放攻击。建议长度大于 32 字节。每次签署 JWT 时应指定为不同的字符串。

​

session_name

​

String

​

可选

​

访问令牌的会话标识。目前仅限在会话隔离场景下使用，即将 session_name 指定为用户在业务侧的 UID，以此区分不同业务侧用户的对话历史。

​

若未指定 session_name，不同用户的对话历史可能会掺杂在一起。

​

session_context

​

Object

​

可选

​

会话上下文信息，包含设备相关信息等。

​

​

session_context.device_info

​

Object

​

可选

​

用于配置设备相关信息，扣子编程基于该部分信息对设备做用量管控以及账单记录。

​

说明

仅扣子企业旗舰版支持该参数。硬件设备用量管控的具体操作可参考

​

终端用户用量查询和配额管控

​

​

session_context.device_info.device_id

​

String

​

可选

​

IoT 等硬件设备 ID，一个设备对应一个唯一的设备号。

​

当需要记录设备用量或对设备用量进行管控时，需要填写该参数，否则，无法对设备进行用量管控，用量统计页面对应的设备 ID 将显示为 N/A。

​

session_context.device_info.custom_consumer

​

​

String

​

可选

​

自定义维度的实体 ID，你可以根据业务需要进行设置，例如 APP 上的用户名等。

​

当需要记录设备用量或对设备用量进行管控，需要填写该参数，否则，无法对设备进行用量管控，用量统计页面对应的自定义 ID 将显示为 N/A。

​

说明

device_id

和

custom_consumer

建议选择其中一个即可。

​

custom_consumer

参数用于设备用量管控，与对话等 API 传入的

user_id

无关，

user_id

主要用于上下文、数据库隔离等场景。

​

出于数据隐私及信息安全等方面的考虑，不建议使用业务系统中定义的用户敏感标识（如手机号等）作为

custom_consumer

的值。

​

​

Payload 示例如下：

​

​

JSON

复制

{

​

"iss"

:

"310000000002"

,

// OAuth 应用的 ID

​

"aud"

:

"api.coze.cn"

,

// 扣子 API 的 Endpoint

​

"iat"

:

1516239022

,

// JWT 开始生效的时间，秒级时间戳

​

"exp"

:

1516259022

,

// JWT 过期时间，秒级时间戳

​

"jti"

:

"fhjashjgkhalskj"

,

// 随机字符串，防止重放攻击

​

"session_context"

:

{

​

"device_info"

:

{

​

"device_id"

:

"1234567890"

// IoT 等硬件设备的唯一标识 ID

​

}

​

}

​

}

​

​

示例代码

​

你可以直接参考以下示例代码签署 JWT。

​

​

Python

复制

# You must run `

pip install PyJWT cryptography

` to install the PyJWT and the cryptography packages in order to use this script.

​

​

#!/usr/bin/env python3

​

import

sys

​

import

time

​

import

uuid

​

​

import

jwt

​

​

# 替换为你的实际 Coze App 私钥

​

signing_key =

'''

​

-----BEGIN PRIVATE KEY-----

​

xxxxxxxxxxxxxxxxxx

​

-----END PRIVATE KEY-----

​

'''

​

​

payload = {

​

'iat'

:

int

(time.time()),

​

'exp'

:

int

(time.time()) +

600

,

​

"jti"

:

str

(uuid.uuid4()),

​

'aud'

:

'api.coze.cn'

,

# 替换为实际的coze api domain

​

'iss'

:

'1127900106117'

# 替换为你的实际 Coze App ID

​

}

​

​

headers = {

​

'kid'

:

'_v0VjcMlLdQc3tRTD3jC5Xz29TUnKQOhtuD5k-gpyf4'

# 替换为你的实际 Coze App 公钥指纹

​

}

​

​

# Create JWT with headers

​

encoded_jwt = jwt.encode(payload, signing_key, algorithm=

'RS256'

, headers=headers)

​

​

print

(

f"JWT:

{encoded_jwt}

"

)

​

​

最终生成的 JWT 示例如下：

​

​

Plain Text

复制

eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InZZd2ZsdFR1OWZBbWtwWFhSdnR5UmREc3RONVMzZWNFcDFqVzB6dVQyRE****.eyJpc3MiOiIzMTAwMDAwMDAwMDIiLCJhdWQiOiJhcGkuY296ZS5jb20iLCJpYXQiOjE1MTYyMzkwMjIsImV4cCI6MTkxNjI1OTAyMiwianRpIjoiZmhqaGFsc2tqZmFkc2pld3F****.CuoiCCF-nHFyGmu2EKlwFoyd3uDyKQ3Drc1CrXQyMVySTzZlZd2M7zKWsziB3AktwbUZiRJlQ1HbghR05CW2YRHwKL4-dlJ4koR3onU7iQAO5DkPCaIxbAuTsQobtCAdkkZTg8gav9EnN1QN_1xq0w8BzuuhS7wCeY8UbaskkTK9GnO4eU9tEINmVw-2CrfB-kNbEHlEDwXfcrb4YPpkw3GhmuPShenNLObfSWS0CqIyakXL8qD5AgXLoB-SejAsRdzloSUInNXENJHfSVMkThxRhJy7yEjX3BmculC54fMKENRfLElBqwJyLLUjeRHsYnaru2ca4W8_yaPJ7F***

*

​

​

2 获取访问令牌

​

应用程序调用

​

API：通过 JWT 获取 Oauth Access Token

API ，请求 Header 中携带 JWT，

扣子

服务端会在响应中通过  access_token 字段返回访问令牌。

​

请求示例如下：

​

​

Shell

复制

curl --location --request POST 'https://api.coze.cn/api/permission/oauth2/token' \

​

--header 'Content-Type: application/json' \

​

--header 'Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InZZd2ZsdFR1OWZBbWtwWFhSdnR5UmREc3RONVMzZWNFcDFqVzB6dVQyRE****.eyJpc3MiOiIzMTAwMDAwMDAwMDIiLCJhdWQiOiJhcGkuY296ZS5jb20iLCJpYXQiOjE1MTYyMzkwMjIsImV4cCI6MTkxNjI1OTAyMiwianRpIjoiZmhqaGFsc2tqZmFkc2pld3F****.CuoiCCF-nHFyGmu2EKlwFoyd3uDyKQ3Drc1CrXQyMVySTzZlZd2M7zKWsziB3AktwbUZiRJlQ1HbghR05CW2YRHwKL4-dlJ4koR3onU7iQAO5DkPCaIxbAuTsQobtCAdkkZTg8gav9EnN1QN_1xq0w8BzuuhS7wCeY8UbaskkTK9GnO4eU9tEINmVw-2CrfB-kNbEHlEDwXfcrb4YPpkw3GhmuPShenNLObfSWS0CqIyakXL8qD5AgXLoB-SejAsRdzloSUInNXENJHfSVMkThxRhJy7yEjX3BmculC54fMKENRfLElBqwJyLLUjeRHsYnaru2ca4W8_yaPJ7F****' \

​

--data '{

​

"duration_seconds": 86399,

​

"grant_type": "urn:ietf:params:oauth:grant-type:jwt-bearer"

​

}'

​

​

返回示例如下：

​

​

JSON

复制

{

​

"access_token"

:

"czs_RQOhsc7vmUzK4bNgb7hn4wqOgRBYAO6xvpFHNbnl6RiQJX3cSXSguIhFDzgy****"

,

​

"expires_in"

:

1721135859

​

}

​

​

后续操作

​

在 API 请求头中通过

Authorization=Bearer

$Access_Token

指定访问令牌，发起

扣子

API 请求。每个接口对应的权限点不同。

​

以

​

获取已发布智能体的配置（即将下线）

API 为例，完整的 API 请求如下：

​

​

Shell

复制

curl --location --request GET 'https://api.coze.cn/v1/bot/get_online_info?bot_id=123123123' \

​

--header 'Authorization: Bearer czu_UEE2mJn66h0fMHxLCVv9uQ7HAoNNS8DmF6N6grjWmkHX2jPm8SR0tJcKop8v****' \

​

​

API：通过 JWT 获取 Oauth Access Token

​

通过 JWT 获取 Oauth Access Token。

​

说明

JWT 仅能使用一次，如需再次申请 OAuth Access Token，必须重新生成一个 JWT。

​

OAuth Access Token 的有效期默认为 15 分钟，不支持刷新。如需获取新的 Access Token，你需要再次生成一个 JWT，并调用此接口。

​

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

https://api.coze.cn/api/permission/oauth2/token

​

​

Header

​

​

参数

​

取值

​

说明

​

Content-Type

​

application/json

​

请求正文的方式。

​

Authorization

​

Bearer

$JWT

​

使用应用的客户端私钥签署的 JWT。生成方式可参考

​

1 签署 JWT

。

​

​

Body

​

​

字段

​

类型

​

是否必选

​

说明

​

grant_type

​

String

​

必选

​

固定为

urn:ietf:params:oauth:grant-type:jwt-bearer

。

​

duration_seconds

​

Integer

​

可选

​

申请的 AccessToken 有效期，单位为秒，默认 900 秒，即 15 分钟。最大可设置为 86399 秒，即 24 小时。

​

scope

​

Scope object

​

可选

​

指定渠道侧申请的 OAuth Access Token 的操作权限，例如渠道服务端使用此令牌调用 OpenAPI 时只能和智能体 A 对话，不能执行其他操作。

​

说明

仅在渠道侧调用此接口时生效。配置渠道入驻的方式可参考

​

渠道入驻概述

。

​

如果不指定 scope，表示渠道能调用授权的所有权限。

​

​

​

Scope object

​

​

字段

​

类型

​

是否必选

​

说明

​

account_permission

​

Object

​

必选

​

指定 OAuth Access Token 的操作权限。

​

account_permission.permission_list

​

Array of String

​

必选

​

OAuth Access Token 的权限点列表。字符串列表格式，例如

["Connector.botChat"]

表示

chat

权限。

​

attribute_constraint

​

Object

​

必选

​

指定 OAuth Access Token 的权限限制。

​

attribute_constraint.connector_bot_chat_attribute

​

Object

​

必选

​

指定 OAuth Access Token 允许访问的智能体范围，此智能体必须已发布为 API 服务。

​

attribute_constraint.connector_bot_chat_attribute.bot_id_list

​

Array of String

​

必选

​

允许访问的智能体列表，例如

["bot_id_1", "bot_id_2"]

表示 OAuth Access Token 仅对 ID 为 1 或 2 的智能体有访问权限。

​

​

比如，申请 AccessToken，限制只允许和 bot1聊天，scope 应指定为：

​

​

JSON

复制

{

​

"account_permission"

:

{

​

"permission_list"

:

[

"Connector.botChat"

]

​

},

​

"attribute_constraint"

:

{

​

"connector_bot_chat_attribute"

:

{

​

"bot_id_list"

:

[

"bot1"

]

​

}

​

}

​

}

​

​

返回结果

​

​

字段

​

类型

​

说明

​

access_token

​

String

​

OAuth Access Token。

​

expires_in

​

Integer

​

OAuth Access Token 的过期时间，Unixtime 时间戳格式，精度为秒。

​

​

示例

​

请求示例

​

​

Shell

复制

curl --location 'https://api.coze.cn/api/permission/oauth2/token' \

​

--header 'Content-Type: application/json' \

​

--header 'Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InZZd2ZsdFR1OWZBbWtwWFhSdnR5UmREc3RONVMzZWNFcDFqVzB6dVQyRE****.eyJpc3MiOiIzMTAwMDAwMDAwMDIiLCJhdWQiOiJhcGkuY296ZS5jb20iLCJpYXQiOjE1MTYyMzkwMjIsImV4cCI6MTkxNjI1OTAyMiwianRpIjoiZmhqaGFsc2tqZmFkc2pld3F****.CuoiCCF-nHFyGmu2EKlwFoyd3uDyKQ3Drc1CrXQyMVySTzZlZd2M7zKWsziB3AktwbUZiRJlQ1HbghR05CW2YRHwKL4-dlJ4koR3onU7iQAO5DkPCaIxbAuTsQobtCAdkkZTg8gav9EnN1QN_1xq0w8BzuuhS7wCeY8UbaskkTK9GnO4eU9tEINmVw-2CrfB-kNbEHlEDwXfcrb4YPpkw3GhmuPShenNLObfSWS0CqIyakXL8qD5AgXLoB-SejAsRdzloSUInNXENJHfSVMkThxRhJy7yEjX3BmculC54fMKENRfLElBqwJyLLUjeRHsYnaru2ca4W8_yaPJ7F****' \

​

--data '{

​

"duration_seconds": 86399,

​

"grant_type": "urn:ietf:params:oauth:grant-type:jwt-bearer"

​

}'

​

​

返回示例

​

​

JSON

复制

{

​

"access_token"

:

"czs_RQOhsc7vmUzK4bNgb7hn4wqOgRBYAO6xvpFHNbnl6RiQJX3cSXSguIhFDzgy****"

,

​

"expires_in"

:

1721135859

​

}

​

​

错误码

​

​

error_code

​

error_message

​

说明

​

invalid_request

​

invalid request: {parameter}

​

​

原因：请求参数 {parameter} 错误。

​

解决方案：请参考 API 文档查看参数说明。

​

invalid_client

​

/

​

原因：客户端凭证（JWT Token 或者 Client Secret）无效。

​

解决方案：请校验您的客户端凭证。

​

unsupported_grant_type

​

not supported grant type: {grant type}

​

原因：不支持的授权类型 {grant type}。

​

解决方案：请参考 API 文档指定正确的授权类型。

​

access_deny

​

app: {app name} is currently deactivated by the owner

​

原因：OAuth 应用已被禁用。

​

解决方案：在

扣子

编程中启用 OAuth 应用。

​

​

invalid app type

​

原因：应用类型错误。

​

解决方案：渠道应用暂不支持授权码模式。

​

​

login session invalid

​

原因：登录态无效。

​

解决方案：用户需要重新登录

扣子

编程。

​

internal_error

​

Service internal error.

​

原因：服务内部错误。

​

解决方案：建议稍后重试。

​

​

​

​

常见问题

​

如何处理 JWT 授权时，提示"connector app should bind connector id"？

​

进行 OAuth JWT 授权时，提示"connector app should bind connector id"，该报错是由于未正确绑定 OAuth 应用到相应的发布渠道，导致授权失败。你需要在创建自定义发布渠道时，绑定渠道类型的 OAuth 应用，具体请操作参见

​

配置渠道入驻（账号隔离）

。

​

1.

在扣子编程左下角单击头像，选择

账号设置

。

​

2.

在左侧导航栏选择

发布渠道

，在

企业自定义渠道管理

页面，单击目标渠道操作列中的

更多

图标，选择

编辑

。

​

​

​

​

​

​

​

​

​

​

上一篇

OAuth JWT 授权（开发者）

下一篇

OAuth JWT 授权（跨账号授权场景）
============================================================
# OAuth JWT 授权（跨账号授权场景）
来源: https://www.coze.cn/open/docs/developer_guides/oauth_jwt_collaborate
============================================================

OAuth JWT 授权（跨账号授权场景）

在多人协作的纯后端应用场景下，当你需要通过 OAuth JWT Flow 访问其他账号下的资源时，可参考本文完成 OAuth JWT 授权。授权完成后，OAuth 应用将被永久授予指定工作空间下所有资源的访问权限，并随时可以通过后端应用签发的 JWT 获取访问令牌，以后端应用的身份请求扣子 API。

​

说明

在 OAuth 授权码授权、PKCE 授权、设备授权模式下，扣子编程也支持多人协作场景下跨账号的 OAuth 授权。详细说明可参考

​

OAuth 授权（多人协作场景）

。

​

​

授权场景

​

扣子个

人版

​

JWT Access Token 默认仅具备本账号资源的访问权限，因此在多人跨账号协作场景中，还需完成跨账号授权。首先需要在本账号中创建 OAuth 应用，并将 OAuth 应用的授权链接分享给目标工作空间的所有者，由其确认待授予的权限范围。然后在调用

​

通过 JWT 获取 Oauth Access Token

时，务必在 URL 中指定目标空间所有者的 UID。

​

例如扣子用户 A 需要访问某个工作空间中其他用户创建的资源，则可以将授权链接分享给工作空间所有者 B，所有者 B 选择工作空间并完成授权后，用户 A 可以访问指定工作空间中的所有资源。

​

扣子企业版

​

JWT Access Token 默认仅具备本组织资源的访问权限。如果要访问其他组织的资源，首先需要在本组织中创建 OAuth 应用,并将 OAuth 应用的授权链接分享给目标组织的超级管理员或管理员，由其确认待授予的权限范围。

​

示例项目源码

​

扣子编程提供 Python 等多语言 SDK，支持扣子编程的各种鉴权模式，你可以参考下表中的示例代码实现 OAuth JWT 授权流程。

​

​

Python

​

Node.js

​

Java

​

Go

​

examples/

auth_oauth_jwt.py

​

auth/auth-oauth-jwt.ts

​

auth/auth-oauth-jwt-channel.ts

​

JWTsOauthExample.java

​

jwt_example.go

​

​

授权流程

​

授权流程如下：

​

1.

在扣子编程创建 OAuth 应用并授权。

​

2.

分享授权链接

给目标对象

，由其完成授权。

​

3.

应用程序通过公钥和私钥签署 JWT。

​

4.

通过 Token API 获取访问令牌。

​

5.

应用程序根据访问令牌调用扣子 API。

​

1 创建 OAuth 应用并授权

​

开发者需要在扣子编程中创建 OAuth 应用，并为其配置相应的权限。

​

1.

创建 OAuth 应用。

​

a.

登录

扣子编程

。

​

b.

在左侧导航栏选择

API & SDK。

​

c.

在顶部单击

授权

>

OAuth 应用

页签。

​

d.

在 OAuth 应用页面右上角单击

创建新应用

，填写应用的基本信息，并单击

创建并继续

。

​

​

配置

​

说明

​

应用类型

​

应用的类型，此处应指定为

普通

。

​

客户端类型

​

客户端类型，此处设置为

服务类应用

。

​

应用名称

​

应用的名称，在扣子编程中全局唯一。

​

应用描述

​

应用的基本描述信息。

​

​

e.

填写应用的配置信息。

​

​

配置

​

说明

​

公钥和私钥

​

用于应用程序客户端身份认证的非对称密钥。

​

单击

创建 Key

，页面将自动创建一对公钥和私钥，公钥自动配置在扣子编程中，私钥以

private_key.pem

文件格式由网页自动下载至本地。支持创建最多三对公钥和私钥。

​

建议将

private_key.pem

文件安全地存储在只有你的应用可以访问的位置。

​

扣子编程使用符合行业标准的 WebCrypto 加密标准，在浏览器前端创建非对称密钥，密钥强度符合行业标准。扣子编程任何时候都不会上传私钥到后端。请你放心使用。

​

权限

​

应用程序调用扣子 API 时需要的权限范围。不同层级权限的生效范围请参见

​

权限层级

。

​

说明

此处配置旨在于划定应用的权限范围，并未完成授权操作。创建 OAuth 应用后还需要参考后续操作完成授权。

​

​

​

f.

单击

确定

，完成配置。

​

2.

完成 OAuth 应用授权。

​

在弹出的

安装并授权

对话框中，请务必认真核对应用名称、权限列表等重要信息，确认无误后单击

授权

。

​

​

​

​

​

​

2 分享授权链接并授权

​

将 OAuth 应用的授权链接分享给目标工作空间所有者

，由其确认此 OAuth 应用访问自己资源的权限范围。

​

1.

在

OAuth 应用

页面，找到你已创建的 OAuth 应用，单击

分享应用的授权链接

图标，复制授权链接。

​

​

​

​

​

​

2.

将授权链接分享给目标对象，此处假设为用户 B。

​

个人版：需分享给目标工作空间所有者。

​

企业版：需分享给目标组织的超级管理员或管理员。

​

3.

用户 B 打开分享链接，选择授权的组织和空间范围，并确认权限范围后，单击

授权

。

​

​

​

​

​

​

3 签署 JWT

​

扣子编程的

JWT

生成方式及部分参数定义沿用业界统一流程规范，但 JWT 中 Header 和 Payload 部分由扣子编程自行定义。

​

在

JWT

（JSON Web Tokens）的流程中，通常使用私钥来签署（sign）token。JWT 包含三部分，即 Header、Payload 和 signature，其中 header 和 payload 由参数拼接而成，signature 根据指定的签名算法和私钥对 Header 和 Payload 自动计算生成。三部分之间用点（.）分隔。详细的签署方式可参考

JWT 官方文档

。

​

Header 和 Payload

​

扣子编程对 Header 和 Payload 的定义如下：

​

Header

​

Header 部分的参数定义如下：

​

​

参数

​

类型

​

是否必选

​

说明

​

alg

​

String

​

必选

​

签名使用的加密算法。固定为 RS256，即非对称加密算法，一种基于 RSA（非对称加密算法）+ SHA256（安全哈希函数）的签名算法，该算法使用私钥进行签名，公钥进行验证。

​

typ

​

String

​

必选

​

固定为 JWT。

​

kid

​

String

​

必选

​

OAuth 应用的

公钥指纹

，可以在

OAuth 应用

页面找到这个应用，在

操作

列单击编辑图标，进入

配置

页面查看公钥指纹。

​

​

Header 示例如下：

​

​

JSON

复制

{

​

"alg"

:

"RS256"

,

// 固定为RS256

​

"typ"

:

"JWT"

,

// 固定为 JWT

​

"kid"

:

"gdehvaDegW....."

// OAuth 应用的公钥指纹

​

}

​

​

Payload：

​

Payload 部分的参数定义如下：

​

​

参数

​

类型

​

是否必选

​

说明

​

iss

​

String

​

必选

​

OAuth 应用的 ID，可以在

OAuth 应用

页面查看。

​

aud

​

String

​

必选

​

扣子 API 的 Endpoint，即

api.coze.cn

。

​

iat

​

Integer

​

必选

​

JWT 开始生效的时间，Unixtime 时间戳格式，精确到秒。一般为当前时刻。

​

exp

​

Integer

​

必选

​

JWT 过期的时间，Unixtime 时间戳格式，精确到秒。必须晚于 iat。

​

jti

​

String

​

必选

​

随机字符串，用于防止重放攻击。建议长度大于 32 字节。每次签署 JWT 时应指定为不同的字符串。

​

session_name

​

String

​

可选

​

访问令牌的会话标识。目前仅限在会话隔离场景下使用，即将 session_name 指定为用户在业务侧的 UID，以此区分不同业务侧用户的对话历史。

​

若未指定 session_name，不同用户的对话历史可能会掺杂在一起。

​

session_context

​

Object

​

可选

​

会话上下文信息，包含设备相关信息等。

​

​

​

Payload 示例如下：

​

​

JSON

复制

{

​

"iss"

:

"310000000002"

,

// OAuth 应用的 I

D

​

"aud"

:

"api.coze.cn"

,

//扣子 API 的Endpoin

t

​

"iat"

:

1516239022

,

// JWT开始生效的时间，秒级时间

戳

​

"exp"

:

1516259022

,

// JWT过期时间，秒级时间

戳

​

"jti"

:

"fhjashjgkhalskj"

// 随机字符串，防止重放攻

击

​

}

​

​

示例代码

​

你可以直接参考以下示例代码签署 JWT。

​

​

Python

复制

# You must run `

pip install PyJWT cryptography

` to install the PyJWT and the cryptography packages in order to use this script.

​

​

#!/usr/bin/env python3

​

import

sys

​

import

time

​

import

uuid

​

​

import

jwt

​

​

# 替换为你的实际 Coze App 私钥

​

signing_key =

'''

​

-----BEGIN PRIVATE KEY-----

​

xxxxxxxxxxxxxxxxxx

​

-----END PRIVATE KEY-----

​

'''

​

​

payload = {

​

'iat'

:

int

(time.time()),

​

'exp'

:

int

(time.time()) +

600

,

​

"jti"

:

str

(uuid.uuid4()),

​

'aud'

:

'api.coze.cn'

,

# 替换为实际的coze api domain

​

'iss'

:

'1127900106117'

# 替换为你的实际 Coze App ID

​

}

​

​

headers = {

​

'kid'

:

'_v0VjcMlLdQc3tRTD3jC5Xz29TUnKQOhtuD5k-gpyf4'

# 替换为你的实际 Coze App 公钥指纹

​

}

​

​

# Create JWT with headers

​

encoded_jwt = jwt.encode(payload, signing_key, algorithm=

'RS256'

, headers=headers)

​

​

print

(

f"JWT:

{encoded_jwt}

"

)

​

​

最终生成的 JWT 示例如下：

​

​

Plain Text

复制

eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InZZd2ZsdFR1OWZBbWtwWFhSdnR5UmREc3RONVMzZWNFcDFqVzB6dVQyRE****.eyJpc3MiOiIzMTAwMDAwMDAwMDIiLCJhdWQiOiJhcGkuY296ZS5jb20iLCJpYXQiOjE1MTYyMzkwMjIsImV4cCI6MTkxNjI1OTAyMiwianRpIjoiZmhqaGFsc2tqZmFkc2pld3F****.CuoiCCF-nHFyGmu2EKlwFoyd3uDyKQ3Drc1CrXQyMVySTzZlZd2M7zKWsziB3AktwbUZiRJlQ1HbghR05CW2YRHwKL4-dlJ4koR3onU7iQAO5DkPCaIxbAuTsQobtCAdkkZTg8gav9EnN1QN_1xq0w8BzuuhS7wCeY8UbaskkTK9GnO4eU9tEINmVw-2CrfB-kNbEHlEDwXfcrb4YPpkw3GhmuPShenNLObfSWS0CqIyakXL8qD5AgXLoB-SejAsRdzloSUInNXENJHfSVMkThxRhJy7yEjX3BmculC54fMKENRfLElBqwJyLLUjeRHsYnaru2ca4W8_yaPJ7F***

*

​

​

4 获取访问令牌

​

应用程序调用 Token API 时，请求 Header 中将携带 JWT，扣子服务端会在响应中通过  access_token 字段返回访问令牌。Token API 的详细说明，请参考

​

通过 JWT 获取 Oauth Access Token

。

​

说明

跨账号授权场景中，申请 Access Token 的 URL 路径为

/api/permission/oauth2/account/{account_id}/token

。

​

扣子个人版：

{account_id}

为目标资源所属工作空间的所有者 UID。获取 UID 的具体步骤，请参考

​

获取资源所属工作空间的所有者 UID

。

​

扣子企业版多组织场景：

{account_id}

为目标资源所属组织的组织 ID。组织超级管理员或管理员可以在

组织设置

页面查看对应的组织 ID。

​

​

请求示例

​

​

Shell

复制

curl --location --request POST 'https://

api.coze.cn

/api/permission/oauth2/account/292298289606****/token' \

​

--header 'Content-Type: application/json' \

​

--header 'Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InZZd2ZsdFR1OWZBbWtwWFhSdnR5UmREc3RONVMzZWNFcDFqVzB6dVQyRE****.eyJpc3MiOiIzMTAwMDAwMDAwMDIiLCJhdWQiOiJhcGkuY296ZS5jb20iLCJpYXQiOjE1MTYyMzkwMjIsImV4cCI6MTkxNjI1OTAyMiwianRpIjoiZmhqaGFsc2tqZmFkc2pld3F****.CuoiCCF-nHFyGmu2EKlwFoyd3uDyKQ3Drc1CrXQyMVySTzZlZd2M7zKWsziB3AktwbUZiRJlQ1HbghR05CW2YRHwKL4-dlJ4koR3onU7iQAO5DkPCaIxbAuTsQobtCAdkkZTg8gav9EnN1QN_1xq0w8BzuuhS7wCeY8UbaskkTK9GnO4eU9tEINmVw-2CrfB-kNbEHlEDwXfcrb4YPpkw3GhmuPShenNLObfSWS0CqIyakXL8qD5AgXLoB-SejAsRdzloSUInNXENJHfSVMkThxRhJy7yEjX3BmculC54fMKENRfLElBqwJyLLUjeRHsYnaru2ca4W8_yaPJ7F****' \

​

--data '{

​

"duration_seconds": 86399,

​

"grant_type": "urn:ietf:params:oauth:grant-type:jwt-bearer"

​

}'

​

​

返回示例

​

​

Bash

复制

{

​

"access_token"

:

"czs_RQOhsc7vmUzK4bNgb7hn4wqOgRBYAO6xvpFHNbnl6RiQJX3cSXSguIhFDzgy****"

,

​

"expires_in"

: 1721135859

​

}

​

​

5 发起扣子 API 请求

​

在 API 请求头中通过

Authorization=Bearer

$Access_Token

指定访问令牌，发起扣子 API 请求。每个接口对应的权限点不同。

​

以

​

查看智能体配置

API 为例，完整的 API 请求如下：

​

​

Shell

复制

curl --location --request GET 'https://api.coze.cn/v1/bots/73428668*****?is_published=true' \

​

--header 'Authorization: Bearer czu_UEE2mJn66h0fMHxLCVv9uQ7HAoNNS8DmF6N6grjWmkHX2jPm8SR0tJcKop8v****' \

​

​

参考信息

​

获取资源所属工作空间的所有者 UID

​

通过 JWT 授权流程跨账号访问资源

时

，你需要先确认

目标资源所属工作空间

，再确认工作空间的所有者，并由其提供账号 UID。具体步骤如下：

​

1.

确认待访问资源所属工作空间。

​

2.

确认工作空间的所有者。

​

a.

登录扣子编程。

​

b.

在页面左上角选择目标工作空间，展开空间下拉列表，选择

当前空间设置

，在顶部选择

成员管理

页签，查看工作空间所有者信息。

​

​

​

​

​

​

3.

工作空间所有者在扣子编程左下角单击头像，选择

账号设置

，查看账号的 UID。

​

​

​

​

​

​

通过 JWT 获取 Oauth Access Token

​

通过 JWT 获取 OAuth Access Token。

​

说明

JWT 仅能使用一次，如需再次申请 OAuth Access Token，必须重新生成一个 JWT。

​

OAuth Access Token 的有效期默认为 15 分钟，不支持刷新。如需获取新的 Access Token，你需要再次生成一个 JWT，并调用此接口。

​

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

https://

api.coze.cn

/api/permission/

oauth2/

account/{account_id}

/token

​

​

Header

​

​

参数

​

取值

​

说明

​

Content-Type

​

application/json

​

请求正文的方式。

​

Authorization

​

Bearer

$JWT

​

使用应用的客户端私钥签署的 JWT。生成方式可参考

​

2 签署 JWT

。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

说明

​

account_id

​

String

​

必选

​

扣子个人版：

account_id

为目标资源所属工作空间的所有者 UID。获取 UID 的具体步骤，请参考

​

获取资源所属工作空间的所有者 UID

。

​

扣子企业版多组织场景：

account_id

为目标资源所属组织的组织 ID。你可以在

组织管理

>

组织设置

页面查看对应的组织 ID。

​

​

​

​

​

​

​

Body

​

​

字段

​

类型

​

是否必选

​

说明

​

grant_type

​

String

​

必选

​

固定为

urn:ietf:params:oauth:grant-type:jwt-bearer

。

​

duration_seconds

​

Integer

​

可选

​

申请的 AccessToken 有效期，单位为秒，默认 900 秒，即 15 分钟。最大可设置为 86399 秒，即 24 小时。

​

​

返回结果

​

​

字段

​

类型

​

说明

​

access_token

​

String

​

OAuth Access Token。

​

expires_in

​

Integer

​

OAuth Access Token 的过期时间，Unixtime 时间戳格式，精度为秒。

​

​

示例

​

请求示例

​

申请 Token，并限制 Token 只能和 bot1 对话。

​

​

Shell

复制

curl --location '

https://

api.coze.cn

/api/permission/oauth2/account/292298289606****/token

' \

​

--header 'Content-Type: application/json' \

​

--header 'Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InZZd2ZsdFR1OWZBbWtwWFhSdnR5UmREc3RONVMzZWNFcDFqVzB6dVQyRE****.eyJpc3MiOiIzMTAwMDAwMDAwMDIiLCJhdWQiOiJhcGkuY296ZS5jb20iLCJpYXQiOjE1MTYyMzkwMjIsImV4cCI6MTkxNjI1OTAyMiwianRpIjoiZmhqaGFsc2tqZmFkc2pld3F****.CuoiCCF-nHFyGmu2EKlwFoyd3uDyKQ3Drc1CrXQyMVySTzZlZd2M7zKWsziB3AktwbUZiRJlQ1HbghR05CW2YRHwKL4-dlJ4koR3onU7iQAO5DkPCaIxbAuTsQobtCAdkkZTg8gav9EnN1QN_1xq0w8BzuuhS7wCeY8UbaskkTK9GnO4eU9tEINmVw-2CrfB-kNbEHlEDwXfcrb4YPpkw3GhmuPShenNLObfSWS0CqIyakXL8qD5AgXLoB-SejAsRdzloSUInNXENJHfSVMkThxRhJy7yEjX3BmculC54fMKENRfLElBqwJyLLUjeRHsYnaru2ca4W8_yaPJ7F****' \

​

--data '{

​

"duration_seconds": 86399,

​

"grant_type": "urn:ietf:params:oauth:grant-type:jwt-bearer"

​

}'

​

​

返回示例

​

​

JSON

复制

{

​

"access_token"

:

"czs_RQOhsc7vmUzK4bNgb7hn4wqOgRBYAO6xvpFHNbnl6RiQJX3cSXSguIhFDzgy****"

,

​

"expires_in"

:

1721135859

​

}

​

​

错误码

​

​

error_code

​

error_message

​

说明

​

invalid_request

​

invalid request: {parameter}

​

​

原因：请求参数 {parameter} 错误。

​

解决方案：请参考 API 文档查看参数说明。

​

invalid_client

​

/

​

原因：客户端凭证（JWT Token 或者 Client Secret）无效。

​

解决方案：请校验您的客户端凭证。

​

unsupported_grant_type

​

not supported grant type: {grant type}

​

原因：不支持的授权类型 {grant type}。

​

解决方案：请参考 API 文档指定正确的授权类型。

​

access_deny

​

app: {app name} is currently deactivated by the owner

​

原因：OAuth 应用已被禁用。

​

解决方案：在

扣子

编程中启用 OAuth 应用。

​

​

invalid app type

​

原因：应用类型错误。

​

解决方案：渠道应用暂不支持授权码模式。

​

​

login session invalid

​

原因：登录态无效。

​

解决方案：用户需要重新登录

扣子

编程。

​

internal_error

​

Service internal error.

​

原因：服务内部错误。

​

解决方案：建议稍后重试。

​

​

​

​

上一篇

OAuth JWT 授权（渠道场景）

下一篇

OAuth JWT 授权（企业特权应用）
============================================================
# OAuth JWT 授权（企业特权应用）
来源: https://www.coze.cn/open/docs/developer_guides/oauth_jwt_privilege
============================================================

OAuth JWT 授权（企业特权应用）

你可以在企业的默认组织中创建 OAuth JWT 授权（企业特权应用），并根据需要授予 OAuth 应用企业管理、组织管理、空间管理的权限，从而安全、高效地管理企业资源，包括成员、账单、组织及工作空间。你可按需部署多个专项应用，例如财务管理 App 专注账单管理、员工管理 App 负责成员和组织架构维护等。

​

说明

套餐版本

：企业版（企业旗舰版、企业标准版）。

​

角色限制

：组织的超级管理员、管理员。

​

组织限制

：仅支持在

默认组织

中创建 OAuth JWT 授权（企业特权应用）。

​

​

授权流程

​

授权流程如下：

​

1.

在扣子编程创建 OAuth 应用并完成授权。

​

2.

应用程序通过公钥和私钥签署 JWT。

​

3.

应用程序通过 API，获取访问令牌，具体请参见

​

通过 JWT 获取 Oauth Access Token

。

​

4.

应用程序根据访问令牌调用扣子 API。

​

详细步骤如下：

​

1 创建 Oauth 应用并授权

​

你需要在扣子编程中创建 OAuth 应用。

​

1.

登录

扣子编程

。

​

2.

在左侧导航栏选择

API & SDK。

​

3.

在顶部单击

授权

>

OAuth 应用

页签。

​

4.

在 OAuth 应用页面右上角单击

创建新应用

，填写应用的基本信息，并单击

创建并继续

。

​

​

配置

​

说明

​

应用类型

​

应用的类型，此处应指定为

企业特权应用

。

​

客户端类型

​

客户端类型，仅支持

服务类应用

。

​

应用名称

​

应用的名称，在扣子编程中全局唯一。

​

描述

​

应用的基本描述信息。

​

​

5.

填写应用的配置信息。

​

​

​

​

​

​

​

配置

​

说明

​

公钥和私钥

​

用于应用程序客户端身份认证的非对称密钥。

​

单击

创建 Key

，页面将自动创建一对公钥和私钥，公钥自动配置在扣子编程中，私钥以

private_key.pem

文件格式由网页自动下载至本地

Downloads

目录下。支持创建最多三对公钥和私钥。

​

说明

建议将

private_key.pem

文件安全地存储在只有您的应用可以访问的位置。

​

扣子编程使用符合行业标准的 WebCrypto 加密标准，在浏览器前端创建非对称密钥，密钥强度符合行业标准。扣子编程任何时候都不会上传私钥到后端。请您放心使用。

​

​

权限

​

应用程序调用扣子 API 时需要的权限范围。不同层级权限的生效范围请参见

​

权限层级

。

​

说明

此处配置旨在于划定应用的权限范围，并未完成授权操作。创建 OAuth 应用后还需要参考后续操作完成授权。

​

​

​

6.

单击

确定

，完成配置。

​

7.

在弹出的对话框中，确认权限等信息无误后，单击

授权

。

​

​

​

​

​

​

2 签署 JWT

​

扣子编程的

JWT

生成方式及部分参数定义沿用业界统一流程规范，但 JWT 中 Header 和 Payload 部分由扣子编程自行定义。

​

在

JWT

（JSON Web Tokens）的流程中，通常使用私钥来签署（sign）token。JWT 包含三部分，即 Header、Payload 和 signature，其中 header 和 payload 由参数拼接而成，signature 根据指定的签名算法和私钥对 Header 和 Payload 自动计算生成。三部分之间用点（.）分隔。详细的签署方式可参考

JWT 官方文档

。

​

Header 和 Payload

​

扣子编程对 Header 和 Payload 的定义如下：

​

Header

​

Header 部分的参数定义如下：

​

​

参数

​

类型

​

是否必选

​

说明

​

alg

​

String

​

必选

​

签名使用的加密算法。固定为 RS256，即非对称加密算法，一种基于 RSA（非对称加密算法）+ SHA256（安全哈希函数）的签名算法，该算法使用私钥进行签名，公钥进行验证。

​

typ

​

String

​

必选

​

固定为 JWT。

​

kid

​

String

​

必选

​

OAuth 应用的

公钥指纹

，可以在

OAuth 应用

页面找到这个应用，在

操作

列单击编辑图标，进入

配置

页面查看公钥指纹。

​

​

​

​

​

​

​

Header 示例如下：

​

​

JSON

复制

{

​

"alg"

:

"RS256"

,

// 固定为RS256

​

"typ"

:

"JWT"

,

// 固定为 JWT

​

"kid"

:

"gdehvaDegW....."

// OAuth 应用的公钥指纹

​

}

​

​

Payload：

​

Payload 部分的参数定义如下：

​

​

参数

​

类型

​

是否必选

​

说明

​

iss

​

String

​

必选

​

OAuth 应用的 ID，可以在

OAuth 应用

页面查看。

​

aud

​

String

​

必选

​

扣子 API 的 Endpoint，即

api.coze.cn

。

​

iat

​

Integer

​

必选

​

JWT 开始生效的时间，Unixtime 时间戳格式，精确到秒。一般为当前时刻。

​

exp

​

Integer

​

必选

​

JWT 过期的时间，Unixtime 时间戳格式，精确到秒。必须晚于 iat。

​

jti

​

String

​

必选

​

随机字符串，用于防止重放攻击。建议长度大于 32 字节。每次签署 JWT 时应指定为不同的字符串。

​

session_name

​

String

​

可选

​

访问令牌的会话标识。目前仅限在会话隔离场景下使用，即将 session_name 指定为用户在业务侧的 UID，以此区分不同业务侧用户的对话历史。

​

若未指定 session_name，不同用户的对话历史可能会掺杂在一起。

​

说明

会话隔离的详细实现方法请参见

​

如何实现会话隔离

。

​

​

session_context

​

Object

​

可选

​

会话上下文信息，包含设备相关信息等。

​

​

session_context.device_info

​

Object

​

可选

​

用于配置设备相关信息，扣子编程基于该部分信息对设备做用量管控以及账单记录。

​

说明

仅扣子企业旗舰版支持该参数。硬件设备用量管控的具体操作可参考

​

终端用户用量查询和配额管控

。

​

​

session_context.device_info.device_id

​

String

​

可选

​

IoT 等硬件设备 ID，一个设备对应一个唯一的设备号。

​

当需要记录设备用量或对设备用量进行管控时，需要填写该参数，否则，无法对设备进行用量管控，用量统计页面对应的设备 ID 将显示为 N/A。

​

session_context.device_info.custom_consumer

​

​

String

​

可选

​

自定义维度的实体 ID，你可以根据业务需要进行设置，例如 APP 上的用户名等。

​

当需要记录设备用量或对设备用量进行管控，需要填写该参数，否则，无法对设备进行用量管控，用量统计页面对应的自定义 ID 将显示为 N/A。

​

说明

device_id

和

custom_consumer

建议选择其中一个即可。

​

custom_consumer

参数用于设备用量管控，与对话等 API 传入的

user_id

无关，

user_id

主要用于上下文、数据库隔离等场景。

​

出于数据隐私及信息安全等方面的考虑，不建议使用业务系统中定义的用户敏感标识（如手机号等）作为

custom_consumer

的值。

​

​

​

Payload 示例如下：

​

​

JSON

复制

{

​

"iss"

:

"310000000002"

,

// OAuth 应用的 ID

​

"aud"

:

"api.coze.cn"

,

// 扣子 API 的 Endpoint

​

"iat"

:

1516239022

,

// JWT 开始生效的时间，秒级时间戳

​

"exp"

:

1516259022

,

// JWT 过期时间，秒级时间戳

​

"jti"

:

"fhjashjgkhalskj"

,

// 随机字符串，防止重放攻击

​

"session_name"

:

"user_2222"

,

//用户在业务侧的 UID

​

"session_context"

:

{

​

"device_info"

:

{

​

"device_id"

:

"1234567890"

// IoT 等硬件设备的唯一标识 ID

​

}

​

}

​

}

​

​

示例代码

​

你可以直接参考以下示例代码签署 JWT。

​

​

Python

复制

# You must run `

pip install PyJWT cryptography

` to install the PyJWT and the cryptography packages in order to use this script.

​

​

#!/usr/bin/env python3

​

import

sys

​

import

time

​

import

uuid

​

​

import

jwt

​

​

# 替换为你的实际 Coze App 私钥

​

signing_key =

'''

​

-----BEGIN PRIVATE KEY-----

​

xxxxxxxxxxxxxxxxxx

​

-----END PRIVATE KEY-----

​

'''

​

​

payload = {

​

'iat'

:

int

(time.time()),

​

'exp'

:

int

(time.time()) +

600

,

​

"jti"

:

str

(uuid.uuid4()),

​

'aud'

:

'api.coze.cn'

,

# 替换为实际的coze api domain

​

'iss'

:

'1127900106117'

# 替换为你的实际 Coze App ID

​

}

​

​

headers = {

​

'kid'

:

'_v0VjcMlLdQc3tRTD3jC5Xz29TUnKQOhtuD5k-g***'

# 替换为你的实际 Coze App 公钥指纹

​

}

​

​

# Create JWT with headers

​

encoded_jwt = jwt.encode(payload, signing_key, algorithm=

'RS256'

, headers=headers)

​

​

print

(

f"JWT:

{encoded_jwt}

"

)

​

​

最终生成的 JWT 示例如下：

​

​

Plain Text

复制

eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InZZd2ZsdFR1OWZBbWtwWFhSdnR5UmREc3RONVMzZWNFcDFqVzB6dVQyRE****.eyJpc3MiOiIzMTAwMDAwMDAwMDIiLCJhdWQiOiJhcGkuY296ZS5jb20iLCJpYXQiOjE1MTYyMzkwMjIsImV4cCI6MTkxNjI1OTAyMiwianRpIjoiZmhqaGFsc2tqZmFkc2pld3F****.CuoiCCF-nHFyGmu2EKlwFoyd3uDyKQ3Drc1CrXQyMVySTzZlZd2M7zKWsziB3AktwbUZiRJlQ1HbghR05CW2YRHwKL4-dlJ4koR3onU7iQAO5DkPCaIxbAuTsQobtCAdkkZTg8gav9EnN1QN_1xq0w8BzuuhS7wCeY8UbaskkTK9GnO4eU9tEINmVw-2CrfB-kNbEHlEDwXfcrb4YPpkw3GhmuPShenNLObfSWS0CqIyakXL8qD5AgXLoB-SejAsRdzloSUInNXENJHfSVMkThxRhJy7yEjX3BmculC54fMKENRfLElBqwJyLLUjeRHsYnaru2ca4W8_yaPJ7F***

*

​

​

3 获取访问令牌

​

应用程序调用

​

通过 JWT 获取 Oauth Access Token

API ，请求 Header 中携带 JWT，扣子服务端会在响应中通过  access_token 字段返回访问令牌。

​

请求示例如下：

​

​

Shell

复制

curl --location --request POST 'https://api.coze.cn

/

api/permission/oauth2/enterprise_id/volcano_210195***/token' \

​

--header 'Content-Type: application/json' \

​

--header 'Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InZZd2ZsdFR1OWZBbWtwWFhSdnR5UmREc3RONVMzZWNFcDFqVzB6dVQyRE****.eyJpc3MiOiIzMTAwMDAwMDAwMDIiLCJhdWQiOiJhcGkuY296ZS5jb20iLCJpYXQiOjE1MTYyMzkwMjIsImV4cCI6MTkxNjI1OTAyMiwianRpIjoiZmhqaGFsc2tqZmFkc2pld3F****.CuoiCCF-nHFyGmu2EKlwFoyd3uDyKQ3Drc1CrXQyMVySTzZlZd2M7zKWsziB3AktwbUZiRJlQ1HbghR05CW2YRHwKL4-dlJ4koR3onU7iQAO5DkPCaIxbAuTsQobtCAdkkZTg8gav9EnN1QN_1xq0w8BzuuhS7wCeY8UbaskkTK9GnO4eU9tEINmVw-2CrfB-kNbEHlEDwXfcrb4YPpkw3GhmuPShenNLObfSWS0CqIyakXL8qD5AgXLoB-SejAsRdzloSUInNXENJHfSVMkThxRhJy7yEjX3BmculC54fMKENRfLElBqwJyLLUjeRHsYnaru2ca4W8_yaPJ7F****' \

​

--data '{

​

"duration_seconds": 86399,

​

"grant_type": "urn:ietf:params:oauth:grant-type:jwt-bearer"

​

}'

​

​

返回示例如下：

​

​

JSON

复制

{

​

"access_token"

:

"czs_RQOhsc7vmUzK4bNgb7hn4wqOgRBYAO6xvpFHNbnl6RiQJX3cSXSguIhFDzgy****"

,

​

"expires_in"

:

1721135859

​

}

​

​

4 发起扣子 API 请求

​

在 API 请求头中通过

Authorization=Bearer

$Access_Token

指定访问令牌，发起扣子 API 请求。每个接口对应的权限点不同。

​

以

​

查看空间列表

API 为例，完整的 API 请求如下：

​

​

Shell

复制

curl --location --request GET 'https://api.coze.cn/v1/workspaces?&page_num=1&page_size=20' \

​

--header 'Authorization: Bearer czu_UEE2mJn66h0fMHxLCVv9uQ7HAoNNS8DmF6N6grjWmkHX2jPm8SR0tJcKop8v****' \

​

​

通过 JWT 获取 Oauth Access Token

​

通过 JWT 获取 Oauth Access Token。

​

说明

JWT 仅能使用一次，如需再次申请 OAuth Access Token，必须重新生成一个 JWT。

​

OAuth Access Token 的有效期默认为 15 分钟，不支持刷新。如需获取新的 Access Token，你需要再次生成一个 JWT，并调用此接口。

​

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

https://api.coze.cn/

api/

permission/oauth2/enterprise_id/{

enterprise_id

}/token

​

​

Header

​

​

参数

​

取值

​

说明

​

Content-Type

​

application/json

​

请求正文的方式。

​

Authorization

​

Bearer

$JWT

​

使用应用的客户端私钥签署的 JWT。生成方式可参考

​

2 签署 JWT

。

​

​

Path

​

​

字段

​

类型

​

是否必选

​

说明

​

enterprise_id

​

String

​

必选

​

企业 ID。你可以在

组织管理

>

组织设置

页面查看企业 ID。

​

​

​

​

​

​

​

Body

​

​

字段

​

类型

​

是否必选

​

说明

​

grant_type

​

String

​

必选

​

固定为

urn:ietf:params:oauth:grant-type:jwt-bearer

。

​

duration_seconds

​

Integer

​

可选

​

申请的 AccessToken 有效期，单位为秒，默认 900 秒，即 15 分钟。最大可设置为 86399 秒，即 24 小时。

​

​

返回结果

​

​

字段

​

类型

​

说明

​

access_token

​

String

​

OAuth Access Token。

​

expires_in

​

Integer

​

OAuth Access Token 的过期时间，Unixtime 时间戳格式，单位为秒。

​

​

示例

​

请求示例

​

​

Shell

复制

curl --location 'https://

api.coze.cn/

api/permission/oauth2/enterprise_id/volcano_210195***/token

' \

​

--header 'Content-Type: application/json' \

​

--header 'Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InZZd2ZsdFR1OWZBbWtwWFhSdnR5UmREc3RONVMzZWNFcDFqVzB6dVQyRE****.eyJpc3MiOiIzMTAwMDAwMDAwMDIiLCJhdWQiOiJhcGkuY296ZS5jb20iLCJpYXQiOjE1MTYyMzkwMjIsImV4cCI6MTkxNjI1OTAyMiwianRpIjoiZmhqaGFsc2tqZmFkc2pld3F****.CuoiCCF-nHFyGmu2EKlwFoyd3uDyKQ3Drc1CrXQyMVySTzZlZd2M7zKWsziB3AktwbUZiRJlQ1HbghR05CW2YRHwKL4-dlJ4koR3onU7iQAO5DkPCaIxbAuTsQobtCAdkkZTg8gav9EnN1QN_1xq0w8BzuuhS7wCeY8UbaskkTK9GnO4eU9tEINmVw-2CrfB-kNbEHlEDwXfcrb4YPpkw3GhmuPShenNLObfSWS0CqIyakXL8qD5AgXLoB-SejAsRdzloSUInNXENJHfSVMkThxRhJy7yEjX3BmculC54fMKENRfLElBqwJyLLUjeRHsYnaru2ca4W8_yaPJ7F****' \

​

--data '{

​

"duration_seconds": 86399,

​

"grant_type": "urn:ietf:params:oauth:grant-type:jwt-bearer"

​

}'

​

​

返回示例

​

​

JSON

复制

{

​

"access_token"

:

"czs_RQOhsc7vmUzK4bNgb7hn4wqOgRBYAO6xvpFHNbnl6RiQJX3cSXSguIhFDzgy****"

,

​

"expires_in"

:

1721135859

​

}

​

​

错误码

​

​

error_code

​

error_message

​

说明

​

invalid_request

​

invalid request: {parameter}

​

​

原因：请求参数 {parameter} 错误。

​

解决方案：请参考 API 文档查看参数说明。

​

invalid_client

​

/

​

原因：客户端凭证（JWT Token 或者 Client Secret）无效。

​

解决方案：请校验您的客户端凭证。

​

unsupported_grant_type

​

not supported grant type: {grant type}

​

原因：不支持的授权类型 {grant type}。

​

解决方案：请参考 API 文档指定正确的授权类型。

​

access_deny

​

app: {app name} is currently deactivated by the owner

​

原因：OAuth 应用已被禁用。

​

解决方案：在

扣子

编程中启用 OAuth 应用。

​

​

invalid app type

​

原因：应用类型错误。

​

解决方案：渠道应用暂不支持授权码模式。

​

​

login session invalid

​

原因：登录态无效。

​

解决方案：用户需要重新登录

扣子

编程。

​

internal_error

​

Service internal error.

​

原因：服务内部错误。

​

解决方案：建议稍后重试。

​

​

​

​

​

上一篇

OAuth JWT 授权（跨账号授权场景）

下一篇

OAuth 授权（多人协作场景）
============================================================
# OAuth 授权（多人协作场景）
来源: https://www.coze.cn/open/docs/developer_guides/oauth_collaborate
============================================================

OAuth 授权（多人协作场景）

扣子编程支持多人协作场景下跨账号的 OAuth 授权，超级管理员可以为应用程序授予工作空间中的资源权限。

​

说明

仅扣子企业版（企业标准版、企业旗舰版）支持多人协作场景，扣子个人版不支持多人协作场景。

​

​

授权场景

​

使用

​

OAuth 授权码授权

、

​

OAuth PKCE

、

​

OAuth 设备授权

模式时，应用程序获取的 Access Token 默认拥有 OAuth  该企业中所有资源的权限。例如权限列表中包含 chat 权限，通过这个 Token 可以调用 chat 接口，与此账号名下所有空间中的所有智能体对话。

​

在多人协作场景下，扣子用户往往需要跨账号授权，例如，企业 A 里的成员希望使用企业 B 的应用 B，需要给此应用授予权限。

​

授权流程如下：

​

1.

企业 B 的应用发起授权请求。

​

2.

企业 A 的用户通知超级管理员或管理员安装此 OAuth APP。

​

3.

企业 A 的超级管理员或管理员安装此 OAuth APP。

​

4.

企业 A 的用户通知超级管理员或管理员授权此 OAuth APP，应用 B 可以访问企业 A 中的资源。

​

说明

会话、对话、消息为全局资源，不隶属于任何空间，所以指定空间 ID 之后无法授予 Access Token 会话相关的权限，例如创建会话 createConversation。

​

​

实现方案

​

在 OAuth 授权流程中，应用程序发起授权请求，申请获取授权码（code）时，可以指定空间 ID，并引导空间所有者为空间安装应用。

​

以授权码授权模式为例，多人协作场景下应用程序发起授权请求的流程如下。

​

​

​

​

​

​

1 确定工作空间

​

空间协作者可以为应用程序授予工作空间中的资源权限，从而使用工作空间中的资源，例如和工作空间中本人创建的智能体对话、修改本人创建的知识库等。

​

应用程序申请企业资源权限前需要通过以下方式获取空间 ID：

​

引导用户手动输入扣子空间 ID

：扣子用户登录扣子编程后，进入指定空间，空间页面 URL 中

space

参数后的数字就是 Space ID。例如

https://code.coze.cn/space/736163827687053

****

/bot

，空间 ID 为

736163827687053****

。

​

通过 OpenAPI 获取空间列表

。应用程序完成一套简易的授权流程后，调用扣子 OpenAPI 接口

​

查看空间列表

，查看指定账号下的空间列表，并在前端页面中展示空间列表，引导用户选择一个空间。

​

此接口获取的空间 ID 包括以下三种：

​

指定账号的个人空间。

​

指定账号创建的工作空间。

​

指定账号已加入的工作空间。

​

2 发起授权请求

​

1.

应用程序发起授权请求。

​

应用程序通过302重定向方式发起

​

获取授权页面 URL

API 请求，请求的 Path 中指定一个空间 ID，表示授予 Access Token 此空间下所有资源的权限。

​

说明

扣子编程中的资源具有层级关系。授权时如果指定空间，则无法授予 Access Token 与空间平级的其他权限，例如会话相关权限。

​

​

​

​

​

​

​

2.

扣子用户访问授权页面，单击

授权

，确认授权的应用及权限范围。

​

如果你是超级管理员或管理员，单击

授权

后，提示授权成功。请跳转至

​

4 获取授权码

。

​

如果你是成员，单击

授权

后，提示授权失败，说明超级管理员或管理员未安装该应用，请单击

发起申请

。联系超级管理员或管理员安装应用。超级管理员或管理员安装应用后，成员需要再次访问授权页面，单击

授权

，直至页面提示授权成功。

​

如果你是成员，单击

授权

后，提示授权成功，说明超级管理员或管理员已安装该应用。请跳转至

​

4 获取授权码

。

​

3 超级管理员或管理员安装应用

​

当成员单击

发起申请

后，超级管理员或管理员可以通过如下三种方式安装应用：

​

在弹出的安装请求对话框中单击

安装

。

​

在

授权

>

应用安装管理

页面的

操作

列中单击

安装

。

​

访问成员提供的授权链接地址，选择空间权限，单击

授权

。

​

对话框中安装应用

​

​

​

​

​

​

应用安装管理页面安装应用

​

​

​

​

​

​

​

​

​

4 获取授权码

​

授权成功后，扣子 OAuth Server 会在 API 接口响应中返回授权码 code。应用程序可根据授权码换取 Access Token，在被授予的权限范围内调用扣子 API。详细步骤说明可参考

​

2 获取访问令牌

和

​

步骤三：请求令牌

部分。

​

上一篇

OAuth JWT 授权（企业特权应用）

下一篇

鉴权常见问题
============================================================
# 鉴权常见问题
来源: https://www.coze.cn/open/docs/developer_guides/authentication_faq
============================================================

鉴权常见问题

迁移空间后提示鉴权失败

​

从个人版或扣子专业版的工作空间迁移到企业版空间后，原 API 授权将失效，访问线上应用时会鉴权失败，需要重新授权，具体操作请参见

​

升级企业版后更新 API 授权

。

​

令牌有效期太短，如何避免频繁更新？

​

个人访问令牌的有效期最长为一个月，建议使用 OAuth 授权方式。通过 OAuth 授权，可以实现令牌的自动刷新，无需手动更新令牌，从而有效避免频繁更新令牌的问题，具体请参见

​

OAuth 应用管理

。

​

为什么授权失败，提示权限点包含 “企业” 层级？

​

问题现象

​

创建 OAuth 应用或个人访问令牌时，提示

此应用所声明的权限点包含 “企业” 层级，仅企业内的超级管理员或管理员可以授权应用

。

​

可能原因

​

企业层级的权限点，仅团队或企业的超级管理员和管理员创建的访问令牌能被授权该级别的权限。扣子个人账号或企业中的员工不支持授权企业层级的权限点。

​

解决方案

​

1.

确认账号角色：确认登录扣子编程的账号角色为企业的超级管理员或管理员，如果是扣子个人账号，请单击左下角头像，切换到企业的超级管理员或管理员账号。

​

​

​

​

​

​

2.

检查选择的权限点：检查你选择的权限点是否包含了企业层级的权限点。如果你是团队或企业的员工，你需要重新选择权限点，仅保留工作空间级别或账号级别的权限点。

​

​

上一篇

OAuth 授权（多人协作场景）

下一篇

创建智能体
============================================================
# 创建智能体
来源: https://www.coze.cn/open/docs/developer_guides/create_bot
============================================================

创建智能体

创建一个新的智能体。

​

创建的智能体为未发布的草稿状态，创建后可以在扣子编程智能体列表中查看智能体。调用

发布智能体

API 发布智能体后，才能通过

查看智能体列表

或

查看智能体配置

API 查看此智能体。

​

通过 API 方式创建智能体时，支持为智能体设置所在空间、智能体名称和描述、头像、人设与回复逻辑及开场白。

​

基础信息

​

​

请求方式

​

POST

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/bot/create

​

权限

​

createBot

​

确保调用该接口使用的访问令牌开通了

createBot

权限，详细信息参考

鉴权方式

。

​

接口说明

​

调用接口创建一个新的智能体。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $AccessToken

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

space_id

​

String

​

必选

​

75814654762959***

​

智能体所在的空间的 Space ID。Space ID 是空间的唯一标识。

​

进入指定空间，空间页面 URL 中

w

参数后的数字就是 Space ID。例如

https://code.coze.cn/w/75814654762959***/projects

，Space ID 为

75814654762959***

。

​

name

​

String

​

必选

​

每日学一菜

​

智能体的名称。长度为 1~ 20 个字符。

​

description

​

String

​

可选

​

每天教你一道菜的做法，暑假之后你将成为中餐大厨～

​

智能体的描述信息。长度为 0~ 500 个字符。默认为空。

​

icon_file_id

​

String

​

可选

​

73694959811****

​

作为智能体头像的文件 ID。

​

未指定文件 ID 时，扣子编程默认为智能体指定一个头像。

​

如需使用自定义头像，应先通过

上传文件

接口上传本地文件，从接口响应中获取文件 ID。文件 ID 作为智能体头像时，有效期为永久有效。

​

prompt_info

​

Object of

PromptInfo

​

可选

​

{ "prompt": "你是一位经验丰富的中餐大厨，能够熟练传授各类中餐的烹饪技巧，每日为大学生厨师小白教学一道经典中餐的制作方法。" }

​

智能体的人设与回复逻辑。

​

onboarding_info

​

Object of

OnboardingInfo

​

可选

​

{ "prologue": "欢迎你，学徒，今天想学一道什么样的菜？", "suggested_questions": [ "川菜，我想吃辣的", "广东菜，来点鲜的", "随机教我一道菜" ] }

​

智能体的开场白和预置问题相关设置。

​

plugin_id_list

​

Object of

PluginIdList

​

可选

​

{ "id_list": [ { "plugin_id": "731198934927553****", "api_id": "735057536617362****" } ] }

​

智能体的插件配置。

​

workflow_id_list

​

Object of

WorkflowIdList

​

可选

​

{"ids":[{"id":"746049108611037****"}]}

​

智能体绑定的工作流 ID 列表，用于配置智能体关联的工作流。

​

model_info_config

​

Object of

ModelInfoConfig

​

可选

​

{"model_id":"1706077826"}

​

智能体的模型配置，用于指定智能体绑定的模型 ID 及相关参数。不同模型支持的配置参数及取值范围各不相同，可在扣子编程的模型列表中查看具体参数及取值范围。

​

suggest_reply_info

​

Object of

SuggestReplyInfo

​

可选

​

{"reply_mode":"enable"}

​

配置智能体回复后是否提供用户问题建议。

​

​

PromptInfo

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

prompt

​

String

​

可选

​

你是一位经验丰富的中餐大厨，能够熟练传授各类中餐的烹饪技巧，每日为大学生厨师小白教学一道经典中餐的制作方法。

​

智能体的人设与回复逻辑。长度为 0~ 20,000 个字符。默认为空。

​

开启前缀缓存后，不支持通过

prompt

参数设置提示词，需要通过

prefix_prompt_info

参数设置提示词。

​

prompt_mode

​

String

​

可选

​

standard

​

提示词模式，用于指定智能体的人设与回复逻辑的配置方式。枚举值：

​

standard

（默认值）：标准模式。未开启前缀缓存时使用该模式。

​

prefix

：前缀缓存模式，提示词会分为缓存提示词和非缓存提示词两部分。开启前缀缓存后需要设置为该模式。

​

prefix_prompt_info

​

Object of

PrefixPromptInfo

​

可选

​

\

​

通过

cache_type

或

parameters.caching.type

开启前缀缓存后，你需要通过该参数设置

缓存提示词

（

prefix_prompt

）和

非缓存提示词

（

dynamic_prompt

）。不支持通过

prompt

参数设置提示词。

​

​

PrefixPromptInfo

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

prefix_prompt

​

String

​

可选

​

\

​

缓存提示词，大量重复出现的固定规则、模板框架或背景信息，用于指引大模型输出格式与风格。扣子编程会将其缓存并复用，大模型无需重新解析这部分固定信息。

​

dynamic_prompt

​

String

​

可选

​

\

​

非缓存提示词，动态变化的个性化信息，仅针对当前请求生效。

​

​

OnboardingInfo

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

prologue

​

String

​

可选

​

欢迎你，学徒，今天想学一道什么样的菜？

​

智能体的开场白。长度为 0~ 300 个字符。默认无开场白。

​

开场白中如果设置了用户名称变量

{{user_name}}

，API 场景中需要业务方自行处理，例如展示开场白时将此变量替换为业务侧的用户名称。

​

suggested_questions

​

Array of String

​

可选

​

["川菜，我想吃辣的","广东菜，来点鲜的","随机教我一道菜"]

​

智能体的开场白预置问题。每个问题长度为 0~ 50 个字符，问题数量无限制。默认无开场白预置问题。

​

​

PluginIdList

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

id_list

​

Array of

PluginIdInfo

​

可选

​

{ "id_list": [ { "plugin_id": "731198934927553****", "api_id": "735057536617362****" } ] }

​

智能体的插件列表配置。

​

​

PluginIdInfo

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

api_id

​

String

​

必选

​

735057536617362****

​

智能体绑定的插件工具 ID。

​

在扣子编程中，打开资源库页面，选择目标插件，单击插件下的任意工具，页面 URL 中 tool 参数后的数字是插件工具 ID。例如

https://www.coze.cn/space/731762895654132****/plugin/735057533610021****/tool/735057536617362****

，插件工具 ID 为

735057536617362****

。

​

plugin_id

​

String

​

必选

​

731198934927553****

​

智能体绑定的插件 ID。

​

在扣子编程中，打开资源库页面，选择目标插件，页面 URL 中 plugin 参数后的数字是插件 ID。例如

​

https://www.coze.cn/space/728826510807216****/plugin/731198934927553****

，插件 ID 为

731198934927553****

。

​

​

WorkflowIdList

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

ids

​

Array of

WorkflowIdInfo

​

可选

​

[ { "id": "746049108611037****" }]

​

智能体的工作流列表配置。

​

​

WorkflowIdInfo

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

id

​

String

​

必选

​

746049108611037****

​

智能体绑定的工作流 ID。

​

进入工作流的编排页面，在页面 URL 中，

workflow

参数后的数字就是工作流 ID。例如

https://www.coze.com/work_flow?space_id=42463***&workflow_id=73505836754923***

，工作流 ID 为

73505836754923***

。

​

​

ModelInfoConfig

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

model_id

​

String

​

必选

​

1706077826

​

智能体绑定的模型 ID。

​

在工作空间的模型管理页面中单击指定模型，模型详情页面 URL 中

model

参数后的数字就是模型 ID。例如

https://www.coze.cn/space/7288

****

/model/1716

****

，模型 ID 为

1716

****

。

​

top_k

​

Integer

​

可选

​

50

​

生成文本时，采样候选集的大小。该参数控制模型在生成每个词时考虑的候选词数量，值越小生成的文本越保守和确定，值越大生成的文本越多样和随机。

​

top_p

​

Double

​

可选

​

1

​

Top P，即累计概率。该参数控制模型在生成文本时的采样策略，值越小生成的文本越保守和确定，值越大生成的文本越多样和随机。

​

说明

部分模型不支持该参数，具体支持的模型请参见

模型能力差异

。

​

​

max_tokens

​

Integer

​

可选

​

4096

​

最大回复长度。

​

temperature

​

Double

​

可选

​

1

​

生成随机性。

​

说明

部分模型不支持该参数，具体支持的模型请参见

模型能力差异

。

​

​

sp_anti_leak

​

Boolean

​

可选

​

true

​

是否启用 SP 拼接防泄露指令，开启后，当用户尝试获取或复述系统内部的规则、提示词或其他敏感内容时，智能体将礼貌地拒绝用户的请求，确保机密信息不被泄露。

​

true：开启系统提示词防泄漏。

​

false：（默认值）关闭系统提示词防泄漏。

​

context_round

​

Integer

​

可选

​

30

​

携带上下文轮数。

​

response_format

​

String

​

可选

​

text

​

输出格式。取值：

​

text：文本。

​

markdown：Markdown格式。

​

json：JSON 格式。

​

sp_current_time

​

Boolean

​

可选

​

true

​

是否在 SP 中包含当前时间信息。

​

true：智能体在与用户对话时能实时获取并提供准确的时间信息。

​

false：（默认值）在系统提示词中不会拼接当前时间信息。

​

presence_penalty

​

Double

​

可选

​

0

​

重复主题惩罚。

​

frequency_penalty

​

Double

​

可选

​

0

​

重复语句惩罚。

​

cache_type

​

String

​

可选

​

closed

​

为模型开启或关闭前缀缓存。开启前缀缓存后，扣子编程将自动缓存公共前缀内容，后续调用模型时无需重复发送，从而加快模型的响应速度并降低使用成本。具体用法请参见

前缀缓存

。枚举值：

​

closed

（默认值）：关闭前缀缓存。

​

prefix

：开启前缀缓存。

​

说明

套餐限制

：仅扣子个人付费版、企业版（企业标准版、企业旗舰版）支持开启上下文前缀缓存。

​

模型限制

：仅部分模型支持该参数，具体支持的模型请参见

模型能力差异

。

​

其他限制

：该参数仅适用于 Context API 协议，Responses API 协议的前缀缓存需要通过

parameters

参数进行配置。

​

​

api_mode

​

String

​

可选

​

chat_api

​

模型的 API 协议类型，用于指定智能体与模型交互时使用的 API 协议。枚举值：

​

chat_api

（默认值）：智能体需要在请求时带上对话历史作为上下文。适用于日常闲聊、基础咨询、简单文本生成等轻量化需求。

​

responses_api

：模型新推出的 API，不仅延续了 Chat API 的易用性，还原生支持高效的上下文管理和前缀缓存。适用于需要多步推理等复杂任务链处理的场景。

​

说明

仅部分模型支持

responses_api

协议，具体支持的模型请参见

模型能力差异

。

​

​

parameters

​

JSON Map

​

可选

​

深度思考示例：

​

{"thinking_type": "disabled"}

​

上下文管理示例：

​

{"caching":{"type":"disabled"},"store":true,"caching_expire_time":259200}

​

你可以通过该参数配置模型深度思考和

responses_api

的上下文管理相关配置。

​

深度思考

：开发者可以设置开启或关闭深度思考，从而灵活控制模型在交互过程中的 Token 消耗。

​

说明

仅部分模型支持深度思考开关，具体支持的模型请参见

模型能力差异

。

​

​

深度思考

thinking_type

的值可以设置为：

​

enabled

：开启深度思考。智能体在与用户对话时会先输出一段思维链内容，通过逐步拆解问题、梳理逻辑，提升最终输出答案的准确性。但该模式会因额外的推理步骤消耗更多 Token。

​

说明

开启深度思考后：

​

模型不支持 Function Call，即工具调用。

​

智能体不能使用插件、触发器、变量、数据库、文件盒子、不能添加工作流和对话流。

​

不支持使用插件和工作流相关的快捷指令。

​

​

disabled

：关闭深度思考。智能体将直接生成最终答案，不再经过额外的思维链推理过程，可有效降低 Token 消耗，提升响应速度。

​

auto

：启用自动模式后，模型会根据对话内容的复杂度，自动判断是否启用深度思考。

​

上下文管理

：当 api_mode 为

responses_api

时，支持配置前缀缓存、存储和存储时长。

​

说明

仅部分模型支持前缀缓存，具体支持的模型请参见

模型能力差异

。

​

​

上下文管理的具体参数如下：

​

caching.type

：你可以设置为

enabled

或

disabled

，开启或关闭前缀缓存。默认为

disabled

。前缀缓存的具体用法请参考

前缀缓存

。

​

store

：你可以设置为

true

或

false

，开启或关闭存储功能。开启后将自动存储输入、输出字段的消息，不存储思维链中的消息。默认为

true

。

若需使用前缀缓存功能，需开启存储功能。

​

caching_expire_time

：设置上下文缓存和存储的有效时长，单位：秒。最大为 259200 秒（3天）。默认值：259200。

​

​

SuggestReplyInfo

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

reply_mode

​

String

​

可选

​

enable

​

配置智能体回复后，是否提供用户问题建议。枚举值：

​

enable

：在智能体回复后，提供最多 3 条用户问题建议。

​

disable

：在每次智能体回复后，不会提供任何用户问题建议。

​

customized

：开启用户问题建议，并根据用户自定义的 Prompt 提供用户问题建议。你需要在

customized_prompt

参数中设置关于用户问题建议的 Prompt。

​

customized_prompt

​

String

​

可选

​

问题应该与你最后一轮的回复紧密相关，可以引发进一步的讨论。

​

关于用户问题建议的 Prompt。当

reply_mode

设置为

customized

时，需要设置提示词内容。智能体会根据该提示词生成用户问题建议。

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。

​

0 表示调用成功。

​

其他值表示调用失败。你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

CreateDraftBotData

​

{ "bot_id": "73428668*****" }

​

已创建的智能体信息。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

CreateDraftBotData

​

​

参数

​

类型

​

示例

​

说明

​

bot_id

​

String

​

73428668*****

​

创建的智能体 ID。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/bot/create' \

​

--header 'Authorization

:

Bearer $AccessToken' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"space_id"

:

"736142423532160****"

,

​

"name"

:

"每日学一菜"

,

​

"description"

:

"每天教你一道菜的做法，暑假之后你将成为中餐大厨～"

,

​

"icon_file_id"

:

"73694959811****"

,

​

"prompt_info"

:

{

​

"prompt"

:

"你是一位经验丰富的中餐大厨，能够熟练传授各类中餐的烹饪技巧，每日为大学生厨师小白教学一道经典中餐的制作方法。"

​

},

​

"plugin_id_list"

:

{

​

"id_list"

:

[

​

{

​

"plugin_id"

:

"731198934927553****"

,

​

"api_id"

:

"735057536617362****"

​

}

​

]

​

},

​

"onboarding_info"

:

{

​

"prologue"

:

"欢迎你，学徒，今天想学一道什么样的菜？"

,

​

"suggested_questions"

:

[

​

"川菜，我想吃辣的"

,

​

"广东菜，来点鲜的"

,

​

"随机教我一道菜"

​

]

​

},

​

"workflow_id_list"

:

{

​

"ids"

:

[

​

{

​

"id"

:

"746049108611037****"

​

}

​

]

​

},

​

"model_info_config"

:

{

​

"model_id"

:

"1706077826"

​

}

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"data"

:

{

​

"bot_id"

:

"73428668*****"

​

},

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

鉴权常见问题

下一篇

更新智能体
============================================================
# 更新智能体
来源: https://www.coze.cn/open/docs/developer_guides/update_bot
============================================================

更新智能体

更新智能体的配置。

​

通过此 API 可更新通过扣子编程或 API 方式创建的所有智能体。通过 API 方式修改智能体除了智能体名称和描述、头像、人设与回复逻辑及开场白之外，还支持为智能体绑定知识库和插件。

​

接口限制

​

不支持通过 API 绑定火山知识库，只能绑定扣子知识库。

​

基础信息

​

​

请求方式

​

POST

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/bot/update

​

权限

​

edit

​

确保调用该接口使用的访问令牌开通了

edit

权限，详细信息参考

鉴权方式

。

​

接口说明

​

调用接口修改智能体的配置。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $AccessToken

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

bot_id

​

String

​

必选

​

73428668*****

​

待修改配置的智能体 ID。

​

进入智能体的 开发页面，开发页面 URL 中

bot

参数后的数字就是智能体 ID。例如

https://www.coze.cn/space/341****/bot/73428668*****

，bot ID 为

73428668*****

。

​

name

​

String

​

可选

​

每日学一菜

​

智能体的名称。长度为 1~ 20 个字符。

​

description

​

String

​

可选

​

每天教你一道菜的做法，暑假之后你将成为中餐大厨～

​

智能体的描述信息。长度为 0~ 500 个字符。默认为空。

​

icon_file_id

​

String

​

可选

​

73694959811****

​

作为智能体头像的文件 ID。

​

未指定文件 ID 时，扣子编程默认为智能体指定一个头像。

​

如需使用自定义头像，应先通过

上传文件

接口上传本地文件，从接口响应中获取文件 ID。文件 ID 作为智能体头像时，有效期为永久有效。

​

prompt_info

​

Object of

PromptInfo

​

可选

​

{ "prompt": "你是一位经验丰富的中餐大厨，能够熟练传授各类中餐的烹饪技巧，每日为大学生厨师小白教学一道经典中餐的制作方法。" }

​

智能体的人设与回复逻辑。

​

onboarding_info

​

Object of

OnboardingInfo

​

可选

​

{ "prologue": "欢迎你，学徒，今天想学一道什么样的菜？", "suggested_questions": [ "川菜，我想吃辣的", "广东菜，来点鲜的", "随机教我一道菜" ] }

​

智能体的开场白相关设置。

​

knowledge

​

Object of

Knowledge

​

可选

​

{ "dataset_ids": [ "738509371792341****" ], "auto_call": true, "search_strategy": 1 } }

​

智能体的知识库配置。

​

说明

最多绑定 150 个知识库。

​

不支持通过 API 绑定火山知识库，只能绑定扣子知识库。

​

​

plugin_id_list

​

Object of

PluginIdList

​

可选

​

{"id_list":[{"plugin_id":"731198934927553****","api_id":"735057536617362****"}]}

​

智能体的插件配置列表，用于绑定插件及其工具。

​

workflow_id_list

​

Object of

WorkflowIdList

​

可选

​

{"ids": [{"id": "746049108611037****"}]}

​

智能体绑定的工作流 ID 列表，用于配置智能体的工作流。

​

model_info_config

​

Object of

ModelInfoConfig

​

可选

​

{ "model_id": "1706077826" }

​

智能体的模型配置，用于指定智能体使用的模型及其相关参数。

​

模型支持的配置参数及取值范围、默认值各不相同，可在扣子编程中查看具体模型的参数及取值范围。

​

suggest_reply_info

​

Object of

SuggestReplyInfo

​

可选

​

{"reply_mode":"enable"}

​

配置智能体回复后的用户问题建议功能。

​

​

PromptInfo

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

prompt

​

String

​

可选

​

你是一位经验丰富的中餐大厨，能够熟练传授各类中餐的烹饪技巧，每日为大学生厨师小白教学一道经典中餐的制作方法。

​

智能体的人设与回复逻辑。长度为 0~ 20,000 个字符。默认为空。

​

开启前缀缓存后，不支持通过

prompt

参数设置提示词，需要通过

prefix_prompt_info

参数设置提示词。

​

prompt_mode

​

String

​

可选

​

standard

​

提示词模式，用于指定智能体的人设与回复逻辑的配置方式。枚举值：

​

standard

（默认值）：标准模式。未开启前缀缓存时使用该模式。

​

prefix

：前缀缓存模式，提示词会分为缓存提示词和非缓存提示词两部分。开启前缀缓存后需要设置为该模式。

​

prefix_prompt_info

​

Object of

PrefixPromptInfo

​

可选

​

\

​

通过

cache_type

或

parameters.caching.type

开启前缀缓存后，你需要通过该参数设置

缓存提示词

（

prefix_prompt

）和

非缓存提示词

（

dynamic_prompt

）。不支持通过

prompt

参数设置提示词。

​

​

PrefixPromptInfo

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

prefix_prompt

​

String

​

可选

​

\

​

缓存提示词，大量重复出现的固定规则、模板框架或背景信息，用于指引大模型输出格式与风格。扣子编程会将其缓存并复用，大模型无需重新解析这部分固定信息。

​

dynamic_prompt

​

String

​

可选

​

\

​

非缓存提示词，动态变化的个性化信息，仅针对当前请求生效。

​

​

OnboardingInfo

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

prologue

​

String

​

可选

​

欢迎你，学徒，今天想学一道什么样的菜？

​

智能体的开场白。长度为 0~ 300 个字符。默认无开场白。

​

开场白中如果设置了用户名称变量

{{user_name}}

，API 场景中需要业务方自行处理，例如展示开场白时将此变量替换为业务侧的用户名称。

​

suggested_questions

​

Array of String

​

可选

​

["川菜，我想吃辣的","广东菜，来点鲜的","随机教我一道菜"]

​

智能体的开场白预置问题。每个问题长度为 0~ 50 个字符，问题数量无限制。默认无开场白预置问题。

​

​

Knowledge

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

dataset_ids

​

Array of String

​

可选

​

["738509371792341****"]

​

智能体绑定的知识库 ID。

​

在扣子编程中打开指定知识库页面，页面 URL 中

knowledge

参数后的数字就是知识库 ID。例如

https://www.coze.cn/space/736142423532160****/knowledge/738509371792341****

，知识库 ID 为

738509371792341****

。

​

说明

最多绑定 150 个知识库。

​

不支持通过 API 绑定火山知识库，只能绑定扣子知识库。

​

​

auto_call

​

Boolean

​

可选

​

true

​

是否自动调用知识库。取值包括：

​

true：（默认）自动调用

。每一轮对话都会调用知识库，使用召回的内容辅助生成回复。

​

false：按需调用

。根据实际需要来调用知识库，使用召回内容辅助生成回复。此时，需要在左侧的人设与回复逻辑区域明确写清楚在什么情况下调用哪个知识库进行回复。

​

search_strategy

​

Integer

​

可选

​

1

​

知识库搜索策略。取值包括：

​

0

：（默认）语义搜索。像人类一样去理解词与词，句与句之间的关系。

​

1

：混合搜索。结合全文检索和语义检索的优势，并对结果进行综合排序召回相关的内容片段。

​

20

：全文搜索。基于关键词进行全文检索。

​

​

PluginIdList

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

id_list

​

Array of

PluginIdInfo

​

可选

​

{ "id_list": [ { "plugin_id": "731198934927553****", "api_id": "735057536617362****" } ] }

​

智能体的插件列表配置。

​

​

PluginIdInfo

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

api_id

​

String

​

必选

​

735057536617362****

​

智能体绑定的插件工具 ID。

​

在扣子编程中，打开资源库页面，选择目标插件，单击插件下的任意工具，页面 URL 中 tool 参数后的数字是插件工具 ID。例如

https://www.coze.cn/space/731762895654132****/plugin/735057533610021****/tool/735057536617362****

，插件工具 ID 为

735057536617362****

。

​

plugin_id

​

String

​

必选

​

731198934927553****

​

智能体绑定的插件 ID。

​

在扣子编程中，打开资源库页面，选择目标插件，页面 URL 中 plugin 参数后的数字是插件 ID。例如

​

https://www.coze.cn/space/728826510807216****/plugin/731198934927553****

，插件 ID 为

731198934927553****

。

​

​

WorkflowIdList

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

ids

​

Array of

WorkflowIdInfo

​

可选

​

[ { "id": "746049108611037****" }]

​

智能体的工作流列表配置。

​

​

WorkflowIdInfo

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

id

​

String

​

必选

​

746049108611037****

​

智能体绑定的工作流 ID。

​

进入工作流的编排页面，在页面 URL 中，

workflow

参数后的数字就是工作流 ID。例如

https://www.coze.com/work_flow?space_id=42463***&workflow_id=73505836754923***

，工作流 ID 为

73505836754923***

。

​

​

ModelInfoConfig

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

model_id

​

String

​

必选

​

1706077826

​

智能体绑定的模型 ID。

​

在工作空间的模型管理页面中单击指定模型，模型详情页面 URL 中

model

参数后的数字就是模型 ID。例如

https://www.coze.cn/space/7288

****

/model/1716

****

，模型 ID 为

1716

****

。

​

top_k

​

Integer

​

可选

​

50

​

生成文本时，采样候选集的大小。该参数控制模型在生成每个词时考虑的候选词数量，值越小生成的文本越保守和确定，值越大生成的文本越多样和随机。

​

top_p

​

Double

​

可选

​

1

​

Top P，即累计概率。该参数控制模型在生成文本时的采样策略，值越小生成的文本越保守和确定，值越大生成的文本越多样和随机。

​

说明

部分模型不支持该参数，具体支持的模型请参见

模型能力差异

。

​

​

max_tokens

​

Integer

​

可选

​

4096

​

最大回复长度。

​

temperature

​

Double

​

可选

​

1

​

生成随机性。

​

说明

部分模型不支持该参数，具体支持的模型请参见

模型能力差异

。

​

​

sp_anti_leak

​

Boolean

​

可选

​

true

​

是否启用 SP 拼接防泄露指令，开启后，当用户尝试获取或复述系统内部的规则、提示词或其他敏感内容时，智能体将礼貌地拒绝用户的请求，确保机密信息不被泄露。

​

true：开启系统提示词防泄漏。

​

false：（默认值）关闭系统提示词防泄漏。

​

context_round

​

Integer

​

可选

​

30

​

携带上下文轮数。

​

response_format

​

String

​

可选

​

text

​

输出格式。取值：

​

text：文本。

​

markdown：Markdown格式。

​

json：JSON 格式。

​

sp_current_time

​

Boolean

​

可选

​

true

​

是否在 SP 中包含当前时间信息。

​

true：智能体在与用户对话时能实时获取并提供准确的时间信息。

​

false：（默认值）在系统提示词中不会拼接当前时间信息。

​

presence_penalty

​

Double

​

可选

​

0

​

重复主题惩罚。

​

frequency_penalty

​

Double

​

可选

​

0

​

重复语句惩罚。

​

cache_type

​

String

​

可选

​

closed

​

为模型开启或关闭前缀缓存。开启前缀缓存后，扣子编程将自动缓存公共前缀内容，后续调用模型时无需重复发送，从而加快模型的响应速度并降低使用成本。具体用法请参见

前缀缓存

。枚举值：

​

closed

（默认值）：关闭前缀缓存。

​

prefix

：开启前缀缓存。

​

说明

套餐限制

：仅扣子个人付费版、企业版（企业标准版、企业旗舰版）支持开启上下文前缀缓存。

​

模型限制

：仅部分模型支持该参数，具体支持的模型请参见

模型能力差异

。

​

其他限制

：该参数仅适用于 Context API 协议，Responses API 协议的前缀缓存需要通过

parameters

参数进行配置。

​

​

api_mode

​

String

​

可选

​

chat_api

​

模型的 API 协议类型，用于指定智能体与模型交互时使用的 API 协议。枚举值：

​

chat_api

（默认值）：智能体需要在请求时带上对话历史作为上下文。适用于日常闲聊、基础咨询、简单文本生成等轻量化需求。

​

responses_api

：模型新推出的 API，不仅延续了 Chat API 的易用性，还原生支持高效的上下文管理和前缀缓存。适用于需要多步推理等复杂任务链处理的场景。

​

说明

仅部分模型支持

responses_api

协议，具体支持的模型请参见

模型能力差异

。

​

​

parameters

​

JSON Map

​

可选

​

深度思考示例：

​

{"thinking_type": "disabled"}

​

上下文管理示例：

​

{"caching":{"type":"disabled"},"store":true,"caching_expire_time":259200}

​

你可以通过该参数配置模型深度思考和

responses_api

的上下文管理相关配置。

​

深度思考

：开发者可以设置开启或关闭深度思考，从而灵活控制模型在交互过程中的 Token 消耗。

​

说明

仅部分模型支持深度思考开关，具体支持的模型请参见

模型能力差异

。

​

​

深度思考

thinking_type

的值可以设置为：

​

enabled

：开启深度思考。智能体在与用户对话时会先输出一段思维链内容，通过逐步拆解问题、梳理逻辑，提升最终输出答案的准确性。但该模式会因额外的推理步骤消耗更多 Token。

​

说明

开启深度思考后：

​

模型不支持 Function Call，即工具调用。

​

智能体不能使用插件、触发器、变量、数据库、文件盒子、不能添加工作流和对话流。

​

不支持使用插件和工作流相关的快捷指令。

​

​

disabled

：关闭深度思考。智能体将直接生成最终答案，不再经过额外的思维链推理过程，可有效降低 Token 消耗，提升响应速度。

​

auto

：启用自动模式后，模型会根据对话内容的复杂度，自动判断是否启用深度思考。

​

上下文管理

：当 api_mode 为

responses_api

时，支持配置前缀缓存、存储和存储时长。

​

说明

仅部分模型支持前缀缓存，具体支持的模型请参见

模型能力差异

。

​

​

上下文管理的具体参数如下：

​

caching.type

：你可以设置为

enabled

或

disabled

，开启或关闭前缀缓存。默认为

disabled

。前缀缓存的具体用法请参考

前缀缓存

。

​

store

：你可以设置为

true

或

false

，开启或关闭存储功能。开启后将自动存储输入、输出字段的消息，不存储思维链中的消息。默认为

true

。

若需使用前缀缓存功能，需开启存储功能。

​

caching_expire_time

：设置上下文缓存和存储的有效时长，单位：秒。最大为 259200 秒（3天）。默认值：259200。

​

​

SuggestReplyInfo

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

reply_mode

​

String

​

可选

​

enable

​

配置智能体回复后，是否提供用户问题建议。枚举值：

​

enable

：在智能体回复后，提供最多 3 条用户问题建议。

​

disable

：在每次智能体回复后，不会提供任何用户问题建议。

​

customized

：开启用户问题建议，并根据用户自定义的 Prompt 提供用户问题建议。你需要在

customized_prompt

参数中设置关于用户问题建议的 Prompt。

​

customized_prompt

​

String

​

可选

​

问题应该与你最后一轮的回复紧密相关，可以引发进一步的讨论。

​

关于用户问题建议的 Prompt。当

reply_mode

设置为

customized

时，需要设置提示词内容。智能体会根据该提示词生成用户问题建议。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。

​

0 表示调用成功。

​

其他值表示调用失败。你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{ "logid": "20250106172024B5F607030EFFAD653960" }

​

响应详情信息。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/bot/update' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json' \

​

{

​

"bot_id"

:

"73428668*****"

,

​

"name"

:

"每日学一菜"

,

​

"description"

:

"每天教你一道菜的做法，暑假之后你将成为中餐大厨～"

,

​

"icon_file_id"

:

"73694959811****"

,

​

"prompt_info"

:

{

​

"prompt"

:

"你是一位经验丰富的中餐大厨，能够熟练传授各类中餐的烹饪技巧，每日为大学生厨师小白教学一道经典中餐的制作方法。"

​

},

​

"plugin_id_list"

:

{

​

"id_list"

:

[

​

{

​

"plugin_id"

:

"731198934927553****"

,

​

"api_id"

:

"735057536617362****"

​

}

​

]

​

},

​

"onboarding_info"

:

{

​

"prologue"

:

"欢迎你，学徒，今天想学一道什么样的菜？"

,

​

"suggested_questions"

:

[

​

"川菜，我想吃辣的"

,

​

"广东菜，来点鲜的"

,

​

"随机教我一道菜"

​

]

​

},

​

"knowledge"

:

{

​

"dataset_ids"

:

[

​

"738509371792341****"

​

],

​

"auto_call"

:

true

,

​

"search_strategy"

:

1

​

},

​

"model_info_config"

:

{

​

"model_id"

:

"1706077826"

​

},

​

"workflow_id_list"

:

{

​

"ids"

:

[

​

{

​

"id"

:

"746049108611037****"

​

}

​

]

​

}

​

}

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

创建智能体

下一篇

发布智能体
============================================================
# 发布智能体
来源: https://www.coze.cn/open/docs/developer_guides/publish_bot
============================================================

发布智能体

将指定智能体发布到 API、Chat SDK 或者自定义渠道。

​

基础信息

​

​

请求方式

​

POST

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/bot/publish

​

权限

​

publish

​

确保调用该接口使用的访问令牌开通了

publish

权限，详细信息参考

鉴权方式

。

​

接口说明

​

调用接口将指定智能体发布到 API、Chat SDK 或者自定义渠道。

​

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $AccessToken

​

用于验证客户端身份的访问令牌。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

bot_id

​

String

​

必选

​

73428668*****

​

要发布的智能体 ID。

​

进入智能体的开发页面，开发页面 URL 中 bot 参数后的数字就是智能体 ID。例如

https://www.coze.com/space/341****/bot/73428668*****

，bot ID 为

73428668*****

。

​

connector_ids

​

Array of String

​

必选

​

["1024"]

​

智能体的发布渠道 ID 列表。目前支持通过此 API 将智能体发布为 API、Chat SDK 以及自定义渠道。

​

API: 1024

​

ChatSDK: 999

​

自定义渠道: 自定义渠道 ID。自定义渠道 ID 的获取方式如下：在扣子编程左下角单击头像，在

账号设置

>

发布渠道

>

企业自定义渠道管理

页面查看渠道 ID。

​

connectors

​

JSON Map

​

可选

​

{"7470849514748***":{"device_id":"[\"51237825***\"]"}}

​

智能体发布自定义渠道时，你可以通过该参数传递自定义参数给渠道。例如，设置将智能体发布到指定设备。格式：

{"渠道 ID":{"key":"value"}}

，其中

key

为

绑定设备 API

中设置的 key 值，

value

需要经 JSON 序列化。

​

说明

智能体发布自定义渠道时，需要同时发布 API 渠道。

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。

​

0 表示调用成功。

​

其他值表示调用失败。你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

PublishDraftBotData

​

{ "bot_id": "743961547827****", "version": "1732190531***" }

​

接口响应的业务信息。

​

detail

​

Object of

ResponseDetail

​

{"logid":"1234567890****"}

​

包含请求的详细日志信息，用于问题排查和调试。

​

​

PublishDraftBotData

​

​

参数

​

类型

​

示例

​

说明

​

bot_id

​

String

​

73428668*****

​

发布的智能体的 ID。

​

version

​

String

​

1753871809679

​

智能体的版本号，用于标识智能体的当前版本号。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

​

示例

​

请求示例

​

发布官方渠道

发布自定义渠道

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/bot/publish' \

​

--header 'Authorization

:

Bearer pat_x*******' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"bot_id"

:

"73428668*****"

,

​

"connector_ids"

:

[

​

"1024"

​

]

​

}

'

​

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"data"

:

{

​

"bot_id"

:

"743961547827****"

,

​

"version"

:

"1732190531***"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

更新智能体

下一篇

查看智能体列表
============================================================
# 查看智能体列表
来源: https://www.coze.cn/open/docs/developer_guides/bots_list_draft_published
============================================================

查看智能体列表

查看指定空间的智能体列表，包含草稿状态的智能体和已发布的智能体。

​

扣子个人版中，仅支持查询作为空间所有者的智能体。

​

扣子企业版中，可以查看指定空间下的所有智能体。

​

基础信息

​

​

请求方式

​

GET

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/bots

​

权限

​

listBot

​

确保调用该接口使用的访问令牌开通了

listBot

权限，详细信息参考

鉴权方式

。

​

接口说明

​

查看指定空间的智能体列表。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

workspace_id

​

String

​

必选

​

5123945629***

​

智能体所在的工作空间的工作空间 ID。

​

进入指定空间，空间页面 URL 中

w

参数后的数字就是 工作空间 ID。例如

https://code.coze.cn/w/75814654762959***/projects

，工作空间 ID 为

75814654762959***

。

​

publish_status

​

String

​

可选

​

all

​

智能体的发布状态，用于筛选不同发布状态的智能体。枚举值如下：

​

all ：所有状态。

​

published_online ：（默认值）已发布的正式版。

​

published_draft ：已发布但当前为草稿状态。

​

unpublished_draft ：从未发布过。

​

connector_id

​

String

​

可选

​

1024

​

渠道 ID，仅在智能体发布状态为

published_online

或

published_draft

时需要设置。用于筛选指定渠道下已发布的智能体版本，包括线上正式版本和草稿版本。默认值为

1024

，表示获取 API 发布渠道下的最新版本。

​

扣子编程的渠道 ID 包括：

​

1024：API 渠道。

​

999：Chat SDK。

​

10000122：扣子商店。

​

10000113：微信客服。

​

10000120：微信服务号。

​

10000121：微信订阅号。

​

10000126：抖音小程序。

​

10000127：微信小程序。

​

10000011：飞书。

​

10000128：飞书多维表格。

​

10000117：掘金。

​

自定义渠道 ID。自定义渠道 ID 的获取方式如下：在扣子编程左下角单击头像，在

账号设置

>

发布渠道

>

企业自定义渠道管理

页面查看渠道 ID。

​

page_num

​

Integer

​

可选

​

1

​

分页查询时的页码。默认为 1，即返回第一页数据。

​

page_size

​

Integer

​

可选

​

20

​

分页大小。默认为 20，即每页返回 20 条数据。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Object of

OpenGetBotData

​

{"items":[{"id":"74876004423701****","name":"test","icon_url":"

https://example.com/FileBizType.BIZ_BOT_APP/app1***.png

","updated_at":1718289297,"description":"应用测试","is_published":true,"published_at":1718289297,"owner_user_id":"23423423****"}],"total":1}

​

返回的智能体列表数据，包含智能体的基本信息和总数。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"1234567890abcdef"}

​

包含请求的详细日志信息，用于问题排查和调试。

​

​

OpenGetBotData

​

​

参数

​

类型

​

示例

​

说明

​

items

​

Array of

BotSimpleInfo

​

[ { "id": "751614225987***", "is_published": false, "updated_at": 1749994622, "owner_user_id": "32902037***", "name": "***", "description": "***", "icon_url": "

https://example.com/FileBizType.BIZ_BOT_ICON/***

" } ]

​

返回的智能体列表。

​

total

​

Long

​

2

​

返回的智能体的数量。

​

​

BotSimpleInfo

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

7493066380997****

​

智能体的 ID。

​

name

​

String

​

语音伴侣

​

智能体的名称。

​

icon_url

​

String

​

https://example.com/

agent

1

***

.png

​

智能体图标的 URL。

​

folder_id

​

String

​

75231612553354***

​

智能体所属的文件夹 ID。

​

updated_at

​

Long

​

1718289297

​

智能体的最近一次更新时间。以 Unix 时间戳格式表示。单位为秒。

​

description

​

String

​

语音伴侣

​

智能体的描述。

​

is_published

​

Boolean

​

true

​

智能体是否已发布。

​

true

表示已发布。

​

false

表示未发布。

​

published_at

​

Long

​

1718289297

​

智能体的最近一次发布时间。以 Unix 时间戳格式表示。单位为秒。

​

仅当智能体已发布时返回该值。如果智能体是未发布过的草稿版本，则该参数的值为空。

​

owner_user_id

​

String

​

23423423****

​

智能体创建者的扣子用户 ID。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v1/bots?workspace_id=5123945629***&publish_status=&connector_id=1024&page_num=1&page_size=20' \

​

--header 'Authorization

:

Bearer pat_Osa******' \

​

--header 'Content-Type

:

application/json' \

​

​

返回示例

​

​

JSON

复制

{

​

"data"

:

{

​

"items"

:

[

​

{

​

"id"

:

"7493066380997****"

,

​

"name"

:

"语音伴侣"

,

​

"icon_url"

:

"https://example.com/agent1***.png"

,

​

"folder_id"

:

"75231612553354***"

,

​

"updated_at"

:

1718289297

,

​

"description"

:

"语音伴侣"

,

​

"is_published"

:

false

,

​

"published_at"

:

1718289297

,

​

"owner_user_id"

:

"23423423****"

​

}

​

],

​

"total"

:

1

​

},

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

发布智能体

下一篇

查看智能体配置
============================================================
# 查看智能体配置
来源: https://www.coze.cn/open/docs/developer_guides/get_metadata_draft_published
============================================================

查看智能体配置

查看指定智能体的配置信息，你可以查看该智能体已发布版本的配置，或当前草稿版本的配置。

​

基础信息

​

​

请求方式

​

GET

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/bots/:bot_id

​

权限

​

getMetadata

​

确保调用该接口使用的访问令牌开通了

getMedata

权限，详细信息参考

鉴权方式

。

​

接口说明

​

查看指定智能体的配置信息。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $AccessToken

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

bot_id

​

String

​

必选

​

73428668*****

​

要查看的智能体 ID。

​

进入智能体的开发页面，开发页面 URL 中

bot

参数后的数字就是智能体 ID。例如

https://www.coze.cn/space/341****/bot/73428668*****

，bot ID 为

73428668*****

。

​

说明

确保该智能体的所属空间已经生成了访问令牌。

​

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

is_published

​

Boolean

​

可选

​

true

​

根据智能体的发布状态筛选对应版本。默认值为

true

。

​

true

：查看已发布版本的配置。

​

false

：查看当前草稿版本的配置。

​

​

返回参数

​

​

BotInfo

​

​

PromptInfo

​

​

PrefixPromptInfo

​

​

OnboardingInfoV2

​

​

PluginInfo

​

​

ApiInfo

​

​

ModelInfo

​

​

CommonKnowledge

​

​

KnowledgeInfo

​

​

Variable

​

​

MediaConfig

​

​

Voice

​

​

ShortcutCommandInfo

​

​

ShortcutCommandToolInfo

​

​

WorkflowInfo

​

​

BackgroundImageInfo

​

​

BackgroundImageDetail

​

​

CanvasPosition

​

​

GradientPosition

​

​

ResponseDetail

​

​

示例

​

请求示例

​

​

返回示例

​

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

查看智能体列表

下一篇

开启或关闭智能体多人协作
============================================================
# 开启或关闭智能体多人协作
来源: https://www.coze.cn/open/docs/developer_guides/switch_bot_develop_mode
============================================================

开启或关闭智能体多人协作

开启或关闭智能体多人协作模式。

​

开启多人协作后，你才能调用

添加智能体的协作者

API 为智能体添加协作者。

​

接口限制

​

套餐限制

：扣子企业版（企业标准版、企业旗舰版）。

​

不支持渠道类型 OAuth 应用。使用 OAuth JWT 应用和服务访问令牌时，只需要有对应权限点即可。其余认证方式，只有

智能体所有者

能开启或关闭智能体的多人协作模式。

​

关闭智能体多人协作前，需要先调用

删除智能体协作者

API 删除所有协作者。

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/bots/:bot_id/collaboration_mode

​

​

权限

​

Bot.switchDevelopMode

​

确保调用该接口使用的访问令牌开通了

Bot.switchDevelopMode

权限，详细信息参考

鉴权方式

。

​

接口说明

​

开启或关闭智能体多人协作模式。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

bot_id

​

String

​

可选

​

73428668*****

​

需要设置协作模式的智能体 ID。

​

进入智能体的开发页面，开发页面 URL 中 bot 参数后的数字就是智能体 ID。例如

https://www.coze.com/space/341****/bot/73428668*****

，bot ID 为

73428668*****

。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

collaboration_mode

​

String

​

可选

​

collaboration

​

智能体的协作模式，枚举值：

​

single

：单用户模式。

​

collaboration

：多人协作模式。

​

说明

如需将智能体多人协作模式变更为单用户模式，需要先调用

删除智能体协作者

API 删除所有协作者。

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/bots/73428668*****/collaboration_mode' \

​

--header 'Authorization

:

Bearer pat_Osa******' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"collaboration_mode"

:

"collaboration"

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

查看智能体配置

下一篇

添加智能体的协作者
============================================================
# 添加智能体的协作者
来源: https://www.coze.cn/open/docs/developer_guides/add_bot_collaborator
============================================================

添加智能体的协作者

添加智能体的协作者。

​

接口限制

​

套餐限制：扣子企业版（企业标准版、企业旗舰版）。

​

每次请求只能添加一位协作者。如需添加多位，请依次发送请求。

​

协作者只能是该工作空间的成员。

​

不支持渠道类型 OAuth 应用。使用 OAuth JWT 应用和服务访问令牌时，只需要有对应权限点即可。其余认证方式，只有

智能体的所有者和协作者

能添加协作者。

​

主账号内的所有子账号共享同一 API 的流控额度，单个 API 的流控限制为 5 QPS。

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/bots/:bot_id/collaborators

​

​

权限

​

Bot.addCollaborator

​

确保调用该接口使用的访问令牌开通了

Bot.addCollaborator

权限，详细信息参考

鉴权方式

。

​

接口说明

​

添加智能体的协作者。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

bot_id

​

String

​

必选

​

737946218936519****

​

需要添加协作者的智能体 ID。

​

进入智能体编排页面，页面 URL 中

bot

参数后的数字就是智能体 ID。例如

https://www.coze.cn/space/341****/bot/73428668*****

，bot ID 为

73428668*****

。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

collaborators

​

Array of

CollaboratorAddData

​

必选

​

[{"user_id":"411479148551****"}]

​

智能体资源协作者列表。单次最多添加

1

个协作者。

​

​

CollaboratorAddData

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

user_id

​

String

​

必选

​

411479148551****

​

协作者的扣子用户 UID。你只能添加对应工作空间中的成员作为协作者。

​

在扣子编程平台左下角单击头像，选择

账号设置

，查看账号的 UID。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/bots/737946218936519****/collaborators' \

​

--header 'Authorization

:

Bearer pat_Osa******' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"collaborators"

:

[

​

{

​

"user_id"

:

"411479148551****"

​

}

​

]

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

开启或关闭智能体多人协作

下一篇

添加应用的协作者
============================================================
# 添加应用的协作者
来源: https://www.coze.cn/open/docs/developer_guides/add_app_collaborator
============================================================

添加应用的协作者

添加低代码应用的协作者。

​

接口限制

​

套餐限制：扣子企业版（企业标准版、企业旗舰版）。

​

每次请求只能添加一位协作者。如需添加多位，请依次发送请求。

​

协作者只能是该工作空间的成员。

​

不支持渠道类型 OAuth 应用。使用 OAuth JWT 应用和服务访问令牌时，只需要有对应权限点即可。其余认证方式，只有

应用的所有者和协作者

能添加协作者。

​

主账号内的所有子账号共享同一 API 的流控额度，单个 API 的流控限制为 5 QPS。

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/apps/:app_id/collaborators

​

​

权限

​

Project.addCollaborator

​

确保调用该接口使用的访问令牌开通了

Project.addCollaborator

权限，详细信息参考

鉴权方式

。

​

接口说明

​

添加低代码应用的协作者。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

app_id

​

String

​

必选

​

75353861140****

​

低代码应用的 ID。

​

进入应用编排页面，页面 URL 中

project-ide

参数后的数字就是应用 ID。例如

https://www.coze.cn/space/7532329396037500982/project-ide/7535386114057***

，应用 ID 为

7535386114057***

。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

collaborators

​

Array of

CollaboratorAddData

​

必选

​

[{"user_id":"411479148551****"}]

​

低代码应用的协作者列表。单次最多添加

1

个协作者。

​

​

CollaboratorAddData

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

user_id

​

String

​

必选

​

411479148551****

​

协作者的扣子用户 UID。你只能添加对应工作空间中的成员作为协作者。

​

在扣子编程平台左下角单击头像，选择

账号设置

，查看账号的 UID。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/apps/75353861140****/collaborators' \

​

--header 'Authorization

:

Bearer pat_Osa******' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"collaborators"

:

[

​

{

​

"user_id"

:

"411479148551****"

​

}

​

]

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

添加智能体的协作者

下一篇

删除智能体的协作者
============================================================
# 删除智能体的协作者
来源: https://www.coze.cn/open/docs/developer_guides/remove_bot_collaborator
============================================================

删除智能体的协作者

删除智能体的协作者。

​

接口限制

​

每次请求只能删除一位协作者。如需删除多位，请依次发送请求。

​

不支持渠道类型 OAuth 应用。使用 OAuth JWT 应用和服务访问令牌时，只需要有对应权限点即可。其余认证方式，只有

智能体的所有者和协作者

有权删除。

​

主账号内的所有子账号共享同一 API 的流控额度，单个 API 的流控限制为 5 QPS。

​

基础信息

​

​

请求方式

​

DELETE

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/bots/:bot_id/collaborators/:user_id

​

​

权限

​

Bot.removeCollaborator

​

确保调用该接口使用的访问令牌开通了

Bot.removeCollaborator

权限，详细信息参考

鉴权方式

。

​

接口说明

​

删除智能体的协作者。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

bot_id

​

String

​

必选

​

737946218936519****

​

需要删除协作者的智能体 ID。

​

进入智能体编排页面，页面 URL 中

bot

参数后的数字就是智能体 ID。例如

https://www.coze.cn/space/341****/bot/73428668*****

，bot ID 为

73428668*****

。

​

user_id

​

String

​

必选

​

411479148551****

​

待删除的协作者的扣子用户 UID。

​

在扣子编程左下角单击头像，选择

账号设置

，查看账号的 UID。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request DELETE 'https

:

//api.coze.cn/v1/bots/737946218936519****/collaborators/411479148551****' \

​

--header 'Authorization

:

Bearer pat_Osa******' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

添加应用的协作者

下一篇

删除应用的协作者
============================================================
# 删除应用的协作者
来源: https://www.coze.cn/open/docs/developer_guides/remove_app_collaborator
============================================================

删除应用的协作者

删除低代码应用的协作者。

​

删除协作者时，扣子编程会将该协作者创建的工作流、插件等资源转移给应用的所有者。

​

接口限制

​

主账号内的所有子账号共享同一 API 的流控额度，单个 API 的流控限制为 5 QPS。

​

每次请求只能删除一位协作者。如需删除多位，请依次发送请求。

​

不支持渠道类型 OAuth 应用。使用 OAuth JWT 应用和服务访问令牌时，只需要有对应权限点即可。其余认证方式，只有

应用的所有者和协作者

有权删除。

​

基础信息

​

​

请求方式

​

DELETE

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/apps/:app_id/collaborators/:user_id

​

​

权限

​

Project.removeCollaborator

​

确保调用该接口使用的访问令牌开通了

Project.removeCollaborator

权限，详细信息参考

鉴权方式

。

​

接口说明

​

删除低代码应用的协作者。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

app_id

​

String

​

必选

​

75353861140****

​

待删除协作者的低代码应用的 ID。

​

进入低代码应用编排页面，页面 URL 中

project-ide

参数后的数字就是应用 ID。例如

https://www.coze.cn/space/7532329396037500982/project-ide/7535386114057***

，应用 ID 为

7535386114057***

。

​

user_id

​

String

​

必选

​

411479148551****

​

待删除协作者的扣子用户 UID。

​

在扣子编程左下角单击头像，选择

账号设置

，查看账号的 UID。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request DELETE 'https

:

//api.coze.cn/v1/apps/75353861140****/collaborators/411479148551****' \

​

--header 'Authorization

:

Bearer pat_Osa******' \

​

--header 'Content-Type

:

application/json' \

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

删除智能体的协作者

下一篇

查看智能体版本列表
============================================================
# 查看智能体版本列表
来源: https://www.coze.cn/open/docs/developer_guides/list_bot_versions
============================================================

查看智能体版本列表

查看智能体版本列表。

​

接口描述

​

查询某个智能体的版本列表，支持查询已发布版本或未发布版本的版本号、版本创建者信息、创建时间等。

​

扣子个人版中，仅支持查询作为空间所有者的智能体。

​

扣子团队版和企业版中，可以查看团队企业下的所有智能体。

​

基础信息

​

​

请求方式

​

GET

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/bots/:bot_id/versions

​

​

权限

​

Bot.listVersion

​

确保调用该接口使用的访问令牌开通了

Bot.listVersion

权限，详细信息参考

鉴权方式

。

​

接口说明

​

查看智能体版本列表。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

bot_id

​

String

​

必选

​

73428668*****

​

待查询的智能体 ID。

​

进入智能体的开发页面，开发页面 URL 中 bot 参数后的数字就是智能体 ID。例如

https://www.coze.com/space/341****/bot/73428668*****

，bot ID 为

73428668*****

。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

page_num

​

Integer

​

可选

​

1

​

分页查询时的页码。默认为

1

，即返回第一页数据。

​

page_size

​

Integer

​

可选

​

20

​

分页查询时每页返回的数据条数。默认值为

10

，取值范围为 1~30。

​

publish_status

​

String

​

可选

​

published_online

​

智能体的发布状态，根据智能体的发布状态筛选对应版本。默认值为

published_online

。枚举值：

​

published_online

：已发布的线上版本。

​

unpublished_draft

：草稿版本。

​

connector_id

​

String

​

可选

​

1024

​

渠道 ID，仅在智能体发布状态为

published_online

时需要设置。用于筛选指定渠道下已发布的智能体版本。默认为空，表示获取所有发布渠道下的版本列表。

​

扣子编程的渠道 ID 包括：

​

1024：API 渠道。

​

999：Chat SDK。

​

10000122：扣子商店。

​

10000113：微信客服。

​

10000120：微信服务号。

​

10000121：微信订阅号。

​

10000126：抖音小程序。

​

10000127：微信小程序。

​

10000011：飞书。

​

10000128：飞书多维表格。

​

10000117：掘金。

​

自定义渠道 ID。自定义渠道 ID 的获取方式如下：在扣子编程左下角单击头像，在

账号设置

>

发布渠道

>

企业自定义渠道管理

页面查看渠道 ID。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Object of

ListBotVersionsData

​

{"items":[{"creator":{"id":"24787743932***","name":"Susan"},"version":"171638852****","changelog":"更新了智能体的对话逻辑","created_at":"1718609571","publish_status":"published_online"}],"has_more":false}

​

包含智能体版本列表数据的对象，用于返回智能体的所有版本信息及其分页状态。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

ListBotVersionsData

​

​

参数

​

类型

​

示例

​

说明

​

items

​

Array of

OpenBotVersionInfo

​

[{"creator":{"id":"24787743932***","name":"Susan"},"version":"171638852****","changelog":"更新了智能体的对话逻辑","created_at":"1718609571","publish_status":"published_online"}]

​

智能体版本列表数据，包含该智能体的所有版本的详细信息。

​

has_more

​

Boolean

​

false

​

标识当前返回结果是否还有更多数据未加载。

​

true

：当前返回的版本列表未包含所有符合条件的数据。

​

false

：表示已返回所有符合条件的数据。

​

​

OpenBotVersionInfo

​

​

参数

​

类型

​

示例

​

说明

​

creator

​

Object of

OpenCreatorInfo

​

{"id":"24787743932***","name":"Susan"}

​

版本的创建者信息，包含创建者的用户 ID 和用户名。

​

version

​

String

​

171638852****

​

智能体的版本号。

​

changelog

​

String

​

更新了智能体的对话逻辑

​

该版本发布时，用户输入的更新内容或修改说明。

​

created_at

​

Long

​

1718609571

​

该版本的创建时间。格式为 10 位的 Unixtime 时间戳，单位为秒。

​

publish_status

​

String

​

published_online

​

该版本的发布状态。枚举值：

​

published_online

：已发布的线上版本。

​

unpublished_draft

：草稿版本。

​

​

OpenCreatorInfo

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

24787743932***

​

版本创建者的扣子用户 ID。

​

name

​

String

​

Susan

​

版本创建者的扣子用户名。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v1/bots/73428668*****/versions?page_num=1&page_size=20&publish_status=&connector_id=1024' \

​

--header 'Authorization

:

Bearer pat_O******' \

​

--header 'Content-Type

:

application/json' \

​

​

返回示例

​

​

JSON

复制

{

​

"data"

:

{

​

"items"

:

[

​

{

​

"creator"

:

{

​

"id"

:

"24787743932***"

,

​

"name"

:

"Susan"

​

},

​

"version"

:

"171638852****"

,

​

"changelog"

:

"更新了智能体的对话逻辑"

,

​

"created_at"

:

1718609571

,

​

"publish_status"

:

"published_online"

​

}

​

],

​

"has_more"

:

false

​

},

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

删除应用的协作者

下一篇

复制资源
============================================================
# 复制资源
来源: https://www.coze.cn/open/docs/developer_guides/copy_resource_task
============================================================

复制资源

复制智能体、应用和工作流。

​

接口描述

​

本 API 支持

同工作空间复制

或

跨工作空间复制

。如果你是空间成员，你可以调用本 API 将工作空间内任意智能体、应用和工作流，复制到本空间或同一企业/团队下的其他已加入的工作空间。

​

跨空间复制智能体或应用成功后，为保证正常运行，智能体和应用所使用的工作流、插件等资源也将同时复制到新空间。

​

该 API 分为同步执行和异步执行，扣子编程根据不同资源复制类型自动采用对应的执行方式，具体说明如下：

​

​

执行模式

​

适用场景

​

结果返回方式

​

同步执行

​

同一工作空间内复制

智能体

。

​

API 直接返回复制后的智能体 ID。

​

异步执行

​

同一工作空间内复制

应用

、

工作流

。

​

跨工作空间复制

智能体

、

应用

、

工作流

。

​

API 返回任务 ID（

task_id

），需要通过

查询资源复制的结果

API 查询执行结果。

​

​

接口限制

​

不支持将个人工作空间中的资源复制到企业或团队工作空间中，个人版工作空间中的资源只能复制到本空间。

​

操作者需要加入源工作空间和目标工作空间。

​

复制后的智能体或应用为草稿状态。

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/entities/copy_tasks

​

​

权限

​

复制智能体：

Bot.duplicate

、

Workspace.createBot

​

复制扣子应用：

Project.copy

、

Workspace.createProject

​

复制工作流：

Workflow.copy

、

Workspace.createWorkflow

​

根据复制资源的类型授予对应的权限，确保调用该接口使用的访问令牌已开通相应权限，详细信息参考

鉴权方式

。

​

接口说明

​

复制智能体、应用和工作流。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

entity_id

​

String

​

可选

​

753093880875067***

​

待复制资源的 ID，需要和

entity_type

配套使用。

​

例如，当

entity_type

为

bot

时，此字段应填写智能体的 ID。

​

entity_type

​

String

​

可选

​

bot

​

待复制资源的类型。枚举值：

​

app

：应用。

​

bot

：智能体。

​

workflow

：工作流。

​

to_workspace_id

​

String

​

可选

​

7498204883280***

​

目标工作空间 ID。默认为空，即同工作空间复制。

​

如果是跨工作空间复制，需要指定资源复制到哪个工作空间。只能填写本企业或团队下的工作空间。

​

进入指定空间，空间页面 URL 中

w

参数后的数字就是 工作空间 ID。例如

https://code.coze.cn/w/75814654762959***/projects

，工作空间 ID 为

75814654762959***

。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Object of

OpenDuplicateDraftEntityData

​

{"copied_entity_id":"75309388087500****"}

​

资源复制的返回结果。

​

如果任务是异步执行的，则返回

task_id

用于查询任务状态。

​

如果任务直接完成，则返回

copied_entity_id

表示复制后的实体 ID。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

本次请求的详细日志信息，用于问题排查。

​

​

OpenDuplicateDraftEntityData

​

​

参数

​

类型

​

示例

​

说明

​

task_id

​

String

​

123e456700***

​

当资源复制任务为异步执行时，API 返回的任务 ID，你可以根据该

task_id

，通过

查询资源复制的结果

API 查询执行结果。

​

以下场景中 API 为异步执行：

​

同工作空间复制应用、工作流。

​

跨工作空间复制智能体、应用、工作流。

​

copied_entity_id

​

String

​

75309388087500****

​

同工作空间复制智能体时，API 会直接返回复制后的智能体 ID。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/entities/copy_tasks' \

​

--header 'Authorization

:

Bearer pat_O******' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"entity_id"

:

"753093880875067***"

,

​

"entity_type"

:

"bot"

,

​

"to_workspace_id"

:

"7498204883280***"

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"data"

:

{

​

"copied_entity_id"

:

"75309388087500****"

​

},

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

查看智能体版本列表

下一篇

查询资源复制的结果
============================================================
# 查询资源复制的结果
来源: https://www.coze.cn/open/docs/developer_guides/query_resource_copy_execution_result
============================================================

查询资源复制的结果

查询资源复制的结果。

​

接口说明

​

调用

复制资源

API 时，以下场景中 API 为异步执行，响应信息中会返回 task_id，开发者可以通过本 API 查询指定事件的执行结果。

​

同工作空间复制应用、工作流。

​

跨工作空间复制智能体、应用、工作流。

​

基础信息

​

​

请求方式

​

GET

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/entities/copy_tasks/:task_id

​

​

权限

​

无

​

接口说明

​

查询资源复制异步执行的结果。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

task_id

​

String

​

可选

​

567456700***

​

资源复制的任务 ID。调用

复制资源

API 时，如果 API 为异步执行，响应信息中会返回 task_id。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Object of

OpenCopyTaskInfoData

​

{"task_id":"123e456700***","entity_type":"bot","task_status":"successful","source_entity_id":"7530938808750080***","target_entity_id":"7530938808750067***","target_workspace_id":"74982048832804***"}

​

资源复制任务的结果数据，包含任务 ID、资源类型、任务状态、失败原因、原始资源 ID、复制后的资源 ID 以及目标工作空间 ID 等信息。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

本次请求的详细日志信息，用于问题排查。

​

​

OpenCopyTaskInfoData

​

​

参数

​

类型

​

示例

​

说明

​

task_id

​

String

​

123e456700***

​

资源复制的任务 ID。

​

entity_type

​

String

​

bot

​

待复制资源的类型。枚举值：

​

app

：应用。

​

bot

：智能体。

​

workflow

：工作流。

​

task_status

​

String

​

successful

​

任务的状态。枚举值：

​

in_progress

：进行中。

​

successful

：成功。

​

failed

：失败。

​

failed_reasons

​

Array of

TaskFailedReason

​

\

​

当资源复制任务失败时，该字段汇总所有失败的具体原因。每个失败原因包含资源 ID、名称、类型及详细错误描述。

​

source_entity_id

​

String

​

7530938808750080***

​

源资源 ID。

​

target_entity_id

​

String

​

7530938808750067***

​

复制后的资源 ID。

​

target_workspace_id

​

String

​

74982048832804***

​

资源复制后的目标工作空间 ID，表示资源被复制到的工作空间标识。

​

​

TaskFailedReason

​

​

参数

​

类型

​

示例

​

说明

​

entity_id

​

String

​

7530938808750080***

​

在资源复制任务失败时，标识具体失败的资源 ID。

​

entity_name

​

String

​

单词学习助手

​

资源的名称。

​

entity_type

​

String

​

bot

​

在资源复制任务失败时，标识具体失败资源的类型。支持的取值如下所示。

​

app

：应用。

​

bot

：智能体。

​

workflow

：工作流。

​

plugin

：插件。

​

ui

：应用的用户界面。

​

knowledge

：知识库。

​

database

：数据库。

​

variable

：变量。

​

trigger

：触发器。

​

prompt

：提示词。

​

shortcut

：快捷指令。

​

failed_reason

​

String

​

资源配额不足，无法完成复制

​

资源复制任务失败的具体原因描述，API 调用失败时可通过此字段查看详细错误信息。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v1/entities/copy_tasks/567456700***' \

​

--header 'Authorization

:

Bearer pat_O******' \

​

--header 'Content-Type

:

application/json' \

​

​

返回示例

​

​

JSON

复制

{

​

"data"

:

{

​

"task_id"

:

"123e456700***"

,

​

"entity_type"

:

"bot"

,

​

"task_status"

:

"successful"

,

​

"source_entity_id"

:

"7530938808750080***"

,

​

"target_entity_id"

:

"7530938808750067***"

,

​

"target_workspace_id"

:

"74982048832804***"

​

},

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

上一篇

复制资源

下一篇

下架智能体
============================================================
# 下架智能体
来源: https://www.coze.cn/open/docs/developer_guides/unpublish_agent
============================================================

下架智能体

智能体发布后，你可以调用本 API 从扣子编程官方渠道及自定义渠道下架智能体。

​

接口限制

​

仅智能体所有者和自定义渠道的所有者可以下架智能体。

​

暂不支持调用本 API 下架豆包渠道的智能体。

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/bots/:bot_id/unpublish

​

​

权限

​

disconnectBot

、

Connector.disconnectBot

​

确保调用该接口使用的访问令牌开通了

disconnectBot

、

Connector.disconnectBot

权限，详细信息参考

鉴权方式

。

​

接口说明

​

从扣子编程官方渠道及自定义渠道下架智能体。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $AccessToken

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

bot_id

​

String

​

必选

​

73428668*****

​

待下架的智能体的 ID。你可通过智能体开发页面 URL 中的

bot

参数获取智能体 ID 。例如 URL 为

https://www.coze.com/space/341****/bot/73428668*****

时，智能体 ID 为

73428668*****

。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

connector_id

​

String

​

必选

​

1024

​

待下架的渠道 ID。支持下架如下发布渠道中的智能体：

​

1024：API 渠道。

​

999：Chat SDK。

​

10000122：扣子商店。

​

10000113：微信客服。

​

10000120：微信服务号。

​

10000121：微信订阅号。

​

10000126：抖音小程序。

​

10000127：微信小程序。

​

10000011：飞书。

​

10000128：飞书多维表格。

​

10000117：掘金。

​

自定义渠道 ID。自定义渠道 ID 的获取方式如下：在扣子编程左下角单击头像，在

账号设置

>

发布渠道

>

企业自定义渠道管理

页面查看渠道 ID。

​

unpublish_reason

​

String

​

可选

​

终止服务

​

下架渠道的原因说明，用于记录或说明为何执行下架操作。最大支持

1024

个字符。

​

该原因会在扣子编程

工作空间

>

发布管理

页面对应智能体的渠道右侧展示，建议提供清晰易懂的下架原因。

​

​

​

​

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/bots/73428668*****/unpublish' \

​

--header 'Authorization

:

Bearer pat_xitq9LWlowpX3qGCih1lwpAdzvXNqgmpfhpV28HLWFN****' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"connector_id"

:

"1024"

,

​

"unpublish_reason"

:

"终止服务"

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

查询资源复制的结果

下一篇

Bot object
============================================================
# Bot object
来源: https://www.coze.cn/open/docs/developer_guides/bot_object
============================================================

Bot object

bot

对象是一个智能体实体，包含以下信息。

​

​

字段

​

类型

​

说明

​

bot_id

​

String

​

智能体的唯一标识。

​

name

​

String

​

智能体的名称。

​

description

​

String

​

智能体的描述信息。

​

icon_url

​

String

​

智能体头像地址。

​

create_time

​

Integer

​

创建时间，格式为 10 位的 Unixtime 时间戳，单位为秒（s）。

​

update_time

​

Integer

​

更新时间，格式为 10 位的 Unixtime 时间戳，单位为秒（s）。

​

version

​

String

​

智能体最新版本的版本号。

​

prompt_info

​

Object

​

智能体的提示词配置，参考

Prompt object

说明。

​

onboarding_info

​

Object

​

智能体的开场白配置，参考

Onboarding object

说明。

​

bot_mode

​

​

Integer

​

智能体模式，取值：

​

0

：单 Agent 模式

​

1

：多 Agent 模式

​

plugin_info_list

​

Array of Object

​

智能体置的插件，参考

Plugin object

说明。

​

model_info

​

Object

​

智能体置的模型，参考

Model object

说明。

​

knowledge

​

Object

​

智能体定的知识库，参考

Knowledge object

说明。

​

​

Prompt object

​

​

字段

​

类型

​

说明

​

prompt

​

String

​

智能体配置的提示词。

​

​

Onboarding object

​

​

字段

​

类型

​

说明

​

prologue

​

String

​

智能体配置的开场白内容。

​

suggested_questions

​

Array of String

​

智能体配置的推荐问题列表。未开启

用户问题建议

时，不返回此字段。

​

​

Plugin

object

​

​

字段

​

类型

​

说明

​

plugin_id

​

String

​

插件唯一标识。

​

name

​

String

​

插件名称。

​

description

​

String

​

插件描述。

​

icon_url

​

String

​

插件头像。

​

api_info_list

​

Array of Object

​

插件的工具列表信息，详情参考

PluginAPI object

。

​

​

PluginAPI

object

​

​

字段

​

类型

​

说明

​

api_id

​

String

​

工具的唯一标识。

​

name

​

String

​

工具的名称。

​

description

​

String

​

工具的描述。

​

​

Model object

​

​

字段

​

类型

​

说明

​

model_id

​

String

​

模型的唯一标识。

​

model_name

​

String

​

模型名称。

​

​

Knowledge object

​

​

字段

​

类型

​

说明

​

knowledge_infos

​

Array of Object

​

智能体绑定的知识库列表，参考

KnowledgeInfo object

说明。

​

​

KnowledgeInfo object

​

​

字段

​

类型

​

说明

​

id

​

String

​

知识库 ID。

​

name

​

String

​

知识库名称。

​

​

​

​

​

上一篇

下架智能体

下一篇

查看应用列表
============================================================
# 查看应用列表
来源: https://www.coze.cn/open/docs/developer_guides/published_apps_list
============================================================

查看应用列表

查看指定工作空间的应用列表。

​

接口描述

​

查看指定工作空间的应用列表，包含草稿状态的应用和已发布的应用。

​

扣子个人版中，你只能查询你作为工作空间所有者的应用。

​

扣子企业版中，你可以查看指定工作空间下的所有应用。

​

基础信息

​

​

请求方式

​

GET

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/apps

​

权限

​

listApp

​

确保调用该接口使用的访问令牌开通了

listApp

权限，详细信息参考

鉴权方式

。

​

接口说明

​

查看指定工作空间的应用列表。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

workspace_id

​

String

​

必选

​

75123945629***

​

应用所在的工作空间的 Space ID。Space ID 是工作空间的唯一标识。

​

进入指定空间，空间页面 URL 中

w

参数后的数字就是 工作空间 ID。例如

https://code.coze.cn/w/75814654762959***/projects

，工作空间 ID 为

75814654762959***

。

​

publish_status

​

String

​

可选

​

all

​

应用的发布状态，用于筛选不同发布状态的应用。枚举值如下：

​

all ：所有状态。

​

published_online ：（默认值）已发布的正式版。

​

published_draft ：已发布但当前为草稿状态。

​

unpublished_draft ：从未发布过。

​

connector_id

​

String

​

可选

​

1024

​

渠道 ID，仅在

publish_status

为

published_online

或

published_draft

时需要设置。用于筛选该渠道下已发布的应用，包括已发布的线上正式版本和已发布的草稿版本。

​

默认值为 1024，即默认获取 API 发布渠道下的最新版本。

​

扣子编程的渠道 ID 包括：

​

1024：API 渠道。

​

999：Chat SDK。

​

10000122：扣子商店。

​

10000113：微信客服。

​

10000120：微信服务号。

​

10000121：微信订阅号。

​

10000126：抖音小程序。

​

10000127：微信小程序。

​

10000011：飞书。

​

998：WebSDK。

​

自定义渠道 ID。自定义渠道 ID 的获取方式如下：在扣子编程左下角单击头像，在

账号设置

>

发布渠道

>

企业自定义渠道管理

页面查看渠道 ID。

​

page_num

​

Integer

​

可选

​

1

​

分页查询时的页码。默认为 1，即返回第一页数据。

​

page_size

​

Integer

​

可选

​

20

​

分页大小。默认为 20，即每页返回 20 条数据。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Object of

OpenGetProjectData

​

{"items":[{"id":"74876004423701****","name":"test","icon_url":"

https://example.com/FileBizType.BIZ_BOT_APP/app1***.png

","updated_at":1718289297,"description":"应用测试","is_published":true,"published_at":1718289297,"owner_user_id":"23423423****"}],"total":1}

​

返回的应用列表数据，包含应用的基本信息和总数。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"1234567890abcdef"}

​

包含请求的详细日志信息，用于问题排查和调试。

​

​

OpenGetProjectData

​

​

参数

​

类型

​

示例

​

说明

​

items

​

Array of

AppSimpleInfo

​

[ { "id": "751614225987***", "is_published": false, "updated_at": 1749994622, "owner_user_id": "32902037***", "name": "***", "description": "***", "icon_url": "

https://example.com/FileBizType.BIZ_BOT_ICON/***

" } ]

​

返回的应用列表。

​

total

​

Long

​

2

​

返回的应用的数量。

​

​

AppSimpleInfo

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

74876004423701****

​

应用的 ID。

​

name

​

String

​

test

​

应用的名称。

​

icon_url

​

String

​

https://example.com/FileBizType.BIZ_BOT_APP/app1

***

.png

​

应用图标的 URL。

​

folder_id

​

String

​

752316125533***

​

应用所属的文件夹 ID。

​

updated_at

​

Long

​

1718289297

​

应用的最近一次更新时间。以 Unix 时间戳格式表示。单位为秒。

​

description

​

String

​

应用测试

​

应用的描述。

​

is_published

​

Boolean

​

true

​

应用是否已发布。

​

true

表示已发布。

​

false

表示未发布。

​

published_at

​

Long

​

1718289297

​

应用的最近一次发布时间。以 Unix 时间戳格式表示。单位为秒。

​

仅当应用已发布时返回该值。如果应用是未发布过的草稿版本，则该参数的值为空。

​

owner_user_id

​

String

​

23423423****

​

应用创建者的扣子用户 ID。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

GET 'https

:

//api.coze.cn/v1/apps?publish_status=all&workspace_id=751543725346***' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json' \

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"data"

:

{

​

"total"

:

1

,

​

"items"

:

[

​

{

​

"id"

:

"751614225987***"

,

​

"is_published"

:

true

,

​

"updated_at"

:

1749994622

,

​

"published_at"

:

1718289297

,

​

"owner_user_id"

:

"32902037***"

,

​

"name"

:

"test"

,

​

"folder_id"

:

"752316125533542***"

,

​

"description"

:

"应用测试"

,

​

"icon_url"

:

"https://example.com/FileBizType.BIZ_BOT_ICON/***"

​

}

​

]

​

},

​

"msg"

:

""

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

Bot object

下一篇

智能体发布回调事件
============================================================
# 智能体发布回调事件
来源: https://www.coze.cn/open/docs/developer_guides/agent_callback_messages
============================================================

智能体发布回调事件

当开发者订阅了低代码智能体发布回调事件后，开发者发布智能体时，扣子编程会向指定的回调地址推送

回调消息

。订阅回调的具体操作请参见

​

订阅回调

。

​

触发条件

​

开发者发布低代码智能体时，

扣子

编程会向指定的回调地址发送回调消息，消息中包含智能体和开发者的基本信息。如果渠道入驻时配置了渠道授权，发布智能体时

扣子

编程将获取开发者的渠道用户 ID，此 ID 也会包含在回调消息中一起发送到渠道侧。

​

智能体发布回调事件的触发条件如下：

​

​

回调类型

​

个人版

​

企业版（企业标准版、企业旗舰版）

​

普通回调

​

仅

空间所有者

可订阅，当工作空间中任意智能体被发布至扣子编程官方渠道或公共渠道时，对应的回调地址会收到智能体发布回调事件。

​

仅

超级管理员和管理员

可订阅，当企业内任意智能体被发布至扣子编程官方渠道或公共渠道时，对应的回调地址会收到智能体发布回调事件。

​

渠道回调

​

仅

自定义渠道创建者

可订阅，当智能体发布至该自定义渠道时，对应的回调地址会收到智能体发布回调事件。

​

仅

超级管理员和管理员

可订阅，当智能体发布至该自定义渠道时，对应的回调地址会收到智能体发布回调事件。

​

​

回调响应要求

​

业务服务器收到智能体发布回调后，应在 10 秒内响应。

​

如果是普通回调，只需要在响应中返回 HTTP 状态码 200 即可。

​

如果是渠道回调，需要在响应中返回智能体的审核结果，否则智能体发布失败。

​

说明

如果审核流程无法在 10 秒内完成，自定义渠道可以先发送一条审核中的响应消息，审核结束后，再通过 API

​

更新审核结果

通知扣子编程此智能体的最终审核结果。

​

​

回调结构体

​

回调消息的结构体 Body 中包含两个主要字段：

header

和

event

。

​

header

参数的参数说明请参见

​

回调事件

。

​

event

参数中包括以下参数：

​

​

字段

​

类型

​

说明

​

user_id_str

​

Integer

​

发布智能体的

扣子

用户 ID。

​

space_id

​

String

​

智能体所属的空间 ID。

​

订阅普通回调时会返回该参数，订阅渠道回调时不返回该参数。

​

connector_user_id

​

String

​

扣子

用户在渠道中的用户 ID。此字段仅在渠道回调中返回，且仅当配置了渠道授权时才会包含，详细说明可参考

​

步骤三：渠道管理员配置渠道授权

。

​

user_name

​

String

​

发布智能体的

扣子

用户昵称。

​

bot_id_str

​

Integer

​

智能体 ID。

​

bot_name

​

String

​

智能体名称。

​

description

​

String

​

智能体的描述信息。

​

version

​

String

​

智能体的版本号。

​

​

回调结构体示例：

​

​

JSON

复制

{

​

// 事件头

​

"header"

:{

​

// 事件类型

​

"event_type"

:

"bot.published"

,

// 智能体发布回调事件

​

// 事件 id

​

"event_id"

:

"12345abc"

,

​

// 事件创建事件

​

"created_at"

:

1613427443000

,

​

"coze_account_id"

:

"418960299***"

,

// 智能体所属的空间的 owner id

​

"api_app_id"

:

"750974592959****"

,

// 回调应用的 id

​

"connector_id"

:

"12345"

// 如果为渠道回调，这个字段会填充渠道 id

​

},

​

​

// 事件体，根据事件类型不同，结构也不一样。当前展示的是智能体发布的事件

​

"event"

:{

​

// 用户 id

​

"user_id_str"

:

1234567890

,

​

// 渠道用户 id，仅在配置了渠道授权后返回

​

"connector_user_id"

:

"1234567890"

​

// 用户昵称

​

"user_name"

:

"name123"

​

//智能体id

​

"bot_id_str"

:

987654

***

,

​

//智能体名称

​

"bot_name"

:

"SampleBot"

,

​

//智能体描述

​

"description"

:

"This is a sample bot."

,

​

//智能体版本

​

"version"

:

"12345"

​

},

​

}

​

​

响应回调的结构体

​

渠道回调的响应回调的 Body 应包括以下参数：

​

​

字段

​

类型

​

说明

​

audit

​

Array of JSON

​

审核结果。

​

audit.audit_status

​

Integer

​

审核状态。

​

1：审核中

​

2：审核通过

​

3：审核失败

​

audit.reason

​

String

​

审核失败时，此字段返回审核失败原因。

​

​

渠道回调的响应回调的结构体示例：

​

​

JSON

复制

// 不同的事件，要求不同的返回体。此处为智能体发布事件，需要返回审核状态

​

{

​

"audit"

:{

​

"audit_status"

:

2

// 1: 审核中；2: 通过；3: 拒绝

​

"reason"

:

"不通过原因"

// 原因

​

}

​

}

​

​

相关文档

​

​

订阅回调

​

​

接收并处理回调

​

上一篇

查看应用列表

下一篇

智能体删除回调事件
============================================================
# 智能体删除回调事件
来源: https://www.coze.cn/open/docs/developer_guides/agent_delete_callback_messages
============================================================

智能体删除回调事件

当开发者订阅了智能体删除回调事件后，开发者删除低代码智能体时，扣子编程会向指定的回调地址推送回调消息，消息中包含智能体的基本信息。订阅回调的具体操作请参见

​

订阅回调

。

​

触发条件

​

智能体删除回调事件的触发条件如下：

​

​

回调类型

​

个人版

​

企业版（企业标准版、企业旗舰版）

​

普通回调

​

仅

空间所有者

可订阅，当工作空间中任意低代码智能体被删除时，对应的回调地址会收到智能体删除回调事件。

​

仅

超级管理员和管理员

可订阅，当企业内任意低代码智能体被删除时，对应的回调地址会收到智能体删除回调事件。

​

渠道回调

​

仅

自定义渠道创建者

可订阅，当该渠道中的低代码智能体被删除时，对应的回调地址会收到智能体删除回调事件。

​

仅

超级管理员和管理员

可订阅，当自定义渠道中的低代码智能体被删除时，对应的回调地址会收到智能体删除回调事件。

​

​

回调结构体

​

回调消息的结构体 Body 中包含两个主要字段：

header

和

event

。

​

header

参数的参数说明请参见

​

回调事件

。

​

event

参数中包括以下参数：

​

​

字段

​

类型

​

说明

​

bot_id

​

String

​

智能体 ID。

​

space_id

​

String

​

智能体所属的空间 ID。

​

订阅普通回调时会返回该参数，订阅渠道回调时不返回该参数。

​

bot_name

​

String

​

智能体名称。

​

description

​

String

​

智能体的描述信息。

​

​

回调结构体示例：

​

​

JSON

复制

{

​

"header"

:

{

​

"event_type"

:

"bot.deleted"

,

//智能体删除回调事件

​

"event_id"

:

"76464a1a-eda7-48e9-b207-2db50392e60a-7509745929591717899"

,

// 此次触发的唯一 id，用户应该用这个 id 做去重

​

"created_at"

:

1749038258245

,

​

"coze_account_id"

:

"4189602994****"

,

// 被删除的智能体所属的空间的 owner id

​

"api_app_id"

:

"75097459295917****"

,

// 回调应用的 id

​

"connector_id"

:

"12345"

// 如果为渠道回调，这个字段会填充渠道 id

​

},

​

"event"

:

{

​

"bot_id"

:

"7512041635401****"

,

// 智能体 id

​

"space_id"

:

"7309693825197****"

,

// 智能体所属的 space_id, 仅普通回调有这个字段，渠道回调没有

​

"bot_name"

:

"智能体名称"

,

​

"description"

:

"智能体简介"

​

}

​

}

​

​

响应回调

​

开发者服务器收到智能体删除回调后，应在 3 秒内响应，并返回 HTTP 状态码 200。

​

相关文档

​

​

订阅回调

​

​

接收并处理回调

​

上一篇

智能体发布回调事件

下一篇

智能体下架回调事件
============================================================
# 智能体下架回调事件
来源: https://www.coze.cn/open/docs/developer_guides/agent_unpublished_callback_messages
============================================================

智能体下架回调事件

当开发者订阅了智能体下架回调事件后，开发者下架低代码智能体时，扣子编程会向指定的回调地址推送回调消息，消息中包含智能体的基本信息。订阅回调的具体操作请参见

​

订阅回调

。

​

触发条件

​

智能体下架回调事件的触发条件如下：

​

​

回调类型

​

个人版

​

企业版（企业标准版、企业旗舰版）

​

普通回调

​

仅

空间所有者

可订阅，当工作空间中任意低代码智能体被下架时，对应的回调地址会收到智能体下架回调事件。

​

仅

超级管理员和管理员

可订阅，当企业内任意低代码智能体被下架时，对应的回调地址会收到智能体下架回调事件。

​

渠道回调

​

仅

自定义渠道

创建者

可订阅，当该渠道中的低代码智能体被下架时，对应的回调地址会收到智能体下架回调事件。

​

仅

超级管理员和管理员

可订阅，当

自定义渠道中的低代码智能体被下架时，对应的回调地址会收到智能体下架回调事件。

​

​

回调结构体

​

回调消息的结构体 Body 中包含两个主要字段：

header

和

event

。

​

header

参数的参数说明请参见

​

回调事件

。

​

event

参数中包括以下参数：

​

​

字段

​

类型

​

说明

​

bot_id

​

String

​

智能体 ID。

​

space_id

​

String

​

智能体所属的空间 ID。

​

订阅普通回调时会返回该参数，订阅渠道回调时不返回该参数。

​

connector_id

​

String

​

智能体下架的渠道 ID。扣子编程官方渠道对应的渠道 ID 如下：

​

1024：API 渠道。

​

999：Chat SDK。

​

10000122：扣子商店。

​

10000113：微信客服。

​

10000120：微信服务号。

​

10000121：微信订阅号。

​

10000126：抖音小程序。

​

10000127：微信小程序。

​

10000011：飞书。

​

10000128：飞书多维表格。

​

10000117：掘金。

​

bot_name

​

String

​

智能体名称。

​

description

​

String

​

智能体的描述信息。

​

​

回调结构体示例：

​

​

JSON

复制

{

​

"header"

:

{

​

"event_type"

:

"bot.unpublished"

,

//智能体下架回调事件

​

"event_id"

:

"76464a1a-eda7-48e9-b207-2db50392e60a-7509745929591717899"

,

// 此次触发的唯一 id，用户应该用这个 id 做去重

​

"created_at"

:

1749038258245

,

​

"coze_account_id"

:

"4189602994****"

,

// 被下架的智能体所属的空间的 owner id

​

"api_app_id"

:

"75097459295917****"

,

// 回调应用的 id

​

"connector_id"

:

"74239893676742***"

// 如果为渠道回调，这个字段会填充自定义渠道 id

​

},

​

"event"

:

{

​

"bot_id"

:

"7512041635401****"

,

// 智能体 id

​

"space_id"

:

"7309693825197****"

,

// 智能体所属的 space_id, 仅普通回调有这个字段，渠道回调没有

​

"connector_id"

:

"10000122"

,

//渠道 ID

​

"bot_name"

:

"智能体名称"

,

​

"description"

:

"智能体简介"

​

}

​

}

​

​

响应回调

​

开发者服务器收到智能体下架回调后，应在 3 秒内响应，并返回 HTTP 状态码 200。

​

相关文档

​

​

订阅回调

​

​

接收并处理回调

​

上一篇

智能体删除回调事件

下一篇

创建工作空间
============================================================
# 创建工作空间
来源: https://www.coze.cn/open/docs/developer_guides/create_workspace
============================================================

创建工作空间

创建工作空间。

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/workspaces

​

​

权限

​

createWorkspace

​

确保调用该接口使用的访问令牌开通了

createWorkspace

权限，详细信息参考

鉴权方式

。

​

接口说明

​

创建工作空间。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

name

​

String

​

必选

​

文档组的工作空间

​

自定义的空间名称，最大长度为 50 个字符。

​

description

​

String

​

必选

​

文档组内部使用的工作空间。

​

空间的描述信息，用于详细说明空间的用途或特点，最大长度为 2000 个字符。

​

icon_file_id

​

String

​

可选

​

73694959811****

​

作为空间图标的文件 ID。

​

未指定文件 ID 时，使用扣子编程默认的工作空间图标。

​

如需使用自定义图标，应先通过

上传文件

API 上传本地文件，从接口响应中获取文件 ID。文件 ID 作为空间图标时，有效期为永久有效。

​

coze_account_id

​

String

​

可选

​

749088814445***

​

组织 ID，用于标识工作空间所属的组织。

​

扣子个人版中，无需设置此参数。

​

说明

默认在个人账号下创建工作空间，如果需要在企业的组织下创建工作空间，你需要传入组织 ID。

​

你可以在

组织设置

页面查看对应的组织 ID。

​

​

owner_uid

​

String

​

可选

​

user_1234567890

​

指定空间所有者的扣子用户的 UID。

​

说明

扣子个人版中，无需设置此参数，默认当前用户为空间所有者。

​

扣子企业版（企业标准版、企业旗舰版）中，可以指定

coze_account_id

对应组织中的员工为空间所有者，未指定时默认 Token 的创建者为空间所有者。

​

​

你可以单击扣子编程左下角的头像，选择

账号设置

，在页面底部查看扣子用户的 UID。

​

​

​

​

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Object of

OpenCreateSpaceRet

​

{"id":"753232939603****"}

​

工作空间的相关信息。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

OpenCreateSpaceRet

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

753232939603****

​

创建的工作空间的 ID。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/workspaces' \

​

--header 'Authorization

:

Bearer pat_O******' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"name"

:

"文档组的工作空间"

,

​

"description"

:

"文档组内部使用的工作空间。"

,

​

"icon_file_id"

:

"73694959811****"

,

​

"coze_account_id"

:

"749088814445***"

,

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"data"

:

{

​

"id"

:

"753232939603****"

​

},

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

智能体下架回调事件

下一篇

查看空间列表
============================================================
# 查看空间列表
来源: https://www.coze.cn/open/docs/developer_guides/list_workspace
============================================================

查看空间列表

查看当前扣子用户或指定扣子用户创建或加入的空间列表。

​

接口描述

​

你可以查看当前账号创建和加入的工作空间，包括个人账号的工作空间和企业账号的工作空间。

​

在扣子企业版中，你可以在

Query

中指定

enterprise_id

，查看该企业当前账号创建或加入的所有工作空间。

​

你可以在

Query

中同时指定

user_id

和

coze_account_id

，查看指定用户在指定组织下加入的工作空间。这里的组织可以是企业中的某个组织，也可以是个人版账号。

​

不同场景的 Query 参数配置说明如下：

​

​

场景

​

Query 参数

​

​

​

​

enterprise_id

​

user_id

​

coze_account_id

​

查看当前账号的所有工作空间（含个人空间）

​

不传

​

不传

​

不传

​

查看当前账号在指定企业中的工作空间（不含个人空间）

​

必选

​

不传

​

不传

​

查看指定用户在指定组织的工作空间（不含个人空间）

​

不传

​

必选

​

必选

​

​

注意

暂不支持

第三方渠道应用

调用此 API。

​

​

基础信息

​

​

请求方式

​

GET

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/workspaces

​

权限

​

listWorkspace

​

确保调用该接口使用的访问令牌开通了

listWorkspace

权限，详细信息参考

鉴权

。

​

接口说明

​

查看当前扣子用户或指定扣子用户创建或加入的空间列表。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

page_num

​

Integer

​

可选

​

1

​

分页查询时的页码。默认为 1，即返回第一页数据。

​

page_size

​

Integer

​

可选

​

30

​

分页大小，即每页返回多少个工作空间。默认为 20，最大为 50。

​

enterprise_id

​

String

​

可选

​

volcano_2105850***

​

企业 ID，你可以在

组织管理

>

组织设置

页面查看企业 ID。

​

​

​

​

​

​

如果指定

enterprise_id

，则查询对应

EnterpriseId

中，当前账号创建或加入的所有工作空间。

​

如果不指定

enterprise_id

，则查询当前账号创建和加入的所有工作空间，包括个人账号的工作空间和企业/团队账号的工作空间。

​

说明

仅扣子企业版套餐中的用户支持该参数。个人免费版和个人进阶版不支持该参数。

​

​

user_id

​

String

​

可选

​

38509118307***

​

扣子用户 ID，用于查询特定用户的工作空间信息。

​

你可以单击扣子编程左下角的头像，选择

账号设置

，在页面底部查看扣子用户的 UID。

​

​

​

​

​

​

说明

如果同时指定

user_id

和

coze_account_id

，则查询该用户在该组织下加入的工作空间。暂时不支持仅指定

user_id

或仅指定

coze_account_id

。

​

​

coze_account_id

​

String

​

可选

​

38509118307***

​

扣子编程的组织 ID，用于查询特定组织的工作空间信息。

​

扣子个人版中，

coze_account_id

即为

user_id

。

​

扣子企业版中，

coze_account_id

为组织 ID。你可以在

组织管理

>

组织设置

页面查看对应的组织 ID，或通过

查询组织列表

API 查询组织 ID。

​

​

​

​

​

​

说明

如果同时指定

user_id

和

coze_account_id

，则查询该用户在该组织下加入的工作空间。暂时不支持仅指定

user_id

或仅指定

coze_account_id

。

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

调用状态码。

​

0 表示调用成功。

​

其他值表示调用失败。你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

OpenSpaceData

​

\

​

接口响应的业务信息。

detail

​

Object of

ResponseDetail

​

{"logid":"1234567890abcdef"}

包含请求的详细日志信息，用于问题排查和调试。

​

OpenSpaceData

​

​

参数

​

类型

​

示例

​

说明

​

workspaces

​

Array of

OpenSpace

​

\

​

用户创建或加入的空间列表。

​

total_count

​

Long

​

2

​

用户加入的空间总数。

​

​

OpenSpace

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

74876004423701****

​

空间 ID。

​

name

​

String

​

test

​

空间名称。

​

icon_url

​

String

​

https://***/obj/ocean-cloud-tos/FileBizType.BIZ_BOT_SPACE/team.png

​

空间图标的 url 地址。

​

owner_uid

​

String

​

24787743932***

​

空间所有者的扣子用户 UID。

​

role_type

​

String

​

member

​

用户在空间中的角色。枚举值包括：

​

owner：所有者

​

admin：管理员

​

member：成员

​

admin_uids

​

Array of String

​

["24787743932***","24787743932***"]

​

空间管理员的用户 UID 列表，用于标识当前空间的所有管理员。

​

description

​

String

​

这是一个用于测试的空间。

​

空间的描述信息。

​

enterprise_id

​

String

​

volcano_2105850***

​

企业 ID。

​

说明

个人账号下的工作空间，返回的企业 ID 为空。

​

​

joined_status

​

String

​

joined

​

用户在空间中的加入状态。枚举值：

​

joined

：已加入

​

workspace_type

​

String

​

team

​

空间类型。枚举值包括：

​

personal

：个人空间

​

team

：工作空间

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

查询当前账号加入的所有空间

查询指定用户在指定组织下加入的空间

查看当前账号在指定企业中的工作空间

​

JSON

复制

GET 'https

:

//api.coze.cn/v1/workspaces?&page_num=1&page_size=20' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json' \

​

​

​

返回示例

​

​

JSON

复制

{

​

"data"

:

{

​

"workspaces"

:

[

​

{

​

"id"

:

"74876004423701****"

,

​

"name"

:

"test"

,

​

"icon_url"

:

"https://***/obj/ocean-cloud-tos/FileBizType.BIZ_BOT_SPACE/team.png"

,

​

"role_type"

:

"member"

,

​

"enterprise_id"

:

"volcano_2105850***"

,

​

"workspace_type"

:

"team"

​

}

​

{

​

"id"

:

"74879061161065***"

,

​

"name"

:

"个人空间"

,

​

"icon_url"

:

"https://***/obj/ocean-cloud-tos/FileBizType.BIZ_BOT_SPACE/team.png"

,

​

"role_type"

:

"owner"

,

​

"enterprise_id"

:

""

,

​

"workspace_type"

:

"personal"

​

}

​

],

​

"total_count"

:

2

​

},

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"1234567890abcdef****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

创建工作空间

下一篇

修改工作空间基本信息
============================================================
# 修改工作空间基本信息
来源: https://www.coze.cn/open/docs/developer_guides/update_workspace_info
============================================================

修改工作空间基本信息

修改指定工作空间的基本信息，包括空间名称和描述。

​

接口限制

​

个人空间

不支持修改空间基本信息。

​

工作空间的名称和描述需要符合内容安全规范，不得包含涉政、涉黄等违规内容，否则扣子编程会提示 4014 错误。

​

基础信息

​

​

请求方式

​

PUT

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/workspaces/:workspace_id

​

​

权限

​

Workspace.update

​

确保调用该 API 使用的访问令牌开通了

Workspace.update

权限，详细信息参考

鉴权方式

。

​

接口说明

​

修改工作空间基本信息。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

workspace_id

​

String

​

必选

​

736163827687053****

​

需要修改工作空间信息的工作空间 ID。

​

进入指定空间，空间页面 URL 中

w

参数后的数字就是 工作空间 ID。例如

https://code.coze.cn/w/75814654762959***/projects

，workspace_id 为

75814654762959***

。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

name

​

String

​

可选

​

文档组的工作空间

​

修改后的工作空间的名称。默认为空，表示不修改。

​

最大长度为 50 个字符。

​

description

​

String

​

可选

​

文档组内部使用的工作空间。

​

修改后的工作空间的描述。默认为空，表示不修改。

​

最大长度为 2000 个字符。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的日志信息，用于问题排查和技术支持。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request PUT 'https

:

//api.coze.cn/v1/workspaces/736163827687053****' \

​

--header 'Authorization

:

Bearer pat_O******' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"name"

:

"文档组的工作空间"

,

​

"description"

:

"文档组内部使用的工作空间。"

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

查看空间列表

下一篇

查看空间成员列表
============================================================
# 查看空间成员列表
来源: https://www.coze.cn/open/docs/developer_guides/list_space_member
============================================================

查看空间成员列表

查看指定空间的成员列表。

​

基础信息

​

​

请求方式

​

GET

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/workspaces/:workspace_id/members

​

权限

​

readMember

​

确保调用该接口使用的访问令牌开通了

readMember

权限，详细信息参考

鉴权方式

。

​

接口说明

​

查看指定空间的成员列表。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $AccessToken

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

workspace_id

​

String

​

必选

​

736163827687053****

​

需要查看成员列表的空间 ID。

​

进入指定空间，空间页面 URL 中

w

参数后的数字就是 工作空间 ID。例如

https://code.coze.cn/w/75814654762959***/projects

，workspace_id 为

75814654762959***

。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

page_num

​

Integer

​

可选

​

1

​

查询结果分页展示时，此参数用于设置查看的页码。最小值为 1，默认为 1。

​

page_size

​

Integer

​

可选

​

10

​

查询结果分页展示时，此参数用于设置每页返回的数据量。取值范围为 1~50，默认为 20。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Object of

OpenSpaceMemberListData

​

\

​

返回的数据对象，包含空间成员列表和总数。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{logid": "202410242028595CCF353CEC86A8*****" }

​

本次请求返回的详细信息。

​

​

OpenSpaceMemberListData

​

​

参数

​

类型

​

示例

​

说明

​

items

​

Array of

OpenSpaceMember

​

[ { "role_type": "owner", "user_id": "2135714797***", "user_nickname": "RootUser_210202***", "user_unique_name": "kou_testing_001", "avatar_url": "

example.com/cloudidentity.9f6***.jpg

" }, { "avatar_url": "

https://example.com/cloudidentity.9f6***.jpg

", "role_type": "member", "user_id": "402688082103***", "user_nickname": "test_user_01", "user_unique_name": "user170383***6" }]

​

返回的成员列表。

​

total_count

​

Long

​

5

​

空间中的成员总数。

​

​

OpenSpaceMember

​

​

参数

​

类型

​

示例

​

说明

​

user_id

​

String

​

2069720456*****

​

用户的扣子用户 ID。

​

role_type

​

String

​

member

​

该用户在空间中的角色：

​

admin：空间管理员。

​

member：空间成员。

​

owner：空间所有者。

​

user_nickname

​

String

​

小王

​

用户的昵称。

​

user_unique_name

​

String

​

小王

​

用户的名称。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

​

示例

​

请求示例

​

​

JSON

复制

GET 'https

:

//api.coze.cn/v1/workspaces/7515267805****/members' \

​

--header 'Content-Type

:

application/json' \

​

--header 'Authorization

:

Bearer pat_FFTwAe4KB9GpaXCGoCjKbztWig4MT1SRB6yjP4n0PJ1AE3ukqw5yGj****'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"data"

:

{

​

"total_count"

:

4

,

​

"items"

:

[

​

{

​

"role_type"

:

"owner"

,

​

"user_id"

:

"2135714797***"

,

​

"user_nickname"

:

"RootUser_210202***"

,

​

"user_unique_name"

:

"kou_testing_001"

,

​

"avatar_url"

:

"example.com/cloudidentity.9f6***.jpg"

​

},

​

{

​

"avatar_url"

:

"https://example.com/cloudidentity.9f6***.jpg"

,

​

"role_type"

:

"member"

,

​

"user_id"

:

"402688082103***"

,

​

"user_nickname"

:

"test_user_01"

,

​

"user_unique_name"

:

"user170383***6"

​

},

​

{

​

"user_id"

:

"260191467***"

,

​

"user_nickname"

:

"test_user_03"

,

​

"user_unique_name"

:

"user127938***"

,

​

"avatar_url"

:

"https://example.com/cloudidentity.9f6***.jpg"

,

​

"role_type"

:

"member"

​

},

​

{

​

"user_id"

:

"55242585801***"

,

​

"user_nickname"

:

"test_003"

,

​

"user_unique_name"

:

""

,

​

"avatar_url"

:

"https://example.com/cloudidentity.9f6***.jpg"

,

​

"role_type"

:

"member"

​

}

​

]

​

},

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20250616153822E8D5D5F****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

修改工作空间基本信息

下一篇

批量邀请用户加入空间
============================================================
# 批量邀请用户加入空间
来源: https://www.coze.cn/open/docs/developer_guides/add_space_member
============================================================

批量邀请用户加入空间

邀请用户加入工作空间，支持批量邀请，每次最多添加 20 个成员。

​

接口描述

​

通过本 API 批量邀请用户加入工作空间，并设置用户是空间管理员或空间成员。

​

在企业版（企业标准版、企业旗舰版）中，添加用户时会直接将用户加入工作空间，无需被添加者确认。

​

在个人版中，添加用户时会向用户发送邀请，用户同意后才能加入工作空间。

​

如果被添加者的主账号设置了

不允许加入外部空间

，添加该用户时会报错。

​

接口限制

​

在企业版（企业标准版、企业旗舰版）中，仅支持邀请已加入企业的用户加入工作空间，否则调用 API 时会执行失败，并提示错误码 702042162。

​

添加成员后，工作空间成员总数不能超过该工作空间的成员数量上限，否则调用 API 时会执行失败，并提示错误码 702042018。

​

基础信息

​

​

请求方式

​

POST

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/workspaces/:workspace_id/members

​

权限

​

addMember

​

确保调用该接口使用的访问令牌开通了

addMember

权限，详细信息参考

鉴权方式

。

​

接口说明

​

批量邀请用户加入工作空间。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $AccessToken

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

workspace_id

​

String

​

必选

​

736163827687053****

​

需要添加用户的工作空间 ID。

​

进入指定空间，空间页面 URL 中

w

参数后的数字就是 工作空间 ID。例如

https://code.coze.cn/w/75814654762959***/projects

，workspace_id 为

75814654762959***

。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

users

​

Array of

OpenSpaceMember

​

可选

​

["206972012541****","552425858****"]

​

待邀请加入工作空间的用户列表，单次最多添加 20 个成员。

​

​

OpenSpaceMember

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

user_id

​

String

​

必选

​

2069720456*****

​

待邀请加入工作空间的用户的扣子用户 ID。

​

你可以单击扣子编程左下角的头像，选择

账号设置

，在页面底部查看扣子用户的 UID。

​

​

​

​

​

​

role_type

​

String

​

必选

​

member

​

该用户在工作空间中的角色：

​

admin：工作空间管理员。

​

member：工作空间成员。

​

说明

不支持设置为空间所有者。

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Object of

OpenAddSpaceMemberData

​

\

​

添加成员的结果信息。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{ "logid": "20250106172024B5F607030EFFAD6*****" }

​

响应详情信息。

​

​

OpenAddSpaceMemberData

​

​

参数

​

类型

​

示例

​

说明

​

not_exist_user_ids

​

Array of String

​

["21357147977***"]

​

因用户 ID 不存在而导致添加失败的用户 ID 列表。

​

added_success_user_ids

​

Array of String

​

["21399947977***"]

​

企业标准版或企业旗舰版成功添加的用户 ID 列表。

​

already_joined_user_ids

​

Array of String

​

["2177747977***"]

​

用户在该工作空间中已经存在，不重复添加。

​

already_invited_user_ids

​

Array of String

​

["21888147977***"]

​

已经发起邀请但用户还未同意加入的用户 ID 列表。

​

仅个人版的工作空间添加用户时需要发出邀请，用户同意后才会加入工作空间。

​

invited_success_user_ids

​

Array of String

​

["2136666147977***"]

​

个人版中，发起邀请且用户同意加入的用户 ID 列表。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

POST 'https

:

//https://api.coze.cn/v1/workspaces/7515267805***/members' \

​

--header 'Content-Type

:

application/json' \

​

--header 'Authorization

:

Bearer pat_FFTwAe4KB9GpaXCGoCjKbztWig4MT1SRB6yjP4n0PJ1AE3ukqw5yGj****'

​

{

​

"users"

:

[

​

{

​

"role_type"

:

"member"

,

​

"user_id"

:

"21357147977***"

​

},

​

{

​

"role_type"

:

"member"

,

​

"user_id"

:

"55242585801***"

​

}

​

]

​

}

​

返回示例

​

​

JSON

复制

{

​

"data"

:

{

​

"already_joined_user_ids"

:

[

​

"2135714797****"

​

],

​

"already_invited_user_ids"

:

[],

​

"added_success_user_ids"

:

[

​

"55242585****"

​

],

​

"invited_success_user_ids"

:

[],

​

"not_exist_user_ids"

:

[]

​

},

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20250616153813E8D5D5F993****"

​

},

​

"code"

:

0

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

查看空间成员列表

下一篇

批量移除空间中的用户
============================================================
# 批量移除空间中的用户
来源: https://www.coze.cn/open/docs/developer_guides/remove_space_member
============================================================

批量移除空间中的用户

批量移除工作空间中的用户。每次最多移除 5 个成员。

​

接口描述

​

调用本 API 将用户从指定的工作空间中移除。只能移除空间管理员或成员，不支持移除空间所有者。批量移除用户时，你可以在返回结果中查看移除失败的用户以及具体原因。

​

移除成员后，该成员拥有的资源将自动转移给工作空间所有者。

​

基础信息

​

​

请求方式

​

DELETE

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/workspaces/:workspace_id/members

​

权限

​

removeMember

​

确保调用该接口使用的访问令牌开通了

removeMember

权限，详细信息参考

鉴权方式

。

​

接口说明

​

批量移除空间中的用户。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $AccessToken

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

workspace_id

​

String

​

必选

​

736163827687053****

​

需要移除用户的空间 ID。

​

进入指定空间，空间页面 URL 中

w

参数后的数字就是 工作空间 ID。例如

https://code.coze.cn/w/75814654762959***/projects

，workspace_id 为

75814654762959***

。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

user_ids

​

Array of String

​

必选

​

["206972012541****","552425858****"]

​

要移除的成员，单次最多移除 5 个成员。

​

​

​

返回参数

​

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Object of

OpenRemoveSpaceMemberData

​

\

​

移除空间成员的结果信息。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{ "logid": "20250106172024B5F607030EFFAD6*****" }

​

响应详情信息。

​

​

OpenRemoveSpaceMemberData

​

​

参数

​

类型

​

示例

​

说明

​

removed_success_user_ids

​

Array of String

​

["21399947977***"]

​

成功移除的成员列表。

​

not_in_workspace_user_ids

​

Array of String

​

["21399947666***"]

​

不在当前空间中的用户 ID 列表，这些用户不会被处理。

​

owner_not_support_remove_user_ids

​

Array of String

​

["2177747977***"]

​

移除失败，该用户为空间所有者。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request DELETE 'https

:

//api.coze.cn/v1/workspaces/751526780526****/members' \

​

--header 'Content-Type

:

application/json' \

​

--header 'Authorization

:

Bearer pat_FFTwA******' \

​

{

​

"user_ids"

:

[

"206972012541****"

,

"2135714797****"

,

"552425858****"

]

​

​

返回示例

​

​

JSON

复制

{

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20250616153946D01251E104****"

​

},

​

"code"

:

0

,

​

"data"

:

{

​

"removed_success_user_ids"

:

[

​

"552425858****"

​

],

​

"not_in_space_user_ids"

:

[

​

"2069720125****"

​

],

​

"owner_not_support_remove_user_ids"

:

[

​

"21357147977***"

​

]

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

批量邀请用户加入空间

下一篇

查询文件夹列表
============================================================
# 查询文件夹列表
来源: https://www.coze.cn/open/docs/developer_guides/workspace_list_folder
============================================================

查询文件夹列表

工作空间中的用户可以查询工作空间中的文件夹列表。

​

接口描述

​

你可以查询某个文件夹或工作空间根目录下的子文件夹列表。每次查询仅返回下一层级的文件夹信息，不包含更深层级的子文件夹。若需要获取更深层级的文件夹信息，你可以多次调用本 API，利用上一次查询返回的文件夹 ID 继续查询。

​

基础信息

​

​

请求方式

​

GET

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/folders

​

​

权限

​

listFolder

​

确保调用该接口使用的访问令牌开通了

listFolder

权限，详细信息参考

鉴权方式

。

​

接口说明

​

查询工作空间中的文件夹列表。

​

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $AccessToken

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

workspace_id

​

String

​

必选

​

736163827687053****

​

待查询文件夹列表的工作空间 ID。

​

进入指定空间，空间页面 URL 中

w

参数后的数字就是 工作空间 ID。例如

https://code.coze.cn/w/75814654762959***/projects

，工作空间 ID 为

75814654762959***

。

​

folder_type

​

String

​

必选

​

development

​

文件夹类型，参数值固定为

development

。

​

parent_folder_id

​

String

​

可选

​

752430442263***

​

指定要查询的文件夹的父级文件夹 ID。当需要查看某个文件夹下的子文件夹列表时，需传入该文件夹的 ID。若不传或传入

0

，则表示查询工作空间根目录下的文件夹。

​

文件夹 ID 的获取方法如下：进入指定工作空间，单击

项目管理

，单击目标文件夹，在 URL 中

folder_id

参数后的数字就是文件夹 ID。例如：

https://code.coze.cn/w/74982048832804***/projects?folder_id=75635667770837***

，

folder_id

为

75635667770837***

。

​

page_num

​

Integer

​

可选

​

1

​

分页查询时的页码。默认为 1，即返回第一页数据。

​

page_size

​

Integer

​

可选

​

20

​

每页返回的数据条数，用于分页查询。默认值为

20

，最大值为

50

。

​

​

​

返回参数

​

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Object of

OpenGetSpaceFolderData

​

{"items":[{"id":"1234567****","name":"项目文档","description":"存放2023年项目相关文档","workspace_id":"5123945629***","children_count":0,"creator_user_id":"24787743932***","parent_folder_id":"1234567890***"}],"has_more":false,"total_count":10}

​

文件夹列表的查询结果，包含文件夹的详细信息、是否还有更多数据以及文件夹的总数量。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含本次请求的详细日志信息，用于问题排查。如果遇到异常报错场景，且反复重试仍然报错，可以根据此

logid

联系扣子团队获取帮助。

​

​

OpenGetSpaceFolderData

​

​

参数

​

类型

​

示例

​

说明

​

items

​

Array of

FolderSimpleInfo

​

\

​

查询的父文件夹下的文件夹列表，仅展示下一层级文件夹信息，不包含更深层级的子文件夹的信息。

​

has_more

​

Boolean

​

true

​

标识当前返回的文件夹列表是否还有更多数据未返回。

​

true

：还有更多未返回的文件夹。

​

false

：已返回所有数据。

​

total_count

​

Long

​

10

​

当前查询条件下第一层级的文件夹总数，不包含更深层级的子文件夹。

​

​

FolderSimpleInfo

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

1752316125533542***

​

文件夹 ID。

​

name

​

String

​

项目文档

​

文件夹的名称，用于标识和区分不同的文件夹。

description

​

String

​

存放2023年项目相关文档

​

文件夹的描述信息，用于提供关于文件夹的额外说明或备注。

folder_type

​

String

​

development

​

文件夹类型，当前仅支持

development

。

​

workspace_id

​

String

​

5123945629***

​

文件夹所属的工作空间的 Space ID。Space ID 是空间的唯一标识。

​

children_count

​

Integer

​

5

​

当前文件夹下的子文件夹数量，仅统计下一层级文件夹数量，不包含更深层级的子文件夹。

​

creator_user_id

​

String

​

24787743932***

​

创建该文件夹的扣子用户 UID，用于标识文件夹的创建者。

​

parent_folder_id

​

String

​

754268556394029***

​

当前文件夹的

父

文件夹 ID，用于标识文件夹的层级关系。如果未返回该字段，则表示当前文件夹为根文件夹。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v1/folders?folder_type=development&workspace_id=75060471874****' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json'

​

​

返回示例

​

​

JSON

复制

{

​

"data"

:

{

​

"total_count"

:

2

,

​

"has_more"

:

false

,

​

"items"

:

[

​

{

​

"name"

:

"项目文件夹2"

,

​

"description"

:

""

,

​

"id"

:

"7523161255335***"

,

​

"workspace_id"

:

"7506047187433***"

,

​

"creator_user_id"

:

"14232418519***"

,

​

"folder_type"

:

"development"

,

​

"parent_folder_id"

:

"752316125533***"

,

​

"children_count"

:

0

​

},

​

{

​

"name"

:

"项目文件夹1"

,

​

"description"

:

"存放扣子编程项目的文件"

,

​

"id"

:

"7523161237887238182"

,

​

"workspace_id"

:

"7506047187***"

,

​

"creator_user_id"

:

"14232418***"

,

​

"folder_type"

:

"development"

,

​

"parent_folder_id"

:

"752316125533****"

,

​

"children_count"

:

0

​

}

​

]

​

},

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"0217517972369490000000000000****"

​

},

​

"code"

:

0

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

批量移除空间中的用户

下一篇

查询文件夹详情
============================================================
# 查询文件夹详情
来源: https://www.coze.cn/open/docs/developer_guides/workspace_read_folder
============================================================

查询文件夹详情

工作空间中的用户可以查询工作空间中指定文件夹的详情，包括文件夹的名称、描述、所属工作空间、文件夹创建者的 UID等。

​

基础信息

​

​

请求方式

​

GET

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/folders/:folder_id

​

​

权限

​

readFolder

​

确保调用该接口使用的访问令牌开通了

readFolder

权限，详细信息参考

鉴权方式

。

​

接口说明

​

查询文件夹详情。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

folder_id

​

String

​

必选

​

7523161255335***1

​

文件夹 ID。你可以通过扣子编程页面获取文件夹 ID：

​

进入指定工作空间，单击

项目管理

，单击目标文件夹，在 URL 中

folder_id

参数后的数字就是文件夹 ID。例如：

https://code.coze.cn/w/74982048832804***/projects?folder_id=75635667770837***

，

folder_id

为

75635667770837***

。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Object of

FolderSimpleInfo

​

{"id":"1234567****","name":"项目文档","description":"存放2023年项目相关文档","workspace_id":"5123945629***","creator_user_id":"24787743932***","parent_folder_id":"1234567890***"}

​

包含文件夹的详细信息，如文件夹 ID、名称、描述、所属工作空间 ID、创建者用户 UID 和父文件夹 ID。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含本次请求的详细日志信息，用于问题排查和技术支持。

​

FolderSimpleInfo

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

1752316125533542***

​

文件夹 ID。

​

name

​

String

​

项目文档

​

文件夹的名称，用于标识和区分不同的文件夹。

description

​

String

​

存放2023年项目相关文档

​

文件夹的描述信息，用于提供关于文件夹的额外说明或备注。

folder_type

​

String

​

development

​

文件夹类型，当前仅支持

development

。

​

workspace_id

​

String

​

5123945629***

​

文件夹所属的工作空间的 Space ID。Space ID 是空间的唯一标识。

​

creator_user_id

​

String

​

24787743932***

​

创建该文件夹的扣子用户 UID，用于标识文件夹的创建者。

​

parent_folder_id

​

String

​

754268556394029***

​

当前文件夹的

父

文件夹 ID，用于标识文件夹的层级关系。如果未返回该字段，则表示当前文件夹为根文件夹。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v1/folders/752316125533***' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json' \

​

​

返回示例

​

​

JSON

复制

{

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20250707155659005CF0FD***"

​

},

​

"code"

:

0

,

​

"data"

:

{

​

"creator_user_id"

:

"14232418519***"

,

​

"parent_folder_id"

:

"754268556394029***"

,

​

"folder_type"

:

"development"

,

​

"name"

:

"项目文件夹1"

,

​

"description"

:

""

,

​

"id"

:

"752316131905***"

,

​

"workspace_id"

:

"7506047187433***"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

查询文件夹列表

下一篇

成员管理（火山 API）
============================================================
# 成员管理（火山 API）
来源: https://www.coze.cn/open/docs/developer_guides/create_coze_user
============================================================

成员管理（火山 API）

将员工添加到扣子编程之前，需要先在火山引擎创建成员（即火山子用户）。本文介绍如何调用火山引擎 API 创建成员、授权成员访问扣子编程和查看成员列表。

​

背景信息

​

扣子编程的成员管理依赖火山引擎访问控制（IAM）产品，相关 API 均由火山引擎提供，与扣子编程业务 API 分属不同体系。

开发者在调用前需注意以下方面：

​

鉴权方式

：仅支持火山引擎的鉴权方式，需使用火山账号的

AccessKey

和

SecretKey

，不支持扣子编程的访问令牌。

​

调用方法

：成员管理使用火山引擎 OpenAPI 的请求结构和返回结构，具体请参见

请求结构

、

返回结构

。

​

在线调用工具

：你可以通过火山引擎

API Explorer

快速发起 API 调用，获取响应结果和代码示例。扣子编程 Playground 不支持调用本文所列的 API。

​

SDK

：你

可以使用火山引擎提供的 Volcengine SDK 实现成员管理

，

该 SDK 已内置 AK/SK 签名逻辑，无需自行实现，

SDK 接入方法请参见

Volcengine SDK 接入指南

。

扣子编程自身的 SDK 不含成员管理相关接口。

​

流控限制

​

主账号内的所有

AccessKey

共享同一 API 的流控额度，单个 API 的流控限制为 5 QPS。

​

准备工作

​

已获取火山引擎 API 访问令牌

​

火山引擎的访问令牌和扣子编程的访问令牌不通用，调用火山引擎 API 之前，你需要获取

火山账号

的

AccessKey

和

SecretKey

，具体请参见

获取AccessKey、SecretKey

。

​

说明

为了账号安全，建议使用子用户密钥，为应用程序创建独立的 IAM 用户，并为 IAM 用户分配

CozeFullAccess

和

CloudIdentityFullAccess

权限。

​

​

​

​

​

​

​

步骤一：

创建成员

​

调用火山引擎的

CreateUser-新建成员

API，创建扣子成员（火山子用户）。

​

说明

每次请求只能新增一位成员。如需添加多位，请依次发送请求。

​

该 API 不支持并发请求。

​

创建成员后，会自动将其加入扣子编程的团队/企业中。

​

​

请求示例

​

​

JSON

复制

POST /?Action=CreateUser&Version=

2025-06-01

HTTP/

1.1

​

Host

:

open.volcengineapi.com

​

Content-Type

:

application/json; charset=UTF

-8

​

X-Date

:

20250605

T145232Z

​

X-Content-Sha256

:

287e874

e******d653b44d21e

​

Authorization

:

HMAC-SHA256 Credential=Adfks******wekfwe/

20250605

/cn-beijing/coze/request

,

SignedHeaders=host;x-content-sha256;x-date

,

Signature=

47

a7d934ff7b37c03938******cd7b8278a40a1057690c401e92246a0e41085f

​

​

{

​

"UserName"

:

"username"

,

​

"SecurePhone"

:

"+861112225***5"

,

​

"SecureEmail"

:

"test@email.com"

​

}

​

​

返回示例

​

​

JSON

复制

{

​

"ResponseMetadata"

:

{

​

"RequestId"

:

"20250605225240127115***E6E58"

,

​

"Action"

:

"CreateUser"

,

​

"Version"

:

"2025-06-01"

,

​

"Service"

:

"coze"

,

​

"Region"

:

"cn-beijing"

​

},

​

"Result"

:

{

​

"UserID"

:

"123****4"

​

}

​

}

​

​

说明

你需要保存返回的

UserID

，后续授权时需要使用。

​

​

步骤二：授权成员访问扣子编程

​

调用火山引擎的

AuthorizeCozeToUser-授权成员访问扣子

API，给目标成员授权访问扣子编程。

​

授权成功后，系统会自动激活该成员。

​

请求示例

​

​

JSON

复制

POST /?Action=AuthorizeCozeToUser&Version=

2025-06-01

HTTP/

1.1

​

Host

:

open.volcengineapi.com

​

Content-Type

:

application/json; charset=UTF

-8

​

X-Date

:

20250604

T100255Z

​

X-Content-Sha256

:

287e874

e******d653b44d21e

​

Authorization

:

HMAC-SHA256 Credential=Adfks******wekfwe/

20250604

/cn-beijing/coze/request

,

SignedHeaders=host;x-content-sha256;x-date

,

Signature=

47

a7d934ff7b37c03938******cd7b8278a40a1057690c401e92246a0e41085f

​

​

{

​

"UserId"

:

"t3HTsg"

​

}

​

​

返回示例

​

​

JSON

复制

{

​

"ResponseMetadata"

:

{

​

"RequestId"

:

"20250604180259120150106074E7FD18"

,

​

"Action"

:

"AuthorizeCozeToUser"

,

​

"Version"

:

"2025-06-01"

,

​

"Service"

:

"coze"

,

​

"Region"

:

"cn-beijing"

​

},

​

"Result"

:

{}

​

}

​

​

步骤三：（可选）授权访问火山引擎控制台

​

若要允许成员以 IAM 子用户身份访问火山引擎控制台，你可以调用火山引擎的

AuthorizeVolcToUser-授权访问火山引擎控制台

API，给对应的成员授权，否则该成员只能使用扣子编程，无法访问火山引擎控制台。

​

请求示例

​

​

JSON

复制

POST /?Action=AuthorizeVolcToUser&Version=

2025-06-01

HTTP/

1.1

​

Host

:

open.volcengineapi.com

​

Content-Type

:

application/json; charset=UTF

-8

​

X-Date

:

20250605

T145209Z

​

X-Content-Sha256

:

287e874

e******d653b44d21e

​

Authorization

:

HMAC-SHA256 Credential=Adfks******wekfwe/

20250605

/cn-beijing/coze/request

,

SignedHeaders=host;x-content-sha256;x-date

,

Signature=

47

a7d934ff7b37c03938******cd7b8278a40a1057690c401e92246a0e41085f

​

​

{

​

"UserId"

:

"123"

​

}

​

​

返回示例

​

​

JSON

复制

{

​

"ResponseMetadata"

:

{

​

"RequestId"

:

"2025060420393105323013214***"

,

​

"Action"

:

"AuthorizeVolcToUser"

,

​

"Version"

:

"2025-06-01"

,

​

"Service"

:

"coze"

,

​

"Region"

:

"cn-beijing"

​

},

​

"Result"

:

{}

​

}

​

​

相关操作

​

查看成员列表

​

调用火山引擎的

ListCozeUser-成员列表

API，查看已创建的成员信息，包括火山引擎账号 ID、用户名、扣子用户 UID、是否已激活等。

​

请求示例

​

​

JSON

复制

POST /?Action=ListCozeUser&Version=

2025-06-01

HTTP/

1.1

​

Host

:

open.volcengineapi.com

​

Content-Type

:

application/json; charset=UTF

-8

​

X-Date

:

20250605

T145044Z

​

X-Content-Sha256

:

287e874

e******d653b44d21e

​

Authorization

:

HMAC-SHA256 Credential=Adfks******wekfwe/

20250605

/cn-beijing/coze/request

,

SignedHeaders=host;x-content-sha256;x-date

,

Signature=

47

a7d934ff7b37c03938******cd7b8278a40a1057690c401e92246a0e41085f

​

​

{

​

"QueryString"

:

"user"

,

​

"PageNumber"

:

1

,

​

"PageSize"

:

10

,

​

"UserName"

:

"username"

​

}

​

​

返回示例

​

​

JSON

复制

{

​

"ResponseMetadata"

:

{

​

"RequestId"

:

"20250605225102135200***07"

,

​

"Action"

:

"ListCozeUser"

,

​

"Version"

:

"2025-06-01"

,

​

"Service"

:

"coze"

,

​

"Region"

:

"cn-beijing"

​

},

​

"Result"

:

{

​

"PageNumber"

:

1

,

​

"PageSize"

:

10

,

​

"Total"

:

10

,

​

"Users"

:

[

​

{

​

"CozeUserInEnterprise"

:

"true"

,

​

"CreatedTime"

:

"2025-02-25T19:21:15+08:00"

,

​

"UpdatedTime"

:

"2025-02-25T19:21:15+08:00"

,

​

"UserId"

:

"1234"

,

​

"UserName"

:

"username"

,

​

"CozeUserId"

:

"1888000022***3"

,

​

"CozeUserName"

:

"用户111222"

​

}

​

]

​

}

​

}

​

​

​

上一篇

查询文件夹详情

下一篇

添加企业成员
============================================================
# 添加企业成员
来源: https://www.coze.cn/open/docs/developer_guides/add_enterprise_member
============================================================

添加企业成员

添加员工到企业。

​

在火山引擎创建用户后，

默认会自动将用户添加至企业

，若未成功添加，你可以调用本 API 将用户添加至企业。火山引擎创建用户的具体方法请参见

成员管理

。

​

接口限制

​

套餐限制

：扣子企业版（企业标准版、企业旗舰版）。

​

本 API 仅支持添加员工（火山子用户），不支持添加外部成员（访客）。

​

添加成员总数不能超过企业标准版权益中的成员数量上限（100 个成员），否则会提示 777074011错误。

​

说明

每次请求只能添加一位成员。如需添加多位，请依次发送请求。

​

该 API 不支持并发请求。

​

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/enterprises/:enterprise_id/members

​

​

权限

​

Enterprise.batchAddPeople

​

确保调用该接口使用的访问令牌开通了

Enterprise.batchAddPeople

权限，详细信息参考

鉴权方式

。

​

接口说明

​

添加企业成员。

​

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

enterprise_id

​

String

​

必选

​

volcano_210195***

​

企业 ID，用于标识用户所属的企业。

​

你可以在组织管理 > 组织设置页面查看企业 ID。

​

​

​

​

​

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

users

​

Array of

OpenEnterpriseMember

​

可选

​

[ { "user_id": "247877439325****", "role": "enterprise_member" } ]

​

待邀请加入企业的用户列表，单次最多添加

1

个成员。每个成员包含用户 ID 和角色信息。

​

​

OpenEnterpriseMember

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

role

​

String

​

必选

​

enterprise_member

​

成员在企业中的角色，枚举值：

​

enterprise_admin

：企业管理员。

​

enterprise_member

：企业普通成员。

​

user_id

​

String

​

必选

​

247877439325****

​

需要添加至企业的扣子用户 UID。

​

你可以调用火山引擎的

ListCozeUser-成员列表

API，查看

CozeUserId

的值即为扣子用户 UID。

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/enterprises/volcano_210195*** /members' \

​

--header 'Authorization

:

Bearer pat_O******' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"users"

:

[

​

{

​

"user_id"

:

"247877439325****"

,

​

"role"

:

"enterprise_member"

​

}

​

]

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

成员管理（火山 API）

下一篇

修改企业员工的角色
============================================================
# 修改企业员工的角色
来源: https://www.coze.cn/open/docs/developer_guides/update_enterprise_people
============================================================

修改企业员工的角色

修改企业员工的角色。

​

企业员工角色包括企业管理员和企业普通成员，你可以通过本 API 修改企业员工的角色。

​

接口限制

​

不能修改访客的角色。

​

基础信息

​

​

请求方式

​

PUT

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/enterprises/:enterprise_id/members/:user_id

​

​

权限

​

Enterprise.updatePeople

​

确保调用该接口使用的访问令牌开通了

企业特权应用

中的

Enterprise.updatePeople

权限，详细信息参考

OAuth JWT 授权（企业特权应用）

。

​

接口说明

​

修改企业员工的角色。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息参考

OAuth JWT 授权（企业特权应用）

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

enterprise_id

​

String

​

必选

​

volcano_210195***

​

企业 ID，待修改的员工所属的企业。

​

你可以在组织管理 > 组织设置页面查看企业 ID。

​

​

​

​

​

​

user_id

​

String

​

必选

​

247877439325****

​

待修改员工的扣子用户 UID。

​

你可以调用火山引擎的

ListCozeUser-成员列表

API，其中

CozeUserId

的值即为扣子用户 UID。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

role

​

String

​

必选

​

enterprise_member

​

设置成员在企业中的角色，枚举值：

​

enterprise_admin

：企业管理员。

​

enterprise_member

：企业普通成员。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID，便于在异常情况下进行问题排查。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request PUT 'https

:

//api.coze.cn/v1/enterprises/volcano_210195***/members/247877439325****' \

​

--header 'Authorization

:

Bearer pat_O******' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"role"

:

"enterprise_member"

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

添加企业成员

下一篇

移除企业成员
============================================================
# 移除企业成员
来源: https://www.coze.cn/open/docs/developer_guides/remove_enterprise_member
============================================================

移除企业成员

移除企业成员，并指定资源接收人。

​

接口限制

​

套餐限制

：扣子企业版（企业标准版、企业旗舰版）。

​

需要先调用

移除组织成员

API 将用户从所有组织中移除，再执行本 API 将其移出企业。

​

被移除成员的资源只能转移给企业超级管理员或企业管理员。

​

说明

每次请求只能移除一位成员。如需移除多位成员，请依次发送请求。

​

该 API 不支持并发请求。

​

​

基础信息

​

​

请求方式

​

DELETE

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/enterprises/:enterprise_id/members/:user_id

​

​

权限

​

Enterprise.removePeople

​

确保调用该接口使用的访问令牌开通了

企业特权应用

中的

Enterprise.removePeople

权限，详细信息参考

OAuth JWT 授权（企业特权应用）

。

​

接口说明

​

移除企业成员。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

enterprise_id

​

String

​

必选

​

volcano_210195***

​

需要移除用户的企业 ID。

​

你可以在

组织管理

>

组织设置

页面查看企业 ID。

​

​

​

​

​

​

user_id

​

String

​

必选

​

247877439325****

​

需要移除的扣子用户 UID。

​

你可以调用火山引擎的

ListCozeUser-成员列表

API，查看

CozeUserId

的值即为扣子用户 UID。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

receiver_user_id

​

String

​

必选

​

41134548551****

​

接收被移除成员资源的扣子用户 UID，需填写企业超级管理员或管理员的用户 UID。被移除成员的工作空间、智能体、工作流等资源将转移给该用户。

​

获取企业超级管理员或管理员用户 UID 的方法如下：

​

1.

在

企业管理

>

成员管理

页面查看企业的超级管理员或管理员信息。

​

2.

企业的超级管理员或管理员在扣子编程左下角单击头像，选择

账号设置

，查看账号的 UID。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request DELETE 'https

:

//api.coze.cn/v1/enterprises/volcano_210195***/members/247877439325****' \

​

--header 'Authorization

:

Bearer pat_O******' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"receiver_user_id"

:

"41134548551****"

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

修改企业员工的角色

下一篇

创建组织
============================================================
# 创建组织
来源: https://www.coze.cn/open/docs/developer_guides/create_organization
============================================================

创建组织

在指定的企业中创建组织。

​

接口限制

​

套餐限制

：扣子企业旗舰版。

​

数量限制

：一个企业中最多存在 20 个组织。

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/enterprises/:enterprise_id/organizations

​

​

权限

​

Enterprise.createOrganization

​

确保调用该接口使用的访问令牌开通了

企业特权应用

中的

Enterprise.createOrganization

权限，详细信息参考

OAuth JWT 授权（企业特权应用）

。

​

接口说明

​

在指定的企业中创建组织。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息参考

OAuth JWT 授权（企业特权应用）

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

enterprise_id

​

String

​

必选

​

volcano_210195***

​

企业 ID，用于标识该组织所属的企业。

​

你可以在

组织管理

>

组织设置

页面查看企业 ID。

​

​

​

​

​

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

name

​

String

​

必选

​

研发部

​

自定义组织的名称。

​

最大长度为 30 个字符。

​

super_admin_user_id

​

String

​

必选

​

411345614833****

​

指定组织的超级管理员的扣子用户 UID。

​

你可以调用火山引擎的

ListCozeUser-成员列表

API，

CozeUserId

的值即为扣子用户 UID。

​

说明

只有已加入企业的员工能被指定为组织的超级管理员。

​

​

description

​

String

​

可选

​

研发部内部使用的组织

​

自定义组织的描述信息，最大长度为 100 个字符。默认为空。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

CreateOrganizationData

​

{"organization_id":"74908881444562***"}

​

返回的组织信息。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含本次请求的详细信息，主要用于异常报错场景下的问题排查。

​

​

CreateOrganizationData

​

​

参数

​

类型

​

示例

​

说明

​

organization_id

​

String

​

74908881444562***

​

组织 ID。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/enterprises/volcano_210195***/organizations' \

​

--header 'Authorization

:

Bearer pat_O******' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"name"

:

"研发部"

,

​

"super_admin_user_id"

:

"411345614833****"

,

​

"description"

:

"研发部内部使用的组织"

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"data"

:

{

​

"organization_id"

:

"74908881444562***"

​

},

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

移除企业成员

下一篇

修改组织基本信息
============================================================
# 修改组织基本信息
来源: https://www.coze.cn/open/docs/developer_guides/update_organization_info
============================================================

修改组织基本信息

修改指定组织的基本信息，包括组织名称和描述。

​

接口限制

​

套餐限制

：仅扣子企业旗舰版支持。

​

组织的名称和描述需要符合内容安全规范，不得包含涉政、涉黄等违规内容，否则扣子编程会提示 4102 错误。

​

基础信息

​

​

请求方式

​

PUT

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/organizations/:organization_id

​

​

权限

​

Account.updateOrganization

​

确保调用该接口使用的访问令牌开通了

Account.updateOrganization

权限，详细信息参考

鉴权方式

。

​

接口说明

​

修改组织基本信息。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

organization_id

​

String

​

必选

​

7559861372637***

​

待修改组织信息的组织 ID。

​

你可以在

组织管理

>

组织设置

页面查看对应的组织 ID，或通过

查询组织列表

API 查询组织 ID。

​

​

​

​

​

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

name

​

String

​

可选

​

研发部

​

修改后的组织名称。默认为空，表示不修改。

​

最大长度为 30 个字符。

​

description

​

String

​

可选

​

研发部内部使用的组织

​

修改后的组织描述。默认为空，表示不修改。

​

最大长度为 100 个字符。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的日志信息，用于问题排查和技术支持。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request PUT 'https

:

//api.coze.cn/v1/organizations/7559861372637***' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json'

​

--data-raw '

{

​

"name"

:

"研发部"

,

​

"description"

:

"研发部内部使用的组织"

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

创建组织

下一篇

查询组织列表
============================================================
# 查询组织列表
来源: https://www.coze.cn/open/docs/developer_guides/list_organization
============================================================

查询组织列表

查询指定企业中的组织列表。

​

接口限制

​

套餐限制

：扣子企业版（企业标准版、企业旗舰版）。

​

基础信息

​

​

请求方式

​

GET

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/enterprises/:enterprise_id/organizations

​

​

权限

​

Enterprise.listOrganization

​

确保调用该接口使用的访问令牌开通了

企业特权应用

中的

Enterprise.listOrganization

权限，详细信息参考

OAuth JWT 授权（企业特权应用）

。

​

接口说明

​

查询指定企业中的组织列表。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息参考

OAuth JWT 授权（企业特权应用）

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

enterprise_id

​

String

​

必选

​

volcano_210195***

​

企业 ID，查询组织列表所属的企业。

​

你可以在

组织管理

>

组织设置

页面查看企业 ID。

​

​

​

​

​

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

page_num

​

Integer

​

可选

​

1

​

分页查询时的页码。默认为 1，即返回第一页数据。

​

page_size

​

Integer

​

可选

​

20

​

每页返回的数据条数，用于分页查询。默认值为 20，最大值为 20。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

ListOrganizationData

​

{"items":[{"organization_id":"7490888144456***","organization_name":"默认组织","organization_icon_url":"

https://example.com/organization_icons/7490888144456***.png

","is_default_organization":true},{"organization_id":"7490888144457***","organization_name":"市场部","organization_icon_url":"

https://example.com/organization_icons/7490888144457***.png

","is_default_organization":false}],"total_count":2}

​

包含符合查询条件的企业组织列表及其数量。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含本次请求的详细信息，主要用于异常报错场景下的问题排查。

​

​

ListOrganizationData

​

​

参数

​

类型

​

示例

​

说明

​

items

​

Array of

OrganizationBasicInfo

​

[{"organization_id":"7490888144456***","organization_name":"默认组织","organization_icon_url":"

https://example.com/organization_icons/7490888144456***.png

","is_default_organization":true},{"organization_id":"7490888144457***","organization_name":"市场部","organization_icon_url":"

https://example.com/organization_icons/7490888144457***.png

","is_default_organization":false}]

​

企业下的组织列表，包含每个组织的详细信息。

​

total_count

​

Long

​

2

​

企业中的组织数量。

​

​

OrganizationBasicInfo

​

​

参数

​

类型

​

示例

​

说明

​

organization_id

​

String

​

7490888144456***

​

组织 ID。

​

organization_name

​

String

​

市场部

​

组织名称。

​

organization_icon_url

​

String

​

https://example.com/organization_icons/7490888144456***.png

​

组织的头像 URL 地址。

​

is_default_organization

​

Boolean

​

true

​

标识当前组织是否为默认组织。

​

true

：默认组织。

​

false

：自定义组织。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v1/enterprises/volcano_210195***/organizations?page_num=1&page_size=20' \

​

--header 'Authorization

:

Bearer pat_O******' \

​

--header 'Content-Type

:

application/json' \

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"data"

:

{

​

"items"

:

[

​

{

​

"organization_id"

:

"7490888144456***"

,

​

"organization_name"

:

"默认组织"

,

​

"organization_icon_url"

:

"https://example.com/organization_icons/7490888144456***.png"

,

​

"is_default_organization"

:

true

​

},

​

{

​

"organization_id"

:

"7490888144457***"

,

​

"organization_name"

:

"市场部"

,

​

"organization_icon_url"

:

"https://example.com/organization_icons/7490888144457***.png"

,

​

"is_default_organization"

:

false

​

}

​

],

​

"total_count"

:

2

​

},

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

修改组织基本信息

下一篇

添加组织成员
============================================================
# 添加组织成员
来源: https://www.coze.cn/open/docs/developer_guides/add_organization_people
============================================================

添加组织成员

添加组织成员。

​

接口描述

​

用户加入企业时将自动加入默认组织。

创建组织

后，你可以调用本 API 将员工和访客加入对应组织。

​

接口限制

​

套餐限制

：扣子企业版（企业标准版、企业旗舰版）。

​

用户加入组织前，需先将其添加至对应企业，具体请参见

添加企业成员

。

​

访客加入组织后，组织角色只能是访客。

​

说明

每次请求只能添加一位成员。如需添加多位，请依次发送请求。

​

该 API 不支持并发请求。

​

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/organizations/:organization_id/members

​

​

权限

​

batchAddOrganizationPeople

​

确保调用该接口使用的访问令牌开通了

企业特权应用

中的

batchAddOrganizationPeople

权限，详细信息参考

OAuth JWT 授权（企业特权应用）

。

​

接口说明

​

添加组织成员。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息参考

OAuth JWT 授权（企业特权应用）

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

organization_id

​

String

​

必选

​

7490888144456***

​

需要添加组织成员的组织 ID。

​

你可以在

组织管理

>

组织设置

页面查看对应的组织 ID，或通过

查询组织列表

API 查询组织 ID。

​

​

​

​

​

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

organization_people

​

Array of

OrganizationPeopleAddData

​

必选

​

[{"user_id":"41135614833****","organization_role_type":"organization_admin"}]

​

待添加至组织的成员列表。

​

​

OrganizationPeopleAddData

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

user_id

​

String

​

必选

​

41135614833****

​

需要添加至组织的扣子用户的 UID。

​

你可以调用火山引擎的

ListCozeUser-成员列表

API，其中

CozeUserId

的值即为扣子用户的 UID。

​

organization_role_type

​

String

​

必选

​

organization_admin

​

设置用户在组织中的角色，枚举值：

​

organization_super_admin

：组织超级管理员。

​

organization_admin

：组织管理员。

​

organization_member

：组织成员。

​

organization_guest

：访客。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含本次请求的详细信息，主要用于异常报错场景下的问题排查。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/organizations/7490888144456***/members' \

​

--header 'Authorization

:

Bearer pat_O******' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"organization_people"

:

[

​

{

​

"user_id"

:

"41135614833****"

,

​

"organization_role_type"

:

"organization_admin"

​

}

​

]

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

查询组织列表

下一篇

查询组织成员列表
============================================================
# 查询组织成员列表
来源: https://www.coze.cn/open/docs/developer_guides/list_organization_people
============================================================

查询组织成员列表

查询指定组织中的成员列表。

​

基础信息

​

​

请求方式

​

GET

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/organizations/:organization_id/members

​

​

权限

​

Account.listOrganizationPeople

​

确保调用该接口使用的访问令牌开通了

企业特权应用

中的

Account.listOrganizationPeople

权限，详细信息参考

OAuth JWT 授权（企业特权应用）

。

​

接口说明

​

查询组织成员列表。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息参考

OAuth JWT 授权（企业特权应用）

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

organization_id

​

String

​

必选

​

7559861372637***

​

需要查询组织成员列表的组织 ID。

​

你可以在

组织管理

>

组织设置

页面查看对应的组织 ID，或通过

查询组织列表

API 查询组织 ID。

​

​

​

​

​

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

page_num

​

Integer

​

可选

​

1

​

分页查询时的页码。默认为 1，即返回第一页数据。

​

page_size

​

Integer

​

可选

​

20

​

每页返回的数据条数，用于分页查询。默认值为

20

，最大支持

50

条。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

ListOrganizationPeopleData

​

{"items":[{"user_id":"41147914833****","is_valid":true,"avatar_url":"

https://example.com/avatar/41147914833****.jpg

","created_at":1715000000,"people_type":"employee","user_nickname":"John","user_unique_name":"John_123","organization_role_type":"organization_admin"}],"total_count":1}

​

组织成员列表，包含成员详细信息和总数。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含本次请求的日志信息，用于问题排查和技术支持。

​

​

ListOrganizationPeopleData

​

​

参数

​

类型

​

示例

​

说明

​

items

​

Array of

OrganizationPeople

​

[{"user_id":"41147914833****","is_valid":true,"avatar_url":"

https://example.com/avatar/41147914833****.jpg

","created_at":1715000000,"people_type":"employee","user_nickname":"John","user_unique_name":"John_123","organization_role_type":"organization_admin"}]

​

组织成员列表。

​

total_count

​

Long

​

100

​

组织中的成员数量。

​

​

OrganizationPeople

​

​

参数

​

类型

​

示例

​

说明

​

user_id

​

String

​

41147914833****

​

扣子用户的 UID。

​

is_valid

​

Boolean

​

true

​

标识该组织成员账号状态是否正常。

​

true

：账号状态正常，可正常使用。

​

false

：该成员的火山账号已被删除，不可使用。

​

avatar_url

​

String

​

https://example.com/avatar/41147914833****.jpg

​

用户头像的 URL 地址。

​

created_at

​

Long

​

1715000000

​

用户加入组织的时间戳，格式为 10 位的 Unix 时间戳，单位为秒。

​

people_type

​

String

​

employee

​

组织成员在企业中的身份类型，枚举值：

​

employee

：企业员工。

​

guest

：访客。

​

user_nickname

​

String

​

John

​

用户昵称。

​

user_unique_name

​

String

​

user5916927***

​

扣子用户名。

​

organization_role_type

​

String

​

organization_admin

​

组织成员在组织中的角色类型，枚举值：

​

organization_super_admin

：组织超级管理员。

​

organization_admin

：组织管理员。

​

organization_member

：组织成员。

​

organization_guest

：访客。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v1/organizations/7559861372637***/members?page_num=1&page_size=20' \

​

--header 'Authorization

:

Bearer pat_O******' \

​

--header 'Content-Type

:

application/json' \

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"data"

:

{

​

"items"

:

[

​

{

​

"user_id"

:

"41147914833****"

,

​

"is_valid"

:

true

,

​

"avatar_url"

:

"https://example.com/avatar/41147914833****.jpg"

,

​

"created_at"

:

1715000000

,

​

"people_type"

:

"employee"

,

​

"user_nickname"

:

"John"

,

​

"user_unique_name"

:

"John_123"

,

​

"organization_role_type"

:

"organization_admin"

​

}

​

],

​

"total_count"

:

1

​

},

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

添加组织成员

下一篇

修改组织成员角色
============================================================
# 修改组织成员角色
来源: https://www.coze.cn/open/docs/developer_guides/update_organization_people
============================================================

修改组织成员角色

修改组织成员的角色。

​

组织成员角色包括组织超级管理员、组织管理员、组织成员和访客。你可以通过本 API 修改组织成员的角色。

​

接口限制

​

企业外部用户的角色只能是访客，不支持修改。

​

企业员工的角色不能设置为访客。

​

组织管理员不能将其他人设为组织超级管理员，只有组织超级管理员创建的访问令牌能设置其他人为组织超级管理员。

​

基础信息

​

​

请求方式

​

PUT

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/organizations/:organization_id/members/:user_id

​

​

权限

​

updateOrganizationPeople

​

确保调用该接口使用的访问令牌开通了

企业特权应用

中的

updateOrganizationPeople

权限，详细信息参考

OAuth JWT 授权（企业特权应用）

。

​

接口说明

​

修改组织成员的角色。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息参考

OAuth JWT 授权（企业特权应用）

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

organization_id

​

String

​

必选

​

7490888144456***

​

待修改组织成员的组织 ID。

​

你可以在

组织管理

>

组织设置

页面查看对应的组织 ID。

​

​

​

​

​

​

user_id

​

String

​

必选

​

41135614833****

​

待修改角色的组织成员的 UID。

​

你可以调用

查询组织成员列表

API，查看组织成员的扣子用户 UID。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

organization_role_type

​

String

​

必选

​

organization_member

​

设置用户在组织中的角色，枚举值：

​

organization_super_admin

：组织超级管理员。

​

organization_admin

：组织管理员。

​

organization_member

：组织成员。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含本次请求的详细信息，主要用于异常报错场景下的问题排查。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request PUT 'https

:

//api.coze.cn/v1/organizations/74908881444562***/members/41135614833****' \

​

--header 'Authorization

:

Bearer pat_O******' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"organization_role_type"

:

"organization_member"

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

查询组织成员列表

下一篇

移除组织成员
============================================================
# 移除组织成员
来源: https://www.coze.cn/open/docs/developer_guides/remove_organization_member
============================================================

移除组织成员

移除组织成员，并指定资源接收人。

​

接口描述

​

如果成员因离职或换部门等场景需要调整归属的组织时，你可以调用本 API 将其移出组织。

​

移除组织成员时，扣子编程会自动将成员移出工作空间，并将其拥有的资源转移给指定的组织超级管理员。移除组织成员并不会将该成员从企业中删除，如果需要彻底从企业中删除，请调用

移除企业成员

API 将该成员从企业中移除。

​

接口限制

​

套餐限制

：扣子企业版（企业标准版、企业旗舰版）。

​

被移除成员的资源只能转移给组织超级管理员。

​

移除组织超级管理员前，请确保该组织中已存在其他超级管理员，否则，移除时会提示 777074044 错误。

​

说明

每次请求只能移除一位成员。如需移除多位成员，请依次发送请求。

​

该 API 不支持并发请求。

​

​

基础信息

​

​

请求方式

​

DELETE

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/organizations/:organization_id/members/:user_id

​

​

权限

​

Account.removeOrganizationPeople

​

确保调用该接口使用的访问令牌开通了

企业特权应用

中的

Account.removeOrganizationPeople

权限，详细信息参考

OAuth JWT 授权（企业特权应用）

。

​

接口说明

​

移除组织成员。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

organization_id

​

String

​

必选

​

74908881444562***

​

组织 ID。你可以在

组织管理

>

组织设置

页面查看对应的组织 ID。

​

​

​

​

​

​

user_id

​

String

​

必选

​

41135614833****

​

需要移除的扣子用户的 UID。

​

你可以调用火山引擎的

ListCozeUser-成员列表

API，查看

CozeUserId

的值即为扣子用户 UID。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

receiver_user_id

​

String

​

必选

​

411356148551****

​

接收被移除成员资源的扣子用户 UID，需填写

组织超级管理员

的用户 UID。被移除成员的工作空间、智能体、工作流等资源将转移给该用户。

​

获取组织超级管理员用户 UID 的步骤如下：

​

1.

在

组织管理

>

组织成员管理

页面查看组织的超级管理员信息。

​

2.

组织的超级管理员在扣子编程左下角单击头像，选择

账号设置

，查看账号的 UID。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request DELETE 'https

:

//api.coze.cn/v1/organizations/74908881444562***/members/411356148551****' \

​

--header 'Authorization

:

Bearer pat_O******' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"receiver_user_id"

:

"411379148551****"

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​
============================================================
# 创建会话
来源: https://www.coze.cn/open/docs/developer_guides/create_conversation
============================================================

创建会话

创建一个会话。

​

接口描述

​

会话是智能体和用户之间的基于一个或多个主题的问答交互，一个会话包含一条或多条消息。创建会话时，扣子编程会同时在会话中创建一个空白的上下文片段，用于存储某个主题的消息。后续发起对话时，上下文片段中的消息是模型可见的消息历史。

​

你可以在创建会话时同步写入消息，或者创建会话后另外调用

创建消息 API

写入消息。消息默认写入到最新的一个上下文片段中，对话时将作为上下文传递给模型。

​

会话、对话、消息和上下文片段的概念说明，可参考

基础概念

。

​

如果需要将不同业务侧用户的会话互相隔离，请参见

如何实现会话隔离

。

​

基础信息

​

​

请求方式

​

POST

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/conversation/create

​

权限

​

createConversation

​

确保调用该接口使用的访问令牌开通了

createConversation

权限，详细信息参考

准备工作

。

​

接口说明

​

创建一个会话。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

bot_id

​

String

​

可选

​

730454116184516*

​

会话对应的智能体 ID。

​

创建会话时指定智能体 ID，后续才能通过

查看会话列表

查看指定智能体 ID 对应的会话列表。

​

智能体 ID，获取方法如下：

​

进入智能体的 开发页面，开发页面 URL 中

bot

参数后的数字就是智能体 ID。例如

https://www.coze.cn/space/341****/bot/73428668*****

，智能体 ID 为

73428668*****

。

​

name

​

String

​

可选

​

推荐杭州美食

​

会话的名称。默认为空。为了方便区分不同会话，建议设置会话名称。最多支持 100 个字符。

​

messages

​

Array of

EnterMessage

​

可选

​

[ { "role": "user", "content":"[{"type":"text","text":"你好，这是我的图片"},{"type":"image","file_id":"145657573***"}]", "content_type":"object_string" }, { "role": "assistant", "content": "你好我是一个bot", "content_type":"text" } ]

​

会话中的消息内容。详细说明可参考

EnterMessage object

。

​

connector_id

​

String

​

可选

​

1024

​

该会话在哪个渠道创建。目前支持如下渠道：

​

API：（默认）1024

​

ChatSDK：999

​

自定义渠道：自定义渠道 ID。自定义渠道 ID 的获取方式如下：在扣子编程左下角单击头像，在

账号设置

>

发布渠道

>

企业自定义渠道管理

页面查看渠道 ID。

​

meta_data

​

JSON Map

​

可选

​

{ "uuid": "newid1234" }

​

附加信息，通常用于封装一些业务相关的字段。

查看会话信息

时，扣子编程会透传此附加信息，

查看消息列表

时不会返回该附加信息。

​

自定义键值对，应指定为 Map 对象格式。长度为 16 对键值对，其中键（key）的长度范围为 1～64 个字符，值（value）的长度范围为 1～512 个字符。

​

​

EnterMessage

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

role

​

String

​

必选

​

user

​

发送这条消息的实体。取值：

​

user

：代表该条消息内容是用户发送的。

​

assistant

：代表该条消息内容是 Bot 发送的。

​

type

​

String

​

可选

​

question

​

消息类型。默认为

question。

​

question

：用户输入内容。

​

answer

：Bot 返回给用户的消息内容，支持增量返回。如果工作流绑定了输出节点，可能会存在多 answer 场景，此时可以用流式返回的结束标志来判断所有 answer 完成。

​

function_call

：Bot 对话过程中调用函数（function call）的中间结果。

​

tool_response

：调用工具 （function call）后返回的结果。

​

follow_up

：如果在 Bot 上配置打开了用户问题建议开关，则会返回推荐问题相关的回复内容。不支持在请求中作为入参。

​

verbose

：多 answer 场景下，服务端会返回一个 verbose 包，对应的 content 为 JSON 格式，

content.msg_type =generate_answer_finish

代表全部 answer 回复完成。不支持在请求中作为入参。

​

说明

仅发起会话（v3）接口支持将此参数作为入参，且：

​

如果 autoSaveHistory=true，type 支持设置为 question 或 answer。

​

如果 autoSaveHistory=false，type 支持设置为 question、answer、function_call、tool_output/tool_response。

​

其中，type=question 只能和 role=user 对应，即仅用户角色可以且只能发起 question 类型的消息。详细说明可参考

消息 type 说明

。

​

​

content

​

String

​

可选

​

[{"type":"text","text":"你好，这是我的图片"},{"type":"image","file_id":"145657573***"}]

​

消息的内容，支持纯文本、多模态（文本、图片、文件混合输入）、卡片等多种类型的内容。

​

content_type 为 object_string 时，content 为

object_string object

数组序列化之后的 JSON String，详细说明可参考

object_string object。

​

当 content_type

=

text 时，content 为普通文本，例如

"content" :"Hello!"

。

​

meta_data

​

JSON Map

​

可选

​

{ "uuid": "newid1234" }

​

创建消息时的附加消息，获取消息时也会返回此附加消息。

​

自定义键值对，应指定为 Map 对象格式。长度为 16 对键值对，其中键（key）的长度范围为 1～64 个字符，值（value）的长度范围为 1～512 个字符。

​

说明

content 不为空时，此参数为必选。

​

​

content_type

​

String

​

可选

​

text

​

消息内容的类型，支持设置为：

​

text：文本。

​

object_string：多模态内容，即文本和文件的组合、文本和图片的组合。

​

card：卡片。此枚举值仅在接口响应中出现，不支持作为入参。

​

说明

content 不为空时，此参数为必选。

​

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Object of

ConversationData

​

\

​

会话的基础信息，包含会话的唯一标识、名称、创建时间等详细信息。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

​

ConversationData

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

737999610479815****

​

Conversation ID，即会话的唯一标识。

​

name

​

String

​

推荐杭州美食

​

会话的名称，用于标识和区分不同的会话。

​

meta_data

​

JSON Map

​

{ "uuid": "newid1234" }

​

附加信息，通常用于封装一些业务相关的字段。

查看会话信息

时，扣子编程会透传此附加信息，

查看消息列表

时不会返回该附加信息。

​

自定义键值对，应指定为 Map 对象格式。长度为 16 对键值对，其中键（key）的长度范围为 1～64 个字符，值（value）的长度范围为 1～512 个字符。

​

creator_id

​

String

​

247877439325****

​

会话创建者的扣子 UID，用于标识创建该会话的用户。

​

created_at

​

Long

​

1718289297

​

会话创建的时间。格式为 10 位的 Unixtime 时间戳，单位为秒。

​

updated_at

​

Long

​

1718289297

​

会话的最后更新时间，格式为 10 位的 Unix 时间戳，单位为秒。

​

last_section_id

​

String

​

749566434761695***

​

会话中最新的一个上下文片段 ID。

​

connector_id

​

String

​

1024

​

该会话在哪个渠道创建。目前支持如下渠道：

​

API：1024

​

ChatSDK：999

​

自定义渠道：自定义渠道 ID。自定义渠道 ID 的获取方式如下：在扣子编程左下角单击头像，在

账号设置

>

发布渠道

>

企业自定义渠道管理

页面查看渠道 ID。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

创建空会话

创建会话和消息

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/conversation/create'\

​

--header 'Authorization

:

Bearer pat_xitq9LWlowpX3qGCih1lwpAdzvXNqgmpfhpV28HLWFypY37xR5Uaj2GioN****' \

​

--header 'Content-Type

:

application/json' \

​

​

​

返回示例

​

​

JSON

复制

{

​

"data"

:

{

​

"id"

:

"737999610479815****"

,

​

"name"

:

"推荐杭州美食"

,

​

"meta_data"

:

{

​

"uuid"

:

"newid1234"

​

},

​

"created_at"

:

1718289297

,

​

"creator_id"

:

"247877439325****"

,

​

"connector_id"

:

"1024"

,

​

"updated_at"

:

1718289297

,

​

"last_section_id"

:

"7495664347616952360"

​

},

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

},

​

"code"

:

0

,

​

"msg"

:

""

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

移除组织成员

下一篇

查看会话信息
============================================================
# 查看会话信息
来源: https://www.coze.cn/open/docs/developer_guides/retrieve_conversation
============================================================

查看会话信息

通过会话 ID 查看会话信息。

​

接口限制

​

仅支持查询本人创建的会话。

​

基础信息

​

​

请求方式

​

GET

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/conversation/retrieve

​

权限

​

retrieveConversation

​

确保调用该接口使用的访问令牌开通了

retrieveConversation

权限，详细信息参考

鉴权方式

。

​

接口说明

​

通过会话 ID 查看会话信息。

​

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

conversation_id

​

Integer

​

必选

​

737989918257****

​

Conversation ID，用于查询指定会话的详细信息。你可以在

发起对话

接口的 Response 中通过

conversation_id

字段获取会话 ID。

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Object of

ConversationData

​

\

​

会话的详细信息。

​

detail

​

Object of

ResponseDetail

​

20241210152726467C48D89D6DB2****

​

响应的详细信息。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

​

ConversationData

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

737999610479815****

​

Conversation ID，即会话的唯一标识。

​

name

​

String

​

推荐杭州美食

​

会话的名称，用于标识和区分不同的会话。

​

meta_data

​

JSON Map

​

{ "uuid": "newid1234" }

​

附加信息，通常用于封装一些业务相关的字段。

查看会话信息

时，扣子编程会透传此附加信息，

查看消息列表

时不会返回该附加信息。

​

自定义键值对，应指定为 Map 对象格式。长度为 16 对键值对，其中键（key）的长度范围为 1～64 个字符，值（value）的长度范围为 1～512 个字符。

​

creator_id

​

String

​

247877439325****

​

会话创建者的扣子 UID，用于标识创建该会话的用户。

​

created_at

​

Long

​

1718289297

​

会话创建的时间。格式为 10 位的 Unixtime 时间戳，单位为秒。

​

updated_at

​

Long

​

1718289297

​

会话的最后更新时间，格式为 10 位的 Unix 时间戳，单位为秒。

​

last_section_id

​

String

​

749566434761695***

​

会话中最新的一个上下文片段 ID。

​

connector_id

​

String

​

1024

​

该会话在哪个渠道创建。目前支持如下渠道：

​

API：1024

​

ChatSDK：999

​

自定义渠道：自定义渠道 ID。自定义渠道 ID 的获取方式如下：在扣子编程左下角单击头像，在

账号设置

>

发布渠道

>

企业自定义渠道管理

页面查看渠道 ID。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v1/conversation/retrieve?conversation_id=737989918257****' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json' \

​

​

返回示例

​

​

JSON

复制

{

​

"data"

:

{

​

"id"

:

"737999610479815****"

,

​

"name"

:

"推荐杭州美食"

,

​

"meta_data"

:

{

​

"uuid"

:

"newid1234"

​

},

​

"created_at"

:

1718289297

,

​

"creator_id"

:

"247877439325****"

,

​

"connector_id"

:

"1024"

,

​

"updated_at"

:

1718289297

,

​

"last_section_id"

:

"7495664347616952360"

​

},

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

},

​

"code"

:

0

,

​

"msg"

:

""

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

创建会话

下一篇

查看会话列表
============================================================
# 查看会话列表
来源: https://www.coze.cn/open/docs/developer_guides/list_conversations
============================================================

查看会话列表

查看指定智能体的会话列表。

​

说明

调用此 API 之前，应确认当前使用的访问密钥拥有智能体所在工作空间的权限。

​

仅支持通过此 API 查看智能体在 API 或 Chat SDK 渠道产生的会话。

​

仅支持查询本人创建的会话。

​

​

基础信息

​

​

请求方式

​

GET

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/conversations

​

权限

​

listConversation

​

确保调用该接口使用的访问令牌开通了

listConversation

权限，详细信息参考

鉴权方式

。

​

接口说明

​

获取指定智能体的会话列表。

​

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

bot_id

​

String

​

必选

​

73428668*****

​

智能体 ID，获取方法如下：

​

进入智能体的 开发页面，开发页面 URL 中

bot

参数后的数字就是智能体 ID。例如

https://www.coze.cn/space/341****/bot/73428668*****

，智能体 ID 为

73428668*****

。

​

page_num

​

Integer

​

可选

​

1

​

分页查询时的页码。默认为 1，即返回第一页数据。

​

page_size

​

Integer

​

可选

​

40

​

每一页的数据条目个数，默认为 50，最大为 50。

​

sort_order

​

String

​

可选

​

ASC

​

会话列表的排序方式：

​

ASC

：按创建时间升序排序，最早创建的会话排序最前。

​

DESC

：（默认）按创建时间降序排序，最近创建的会话排序最前。

​

connector_id

​

String

​

可选

​

999

​

发布渠道 ID，用于筛选指定渠道的会话。仅支持查看以下渠道的会话：

​

（默认）API 渠道，渠道 ID 为 1024。

​

Chat SDK 渠道，渠道 ID 为 999。

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

ListConversationData

​

[{"id":"737999610479815****","name":"推荐杭州美食","meta_data":{"uuid":"newid1234"},"creator_id":"247877439325****","created_at":1718289297,"updated_at":1718289297,"last_section_id":"7495664347616952360","connector_id":"1024"}]

​

会话列表的详细。

​

detail

​

Object of

ResponseDetail

​

{ "logid": "202412345678901234567890" }

​

响应的详细信息。

​

​

ListConversationData

​

​

参数

​

类型

​

示例

​

说明

​

has_more

​

Boolean

​

false

​

是否还有更多会话未在本次请求中返回。

​

true：还有更多未返回的会话。

​

false：已返回符合筛选条件的全部会话。

​

conversations

​

Array of

ConversationData

​

{"id":"737999610479815****","name":"推荐杭州美食","meta_data":{"uuid":"newid1234"},"creator_id":"247877439325****","created_at":1718289297,"updated_at":1718289297,"last_section_id":"7495664347616952360","connector_id":"1024"}

​

会话的详细信息。

​

​

ConversationData

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

737999610479815****

​

Conversation ID，即会话的唯一标识。

​

name

​

String

​

推荐杭州美食

​

会话的名称，用于标识和区分不同的会话。

​

meta_data

​

JSON Map

​

{ "uuid": "newid1234" }

​

附加信息，通常用于封装一些业务相关的字段。

查看会话信息

时，扣子编程会透传此附加信息，

查看消息列表

时不会返回该附加信息。

​

自定义键值对，应指定为 Map 对象格式。长度为 16 对键值对，其中键（key）的长度范围为 1～64 个字符，值（value）的长度范围为 1～512 个字符。

​

created_at

​

Long

​

1718289297

​

会话创建的时间。格式为 10 位的 Unixtime 时间戳，单位为秒。

​

updated_at

​

Long

​

1718289297

​

会话的最后更新时间，格式为 10 位的 Unix 时间戳，单位为秒。

​

last_section_id

​

String

​

749566434761695***

​

会话中最新的一个上下文片段 ID。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v1/conversations?bot_id=73428668*****&page_num=1&page_size=40&sort_order=ASC&connector_id=999' \

​

--header 'Authorization

:

Bearer pat_xitq9LWlowpX3qGCih1lwpAdzvXNqgmpfhpV28HLWFN****' \

​

--header 'Content-Type

:

application/json'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"data"

:

{

​

"has_more"

:

false

,

​

"conversations"

:

[

​

{

​

"id"

:

"737999610479815****"

,

​

"name"

:

"推荐杭州美食"

,

​

"meta_data"

:

{

​

"uuid"

:

"newid1234"

​

},

​

"creator_id"

:

"247877439325****"

,

​

"connector_id"

:

"1024"

,

​

"created_at"

:

1718289297

,

​

"updated_at"

:

1718289297

,

​

"last_section_id"

:

"7495664347616952360"

​

}

​

]

​

},

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

查看会话信息

下一篇

更新会话名称
============================================================
# 更新会话名称
来源: https://www.coze.cn/open/docs/developer_guides/edit_conversation
============================================================

更新会话名称

会话创建者可以更新指定会话的会话名，以便更好地识别和管理会话。

​

在创建会话时，扣子编程会默认将用户发送的第一个消息内容作为会话名称。用户也可以根据会话的实际内容或主题对会话名称进行更新，从而更直观地区分不同的会话，提升管理效率。

​

基础信息

​

​

请求方式

​

PUT

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/conversations/:conversation_id

​

​

权限

​

editConversation

​

确保调用该接口使用的访问令牌开通了

editConversation

权限，详细信息参考

准备工作

。

​

接口说明

​

更新指定会话的会话名称。

​

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

conversation_id

​

String

​

必选

​

737989918257****

​

待更新的会话 ID。你可以在

发起对话

接口的 Response 中通过

conversation_id

字段获取会话 ID。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

name

​

String

​

必选

​

推荐杭州美食

​

更新后的会话名称，最多支持 100 个字符。

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Object of

ConversationData

​

{ "creator_id": "14264794847***", "connector_id": "1024", "created_at": 1749439208, "id": "7513776737285***", "meta_data": {}, "updated_at": 1753326053, "last_section_id": "7513776737285570569", "name": "推荐杭州美食" }

​

包含会话详细信息的对象。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

ConversationData

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

737999610479815****

​

Conversation ID，即会话的唯一标识。

​

name

​

String

​

推荐杭州美食

​

会话的名称，用于标识和区分不同的会话。

​

meta_data

​

JSON Map

​

{ "uuid": "newid1234" }

​

附加信息，通常用于封装一些业务相关的字段。

查看会话信息

时，扣子编程会透传此附加信息，

查看消息列表

时不会返回该附加信息。

​

自定义键值对，应指定为 Map 对象格式。长度为 16 对键值对，其中键（key）的长度范围为 1～64 个字符，值（value）的长度范围为 1～512 个字符。

​

creator_id

​

String

​

247877439325****

​

会话创建者的扣子 UID，用于标识创建该会话的用户。

​

created_at

​

Long

​

1718289297

​

会话创建的时间。格式为 10 位的 Unixtime 时间戳，单位为秒。

​

updated_at

​

Long

​

1718289297

​

会话的最后更新时间，格式为 10 位的 Unix 时间戳，单位为秒。

​

last_section_id

​

String

​

749566434761695***

​

会话中最新的一个上下文片段 ID。

​

connector_id

​

String

​

1024

​

该会话在哪个渠道创建。目前支持如下渠道：

​

API：1024

​

ChatSDK：999

​

自定义渠道：自定义渠道 ID。自定义渠道 ID 的获取方式如下：在扣子编程左下角单击头像，在

账号设置

>

发布渠道

>

企业自定义渠道管理

页面查看渠道 ID。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request PUT 'https

:

//api.coze.cn/v1/conversations/737999610479815****' \

​

--header 'Authorization

:

Bearer pat_xitq9LWlowpX3qGCih1lwpAdzvXNqgmpfhpV28HLWFypY37xR5Uaj2GioN****' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"name"

:

"推荐杭州美食"

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"202507311334280ADC900DF8FCF***"

​

},

​

"data"

:

{

​

"creator_id"

:

"14264794847***"

,

​

"connector_id"

:

"1024"

,

​

"created_at"

:

1749439208

,

​

"id"

:

"7513776737285***"

,

​

"meta_data"

:

{},

​

"updated_at"

:

1753326053

,

​

"last_section_id"

:

"751377673728557***"

,

​

"name"

:

"推荐杭州美食"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

查看会话列表

下一篇

删除会话
============================================================
# 删除会话
来源: https://www.coze.cn/open/docs/developer_guides/delete_conversation
============================================================

删除会话

删除指定的会话。

​

仅会话创建者可以删除会话。

​

基础信息

​

​

请求方式

​

DELETE

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/conversations/:conversation_id

​

​

权限

​

editConversation

​

确保调用该接口使用的访问令牌开通了

editConversation

权限，详细信息参考

准备工作

。

​

接口说明

​

删除指定的会话。

​

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $AccessToken

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

conversation_id

​

String

​

必选

​

737989918257****

​

待删除的会话 ID。你可以在

发起对话

接口的 Response 中通过 conversation_id 字段获取会话 ID。

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request DELETE 'https

:

//api.coze.cn/v1/conversations/737999610479815****' \

​

--header 'Authorization

:

Bearer pat_xitq9LWlowpX3qGCih1lwpAdzvXNqgmpfhpV28HLWFypY37xR5Uaj2GioN****' \

​

--header 'Content-Type

:

application/json' \

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

更新会话名称

下一篇

清除上下文
============================================================
# 清除上下文
来源: https://www.coze.cn/open/docs/developer_guides/clear_conversation_context
============================================================

清除上下文

清除指定会话中的上下文。

​

接口说明

​

在智能体对话场景中，上下文指模型在处理当前输入时所能参考的历史消息、对话记录，它决定了模型对当前任务的理解深度和连贯性，直接影响输出结果的准确性和相关性。多轮对话中，如果需要开启新的话题，可以调用此 API 清除上下文。清除上下文后，对话中的历史消息不会作为上下文被输入给模型，后续对话不再受之前历史消息的影响，避免信息干扰，确保对话的准确性和连贯性。

​

会话中的消息存储在上下文段落（section）中，每次调用此 API 清除上下文时，系统会自动删除旧的上下文段落，并创建新的上下文段落用于存储新的消息。再次发起对话时，新分区中的消息会作为新的上下文传递给模型参考。

​

说明

清除上下文 API 只是清空模型可见的消息历史，不会实际删除会话中的消息，通过

查看消息列表

或

查看消息详情

等 API 仍能查看到消息内容。

​

仅支持清除本人创建的会话的上下文。

​

会话、对话、消息和上下文段落的术语解释请参见

基础概念

。

​

​

​

​

​

​

​

基础信息

​

​

请求方式

​

POST

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/conversations/:conversation_id/clear

​

权限

​

editConversation

​

确保调用该接口使用的访问令牌开通了

editConversation

权限，详细信息参考

准备工作

。

​

接口说明

​

清除指定会话中的上下文。

​

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

conversation_id

​

String

​

必选

​

737989918257****

​

待清除上下文的会话 ID。你可以在

发起对话

接口的 Response 中通过 conversation_id 字段获取会话 ID。

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过

msg

字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

Section

​

{ "id": "75331946251175***", "conversation_id": "737989918257****" }

​

上下文段落（section）的详细信息。

​

Section 是一个独立的上下文段落，用于分隔不同的对话阶段或主题。Section 中包括上下文消息，当用户清除上下文时，系统会创建一个新的 Section，从而确保新的对话不受历史消息的影响。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

返回的详情信息，包含本次请求的日志 ID。如果遇到异常报错场景，可以根据此日志 ID 联系技术支持获取帮助。

​

​

Section

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

75331946251175***

​

新的 Session ID，即清除上下文后新创建的上下文段落（section）的 ID。

​

每个上下文段落对应一批独立的上下文消息。每次清除上下文时，系统会新建一个上下文段落用于存储新的上下文消息。

​

conversation_id

​

String

​

737999610479815****

​

Conversation ID，即会话的唯一标识。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/conversations/737989918257****/clear' \

​

--header 'Authorization

:

Bearer pat_xitq9LWlowpX3qGCih1lwpAdzvXNqgmpfhpV28HLWFypY37xR5Uaj2GioN****' \

​

--header 'Content-Type

:

application/json' \

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"data"

:

{

​

"id"

:

"75331946251175***"

,

​

"conversation_id"

:

"737989918257****"

​

},

​

"detail"

:

{

​

"logid"

:

"202411123456789****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

删除会话

下一篇

创建消息
============================================================
# 创建消息
来源: https://www.coze.cn/open/docs/developer_guides/create_message
============================================================

创建消息

创建一条消息，并将其添加到指定的会话中。

​

会话、对话和消息的概念说明，可参考

基础概念

。

​

说明

消息在服务端的保存时长为 180 天，到期后自动删除。你也可以调用

删除消息

接口，手动从会话中删除消息。

​

你可以通过

查看消息列表

查询指定会话（conversation）中的所有消息。

​

​

基础信息

​

​

请求方式

​

POST

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/conversation/message/create

​

权限

​

createMessage

​

确保调用该接口使用的访问令牌开通了

createMessage

权限，详细信息参考

鉴权方式

。

​

接口说明

​

创建一条消息，并将其添加到指定的会话中。

​

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $AccessToken

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考准备工作。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

conversation_id

​

Integer

​

必选

​

737363834493434****

​

Conversation ID，即会话的唯一标识。你可以在

发起对话

接口 Response 中查看 conversation_id 字段。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

role

​

String

​

必选

​

user

​

发送这条消息的实体。取值：

​

user

：代表该条消息内容是用户发送的。

​

assistant

：代表该条消息内容是 Bot 发送的。

​

content

​

String

​

必选

​

早上好，今天星期几

​

消息的内容，支持纯文本、多模态（文本、图片、文件混合输入）、卡片等多种类型的内容。

​

content_type

​

String

​

必选

​

text

​

消息内容的类型，支持设置为：

​

text：文本

​

object_string：多模态内容，即文本和文件的组合、文本和图片的组合

​

meta_data

​

JSON Map

​

可选

​

{"customKey1":"customValue1","customKey2":"customValue2"}

​

创建消息时的附加信息，用于封装业务相关的自定义键值对。获取消息时也会返回此附加信息。支持最多 16 对键值对，其中键（key）的长度范围为 1～64 个字符，值（value）的长度范围为 1～512 个字符。

​

​

​

返回参数

​

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Object of

OpenMessageApi

​

{ "role": "user", "content": "[{\"type\":\"text\",\"text\":\"帮我看看这个图片里有什么内容？\"},{\"type\":\"image\",\"file_id\":\"7380331280292495370\"}]" "content_type": "object_string" }

​

消息的详情。

​

detail

​

Object of

ResponseDetail

​

{ "logid": "20250106172024B5F607030EFFAD653960" }

​

响应详情。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

​

OpenMessageApi

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

738130009748252****

​

Message ID，即消息的唯一标识。

​

conversation_id

​

String

​

737999610479815****

​

此消息所在的会话 ID。

​

bot_id

​

String

​

747363834493437****

​

编写此消息的智能体 ID。此参数仅在对话产生的消息中返回。

​

chat_id

​

String

​

757363834493437****

​

Chat ID。此参数仅在对话产生的消息中返回。

​

不同的对话中，系统会生成新的

chat_id

。同一个用户在第一次对话和第二次对话时，

chat_id

不一样。

​

meta_data

​

JSON Map

​

{"source":"mobile_app","location":"Beijing","custom_flag":"high_priority"}

​

创建消息时的附加信息，以键值对形式存储，获取消息时会原样返回。可用于存储与业务相关的自定义数据。

​

role

​

String

​

user

​

发送这条消息的实体。取值：

​

user

：代表该条消息内容是用户发送的。

​

assistant

：代表该条消息内容是 Bot 发送的。

​

content

​

String

​

早上好，今天星期几？

​

消息的内容，支持纯文本、多模态（文本、图片、文件混合输入）、卡片等多种类型的内容。

​

content_type

​

String

​

text

​

消息内容的类型，取值包括：

​

text：文本。

​

object_string：多模态内容，即文本和文件的组合、文本和图片的组合。

​

card：卡片。此枚举值仅在接口响应中出现，不支持作为入参。

​

created_at

​

Long

​

1718592898

​

消息的创建时间，格式为 10 位的 Unixtime 时间戳，单位为秒（s）。

​

updated_at

​

Long

​

1718592898

​

消息的更新时间，格式为 10 位的 Unixtime 时间戳，单位为秒（s）。

​

type

​

String

​

question

​

消息类型。

​

question

：用户输入内容。

​

answer

：智能体返回给用户的消息内容，支持增量返回。如果工作流绑定了 messge 节点，可能会存在多 answer 场景，此时可以用流式返回的结束标志来判断所有 answer 完成。

​

function_call

：智能体对话过程中调用函数（function call）的中间结果。

​

tool_response

：调用工具 （function call）后返回的结果。

​

follow_up

：如果在 Bot 上配置打开了用户问题建议开关，则会返回推荐问题相关的回复内容。

​

verbose

：多 answer 场景下，服务端会返回一个 verbose 包，对应的 content 为 JSON 格式，

content.msg_type =generate_answer_finish

代表全部 answer 回复完成。

​

Tip

仅发起对话（v3）接口支持将此参数作为入参，且：

​

如果 autoSaveHistory=true，type 支持设置为 question 或 answer。

​

如果 autoSaveHistory=false，type 支持设置为 question、answer、function_call、tool_output、tool_response。

​

其中，type=question 只能和 role=user 对应，即仅用户角色可以且只能发起 question 类型的消息。详细说明可参考

消息 type 说明

。

​

​

section_id

​

String

​

757363834493437****

​

上下文片段 ID。每次清除上下文都会生成一个新的 section_id。

​

reasoning_content

​

String

​

好的，我现在需要给一个13岁的大学生提供学习建议。首先，我得考虑用户的情况……

​

模型的思维链（CoT），展示模型如何将复杂问题逐步分解为多个简单步骤并推导出最终答案。仅当模型支持深度思考、且智能体开启了深度思考时返回该字段，当前支持深度思考的模型请参考

模型能力差异

。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

​

​

示例

​

请求示例

​

创建文本消息

创建图文消息，图片为在线 URL

创建图文消息，图片为已上传的图片文件

创建文本和文件消息，文件为在线 URL

创建文本和文件消息，文件为已上传的文件

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/conversation/message/create?conversation_id=737363834493434****' \

​

--header 'Authorization

:

Bearer pat_qad2rHYNqKnCmRYZW4PhVRibaS***' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"role"

:

"user"

,

​

"content"

:

"早上好，今天星期几？"

​

"content_type"

:

"text"

​

}

'

​

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"data"

:

{

​

"bot_id"

:

""

,

​

"chat_id"

:

""

,

​

"content"

:

"早上好，今天星期几？"

,

​

"content_type"

:

"text"

,

​

"conversation_id"

:

"737999610479815****"

,

​

"created_at"

:

1718592898

,

​

"id"

:

"738130009748252****"

,

​

"meta_data"

:

{},

​

"role"

:

"user"

,

​

"type"

:

""

,

​

"updated_at"

:

"1718592898"

​

},

​

"msg"

:

""

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

清除上下文

下一篇

查看消息列表
============================================================
# 查看消息列表
来源: https://www.coze.cn/open/docs/developer_guides/list_message
============================================================

查看消息列表

查看指定会话的消息列表。

​

查看消息列表

API 与

查看对话消息详情

API 的区别在于：

​

查看消息列表

API 用于查询指定会话（conversation）中的消息记录，不仅包括开发者在会话中手动插入的每一条消息和用户发送的 Query，也包括调用

发起对话

API 得到的 type=answer 的智能体回复，但不包括 type=function_call、tool_response 和 follow-up 类型的对话中间态消息。

​

查看对话消息详情

API 通常用于非流式对话场景中，查看某次对话（chat）中 type=answer 的智能体回复及 type=function_call、tool_response 和 follow-up 类型的对话中间态消息。不包括用户发送的 Query。

​

说明

消息在服务端的保存时长为180天，期满后，消息将自动从会话的消息记录中删除。

​

​

基础信息

​

​

请求方式

​

POST

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/conversation/message/list

​

权限

​

chat

、

listMessage

​

确保调用该接口使用的访问令牌开通了

chat

和

listMessage

权限，详细信息参考

鉴权方式

。

​

接口说明

​

调用接口查看指定会话的消息列表。

​

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $AccessToken

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

conversation_id

​

Integer

​

必选

​

737363834493434****

​

Conversation ID，即会话的唯一标识。可以在

发起对话

接口 Response 中查看 conversation_id 字段。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

order

​

String

​

可选

​

desc

​

消息列表的排序方式。

​

desc：（默认）按创建时间降序排序，最新的消息排序最前。

​

asc：按创建时间升序排序，最早的消息排序最前。

​

chat_id

​

String

​

可选

​

737999610479815****

​

筛选指定 Chat ID 中的消息列表。

发起对话

接口 Response 中 Chat 事件的

data.id

字段即为 Chat ID。

​

before_id

​

String

​

可选

​

737363834493437****

​

查看指定位置之前的消息。

​

默认为 0，表示不指定位置。如需向前翻页，则指定为返回结果中的 first_id。

​

after_id

​

String

​

可选

​

737363834493437****

​

查看指定位置之后的消息。

​

默认为 0，表示不指定位置。如需向后翻页，则指定为返回结果中的 last_id。

​

limit

​

Long

​

可选

​

30

​

每次查询返回的数据量。默认为 50，取值范围为 1~50。

​

include_middle_message

​

Boolean

​

可选

​

​

是否包含中间消息

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Array of

OpenMessageApi

​

[ { "bot_id": "", "chat_id": "", "content": "你的名字叫什么", "content_type": "text", "conversation_id": "737363834493434****", "created_at": 1716809829, "id": "737363834493437****", "meta_data": {}, "role": "user", "type": "", "updated_at": "1716809829" }]

​

消息详情。

​

has_more

​

Boolean

​

true

​

是否已返回全部消息。

​

true：未返回全部消息，可再次调用此接口查看其他分页。

​

false：已返回全部消息。

​

first_id

​

String

​

737363834493437****

​

返回的消息列表中，第一条消息的 Message ID。

​

last_id

​

String

​

737363834493440****

​

返回的消息列表中，最后一条消息的 Message ID。

​

detail

​

Object of

ResponseDetail

​

{ "logid": "20250106172024B5F607030EFFAD653960" }

​

响应详情信息。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

​

OpenMessageApi

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

738130009748252****

​

Message ID，即消息的唯一标识。

​

conversation_id

​

String

​

737999610479815****

​

此消息所在的会话 ID。

​

bot_id

​

String

​

747363834493437****

​

编写此消息的智能体 ID。此参数仅在对话产生的消息中返回。

​

chat_id

​

String

​

757363834493437****

​

Chat ID。此参数仅在对话产生的消息中返回。

​

不同的对话中，系统会生成新的

chat_id

。同一个用户在第一次对话和第二次对话时，

chat_id

不一样。

​

meta_data

​

JSON Map

​

{"source":"mobile_app","location":"Beijing","custom_flag":"high_priority"}

​

创建消息时的附加信息，以键值对形式存储，获取消息时会原样返回。可用于存储与业务相关的自定义数据。

​

role

​

String

​

user

​

发送这条消息的实体。取值：

​

user

：代表该条消息内容是用户发送的。

​

assistant

：代表该条消息内容是 Bot 发送的。

​

content

​

String

​

早上好，今天星期几？

​

消息的内容，支持纯文本、多模态（文本、图片、文件混合输入）、卡片等多种类型的内容。

​

content_type

​

String

​

text

​

消息内容的类型，取值包括：

​

text：文本。

​

object_string：多模态内容，即文本和文件的组合、文本和图片的组合。

​

card：卡片。此枚举值仅在接口响应中出现，不支持作为入参。

​

created_at

​

Long

​

1718592898

​

消息的创建时间，格式为 10 位的 Unixtime 时间戳，单位为秒（s）。

​

updated_at

​

Long

​

1718592898

​

消息的更新时间，格式为 10 位的 Unixtime 时间戳，单位为秒（s）。

​

type

​

String

​

question

​

消息类型。

​

question

：用户输入内容。

​

answer

：智能体返回给用户的消息内容，支持增量返回。如果工作流绑定了 messge 节点，可能会存在多 answer 场景，此时可以用流式返回的结束标志来判断所有 answer 完成。

​

function_call

：智能体对话过程中调用函数（function call）的中间结果。

​

tool_response

：调用工具 （function call）后返回的结果。

​

follow_up

：如果在 Bot 上配置打开了用户问题建议开关，则会返回推荐问题相关的回复内容。

​

verbose

：多 answer 场景下，服务端会返回一个 verbose 包，对应的 content 为 JSON 格式，

content.msg_type =generate_answer_finish

代表全部 answer 回复完成。

​

Tip

仅发起对话（v3）接口支持将此参数作为入参，且：

​

如果 autoSaveHistory=true，type 支持设置为 question 或 answer。

​

如果 autoSaveHistory=false，type 支持设置为 question、answer、function_call、tool_output、tool_response。

​

其中，type=question 只能和 role=user 对应，即仅用户角色可以且只能发起 question 类型的消息。详细说明可参考

消息 type 说明

。

​

​

section_id

​

String

​

757363834493437****

​

上下文片段 ID。每次清除上下文都会生成一个新的 section_id。

​

reasoning_content

​

String

​

好的，我现在需要给一个13岁的大学生提供学习建议。首先，我得考虑用户的情况……

​

模型的思维链（CoT），展示模型如何将复杂问题逐步分解为多个简单步骤并推导出最终答案。仅当模型支持深度思考、且智能体开启了深度思考时返回该字段，当前支持深度思考的模型请参考

模型能力差异

。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/conversation/message/list?conversation_id=737363834493434****' \

​

--header 'Authorization

:

Bearer pat_xitq9LWlowpX3qGCih1lwpAdzvXNqgmpfhpV28HLWFypY37xR5Uaj2GioN****' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"order"

:

"desc"

,

​

"chat_id"

:

"737999610479815****"

,

​

"before_id"

:

"737363834493437****"

,

​

"after_id"

:

"737363834493437****"

,

​

"limit"

:

30

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"data"

:

[

​

{

​

"bot_id"

:

"737363834493434****"

,

​

"chat_id"

:

"747363834493434****"

,

​

"content"

:

"你的名字叫什么"

,

​

"content_type"

:

"text"

,

​

"conversation_id"

:

"737363834493434****"

,

​

"created_at"

:

1716809829

,

​

"id"

:

"737363834493437****"

,

​

"meta_data"

:

{},

​

"role"

:

"user"

,

​

"type"

:

""

,

​

"updated_at"

:

"1716809829"

​

},

​

{

​

"bot_id"

:

"737363834493434****"

,

​

"chat_id"

:

"747363834493434****"

,

​

"content"

:

"我的名字叫bot"

,

​

"content_type"

:

"text"

,

​

"conversation_id"

:

"737363834493434****"

,

​

"created_at"

:

"1716809829"

,

​

"id"

:

"737363834493440****"

,

​

"meta_data"

:

{},

​

"role"

:

"assistant"

,

​

"type"

:

""

,

​

"updated_at"

:

"1716936779"

​

}

​

],

​

"first_id"

:

"737363834493437****"

,

​

"has_more"

:

true

,

​

"last_id"

:

"737363834493440****"

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20250106172024B5F607030***"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

创建消息

下一篇

查看消息详情
============================================================
# 查看消息详情
来源: https://www.coze.cn/open/docs/developer_guides/retrieve_message
============================================================

查看消息详情

查看指定消息的详细信息。

​

基础信息

​

​

请求方式

​

GET

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/conversation/message/retrieve

​

​

权限

​

retrieveMessage

​

确保调用该接口使用的访问令牌开通了

retrieveMessage

权限，详细信息参考

鉴权方式

。

​

接口说明

​

查看指定消息的详细信息。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $AccessToken

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

conversation_id

​

Integer

​

必选

​

737549035601767****

​

Conversation ID，即会话的唯一标识。你可以在

发起对话

接口 Response 中查看 conversation_id 字段的值。

​

message_id

​

Integer

​

必选

​

737549035601806****

​

Message ID，即消息的唯一标识。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Object of

OpenMessageApi

​

{ "bot_id": "747999610479815****", "chat_id": "757999610479815****", "content": "早上好，今天星期几？", "content_type": "text", "conversation_id": "737999610479815****", "created_at": 1718595518, "id": "738131140595115****", "meta_data": {}, "role": "user", "type": "", "updated_at": "1718595518" }

​

消息详情。

​

detail

​

Object of

ResponseDetail

​

{ "logid": "20250106172024B5F607030EFFAD***" }

​

响应详情。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

​

OpenMessageApi

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

738130009748252****

​

Message ID，即消息的唯一标识。

​

conversation_id

​

String

​

737999610479815****

​

此消息所在的会话 ID。

​

bot_id

​

String

​

747363834493437****

​

编写此消息的智能体 ID。此参数仅在对话产生的消息中返回。

​

chat_id

​

String

​

757363834493437****

​

Chat ID。此参数仅在对话产生的消息中返回。

​

不同的对话中，系统会生成新的

chat_id

。同一个用户在第一次对话和第二次对话时，

chat_id

不一样。

​

meta_data

​

JSON Map

​

{"source":"mobile_app","location":"Beijing","custom_flag":"high_priority"}

​

创建消息时的附加信息，以键值对形式存储，获取消息时会原样返回。可用于存储与业务相关的自定义数据。

​

role

​

String

​

user

​

发送这条消息的实体。取值：

​

user

：代表该条消息内容是用户发送的。

​

assistant

：代表该条消息内容是 Bot 发送的。

​

content

​

String

​

早上好，今天星期几？

​

消息的内容，支持纯文本、多模态（文本、图片、文件混合输入）、卡片等多种类型的内容。

​

content_type

​

String

​

text

​

消息内容的类型，取值包括：

​

text：文本。

​

object_string：多模态内容，即文本和文件的组合、文本和图片的组合。

​

card：卡片。此枚举值仅在接口响应中出现，不支持作为入参。

​

created_at

​

Long

​

1718592898

​

消息的创建时间，格式为 10 位的 Unixtime 时间戳，单位为秒（s）。

​

updated_at

​

Long

​

1718592898

​

消息的更新时间，格式为 10 位的 Unixtime 时间戳，单位为秒（s）。

​

type

​

String

​

question

​

消息类型。

​

question

：用户输入内容。

​

answer

：智能体返回给用户的消息内容，支持增量返回。如果工作流绑定了 messge 节点，可能会存在多 answer 场景，此时可以用流式返回的结束标志来判断所有 answer 完成。

​

function_call

：智能体对话过程中调用函数（function call）的中间结果。

​

tool_response

：调用工具 （function call）后返回的结果。

​

follow_up

：如果在 Bot 上配置打开了用户问题建议开关，则会返回推荐问题相关的回复内容。

​

verbose

：多 answer 场景下，服务端会返回一个 verbose 包，对应的 content 为 JSON 格式，

content.msg_type =generate_answer_finish

代表全部 answer 回复完成。

​

Tip

仅发起对话（v3）接口支持将此参数作为入参，且：

​

如果 autoSaveHistory=true，type 支持设置为 question 或 answer。

​

如果 autoSaveHistory=false，type 支持设置为 question、answer、function_call、tool_output、tool_response。

​

其中，type=question 只能和 role=user 对应，即仅用户角色可以且只能发起 question 类型的消息。详细说明可参考

消息 type 说明

。

​

​

section_id

​

String

​

757363834493437****

​

上下文片段 ID。每次清除上下文都会生成一个新的 section_id。

​

reasoning_content

​

String

​

好的，我现在需要给一个13岁的大学生提供学习建议。首先，我得考虑用户的情况……

​

模型的思维链（CoT），展示模型如何将复杂问题逐步分解为多个简单步骤并推导出最终答案。仅当模型支持深度思考、且智能体开启了深度思考时返回该字段，当前支持深度思考的模型请参考

模型能力差异

。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v1/conversation/message/retrieve?conversation_id=737549035601767****&message_id=737549035601806****' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json'

​

​

返回示例

​

纯文本消息

多模态消息

​

JSON

复制

{

​

"code"

:

0

,

​

"data"

:

{

​

"bot_id"

:

"747999610479815****"

,

​

"chat_id"

:

"757999610479815****"

,

​

"content"

:

"早上好，今天星期几？"

,

​

"content_type"

:

"text"

,

​

"conversation_id"

:

"737999610479815****"

,

​

"created_at"

:

1718595518

,

​

"id"

:

"738131140595115****"

,

​

"meta_data"

:

{},

​

"role"

:

"user"

,

​

"type"

:

""

,

​

"updated_at"

:

"1718595518"

​

},

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20250106172024B5F607030EFFAD653960"

​

}

​

}

​

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

查看消息列表

下一篇

修改消息
============================================================
# 修改消息
来源: https://www.coze.cn/open/docs/developer_guides/modify_message
============================================================

修改消息

修改一条消息，支持修改消息内容、附加内容和消息类型。

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/conversation/message/modify

​

​

权限

​

modifyMessage

​

确保调用该接口使用的访问令牌开通了

modifyMessage

权限，详细信息参考

鉴权方式

。

​

接口说明

​

修改一条消息，支持修改消息内容、附加内容和消息类型。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

conversation_id

​

Integer

​

必选

​

737475200011611****

​

Conversation ID，即会话的唯一标识。可以在

发起对话

接口 Response 中查看 conversation_id 字段。

​

message_id

​

Integer

​

必选

​

737492830742885***

​

Message ID，即消息的唯一标识。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

content

​

String

​

可选

​

早上好，今天深圳天气怎么样？

​

消息的内容，支持纯文本、多模态（文本、图片、文件混合输入）、卡片等多种类型的内容。

​

Tip

meta_data 和 content 不能同时为空。

​

​

content_type

​

String

​

可选

​

text

​

消息内容的类型。取值包括：

​

text：文本

​

object_string：多模态内容，即文本和文件的组合、文本和图片的组合

​

Note

传入 content 时，应同时指定 content_type。

​

​

meta_data

​

JSON Map

​

可选

​

{}

​

创建消息时的附加消息，获取消息时也会返回此附加消息。

​

自定义键值对，应指定为 Map 对象格式。长度为 16 对键值对，其中键（key）的长度范围为 1～64 个字符，值（value）的长度范围为 1～512 个字符。

​

说明

meta_data 和 content 不能同时为空。

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

message

​

Object of

OpenMessageApi

​

{ "bot_id": "", "chat_id": "", "content": "早上好，今天深圳天气怎么样？", "content_type": "text", "conversation_id": "737999610479815****", "created_at": 1718595518, "id": "738131140595115****", "meta_data": {}, "role": "user", "type": "", "updated_at": "1718595677" }

​

修改后的消息详细信息。

​

detail

​

Object of

ResponseDetail

​

{ "logid": "20250106172024B5F607030EFFA***" }

​

响应详情。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

​

OpenMessageApi

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

738130009748252****

​

Message ID，即消息的唯一标识。

​

conversation_id

​

String

​

737999610479815****

​

此消息所在的会话 ID。

​

bot_id

​

String

​

747363834493437****

​

编写此消息的智能体 ID。此参数仅在对话产生的消息中返回。

​

chat_id

​

String

​

757363834493437****

​

Chat ID。此参数仅在对话产生的消息中返回。

​

不同的对话中，系统会生成新的

chat_id

。同一个用户在第一次对话和第二次对话时，

chat_id

不一样。

​

meta_data

​

JSON Map

​

{"source":"mobile_app","location":"Beijing","custom_flag":"high_priority"}

​

创建消息时的附加信息，以键值对形式存储，获取消息时会原样返回。可用于存储与业务相关的自定义数据。

​

role

​

String

​

user

​

发送这条消息的实体。取值：

​

user

：代表该条消息内容是用户发送的。

​

assistant

：代表该条消息内容是 Bot 发送的。

​

content

​

String

​

早上好，今天星期几？

​

消息的内容，支持纯文本、多模态（文本、图片、文件混合输入）、卡片等多种类型的内容。

​

content_type

​

String

​

text

​

消息内容的类型，取值包括：

​

text：文本。

​

object_string：多模态内容，即文本和文件的组合、文本和图片的组合。

​

card：卡片。此枚举值仅在接口响应中出现，不支持作为入参。

​

created_at

​

Long

​

1718592898

​

消息的创建时间，格式为 10 位的 Unixtime 时间戳，单位为秒（s）。

​

updated_at

​

Long

​

1718592898

​

消息的更新时间，格式为 10 位的 Unixtime 时间戳，单位为秒（s）。

​

type

​

String

​

question

​

消息类型。

​

question

：用户输入内容。

​

answer

：智能体返回给用户的消息内容，支持增量返回。如果工作流绑定了 messge 节点，可能会存在多 answer 场景，此时可以用流式返回的结束标志来判断所有 answer 完成。

​

function_call

：智能体对话过程中调用函数（function call）的中间结果。

​

tool_response

：调用工具 （function call）后返回的结果。

​

follow_up

：如果在 Bot 上配置打开了用户问题建议开关，则会返回推荐问题相关的回复内容。

​

verbose

：多 answer 场景下，服务端会返回一个 verbose 包，对应的 content 为 JSON 格式，

content.msg_type =generate_answer_finish

代表全部 answer 回复完成。

​

Tip

仅发起对话（v3）接口支持将此参数作为入参，且：

​

如果 autoSaveHistory=true，type 支持设置为 question 或 answer。

​

如果 autoSaveHistory=false，type 支持设置为 question、answer、function_call、tool_output、tool_response。

​

其中，type=question 只能和 role=user 对应，即仅用户角色可以且只能发起 question 类型的消息。详细说明可参考

消息 type 说明

。

​

​

section_id

​

String

​

757363834493437****

​

上下文片段 ID。每次清除上下文都会生成一个新的 section_id。

​

reasoning_content

​

String

​

好的，我现在需要给一个13岁的大学生提供学习建议。首先，我得考虑用户的情况……

​

模型的思维链（CoT），展示模型如何将复杂问题逐步分解为多个简单步骤并推导出最终答案。仅当模型支持深度思考、且智能体开启了深度思考时返回该字段，当前支持深度思考的模型请参考

模型能力差异

。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

POST https

:

//api.coze.cn/v1/conversation/message/modify?conversation_id=737475200011611****&message_id=737492830742885****

​

{

​

"content"

:

"早上好，今天深圳天气怎么样？"

,

​

"content_type"

:

"text"

​

}

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"message"

:

{

​

"bot_id"

:

""

,

​

"chat_id"

:

""

,

​

"content"

:

"早上好，今天深圳天气怎么样？"

,

​

"content_type"

:

"text"

,

​

"conversation_id"

:

"737999610479815****"

,

​

"created_at"

:

1718595518

,

​

"id"

:

"738131140595115****"

,

​

"meta_data"

:

{},

​

"role"

:

"user"

,

​

"type"

:

""

,

​

"updated_at"

:

"1718595677"

​

},

​

"msg"

:

""

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

查看消息详情

下一篇

删除消息
============================================================
# 删除消息
来源: https://www.coze.cn/open/docs/developer_guides/delete_message
============================================================

删除消息

调用接口在指定会话中删除消息。

​

说明

暂不支持批量操作，需要逐条删除。

​

删除指定 message id 对应的消息。如果消息 type=answer，会同步删除与之相关的 verbose、function_call 等中间态消息，但不支持仅删除某一条中间态消息。

​

删除消息后，无法通过

查看消息列表

或

查看对话消息详情

接口查看已删除的这些消息。

​

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/conversation/message/delete

​

​

权限

​

deleteMessage

​

确保调用该接口使用的访问令牌开通了

deleteMessage

权限，详细信息参考

鉴权方式

。

​

接口说明

​

调用接口在指定会话中删除消息。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

conversation_id

​

String

​

必选

​

74076802623535*****

​

待删除的消息所属的会话 ID。

​

message_id

​

String

​

必选

​

74076856761178****

​

待删除的消息 ID，你可以选择删除会话中的 question 消息和 answer 消息。

​

待删除消息必须属于 conversation_id 指定的会话。

​

仅支持删除 type=answer 或 question 的消息，不支持单独删除 function_call 等中间态消息。当删除 type=answer 的消息时，系统会同步删除与之关联的 function_call 等中间态消息。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Object of

OpenMessageApi

​

{ "bot_id": "73250261716436*****", "chat_id": "74076802623535*****", "content": "您好呀！今天感觉怎么样？", "content_type": "text", "conversation_id": "74076802623535*****", "created_at": 1724734970, "id": "74076802623536*****", "meta_data": {}, "role": "assistant", "type": "answer", "updated_at": 1724734971 }

​

已删除的 Message 详情。

​

detail

​

Object of

ResponseDetail

​

{ "logid": "20250106172024B5F60***" }

​

响应详情。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

​

OpenMessageApi

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

738130009748252****

​

Message ID，即消息的唯一标识。

​

conversation_id

​

String

​

737999610479815****

​

此消息所在的会话 ID。

​

bot_id

​

String

​

747363834493437****

​

编写此消息的智能体 ID。此参数仅在对话产生的消息中返回。

​

chat_id

​

String

​

757363834493437****

​

Chat ID。此参数仅在对话产生的消息中返回。

​

不同的对话中，系统会生成新的

chat_id

。同一个用户在第一次对话和第二次对话时，

chat_id

不一样。

​

meta_data

​

JSON Map

​

{"source":"mobile_app","location":"Beijing","custom_flag":"high_priority"}

​

创建消息时的附加信息，以键值对形式存储，获取消息时会原样返回。可用于存储与业务相关的自定义数据。

​

role

​

String

​

user

​

发送这条消息的实体。取值：

​

user

：代表该条消息内容是用户发送的。

​

assistant

：代表该条消息内容是 Bot 发送的。

​

content

​

String

​

早上好，今天星期几？

​

消息的内容，支持纯文本、多模态（文本、图片、文件混合输入）、卡片等多种类型的内容。

​

content_type

​

String

​

text

​

消息内容的类型，取值包括：

​

text：文本。

​

object_string：多模态内容，即文本和文件的组合、文本和图片的组合。

​

card：卡片。此枚举值仅在接口响应中出现，不支持作为入参。

​

created_at

​

Long

​

1718592898

​

消息的创建时间，格式为 10 位的 Unixtime 时间戳，单位为秒（s）。

​

updated_at

​

Long

​

1718592898

​

消息的更新时间，格式为 10 位的 Unixtime 时间戳，单位为秒（s）。

​

type

​

String

​

question

​

消息类型。

​

question

：用户输入内容。

​

answer

：智能体返回给用户的消息内容，支持增量返回。如果工作流绑定了 messge 节点，可能会存在多 answer 场景，此时可以用流式返回的结束标志来判断所有 answer 完成。

​

function_call

：智能体对话过程中调用函数（function call）的中间结果。

​

tool_response

：调用工具 （function call）后返回的结果。

​

follow_up

：如果在 Bot 上配置打开了用户问题建议开关，则会返回推荐问题相关的回复内容。

​

verbose

：多 answer 场景下，服务端会返回一个 verbose 包，对应的 content 为 JSON 格式，

content.msg_type =generate_answer_finish

代表全部 answer 回复完成。

​

Tip

仅发起对话（v3）接口支持将此参数作为入参，且：

​

如果 autoSaveHistory=true，type 支持设置为 question 或 answer。

​

如果 autoSaveHistory=false，type 支持设置为 question、answer、function_call、tool_output、tool_response。

​

其中，type=question 只能和 role=user 对应，即仅用户角色可以且只能发起 question 类型的消息。详细说明可参考

消息 type 说明

。

​

​

section_id

​

String

​

757363834493437****

​

上下文片段 ID。每次清除上下文都会生成一个新的 section_id。

​

reasoning_content

​

String

​

好的，我现在需要给一个13岁的大学生提供学习建议。首先，我得考虑用户的情况……

​

模型的思维链（CoT），展示模型如何将复杂问题逐步分解为多个简单步骤并推导出最终答案。仅当模型支持深度思考、且智能体开启了深度思考时返回该字段，当前支持深度思考的模型请参考

模型能力差异

。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/conversation/message/delete?conversation_id=74076802623535*****&message_id=74076856761178****' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json' \

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"data"

:

{

​

"bot_id"

:

"73250261716436*****"

,

​

"chat_id"

:

"74076802623535*****"

,

​

"content"

:

"您好呀！今天感觉怎么样？"

,

​

"content_type"

:

"text"

,

​

"conversation_id"

:

"74076802623535*****"

,

​

"created_at"

:

1724734970

,

​

"id"

:

"74076802623536*****"

,

​

"meta_data"

:

{},

​

"role"

:

"assistant"

,

​

"type"

:

"answer"

,

​

"updated_at"

:

1724734971

​

},

​

"msg"

:

""

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

修改消息

下一篇

消息 type 说明
============================================================
# 消息 type 说明
来源: https://www.coze.cn/open/docs/developer_guides/message_type
============================================================

消息 type 说明

仅

​

发起对话

接口需要在接口传参中添加消息内容（content）和消息类型（type），但不同场景支持传入的消息类型和角色类型（role）不同。本文档介绍各个场景支持的 type 类型及各种类型消息内容示例。

​

支持的 type 类型

​

仅

​

发起对话

接口支持将此参数作为入参，且：

​

如果 autoSaveHistory=true，type 支持设置为 question 或 answer。

​

如果 autoSaveHistory=false，type 支持设置为 question、answer、function_call、tool_output/tool_response。

​

其中，type=question 只能和 role=user 对应，即仅用户角色可以且只能发起 question 类型的消息。

​

​

type

​

发起对话

​

​

​

​

Response

​

Request，且 autoSaveHistory=false

​

Request，且 autoSaveHistory=true

​

question

​

❌

​

✔️

​

✔️

​

answer

​

✔️

​

✔️

​

✔️

​

function_call

​

✔️

​

✔️

​

❌

​

tool_output/tool_response

​

✔️

​

✔️

​

❌

​

follow_up

​

✔️

​

❌

​

❌

​

knowledge

​

✔️

​

❌

​

❌

​

verbose

​

✔️

​

❌

​

❌

​

​

消息结构示例

​

创建消息并指定消息类型时，应遵循 type、role 和 content_type 的匹配关系，例如 role 为 user 时，type 只能为 question。详细的匹配关系及消息体示例可参考下表。

​

​

消息类型（type）

​

角色

​

（role）

​

内容类型

​

（content_type）

​

示例

​

question

​

user

​

text

​

object_string

​

​

JSON

复制

{

​

"role"

:

"user"

,

​

"content"

:

"--- 只需要回答最新的这一条问题：搜几个最新的军事新闻"

,

​

"content_type"

:

"text"

,

​

"type"

:

"question"

​

}

​

​

answer

​

assistant

​

text

​

​

JSON

复制

{

​

"role"

:

"assistant"

,

​

"content"

:

"以下是最新的体育新闻 ......"

,

​

"content_type"

:

"text"

,

​

"type"

:

"answer"

​

}

​

​

function_call

​

assistant

​

text

​

​

JSON

复制

{

​

"role": "assistant",

​

"content": "{\"name\":\"toutiaosousuo-search\",\"arguments\":{\"cursor\":0,\"input_query\":\"体育新闻\"...}",

​

"content_type": "text",

​

"type": "function_call"

​

}

​

​

tool_output/tool_response

​

assistant

​

text

​

​

JSON

复制

{

​

"role": "assistant",

​

"content": "{\"news\":[{\"title\":\"新闻内容：.....\"}]}",

​

"content_type": "text",

​

"type": "tool_output"

​

},

​

​

follow_up

​

assistant

​

text

​

​

JSON

复制

{

​

"role"

:

"assistant"

,

​

"type"

:

"follow_up"

,

​

"content"

:

"国足将会有哪些变化和调整？"

,

​

"content_type"

:

"text"

​

}

​

​

verbose

​

assistant

​

text

​

​

JSON

复制

{

​

"role"

:

"assistant"

,

​

"type"

:

"verbose"

,

​

// generate_answer_finish 表示全部 answer 已回复完毕

​

"content"

:

"{\"msg_type\":\"generate_answer_finish\",\"data\":\"\",\"from_module\":null,\"from_unit\":null}"

,

​

"content_type"

:

"text"

​

}

​

​

​

上一篇

删除消息

下一篇

提交消息评价
============================================================
# 提交消息评价
来源: https://www.coze.cn/open/docs/developer_guides/message_feedback
============================================================

提交消息评价

用户可以对智能体或应用回复的消息提交评价，包括点赞、点踩和反馈详细的评论。

​

接口描述

​

无论是“一问一答”还是“一问多答”场景，每条消息的评价都是独立的，不会相互覆盖或影响。如果用户对同一条消息多次提交评价，系统将仅保留最后一次的评价内容。

​

开发者可以在扣子罗盘的消息日志中查看消息的评价数据，以便改进智能体或应用。

​

接口限制

​

仅会话创建者能评价对应会话中的消息。

​

仅支持评价以下来源的文本消息:

​

通过发起对话 API 生成的

type=answer

类型的文本消息。

​

通过执行对话流 API 返回的文本消息。

​

仅支持评价 2025 年 7 月 11 日 0 时之后的消息。

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/conversations/:conversation_id/messages/:message_id/feedback

​

​

权限

​

feedback

​

确保调用该接口使用的访问令牌开通了

feedback

权限，详细信息参考

鉴权方式

。

​

接口说明

​

对智能体或应用回复的消息提交评价。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

conversation_id

​

String

​

必选

​

737363834493434****

​

Conversation ID，即会话的唯一标识。你可以在

发起对话

API 返回的 Response 中查看 conversation_id 字段。

​

message_id

​

String

​

必选

​

74076856761178****

​

针对指定的消息 ID 提交评价。你可以通过

查看对话消息详情

API 返回的 Response 中查看消息 ID。

​

此消息必须在 conversation_id 指定的会话中。

​

仅支持评价以下来源的文本消息：

​

通过发起对话 API 生成的

type=answer

类型的文本消息。

​

通过执行对话流 API 返回的文本消息。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

feedback_type

​

String

​

必选

​

like

​

对智能体或应用回复的消息提交评价，包括以下枚举值：

​

like

：点赞。

​

unlike

：点踩。

​

reason_types

​

Array of String

​

可选

​

["事实性错误","逻辑矛盾","格式混乱"]

​

用户自定义的反馈标签列表，用于分类标识对智能体回复的具体不满类型。每个标签应为简明扼要的分类描述，如问题类型等。

​

最多可添加 10 个标签，单个标签长度不超过 30 个字符。

​

comment

​

String

​

可选

​

智能体关于产品功能的回答存在错误，实际参数应为 5.0 版本而非 4.0 版本。

​

用户对智能体回复消息的具体评价，最多可输入 250 个字符。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细日志信息，用于问题排查。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/conversations/7515364893***/messages/752173729302***/feedback' \

​

--header 'Authorization

:

Bearer pat_xFWpGsNio4S7sfAzpu02vHCkAdL38VnSsTOIu8CkySdY9Z2xmeM8jjn***' \

​

--header 'Content-Type

:

application/json'

​

{

​

"feedback_type"

:

"unlike"

,

​

"reason_types"

:

[

​

"内容有误"

,

​

"不够详细"

​

],

​

"comment"

:

"实际参数应为 5.0 版本而非 4.0 版本。"

​

}

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210191248C8EF760***"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

消息 type 说明

下一篇

删除消息评价
============================================================
# 删除消息评价
来源: https://www.coze.cn/open/docs/developer_guides/delete_message_feedback
============================================================

删除消息评价

删除指定消息的评价。

​

接口限制

​

仅会话创建者能删除对应会话中消息的评价。

​

基础信息

​

​

请求方式

​

DELETE

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/conversations/:conversation_id/messages/:message_id/feedback

​

​

权限

​

feedback

​

确保调用该接口使用的访问令牌开通了

feedback

权限，详细信息参考

鉴权方式

。

​

接口说明

​

删除指定消息的评价。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

conversation_id

​

String

​

必选

​

737363834493434****

​

Conversation ID，即会话的唯一标识。可以在

发起对话

接口 Response 中查看 conversation_id 字段。

​

message_id

​

String

​

必选

​

74076856761178****

​

待删除评价的消息 ID。你可以通过

查看对话消息详情

API 返回的 Response 中查看消息 ID。

​

此消息必须在 conversation_id 指定的会话中。

​

仅支持评价以下来源的文本消息：

​

通过发起对话 API 生成的

type=answer

类型的文本消息。

​

通过执行对话流 API 返回的文本消息。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细日志信息，用于问题排查和技术支持。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

DELETE https

:

//api.coze.cn/v1/conversations/751536489399***/messages/751903981556***/feedback \

​

--header 'Authorization

:

Bearer pat_xFWpGsNio4S7sfAzpu02vHCkAdL38VnSsTOIu8CkySdY9Z2xmeM8jjn****' \

​

--header 'Content-Type

:

application/json'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210191248C8EF76****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

提交消息评价

下一篇

发起对话
============================================================
# 发起对话
来源: https://www.coze.cn/open/docs/developer_guides/chat_v3
============================================================

发起对话

调用此接口发起一次对话，支持添加上下文和流式响应。

​

会话、对话和消息的概念说明，可参考

基础概念

。

​

接口说明

​

发起对话接口用于向指定智能体发起一次对话，支持在对话时添加对话的上下文消息，以便智能体基于历史消息做出合理的回复。开发者可以按需选择响应方式，即流式或非流式响应，响应方式决定了开发者获取智能体回复的方式。关于获取智能体回复的详细说明可参考

通过对话接口获取智能体回复

。

​

流式响应

：智能体在生成回复的同时，将回复消息以数据流的形式逐条发送给客户端。处理结束后，服务端会返回一条完整的智能体回复。详细说明可参考

流式响应

。

​

非流式响应

：无论对话是否处理完毕，立即发送响应消息。开发者可以通过接口

查看对话详情

确认本次对话处理结束后，再调用

查看对话消息详情

接口查看模型回复等完整响应内容。详细说明可参考

非流式响应

。

​

创建会话

API 和

发起对话

API 的区别如下：

​

创建会话：

​

主要用于初始化一个新的会话环境。

​

一个会话是Bot和用户之间的一段问答交互，可以包含多条消息。

​

创建会话时，可以选择携带初始的消息内容。

​

发起对话：

​

用于在已经存在的会话中发起一次对话。

​

支持添加上下文和流式响应。

​

可以基于历史消息进行上下文关联，提供更符合语境的回复。

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/

v3/chat

​

​

权限

​

chat

​

确保调用该接口使用的个人令牌开通了

chat

权限，详细信息参考

鉴权方式

。

​

接口说明

​

调用此接口发起一次对话，支持添加上下文和流式响应。

​

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

​

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

​

​

Query

​

​

参数

​

类型

​

是否必选

​

说明

​

conversation_id

​

String

​

可选

​

标识对话发生在哪一次会话中。

​

会话是智能体和用户之间的一段问答交互。一个会话包含一条或多条消息。对话是会话中对智能体的一次调用，智能体会将对话中产生的消息添加到会话中。

​

可以使用已创建的会话，会话中已存在的消息将作为上下文传递给模型。创建会话的方式可参考

​

创建会话

。

​

对于一问一答等不需要区分 conversation 的场合可不传该参数，系统会自动生成一个会话。

​

说明

一个会话中，只能有一个进行中的对话，否则调用此接口时会报错 4016。

​

​

​

Body

​

​

EnterMessage Object

​

​

object_string object

​

​

​

例如，以下数组是一个完整的多模态内容：

​

​

消息结构示例：

​

​

ShortcutCommandDetail Object

​

​

返回结果

​

此接口通过请求 Body 参数 stream 为 true 或 false 来指定 Response 为流式或非流式响应。你可以根据以下步骤判断当前业务场景适合的响应模式。

​

流程图

No

是否需要打字机效果

显示Response

是否需要

同步处理 Response

流式响应

stream=true

非流式响应

stream=false

是否需要

即时查看 Bot 回复

YES

YES

YES

No

No

​

流式响应

​

在流式响应中，服务端不会一次性发送所有数据，而是以数据流的形式逐条发送数据给客户端，数据流中包含对话过程中触发的各种事件（event），直至处理完毕或处理中断。处理结束后，服务端会通过 conversation.message.completed 事件返回拼接后完整的模型回复信息。各个事件的说明可参考

流式响应事件

。

​

流式响应允许客户端在接收到完整的数据流之前就开始处理数据，例如在对话界面实时展示智能体的回复内容，减少客户端等待模型完整回复的时间。

​

流式响应的整体流程如下：

​

​

返回的事件消息体结构如下：

​

​

流式响应事件

​

​

非流式响应

​

在非流式响应中，无论服务端是否处理完毕，立即发送响应消息。其中包括本次对话的 chat_id、状态等元数据信息，但不包括模型处理的最终结果。

​

非流式响应不需要维持长连接，在场景实现上更简单，但通常需要客户端主动查询对话状态和消息详情才能得到完整的数据。你可以通过接口

​

查看对话详情

确认本次对话处理结束后，再调用

​

查看对话消息详情

接口查看模型回复等完整响应内容。流程如下：

​

​

​

​

​

​

非流式响应的结构如下：

​

​

响应参数

​

​

Message Object

​

​

示例

​

流式响应

​

​

非流式响应

​

​

给自定义参数赋值

​

自定义参数用于在智能体交互中存储和管理每个用户的特定信息，例如用户ID、地理位置等，以便实现个性化处理和差异化响应。你可以对话流中输入自定义参数，并在用户与智能体对话时动态更新和读取变量值。

​

1.

在对话流开始节点的输入参数中设置自定义用户变量。本文以自定义参数

user

为例，你可以根据实际业务场景设置其他参数。

​

​

​

​

​

​

2.

在调用发起对话接口时，通过

parameters

参数传入变量的值。例如给自定义参数

user

赋值，API 调用的示例代码如下：

​

​

Prompt 变量

​

例如在智能体的 Prompt 中定义了一个 {{bot_name}} 的变量，在调用接口时，可以通过

custom_variables

参数传入变量值。

​

​

扣子编程也支持 Jinja2 语法。在下面这个模板中，prompt1 将在 key 变量存在时使用，而 prompt2 将在 key 变量不存在时使用。通过在 custom_variables 中传递 key 的值，你可以控制智能体的响应。

​

​

​

​

携带上下文

​

你可以在发起对话时把多条消息作为上下文一起上传，模型会参考上下文消息，对用户 Query 进行针对性回复。在发起对话时，扣子编程会将以下内容作为上下文传递给模型。

​

会话中的消息

：调用

发起对话

接口时，如果指定了会话 ID，会话中已有的消息会作为上下文传递给模型。

​

additional_messages 中的消息

：如果 additional_messages 中有多条消息，则最后一条会作为本次用户 Query，其他消息为上下文。

​

扣子编程推荐你通过以下方式在对话中指定上下文：

​

​

以方式一为例，在对话中携带上下文的操作步骤如下：

​

1.

准备上下文消息。

​

​

以下消息列表是一个完整的上下文消息。其中：

​

第 2 行是用户传入的历史消息

​

第 4 行是模型返回的历史消息

​

​

2.

调用

​

创建会话

接口创建一个会话，其中包含以上两条消息，并记录会话 ID。

​

请求示例如下：

​

​

3.

调用发起对话（V3）接口，并指定会话 ID。

​

在对话中可以通过 additional_messages 增加本次对话的 query。这些消息会和对话中已有的消息一起作为上下文被传递给大模型。

​

​

4.

调用接口

​

查看对话消息详情

查看模型回复。

​

你可以从智能体的回复中看出这一次会话是符合上下文语境的。响应信息如下：

​

​

​

​

​

上一篇

删除消息评价

下一篇

查看对话详情
============================================================
# 查看对话详情
来源: https://www.coze.cn/open/docs/developer_guides/retrieve_chat
============================================================

查看对话详情

查看对话的详细信息。

​

在非流式会话场景中，调用

发起对话

接口后，可以先轮询此 API 确认本轮对话已结束（status=completed），再调用接口

查看对话消息详情

查看本轮对话的模型回复。

​

说明

仅在对话开启了保存历史记录（auto_save_history=true）后，可通过此接口查看对话的详细信息。

​

建议一个对话每秒轮询一次。

​

​

基础信息

​

​

请求方式

​

GET

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v3/chat/retrieve

​

权限

​

getChat

​

确保调用该接口使用的个人令牌开通了

getChat

权限，详细信息参考

鉴权方式

。

​

接口说明

​

查看对话的详细信息。

​

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

conversation_id

​

String

​

必选

​

738137187639794****

​

Conversation ID，即会话的唯一标识。可以在

发起对话

接口 Response 中查看 conversation_id 字段。

​

chat_id

​

String

​

必选

​

738136585609548****

​

Chat ID，即对话的唯一标识。可以在

发起对话

接口 Response 中查看 id 字段，如果是流式响应，则在 Response 的 chat 事件中查看 id 字段。

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Object of

ChatV3ChatDetail

​

\

​

本次对话的基本信息。

​

detail

​

Object of

ResponseDetail

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此

logid

及错误码联系扣子团队获取帮助。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

​

ChatV3ChatDetail

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

738137187639794****

​

对话 ID，即对话的唯一标识。

​

conversation_id

​

String

​

738136585609548****

​

会话 ID，即会话的唯一标识。

​

bot_id

​

String

​

737946218936519****

​

该会话所属的智能体的 ID。

​

status

​

String

​

completed

​

对话的运行状态。取值为：

​

created：对话已创建。

​

in_progress：智能体正在处理中。

​

completed：智能体已完成处理，本次对话结束。

​

failed：对话失败。

​

requires_action：对话中断，需要进一步处理。

​

canceled：对话已取消。

​

created_at

​

Integer

​

1718609571

​

对话创建的时间。格式为 10 位的 Unixtime 时间戳，单位为秒。

​

completed_at

​

Integer

​

1718609575

​

对话结束的时间。格式为 10 位的 Unixtime 时间戳，单位为秒。

​

failed_at

​

Integer

​

1718609571

​

对话失败的时间。格式为 10 位的 Unixtime 时间戳，单位为秒。

​

meta_data

​

JSON Map

​

{"customKey1":"customValue1","customKey2":"customValue2"}

​

发起对话时的附加消息，用于传入使用方的自定义数据，

查看对话详情

时也会返回此附加消息。

​

自定义键值对，应指定为 Map 对象格式。长度为 16 对键值对，其中键（key）的长度范围为 1～64 个字符，值（value）的长度范围为 1～512 个字符。

​

last_error

​

Object of

LastError

​

\

​

对话运行异常时，此字段中返回详细的错误信息，包括：

​

Code：错误码。Integer 类型。0 表示成功，其他值表示失败。

​

Msg：错误信息。String 类型。

​

section_id

​

String

​

737946218936519****

​

上下文片段 ID。每次调用

清除上下文

API 都会生成一个新的 section_id。

​

required_action

​

Object of

RequiredAction

​

{"type":"submit_tool_outputs","submit_tool_outputs":{"tool_calls":[{"id":"738137187639794****","type":"function","function":{"name":"get_weather","arguments":"{\"city\":\"Beijing\"}"}}]}}

​

当对话状态为

requires_action

时，此字段包含需要进一步处理的信息详情，用于继续对话。

​

usage

​

Object of

Usage

​

​

预留字段，无需关注，具体消耗的 Token 请查看火山账单。

​

​

LastError

​

​

参数

​

类型

​

示例

​

说明

​

msg

​

String

​

详见响应示例

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

code

​

Integer

​

0

​

状态码。

​

0 代表调用成功。

​

​

RequiredAction

​

​

参数

​

类型

​

示例

​

说明

​

type

​

String

​

submit_tool_outputs

​

额外操作的类型，枚举值：

​

submit_tool_outputs

：需要提交工具输出以继续对话。

​

submit_tool_outputs

​

Object of

SubmitToolOutputs

​

{"tool_calls":[{"id":"738137187639794****","type":"function","function":{"name":"get_weather","arguments":"{\"city\":\"Beijing\"}"}}]}

​

当对话状态为

requires_action

时，此字段包含需要提交的工具输出信息，用于继续对话。通常包含一个工具调用列表，每个工具调用包含工具类型和参数。

​

​

SubmitToolOutputs

​

​

参数

​

类型

​

示例

​

说明

​

tool_calls

​

Array of

InterruptPlugin

​

[{"id":"738137187639794****","type":"function","function":{"name":"get_weather","arguments":"{\"city\":\"Beijing\"}"}}]

​

当对话状态为

requires_action

时，此字段包含需要提交的工具调用列表，每个工具调用包含工具类型和参数。

​

​

InterruptPlugin

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

738137187639794****

​

上报运行结果的 ID。

​

type

​

String

​

function

​

工具类型，枚举值包括：

​

function：待执行的方法，通常是端插件。触发端插件时会返回此枚举值。

​

reply_message：待回复的选项。触发工作流问答节点时会返回此枚举值。

​

function

​

Object of

InterruptFunction

​

{"name":"get_weather","arguments":"{\"city\":\"Beijing\"}"}

​

当对话状态为

requires_action

时，此字段表示需要调用的工具或函数的定义，包含函数名称和参数。通常用于指定工具的具体执行方法。

​

​

InterruptFunction

​

​

参数

​

类型

​

示例

​

说明

​

name

​

String

​

get_weather

​

当对话状态为

requires_action

时，此字段表示需要调用的工具或函数的名称，用于继续对话。通常与

arguments

字段配合使用，指定工具的具体执行方法。

​

arguments

​

String

​

{"city":"Beijing"}

​

当对话状态为

requires_action

时，此字段表示需要调用的工具或函数的参数，通常为 JSON 格式的字符串，用于指定工具的具体执行参数。

​

​

Usage

​

​

参数

​

类型

​

示例

​

说明

​

input_count

​

Integer

​

50

​

输入内容所消耗的 Token 数，包含对话上下文、系统提示词、用户当前输入等所有输入类的 Token 消耗。

​

token_count

​

Integer

​

150

​

本次 API 调用消耗的 Token 总量，包括输入和输出两部分的消耗。

​

output_count

​

Integer

​

100

​

大模型输出的内容所消耗的 Token 数。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v3/chat/retrieve?conversation_id=738137187639794****&chat_id=738136585609548****' \

​

--header 'Authorization

:

Bearer *$Access_Token*' \

​

--header 'Content-Type

:

application/json'

​

​

返回示例

​

状态正常的对话

需要使用方额外处理的对话

​

JSON

复制

{

​

"code"

:

0

,

​

"data"

:

{

​

"bot_id"

:

"737946218936519****"

,

​

"completed_at"

:

1718609575

,

​

"conversation_id"

:

"738136585609548****"

,

​

"created_at"

:

1718609571

,

​

"id"

:

"738137187639794****"

,

​

"status"

:

"completed"

,

​

"usage"

:

{

​

"input_count"

:

242

,

​

"output_count"

:

56

,

​

"token_count"

:

298

​

}

​

},

​

"msg"

:

""

​

}

​

​

错误码

​

该接口有两处错误需要判断。一个位于回包的

.code

，对应该接口本身的错误；另一个位于回包的

.last_error.code

，对应/v3/chat的错误。

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

发起对话

下一篇

查看对话消息详情
============================================================
# 查看对话消息详情
来源: https://www.coze.cn/open/docs/developer_guides/list_chat_messages
============================================================

查看对话消息详情

查看指定对话中除 Query 以外的其他消息，包括模型回复、智能体执行的中间结果等消息。

​

接口描述

​

查看消息列表

API 与

查看对话消息详情

API 的区别在于：

​

查看消息列表

API 用于查询指定会话（conversation）中的消息记录，不仅包括开发者在会话中手动插入的每一条消息和用户发送的 Query，也包括调用

发起对话

API 得到的 type=answer 的智能体回复，但不包括 type=function_call、tool_response 和 follow-up 类型的对话中间态消息。

​

查看对话消息详情

API 通常用于非流式对话场景中，查看某次对话（chat）中 type=answer 的智能体回复及 type=function_call、tool_response 和 follow-up 类型类型的对话中间态消息。不包括用户发送的 Query。

​

说明

调用此 API 之前，建议先以每秒最多 1 次的频率轮询

查看对话详情

API 确认本轮对话已结束（status=completed），否则调用此 API 时获取到的消息内容可能不完整。

​

​

基础信息

​

​

请求方式

​

GET

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v3/chat/message/list

​

权限

​

chat

、

listMessage

​

确保调用该接口使用的访问令牌开通了

chat

和

listMessage

权限，详细信息参考

鉴权方式

。

​

接口说明

​

查看指定对话中除 Query 以外的其他消息，包括模型回复、智能体执行的中间结果等消息。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

conversation_id

​

String

​

必选

​

738216760624714****

​

Conversation ID，即会话的唯一标识。可以在

发起对话

接口 Response 中查看 conversation_id 字段。

​

chat_id

​

String

​

必选

​

738147352534297****

​

Chat ID，即对话的唯一标识。可以在

发起对话

接口 Response 中查看 id 字段，如果是流式响应，则在 Response 的 chat 事件中查看 id 字段。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Array of

ChatV3MessageDetail

​

[ { "bot_id": "737946218936519****", "content": "{\"msg_type\":\"generate_answer_finish\",\"data\":\"\",\"from_module\":null,\"from_unit\":null}", "content_type": "text", "conversation_id": "738147352534297****", "id": "738216762080970****", "role": "assistant", "type": "verbose" }]

​

指定对话中除 Query 以外的其他消息，包括模型回复、智能体执行的中间结果等消息。

​

detail

​

Object of

ResponseDetail

​

{ "logid": "20250106172024B5F607030EFFAD653960" }

​

响应详情信息。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

​

ChatV3MessageDetail

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

738216762080970****

​

智能体回复的消息的 Message ID，即消息的唯一标识。

​

conversation_id

​

String

​

738147352534297****

​

此消息所在的会话 ID。

​

role

​

String

​

assistant

​

发送这条消息的实体。取值：

​

user：代表该条消息内容是用户发送的。

​

assistant：代表该条消息内容是智能体发送的。

​

type

​

String

​

verbose

​

消息类型。

​

question

：用户输入内容。

​

answer

：智能体返回给用户的消息内容，支持增量返回。如果工作流绑定了 messge 节点，可能会存在多 answer 场景，此时可以用流式返回的结束标志来判断所有 answer 完成。

​

function_call

：智能体对话过程中调用函数（function call）的中间结果。

​

tool_output

：调用工具 （function call）后返回的结果。

​

tool_response

：调用工具 （function call）后返回的结果。

​

follow_up

：如果在智能体上配置打开了用户问题建议开关，则会返回推荐问题相关的回复内容。

​

verbose

：多 answer 场景下，服务端会返回一个 verbose 包，对应的 content 为 JSON 格式，content.msg_type =generate_answer_finish 代表全部 answer 回复完成。

​

说明

仅发起对话（v3）接口支持将此参数作为入参，且：

​

如果 autoSaveHistory=true，type 支持设置为 question 或 answer。

​

如果 autoSaveHistory=false，type 支持设置为 question、answer、function_call、tool_output、tool_response。

​

其中，type=question 只能和 role=user 对应，即仅用户角色可以且只能发起 question 类型的消息。详细说明可参考

消息 type 说明

。

​

​

bot_id

​

String

​

737946218936519****

​

编写此消息的智能体 ID。此参数仅在对话产生的消息中返回。

​

chat_id

​

String

​

747946218936519****

​

Chat ID。此参数仅在对话产生的消息中返回。

​

section_id

​

String

​

767946218936519****

​

上下文片段 ID。每次调用

清除上下文

API 都会生成一个新的 section_id。

​

content

​

String

​

{"msg_type":"generate_answer_finish","data":"","from_module":null,"from_unit":null}

​

消息的内容，支持纯文本、多模态（文本、图片、文件混合输入）、卡片等多种类型的内容。

​

说明

当

role

为 user 时，支持返回多模态内容。

​

当

role

为 assistant 时，只支持返回纯文本内容。

​

​

meta_data

​

JSON Map

​

{ "uuid": "newid1234" }

​

创建消息时的附加消息，

查看消息列表

时也会返回此附加消息。

​

created_at

​

Long

​

1718592898

​

消息的创建时间，格式为 10 位的 Unixtime 时间戳，单位为秒（s）。

​

updated_at

​

Long

​

1718592898

​

消息的更新时间，格式为 10 位的 Unixtime 时间戳，单位为秒（s）。

​

content_type

​

String

​

text

​

消息内容的类型，取值包括：

​

text：文本。

​

object_string：多模态内容，即文本和文件的组合、文本和图片的组合。

​

card：卡片。此枚举值仅在接口响应中出现，不支持作为入参。

​

reasoning_content

​

String

​

好的，我现在需要给一个13岁的大学生提供学习建议。首先，我得考虑用户的情况……

​

模型的思维链（CoT），展示模型如何将复杂问题逐步分解为多个简单步骤并推导出最终答案。仅当模型支持深度思考、且智能体开启了深度思考时返回该字段，当前支持深度思考的模型请参考

模型能力差异

。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v3/chat/message/list?conversation_id=738216760624714****&chat_id=738147352534297****' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json'

​

​

返回示例

​

基础对话

图文对话

​

JSON

复制

{

​

"code"

:

0

,

​

"data"

:

[

​

{

​

"bot_id"

:

"737946218936519****"

,

​

"content"

:

"{\"msg_type\":\"generate_answer_finish\",\"data\":\"\",\"from_module\":null,\"from_unit\":null}"

,

​

"content_type"

:

"text"

,

​

"conversation_id"

:

"738147352534297****"

,

​

"id"

:

"738216762080970****"

,

​

"role"

:

"assistant"

,

​

"type"

:

"verbose"

​

},

​

{

​

"bot_id"

:

"7379462189365198898"

,

​

"content"

:

"2024 年 10 月 1 日是星期二。您可以通过日历或者相关的日期查询工具来核实确认。 "

,

​

"content_type"

:

"text"

,

​

"conversation_id"

:

"738147352534297****"

,

​

"id"

:

"738216760624724****"

,

​

"role"

:

"assistant"

,

​

"type"

:

"answer"

​

}

​

],

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20250106172024B5F607030EFF***"

​

}

​

}

​

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

查看对话详情

下一篇

提交工具执行结果
============================================================
# 提交工具执行结果
来源: https://www.coze.cn/open/docs/developer_guides/chat_submit_tool_outputs
============================================================

提交工具执行结果

调用此接口提交工具执行的结果。

​

接口说明

​

你可以将需要客户端执行的操作定义为插件，对话中如果触发这个插件，流式 event 响应信息会提示“conversation.chat.requires_action”，此时需要执行客户端的操作后，通过此接口提交插件执行后的结果。

​

说明

调用

发起对话

API 时，

auto_save_history

参数需要设置为

true

，否则调用本 API 提交工具执行结果时会提示 5000 错误。

​

仅触发了端插件的对话需要调用此接口提交执行结果。端插件是非扣子服务端执行的插件，需要开发者自行执行任务后提交结果，通常用于 IoT 等设备控制场景。详细说明可参考

通过 API 使用端插件

。

​

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v3/chat/submit_tool_outputs

​

​

权限

​

submitToolChat

​

确保调用该接口使用的访问令牌开通了

submitToolChat

权限，详细信息参考

准备工作

。

​

接口说明

​

调用接口提交工具执行结果。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

鉴权方式

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

conversation_id

​

String

​

必选

​

748348012449138***

​

Conversation ID，即会话的唯一标识。可以在

发起对话

接口 Response 中查看 conversation_id 字段。

​

chat_id

​

String

​

必选

​

738137187639794***

​

Chat ID，即对话的唯一标识。可以在

发起对话

接口 Response 中查看 id 字段，如果是流式响应，则在 Response 的 chat 事件中查看 id 字段。

​

​

Body

​

​

ToolOutput

​

​

​

返回参数

​

非流式响应

​

在非流式响应中，无论服务端是否处理完毕，立即发送响应消息。其中包括本次对话的 chat_id、状态等元数据信息，但不包括模型处理的最终结果。

​

非流式响应不需要维持长连接，在场景实现上更简单，但通常需要客户端主动查询对话状态和消息详情才能得到完整的数据。你可以通过接口

​

查看对话详情

确认本次对话处理结束后，再调用

​

查看对话消息详情

接口查看模型回复等完整响应内容。流程如下：

​

​

​

​

​

​

非流式响应的结构如下：

​

​

ChatV3ChatDetail

​

​

LastError

​

​

RequiredAction

​

​

SubmitToolOutputs

​

​

InterruptPlugin

​

​

InterruptFunction

​

​

Usage

​

​

ResponseDetail

​

​

流式响应

​

在流式响应中，服务端不会一次性发送所有数据，而是以数据流的形式逐条发送数据给客户端，数据流中包含对话过程中触发的各种事件（event），直至处理完毕或处理中断。处理结束后，服务端会通过 conversation.message.completed 事件返回拼接后完整的模型回复信息。各个事件的说明可参考

流式响应事件

。

​

流式响应允许客户端在接收到完整的数据流之前就开始处理数据，例如在对话界面实时展示智能体的回复内容，减少客户端等待模型完整回复的时间。

​

流式响应的整体流程如下：

​

​

​

​

ChatV3MessageDetail

​

​

示例

​

请求示例

​

​

返回示例

​

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

查看对话消息详情

下一篇

取消进行中的对话
============================================================
# 取消进行中的对话
来源: https://www.coze.cn/open/docs/developer_guides/chat_cancel
============================================================

取消进行中的对话

调用此接口取消进行中的对话。

​

调用

发起对话

接口时，如果对话触发了复杂的工作流、图像流，或模型处理数据量大时，对话可能耗时较久。对话进行中时，用户无法在此会话中发起新的对话。此时可以调用此接口取消正在进行中的对话，取消后，对话转为已取消状态（status=canceled），你可以在会话中创建新的对话。

​

注意事项

​

调用取消对话 API 仅切换对话状态，不会中断 chat API 的流式回复，同时根据完整回复内容来计算消耗的模型 Token。如需中断流式回复、停止打印机效果，可以在调用此 API 之后主动中断客户端连接，例如调用浏览器 Web API

AbortController

。

​

取消对话后，本轮用户的 Query 和智能体的回复不会记录为对话的上下文。

​

不支持取消以下状态的对话。你可以通过

查看对话详情

接口的 status 字段查看对话状态。

​

completed：会话结束。

​

failed：会话失败。

​

requires_action：会话中断。

​

对话过程中的状态流转：

​

​

​

​

​

​

​

基础信息

​

​

请求方式

​

POST

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v3/chat/cancel

​

权限

​

cancelChat

​

确保调用该接口使用的访问令牌开通了

cancelChat

权限，详细信息可参考

鉴权方式

。

​

接口说明

​

调用此接口取消进行中的对话。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

鉴权方式

。

​

Content-Type

​

application/json

​

请求正文的方式。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

chat_id

​

String

​

必选

​

7398048669188****

​

对话 ID，即 Chat ID。可以在

发起对话

接口 Response 中查看 id 字段，如果是流式响应，则在 Response 的 chat 事件中查看 id 字段。

​

conversation_id

​

String

​

必选

​

7397787494399****

​

会话 ID，即 Conversation ID。可以在

发起对话

接口 Response 中查看 conversation_id 字段。

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Object of

ChatV3ChatDetail

​

详见响应示例

​

被取消对话的详细信息。详细说明可参考

ChatV3ChatDetail

。

​

detail

​

Object of

ResponseDetail

​

详见响应示例

​

详细信息。

​

code

​

Long

​

0

​

调用状态码。

​

0 表示调用成功。

​

其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

​

ChatV3ChatDetail

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

738137187639794****

​

对话 ID，即对话的唯一标识。

​

conversation_id

​

String

​

738136585609548****

​

会话 ID，即会话的唯一标识。

​

bot_id

​

String

​

737946218936519****

​

该会话所属的智能体的 ID。

​

status

​

String

​

completed

​

对话的运行状态。取值为：

​

created：对话已创建。

​

in_progress：智能体正在处理中。

​

completed：智能体已完成处理，本次对话结束。

​

failed：对话失败。

​

requires_action：对话中断，需要进一步处理。

​

canceled：对话已取消。

​

created_at

​

Integer

​

1718609571

​

对话创建的时间。格式为 10 位的 Unixtime 时间戳，单位为秒。

​

completed_at

​

Integer

​

1718609575

​

对话结束的时间。格式为 10 位的 Unixtime 时间戳，单位为秒。

​

failed_at

​

Integer

​

1718609571

​

对话失败的时间。格式为 10 位的 Unixtime 时间戳，单位为秒。

​

meta_data

​

JSON Map

​

{"customKey1":"customValue1","customKey2":"customValue2"}

​

发起对话时的附加消息，用于传入使用方的自定义数据，

查看对话详情

时也会返回此附加消息。

​

自定义键值对，应指定为 Map 对象格式。长度为 16 对键值对，其中键（key）的长度范围为 1～64 个字符，值（value）的长度范围为 1～512 个字符。

​

last_error

​

Object of

LastError

​

\

​

对话运行异常时，此字段中返回详细的错误信息，包括：

​

Code：错误码。Integer 类型。0 表示成功，其他值表示失败。

​

Msg：错误信息。String 类型。

​

section_id

​

String

​

737946218936519****

​

上下文片段 ID。每次调用

清除上下文

API 都会生成一个新的 section_id。

​

required_action

​

Object of

RequiredAction

​

{"type":"submit_tool_outputs","submit_tool_outputs":{"tool_calls":[{"id":"738137187639794****","type":"function","function":{"name":"get_weather","arguments":"{\"city\":\"Beijing\"}"}}]}}

​

当对话状态为

requires_action

时，此字段包含需要进一步处理的信息详情，用于继续对话。

​

usage

​

Object of

Usage

​

​

预留字段，无需关注，具体消耗的 Token 请查看火山账单。

​

​

LastError

​

​

参数

​

类型

​

示例

​

说明

​

msg

​

String

​

详见响应示例

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

code

​

Integer

​

0

​

状态码。

​

0 代表调用成功。

​

​

RequiredAction

​

​

参数

​

类型

​

示例

​

说明

​

type

​

String

​

submit_tool_outputs

​

额外操作的类型，枚举值：

​

submit_tool_outputs

：需要提交工具输出以继续对话。

​

submit_tool_outputs

​

Object of

SubmitToolOutputs

​

{"tool_calls":[{"id":"738137187639794****","type":"function","function":{"name":"get_weather","arguments":"{\"city\":\"Beijing\"}"}}]}

​

当对话状态为

requires_action

时，此字段包含需要提交的工具输出信息，用于继续对话。通常包含一个工具调用列表，每个工具调用包含工具类型和参数。

​

​

SubmitToolOutputs

​

​

参数

​

类型

​

示例

​

说明

​

tool_calls

​

Array of

InterruptPlugin

​

[{"id":"738137187639794****","type":"function","function":{"name":"get_weather","arguments":"{\"city\":\"Beijing\"}"}}]

​

当对话状态为

requires_action

时，此字段包含需要提交的工具调用列表，每个工具调用包含工具类型和参数。

​

​

InterruptPlugin

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

738137187639794****

​

上报运行结果的 ID。

​

type

​

String

​

function

​

工具类型，枚举值包括：

​

function：待执行的方法，通常是端插件。触发端插件时会返回此枚举值。

​

reply_message：待回复的选项。触发工作流问答节点时会返回此枚举值。

​

function

​

Object of

InterruptFunction

​

{"name":"get_weather","arguments":"{\"city\":\"Beijing\"}"}

​

当对话状态为

requires_action

时，此字段表示需要调用的工具或函数的定义，包含函数名称和参数。通常用于指定工具的具体执行方法。

​

​

InterruptFunction

​

​

参数

​

类型

​

示例

​

说明

​

name

​

String

​

get_weather

​

当对话状态为

requires_action

时，此字段表示需要调用的工具或函数的名称，用于继续对话。通常与

arguments

字段配合使用，指定工具的具体执行方法。

​

arguments

​

String

​

{"city":"Beijing"}

​

当对话状态为

requires_action

时，此字段表示需要调用的工具或函数的参数，通常为 JSON 格式的字符串，用于指定工具的具体执行参数。

​

​

Usage

​

​

参数

​

类型

​

示例

​

说明

​

input_count

​

Integer

​

50

​

输入内容所消耗的 Token 数，包含对话上下文、系统提示词、用户当前输入等所有输入类的 Token 消耗。

​

token_count

​

Integer

​

150

​

本次 API 调用消耗的 Token 总量，包括输入和输出两部分的消耗。

​

output_count

​

Integer

​

100

​

大模型输出的内容所消耗的 Token 数。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v3/chat/cancel' \

​

--header 'Authorization

:

Bearer pat_hfwkehfncaf****' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"chat_id"

:

"73980486691***"

,

​

"conversation_id"

:

"739778749439***"

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"data"

:

{

​

"id"

:

"738137187639794****"

,

​

"usage"

:

{},

​

"bot_id"

:

"737946218936519****"

,

​

"status"

:

"completed"

,

​

"failed_at"

:

null

,

​

"meta_data"

:

{},

​

"created_at"

:

1718609571

,

​

"last_error"

:

{

​

"msg"

:

""

,

​

"code"

:

null

​

},

​

"section_id"

:

""

,

​

"completed_at"

:

1718609575

,

​

"conversation_id"

:

"739778749439***"

,

​

"required_action"

:

{

​

"type"

:

""

,

​

"submit_tool_outputs"

:

{

​

"tool_calls"

:

[

​

{

​

"id"

:

""

,

​

"type"

:

""

,

​

"function"

:

{

​

"name"

:

""

,

​

"arguments"

:

""

​

}

​

}

​

]

​

}

​

}

​

},

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2F37A23"

​

},

​

"msg"

:

""

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

提交工具执行结果

下一篇

执行工作流
============================================================
# 执行工作流
来源: https://www.coze.cn/open/docs/developer_guides/workflow_run
============================================================

执行工作流

执行已发布的工作流。

​

接口说明

​

此接口为非流式响应模式，如果需要采用流式输出，请参考

执行工作流（流式响应）

。

​

调用此接口后，你可以从响应中获得 debug_url，访问链接即可通过可视化界面查看工作流的试运行过程，其中包含每个执行节点的输入输出等详细信息，帮助你在线调试或排障。

​

扣子个人付费版、企业版（企业标准版、企业旗舰版）用户调用此接口时，支持通过

is_async

参数异步运行工作流，适用于工作流执行耗时较长，导致运行超时的情况。异步运行后可通过本接口返回的 execute_id 调用

查询工作流异步执行结果

API 获取工作流的执行结果。

​

限制说明

​

说明

调用此非流式响应 API 时，若 API 在 90 秒内未收到响应，将因超时而断开连接。对于执行耗时较长的工作流，建议使用

执行工作流（流式响应）

API。

​

​

​

限制项

​

说明

​

工作流发布状态

​

必须为已发布。执行未发布的工作流会返回错误码 4200。 创建并发布工作流的操作可参考

使用工作流

。

​

节点限制

​

工作流中不能包含输出节点、开启了流式输出的结束节点。

​

关联智能体

​

调用此 API 之前，应先在扣子平台中试运行此工作流，如果试运行时需要关联智能体，则调用此 API 执行工作流时，也需要指定智能体ID。通常情况下，执行存在数据库节点、变量节点等节点的工作流需要关联智能体。

​

请求大小上限

​

20 MB，包括输入参数及运行期间产生的消息历史等所有相关数据。

​

超时时间

​

未开启工作流异步运行时，工作流整体超时时间为 10 分钟，建议执行时间控制在 5 分钟以内，否则不保障执行结果的准确性。 详细说明可参考

工作流使用限制

。

​

开启工作流异步运行后，工作流整体超时时间为 24 小时。

​

​

​

基础信息

​

​

请求方式

​

POST

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/workflow/run

​

权限

​

run

​

确保调用该接口使用的访问令牌开通了

run

权限，详细信息参考

鉴权方式

。

​

接口说明

​

执行已发布的工作流。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子平台中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

workflow_id

​

String

​

必选

​

73664689170551*****

​

待执行的 Workflow ID，此工作流应已发布。

​

进入 Workflow 编排页面，在页面 URL 中，

workflow

参数后的数字就是 Workflow ID。例如

https://www.coze.com/work_flow?space_id=42463***&workflow_id=73505836754923***

，Workflow ID 为

73505836754923***

。

​

parameters

​

String

​

可选

​

{"image": "{\"file_id\":\"1122334455\"}","user_name":"George"}

​

工作流开始节点的输入参数及取值，以 JSON 序列化字符串形式传入。你可以在指定工作流的编排页面查看输入参数列表。

​

如果工作流输入参数为 Image 等类型的文件，你可以传入文件 URL 或调用

上传文件

API 获取 file_id 后传入 file_id。示例：

​

上传文件并传入 file_id：

​

单个文件示例：

"parameters": { "image": "{\"file_id\":\"1122334455\"}" }

​

文件数组示例：

"parameters": { "image": [ "{\"file_id\":\"1122334455\"}" ] }

。

​

传入文件 URL：

“parameters” :{"input":"请总结图片内容", "image": "

https://example.com/tos-cn-i-mdko3gqilj/example.png

" }

​

bot_id

​

String

​

可选

​

73428668*****

​

需要关联的智能体 ID。 部分工作流执行时需要指定关联的智能体，例如存在数据库节点、变量节点等节点的工作流。

​

​

​

​

​

​

进入智能体的开发页面，开发页面 URL 中 bot 参数后的数字就是智能体t ID。例如

https://www.coze.com/space/341****/bot/73428668*****

，智能体 ID 为

73428668*****

。

​

Tip

确保调用该接口使用的令牌开通了此智能体所在空间的权限。

​

确保该智能体已发布为 API 服务。

​

​

app_id

​

String

​

可选

​

744208683**

​

该工作流关联的扣子应用的 ID。

​

进入应用开发界面，开发页面 URL 中的

project-ide

参数后的数字就是 AppID，例如

https://

www.coze.cn

/space/74421656*****/project-ide/744208683**

，扣子应用 ID 为

744208683**

。

​

说明

仅运行扣子应用中的工作流时，才需要设置 app_id。智能体绑定的工作流、空间资源库中的工作流无需设置 app_id。

​

​

ext

​

JSON Map

​

可选

​

{"latitude": "39.9042", "longitude": "116.4074"}

​

用于指定一些额外的字段，以 Map[String][String] 格式传入。例如某些插件会隐式用到的经纬度等字段。

​

目前仅支持以下字段：

​

latitude：String 类型，表示纬度。

​

longitude：String 类型，表示经度。

​

user_id：String 类型，表示用户 ID。

​

is_async

​

Boolean

​

可选

​

true

​

是否异步运行。异步运行后可通过本接口返回的 execute_id 调用

查询工作流异步执行结果

API 获取工作流的最终执行结果。

​

true：异步运行。

​

false：（默认）同步运行。

​

Tip

异步运行的参数 is_async 仅限扣子个人付费版、企业版（企业标准版、企业旗舰版）使用，否则调用此接口会报错 6003 Workflow execution with is_async=true is a premium feature available only to Coze Professional users

​

​

workflow_version

​

String

​

可选

​

v0.0.5

​

工作流的版本号，仅当运行的工作流属于资源库工作流时有效。未指定版本号时默认执行最新版本的工作流。

​

connector_id

​

String

​

可选

​

​

渠道 ID，用于配置该工作流在什么渠道执行。

​

当智能体或扣子应用发布到某个渠道后，可以通过该参数指定工作流在对应的渠道执行。

​

扣子的渠道 ID 包括：

​

1024（默认值）：API 渠道。

​

999：Chat SDK。

​

998：WebSDK。

​

10000122：扣子商店。

​

10000113：微信客服。

​

10000120：微信服务号。

​

10000121：微信订阅号。

​

10000126：抖音小程序。

​

10000127：微信小程序。

​

10000011：飞书。

​

10000128：飞书多维表格。

​

10000117：掘金。

​

自定义渠道 ID。自定义渠道 ID 的获取方式如下：在扣子左下角单击头像，在

账号设置

>

发布渠道

>

企业自定义渠道管理

页面查看渠道 ID。

​

说明

不同渠道的用户数据、会话记录等相互隔离，进行数据分析统计时，不支持跨渠道数据调用。

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

data

​

String

​

\

​

工作流执行结果，通常为 JSON 序列化字符串，部分场景下可能返回非 JSON 结构的字符串。

​

execute_id

​

String

​

741364789030728****

​

异步执行的事件 ID。

​

debug_url

​

String

​

https://www.coze.cn/work_flow?execute_id=741364789030728****&space_id=736142423532160****&workflow_id=738958910358870****

​

工作流试运行调试页面。访问此页面可查看每个工作流节点的运行结果、输入输出等信息。

​

说明

debug_url 的访问有效期为 7 天，过期后将无法访问。

​

​

usage

​

Object of

Usage

​

{"input_count":50,"token_count":150,"output_count":100}

​

资源使用情况，包含本次 API 调用消耗的 Token 数量等信息。

​

此处大模型返回的消耗 Token 仅供参考，以

火山引擎账单

实际为准。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

code

​

Long

​

0

​

调用状态码。

​

0 表示调用成功。

​

其他值表示调用失败。你可以通过 msg 字段判断详细的错误原因。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

interrupt_data

​

Object of

Interrupt

​

{"data":"{\"content_type\":\"text\",\"content\":\"请输入您的姓名\"}","type":2,"event_id":"740483198820252***","required_parameters":{"name":{"type":"string","required":true}}}

​

中断事件的详细信息，包含中断控制内容、中断类型和事件 ID 等信息。

​

​

Usage

​

​

参数

​

类型

​

示例

​

说明

​

input_count

​

Integer

​

50

​

输入内容所消耗的 Token 数，包含对话上下文、系统提示词、用户当前输入等所有输入类的 Token 消耗。

​

output_count

​

Integer

​

100

​

大模型输出的内容所消耗的 Token 数。

​

token_count

​

Integer

​

150

​

本次 API 调用消耗的 Token 总量，包括输入和输出两部分的消耗。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

Interrupt

​

​

参数

​

类型

​

示例

​

说明

​

data

​

String

​

{\"content_type\":\"text\",\"content\":\"[{\\\"type\\\":\\\"string\\\",\\\"name\\\":\\\"img\\\",\\\"required\\\":true,\\\"assistType\\\":2}]\"}

​

中断控制内容，用于在工作流中断时传递控制信息。当工作流需要用户输入或执行特定操作时，通过此字段传递相关信息。

​

type

​

Integer

​

2

​

工作流中断类型，调用

恢复运行工作流

API 恢复运行时应回传此字段。

​

枚举值：

​

6

：端插件触发中断。

​

2

：问答节点触发中断。

​

5

：输入节点触发中断。

​

7

：OAuth 插件触发中断。

​

event_id

​

String

​

740483198820252***

​

工作流中断事件 ID，调用

恢复运行工作流

API 恢复运行时应回传此字段。

​

required_parameters

​

JSON Map

​

{ "img": { "required": true, "type": "image" } }

​

工作流中断时需要补充的参数信息，采用键值对（key-value）结构，其中 key 为输入节点对应的参数名称，value 为该参数的定义信息（包含类型、是否必填等属性）。

​

​

RequiredParameters

​

​

参数

​

类型

​

示例

​

说明

​

type

​

String

​

string

​

该参数的类型。

​

items

​

Object of

OpenAPIParameter

​

{"type":"image"}

​

当参数类型为

array

时，该字段用于定义数组元素的子类型。

​

required

​

Boolean

​

true

​

标识输入参数是否为必填项。

​

true

：该参数为必填项。

​

false

：该参数为可选项。

​

properties

​

JSON Map

​

{ "arr_obj_num": { "required": false, "type": "number" } }

​

当参数类型为

object

时，该字段用于定义对象类型的子参数信息，采用键值对（key-value）结构，其中 key 为子参数的名称，value 为该子参数的定义信息（包含类型、是否必填等属性）。

​

description

​

String

​

上传的图片。

​

该参数的描述信息。

​

default_value

​

String

​

-

​

该参数配置的默认值。

​

​

示例

​

请求示例

​

同步执行工作流

异步执行工作流

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/workflow/run' \

​

--header 'Authorization

:

Bearer pat_hfwkehfncaf****' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"workflow_id"

:

"73664689170551*****"

,

​

"parameters"

:

{

​

"user_name"

:

"George"

​

}

​

}

'

​

​

​

返回示例

​

同步执行工作流

异步执行工作流

​

JSON

复制

{

​

"code"

:

0

,

​

"data"

:

"{\"output\":\"北京的经度为116.4074°E，纬度为39.9042°N。\"}"

,

​

"debug_url"

:

"https://www.coze.cn/work_flow?execute_id=741364789030728****&space_id=736142423532160****&workflow_id=738958910358870****"

,

​

"msg"

:

""

,

​

"usage"

:

{

​

"input_count"

:

50

,

​

"token_count"

:

150

,

​

"output_count"

:

100

​

}

​

}

​

​

错误码

​

如果成功调用扣子的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

取消进行中的对话

下一篇

执行工作流（流式响应）
============================================================
# 执行工作流（流式响应）
来源: https://www.coze.cn/open/docs/developer_guides/workflow_stream_run
============================================================

执行工作流（流式响应）

执行已发布的工作流，响应方式为流式响应。

​

接口说明

​

调用 API 执行工作流时，对于支持流式输出的工作流，往往需要使用流式响应方式接收响应数据，例如实时展示工作流的输出信息、呈现打字机效果等。

​

在流式响应中，服务端不会一次性发送所有数据，而是以数据流的形式逐条发送数据给客户端，数据流中包含工作流执行过程中触发的各种事件（event），直至处理完毕或处理中断。处理结束后，服务端会通过

event: Done

事件提示工作流执行完毕。各个事件的说明可参考

​

返回结果

。

​

说明

目前支持流式响应的工作流节点包括

输出节点

、

问答节点

和

开启了流式输出的结束节点

。对于不包含这些节点的工作流，可以使用

​

执行工作流

接口一次性接收响应数据。

​

​

限制说明

​

通过 API 方式执行工作流前，应确认此工作流已发布，执行从未发布过的工作流时会返回错误码 4200。创建并发布工作流的操作可参考

​

使用低代码工作流

。

​

调用此 API 之前，应先在扣子编程中试运行此工作流。

​

如果试运行时需要关联智能体，则调用此 API 执行工作流时，也需要指定 bot_id。通常情况下，执行存在数据库节点、变量节点等节点的工作流需要关联智能体。

​

执行应用中的工作流时，需要指定 app_id。

​

请勿同时指定 bot_id 和 app_id，否则 API 会报错 4000，表示请求参数错误。

​

此接口为同步接口，如果工作流整体或某些节点运行超时，智能体可能无法提供符合预期的回复，建议将工作流的执行时间控制在 5 分钟以内。同步执行时，工作流整体超时时间限制可参考

​

低代码工作流使用限制

。

​

工作流支持的请求大小上限为 20MB，包括输入参数以及运行期间产生的消息历史等所有相关数据。

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/

v1/workflow/stream_run

​

​

权限

​

run

​

确保调用该接口使用的访问令牌开通了

run

权限，详细信息参考

​

鉴权方式概述

。

​

接口说明

​

执行已发布的工作流，响应方式为流式响应。

​

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

​

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

​

​

Body

​

​

参数

​

类型

​

是否必选

​

说明

​

workflow_id

​

String

​

必选

​

待执行的 Workflow ID，此工作流应已发布。

​

进入 Workflow 编排页面，在页面 URL 中，

workflow

参数后的数字就是 Workflow ID。例如

https://www.coze.com/work_flow?space_id=42463***&workflow_id=73505836754923***

，Workflow ID 为

73505836754923***

。

​

parameters

​

map[String]Any

​

可选

​

工作流开始节点的输入参数及取值，你可以在指定工作流的编排页面查看参数列表。

​

如果工作流输入参数为 Image 等类型的文件，你可以传入文件 URL 或调用

上传文件

API 获取 file_id 后传入 file_id。示例：

​

上传文件并传入 file_id：

​

单个文件示例：

"parameters": { "image": "{\"file_id\":\"1122334455\"}" }

​

文件数组示例：

"parameters": { "image": [ "{\"file_id\":\"1122334455\"}" ] }

。

​

传入文件 URL：

​

“parameters” :{"input":"请总结图片内容", "image": "

https://example.com/tos-cn-i-mdko3gqilj/example.png

" }

​

bot_id

​

​

String

​

​

可选

​

​

需要关联的智能体ID。 部分工作流执行时需要指定关联的智能体，例如存在数据库节点、变量节点等节点的工作流。

​

​

​

​

​

​

进入智能体的开发页面，开发页面 URL 中

bot

参数后的数字就是智能体ID。例如

https://www.coze.com/space/341****/bot/73428668*****

，Bot ID 为

73428668*****

。

​

说明

确保调用该接口使用的令牌开通了此智能体所在空间的权限。

​

确保该智能体已发布为 API 服务。

​

​

ext

​

Map[String][String]

​

​

可选

​

用于指定一些额外的字段，以 Map[String][String] 格式传入。例如某些插件会隐式用到的经纬度等字段。

​

目前仅支持以下字段：

​

latitude：String 类型，表示纬度。

​

longitude：String 类型，表示经度。

​

user_id：String 类型，表示用户 ID。

​

app_id

​

String

​

可选

​

工作流所在的应用 ID。

​

你可以通过应用的业务编排页面 URL 中获取应用 ID，也就是 URL 中 project-ide 参数后的一串字符，例如

https://www.coze.

cn

/space/739174157340921****/

project

-ide/743996105122521****/workflow/744102227704147****

中，应用的 ID 为

743996105122521****

。

​

说明

仅运行扣子应用中的工作流时，才需要设置 app_id。智能体绑定的工作流、空间资源库中的工作流无需设置 app_id。

​

​

workflow_version

​

​

​

String

​

​

可选

​

​

工作流的版本号，仅当运行的工作流属于资源库工作流时有效。未指定版本号时默认执行最新版本的工作流。

​

connector_id

​

String

​

​

可选

​

​

渠道 ID，用于配置该工作流在什么渠道执行。

​

当智能体或扣子应用发布到某个渠道后，可以通过该参数指定工作流在对应的渠道执行。

​

扣子编程的渠道 ID 包括：

​

1024（默认值）：API 渠道。

​

999：Chat SDK。

​

998：WebSDK。

​

10000122：扣子商店。

​

10000113：微信客服。

​

10000120：微信服务号。

​

10000121：微信订阅号。

​

10000126：抖音小程序。

​

10000127：微信小程序。

​

10000011：飞书。

​

10000128：飞书多维表格。

​

10000117：掘金。

​

自定义渠道 ID。自定义渠道 ID 的获取方式如下：在扣子编程左下角单击头像，在

账号设置

>

发布渠道

>

企业自定义渠道管理

页面查看渠道 ID。

​

说明

不同渠道的用户数据、会话记录等相互隔离，进行数据分析统计时，不支持跨渠道数据调用。

​

​

​

返回结果

​

​

说明

在流式响应中，开发者需要注意是否存在丢包现象。

​

事件 ID（id）默认从 0 开始计数，以包含

event: Done

的事件为结束标志。开发者应根据 id 确认响应消息整体无丢包现象。

​

Message 事件的消息 ID 默认从 0 开始计数，以包含

node_is_finish : true

的事件为结束标志。开发者应根据 node_seq_id 确认 Message 事件中每条消息均完整返回，无丢包现象。

​

​

​

参数名

​

参数类型

​

参数描述

​

id

​

Integer

​

此消息在接口响应中的事件 ID。以 0 为开始。

​

event

​

String

​

当前流式返回的数据包事件。包括以下类型：

​

Message：工作流节点输出消息，例如输出节点、结束节点的输出消息。可以在 data 中查看具体的消息内容。

​

Error：报错。可以在 data 中查看 error_code 和 error_message，排查问题。

​

Done：结束。表示工作流执行结束，此时 data 中包含 debug URL。

​

Interrupt：中断。表示工作流中断，此时 data 字段中包含具体的中断信息。

​

PING：心跳信号。表示工作流执行中，消息内容为空，用于维持连接。

​

data

​

Object

​

事件内容。各个 event 类型的事件内容格式不同。

​

​

Message 事件

​

Message 事件中，data 的结构如下：

​

​

参数名

​

参数类型

​

参数描述

​

content

​

String

​

流式输出的消息内容。

​

node_title

​

String

​

输出消息的节点名称，例如输出节点、结束节点。

​

node_seq_id

​

String

​

此消息在节点中的消息 ID，从 0 开始计数，例如输出节点的第 5 条消息。

​

node_is_finish

​

Boolean

​

当前消息是否为此节点的最后一个数据包。

​

ext

​

Map[String]String

​

额外字段。

​

usage

​

Object of

​

Usage

​

资源使用情况，包含本次 API 调用消耗的 Token 数量等信息。

​

node_id

​

String

​

输出消息的节点 ID。

​

node_execute_uuid

​

String

​

节点每次执行的 ID，用于追踪和识别工作流中特定节点的单次执行情况。

​

​

usage

​

​

参数

​

类型

​

示例

​

说明

​

input_count

​

​

​

Integer

​

​

50

​

​

输入内容所消耗的 Token 数，包含对话上下文、系统提示词、用户当前输入等所有输入类的 Token 消耗。

​

output_count

​

​

​

Integer

​

​

100

​

​

大模型输出的内容所消耗的 Token 数。

​

​

​

token_count

​

​

​

Integer

​

​

150

​

​

本次 API 调用消耗的 Token 总量，包括输入和输出两部分的消耗。

​

​

​

​

Interrupt 事件

​

Interrupt 事件中，data 的结构如下：

​

​

参数名

​

参数类型

​

参数描述

​

interrupt_data

​

Object

​

中断控制内容。

​

interrupt_data.event_id

​

String

​

工作流中断事件 ID，恢复运行时应回传此字段，具体请参见

​

流式恢复运行工作流

。

​

interrupt_data.type

​

Integer

​

工作流中断类型，恢复运行时应回传此字段，具体请参见

​

流式恢复运行工作流

。

​

interrupt_data.required_parameters

​

map<String,WorkflowParameter>

​

工作流中断时需要补充的参数信息，采用键值对（key-value）结构：key为参数名称，value为该参数的值。

​

​

node_title

​

String

​

输出消息的节点名称，例如“问答”。

​

​

Error 事件

​

Error 事件中，data 的结构如下：

​

​

参数名

​

参数类型

​

参数描述

​

error_code

​

Integer

​

调用状态码。

​

0 表示调用成功。

​

其他值表示调用失败。你可以通过 error_message 字段判断详细的错误原因。

​

error_message

​

String

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

​

​

​

示例

​

请求示例

​

​

Shell

复制

curl --location --request POST 'https://api.coze.cn/v1/workflow/stream_run' \

​

--header 'Authorization: Bearer pat_fhwefweuk****' \

​

--header 'Content-Type: application/json' \

​

--data-raw '{

​

"workflow_id": "73664689170551*****",

​

"parameters": {

​

"user_name":"George"

​

}

​

}'

​

​

响应示例

​

Message 事件

Error 事件

Interrupt 事件

​

JSON

复制

id

:

0

​

event

:

Message

​

data

:

{

"content"

:

"msg"

,

"node_is_finish"

:

false

,

"node_seq_id"

:

"0"

,

"node_title"

:

"Message"

}

​

​

id

:

1

​

event

:

Message

​

data

:

{

"content"

:

"为"

,

"node_is_finish"

:

false

,

"node_seq_id"

:

"1"

,

"node_title"

:

"Message"

}

​

​

id

:

2

​

event

:

Message

​

data

:

{

"content"

:

"什么小明要带一把尺子去看电影？\n因"

,

"node_is_finish"

:

false

,

"node_seq_id"

:

"2"

,

"node_title"

:

"Message"

}

​

​

id

:

3

​

event

:

Message

​

data

:

{

"content"

:

"为他听说电影很长，怕"

,

"node_is_finish"

:

false

,

"node_seq_id"

:

"3"

,

"node_title"

:

"Message"

}

​

​

id

:

4

​

event

:

Message

​

data

:

{

"content"

:

"坐不下！"

,

"node_is_finish"

:

true

,

"node_seq_id"

:

"4"

,

"node_title"

:

"Message"

}

​

​

id

:

5

​

event

:

Message

​

data

:

{

"content"

:

"{\"output\":\"为什么小明要带一把尺子去看电影？\\n因为他听说电影很长，怕坐不下！\"}"

,

"cost"

:

"0.00"

,

"node_is_finish"

:

true

,

"node_seq_id"

:

"0"

,

"node_title"

:

""

,

"token"

:

0

}

​

​

id

:

6

​

event

:

Done

​

data

:

{}

​

​

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

​

错误码

文档查看对应的解决方法。

​

​

上一篇

执行工作流

下一篇

恢复运行工作流（流式响应）
============================================================
# 恢复运行工作流（流式响应）
来源: https://www.coze.cn/open/docs/developer_guides/workflow_resume
============================================================

恢复运行工作流（流式响应）

流式恢复运行已中断的工作流。

​

接口说明

​

执行包含问答节点的工作流时，智能体会以指定问题向用户提问，并等待用户回答。此时工作流为中断状态，开发者需要调用此接口回答问题，并恢复运行工作流。如果用户的响应和智能体预期提取的信息不匹配，例如缺少必选的字段，或字段数据类型不一致，工作流会再次中断并追问。如果询问 3 次仍未收到符合预期的回复，则判定为工作流执行失败。

​

恢复运行工作流（流式响应）

和

恢复运行工作流

的区别如下：

​

如果调用

执行工作流（流式响应）

API，中断恢复时需要使用

恢复运行工作流（流式响应）

API，该 API 通过流式返回执行结果。

​

如果调用

执行工作流

API，中断恢复时需要使用

恢复运行工作流

API，该 API 支持同步运行或异步运行返回执行结果。

​

限制说明

​

最多调用此接口恢复运行 3 次，如果第三次恢复运行时智能体仍未收到符合预期的回复，则判定为工作流执行失败。

​

恢复运行后，index 和节点 index 都会重置。

​

恢复运行工作流也会产生 token 消耗，且与

执行工作流（流式响应）

时消耗的 token 数量相同。

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/workflow/stream_resume

​

​

权限

​

run

​

确保调用该接口使用的访问令牌开通了 run 权限，详细信息参考

鉴权方式

。

​

接口说明

​

恢复运行已中断的工作流。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

workflow_id

​

String

​

必选

​

73505836754923***

​

待执行的 Workflow ID，此工作流应已发布。

​

进入 Workflow 编排页面，在页面 URL 中，workflow 参数后的数字就是 Workflow ID。例如

https://www.coze.com/work_flow?space_id=42463***&workflow_id=73505836754923***

，Workflow ID 为 73505836754923***。

​

event_id

​

String

​

必选

​

74048319882025***

​

工作流执行中断事件 ID。你可以从

执行工作流（流式响应）

的响应信息中获得中断事件 ID。

​

interrupt_type

​

Integer

​

必选

​

2

​

工作流执行中断的类型，用于标识导致工作流中断的具体原因，你可以从

执行工作流

的响应信息中获得中断事件的中断类型。枚举值：

​

6

：端插件触发中断。

​

2

：问答节点触发中断。

​

5

：输入节点触发中断。

​

7

：OAuth 插件触发中断。

​

resume_data

​

String

​

必选

​

杭州，2024-08-20

​

恢复执行时，用户对智能体指定问题的回复。

​

如果是问答节点导致的中断，回复中应包含问答节点中的必选参数，否则工作流会再次中断并提问。

​

如果要传入 Image 等类型的文件，可以调用

上传文件

​

上传文件

API 获取 file_id，在调用此 API 时在 resume_data 中以序列化之后的 JSON 格式传入 file_id。例如

“resume_data” : "{\"file_id\": \"1456234***\"}"

。

​

​

返回参数

​

​

说明

在流式响应中，开发者需要注意是否存在丢包现象。

​

事件 ID（id）默认从 0 开始计数，以包含

event: Done

的事件为结束标志。开发者应根据 id 确认响应消息整体无丢包现象。

​

Message 事件的消息 ID 默认从 0 开始计数，以包含

node_is_finish : true

的事件为结束标志。开发者应根据 node_seq_id 确认 Message 事件中每条消息均完整返回，无丢包现象。

​

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

0

​

此消息在接口响应中的事件 ID。以 0 为开始。

​

event

​

String

​

Message

​

当前流式返回的数据包事件。包括以下类型：

​

Message：工作流节点输出消息，例如输出节点、结束节点的输出消息。可以在 data 中查看具体的消息内容。

​

Error：报错。可以在 data 中查看 error_code 和 error_message，排查问题。

​

Done：结束。表示工作流执行结束，此时 data 中包含。

​

Interrupt：中断。表示工作流中断，此时 data 字段中包含具体的中断信息。

​

node_seq_id

​

String

​

0

​

此消息在节点中的消息 ID，从 0 开始计数，例如输出节点的第 5 条消息。

​

node_title

​

String

​

End

​

输出消息的节点名称，例如输出节点、结束节点。

​

content

​

String

​

请问你想查看哪个城市、哪一天的天气呢

​

流式输出的消息内容。

​

node_is_finish

​

Boolean

​

true

​

当前消息是否为此节点的最后一个数据包。

​

interrupt_data

​

Object of

Interrupt

​

{"data":"","event_id":"7404831988202520614/6302059919516746633","type":2}

​

content type为interrupt时传输，中断协议

​

cost

​

String

​

0

​

预留字段，无需关注。

​

error_code

​

Long

​

0

​

调用状态码。

​

0 表示调用成功。

​

其他值表示调用失败。你可以通过 error_message 字段判断详细的错误原因。

​

error_message

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

usage

​

Object of

Usage

​

​

资源使用情况。

​

detail

​

Object of

ResponseDetail

​

20241210152726467C48D89D6DB2****

​

响应详情。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

​

Interrupt

​

​

参数

​

类型

​

示例

​

说明

​

data

​

String

​

{\"content_type\":\"text\",\"content\":\"[{\\\"type\\\":\\\"string\\\",\\\"name\\\":\\\"img\\\",\\\"required\\\":true,\\\"assistType\\\":2}]\"}

​

中断控制内容，用于在工作流中断时传递控制信息。当工作流需要用户输入或执行特定操作时，通过此字段传递相关信息。

​

type

​

Integer

​

2

​

工作流中断类型，调用

恢复运行工作流

API 恢复运行时应回传此字段。

​

枚举值：

​

6

：端插件触发中断。

​

2

：问答节点触发中断。

​

5

：输入节点触发中断。

​

7

：OAuth 插件触发中断。

​

event_id

​

String

​

740483198820252***

​

工作流中断事件 ID，调用

恢复运行工作流

API 恢复运行时应回传此字段。

​

required_parameters

​

JSON Map

​

{ "img": { "required": true, "type": "image" } }

​

工作流中断时需要补充的参数信息，采用键值对（key-value）结构，其中 key 为输入节点对应的参数名称，value 为该参数的定义信息（包含类型、是否必填等属性）。

​

​

RequiredParameters

​

​

参数

​

类型

​

示例

​

说明

​

type

​

String

​

string

​

该参数的类型。

​

items

​

Object of

OpenAPIParameter

​

{"type":"image"}

​

当参数类型为

array

时，该字段用于定义数组元素的子类型。

​

required

​

Boolean

​

true

​

标识输入参数是否为必填项。

​

true

：该参数为必填项。

​

false

：该参数为可选项。

​

properties

​

JSON Map

​

{ "arr_obj_num": { "required": false, "type": "number" } }

​

当参数类型为

object

时，该字段用于定义对象类型的子参数信息，采用键值对（key-value）结构，其中 key 为子参数的名称，value 为该子参数的定义信息（包含类型、是否必填等属性）。

​

description

​

String

​

上传的图片。

​

该参数的描述信息。

​

default_value

​

String

​

-

​

该参数配置的默认值。

​

​

Usage

​

​

参数

​

类型

​

示例

​

说明

​

input_count

​

Integer

​

50

​

输入内容所消耗的 Token 数，包含对话上下文、系统提示词、用户当前输入等所有输入类的 Token 消耗。

​

output_count

​

Integer

​

100

​

大模型输出的内容所消耗的 Token 数。

​

token_count

​

Integer

​

150

​

本次 API 调用消耗的 Token 总量，包括输入和输出两部分的消耗。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location 'https

:

//api.coze.cn/v1/workflow/stream_resume' \

​

--header 'Authorization

:

Bearer pat_vTG1****' \

​

--header 'Content-Type

:

application/json' \

​

--data '

{

​

"event_id"

:

"740483727529459****/433802199567434****"

,

​

"interrupt_type"

:

2

,

​

"resume_data"

:

"杭州，2024-08-20"

,

​

"workflow_id"

:

"739739507914235****"

​

}

'

​

返回示例

​

​

JSON

复制

id

:

0

​

event

:

Message

​

data

:

{

"content"

:

"{\"output\":[{\"condition\":\"中到大雨\",\"humidity\":72,\"predict_date\":\"2024-08-20\",\"temp_high\":35,\"temp_low\":26,\"weather_day\":\"中到大雨\",\"wind_dir_day\":\"西风\",\"wind_dir_night\":\"西风\",\"wind_level_day\":\"3\",\"wind_level_night\":\"3\"}]}"

,

"content_type"

:

"text"

,

"cost"

:

"0"

,

"node_is_finish"

:

true

,

"node_seq_id"

:

"0"

,

"node_title"

:

"End"

,

"token"

:

386

}

​

id

:

1

​

event

:

Done

​

data

:

{}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

执行工作流（流式响应）

下一篇

恢复运行工作流
============================================================
# 恢复运行工作流
来源: https://www.coze.cn/open/docs/developer_guides/resume_workflow
============================================================

恢复运行工作流

恢复运行工作流。

​

接口说明

​

当调用

执行工作流

API 执行包含问答节点、输入节点的工作流时，智能体会以指定问题向用户提问，并等待用户回答。此时工作流为中断状态，开发者需要调用此 API 回答问题，并恢复运行工作流。如果问答节点勾选了

从回复中提取字段

，当用户的响应和智能体预期提取的信息不匹配，例如缺少必选的字段，或字段数据类型不一致，工作流会再次中断并追问。

​

如果

执行工作流

API 为同步运行，则恢复运行工作流也为同步运行。如果

执行工作流

API 为异步运行，则恢复运行工作流也为异步运行，你还需要调用

查询异步执行结果

API 查询执行结果。

​

恢复运行工作流（流式响应）

和

恢复运行工作流

的区别如下：

​

如果调用

执行工作流（流式响应）

API 时工作流中断，恢复时需要使用

恢复运行工作流（流式响应）

API，该 API 通过流式返回执行结果。

​

如果调用

执行工作流

API 时工作流中断，恢复时需要使用

恢复运行工作流

API，该 API 支持同步运行或异步运行返回执行结果。

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/workflows/resume

​

​

权限

​

run

​

确保调用该接口使用的访问令牌开通了

run

权限，详细信息参考

鉴权方式

。

​

接口说明

​

恢复运行工作流。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

workflow_id

​

String

​

必选

​

73505836754923***

​

待执行的 Workflow ID，此工作流应已发布。

​

进入 Workflow 编排页面，在页面 URL 中，workflow 参数后的数字就是 Workflow ID。例如

https://www.coze.com/work_flow?space_id=42463***&workflow_id=73505836754923***

，Workflow ID 为

73505836754923***

。

​

event_id

​

String

​

必选

​

74048319882025***

​

工作流执行中断事件 ID。你可以从

执行工作流

的响应信息中获得中断事件 ID。

​

resume_data

​

String

​

必选

​

杭州，2024-08-20

​

恢复执行时，用户对智能体指定问题的回复。

​

如果是问答节点或输入节点导致的中断，回复中应包含对应节点中的必选参数，否则工作流会再次中断并提问。

​

如果要传入 Image 等类型的文件，可以调用

上传文件

API 获取 file_id，在调用此 API 时在 resume_data 中以序列化之后的 JSON 格式传入 file_id。例如

“resume_data” : "{\"file_id\": \"1456234***\"}"

。

​

interrupt_type

​

Integer

​

必选

​

2

​

工作流执行中断的类型，用于标识导致工作流中断的具体原因，你可以从

执行工作流

的响应信息中获得中断事件的中断类型。枚举值：

​

6

：端插件触发中断。

​

2

：问答节点触发中断。

​

5

：输入节点触发中断。

​

7

：OAuth 插件触发中断。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

String

​

{\"output\":\"杭州当天的天气为小雨。\"}

​

同步运行时返回的工作流执行结果，通常为 JSON 序列化字符串，部分场景下可能返回非 JSON 结构的字符串。

​

debug_url

​

String

​

https://www.coze.cn/work_flow?execute_id=743104097880585****&space_id=730976060439760****&workflow_id=742963539464539****

​

工作流试运行调试页面。访问此页面可查看每个工作流节点的运行结果、输入输出等信息。

​

说明

debug_url 的访问有效期为 7 天，过期后将无法访问。

​

​

usage

​

Object of

Usage

​

{"input_count":50,"token_count":150,"output_count":100}

​

本次 API 调用消耗的 Token 数量。

​

此处大模型返回的消耗 Token 仅供参考，以

火山引擎账单

实际为准。

​

interrupt_data

​

Object of

Interrupt

​

{"data":"{\"content_type\":\"text\",\"content\":\"请输入您的姓名\"}","type":2,"event_id":"740483198820252***","required_parameters":{"name":{"type":"string","required":true}}}

​

中断事件的详细信息，包含中断控制内容、中断类型和事件 ID 等信息。

​

execute_id

​

String

​

743104097880585****

​

异步运行时的事件 ID。如果

执行工作流

为异步运行时，本 API 也为异步运行，响应信息中会返回 execute_id。

​

调用

查询异步执行结果

API 时需要传入此 ID，查询工作流的执行状态或结果。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含本次请求的日志信息，用于问题排查和技术支持。

​

​

Usage

​

​

参数

​

类型

​

示例

​

说明

​

input_count

​

Integer

​

50

​

输入内容所消耗的 Token 数，包含对话上下文、系统提示词、用户当前输入等所有输入类的 Token 消耗。

​

output_count

​

Integer

​

100

​

大模型输出的内容所消耗的 Token 数。

​

token_count

​

Integer

​

150

​

本次 API 调用消耗的 Token 总量，包括输入和输出两部分的消耗。

​

​

Interrupt

​

​

参数

​

类型

​

示例

​

说明

​

data

​

String

​

{\"content_type\":\"text\",\"content\":\"[{\\\"type\\\":\\\"string\\\",\\\"name\\\":\\\"img\\\",\\\"required\\\":true,\\\"assistType\\\":2}]\"}

​

中断控制内容，用于在工作流中断时传递控制信息。当工作流需要用户输入或执行特定操作时，通过此字段传递相关信息。

​

type

​

Integer

​

2

​

工作流中断类型，调用

恢复运行工作流

API 恢复运行时应回传此字段。

​

枚举值：

​

6

：端插件触发中断。

​

2

：问答节点触发中断。

​

5

：输入节点触发中断。

​

7

：OAuth 插件触发中断。

​

event_id

​

String

​

740483198820252***

​

工作流中断事件 ID，调用

恢复运行工作流

API 恢复运行时应回传此字段。

​

required_parameters

​

JSON Map

​

{ "img": { "required": true, "type": "image" } }

​

工作流中断时需要补充的参数信息，采用键值对（key-value）结构，其中 key 为输入节点对应的参数名称，value 为该参数的定义信息（包含类型、是否必填等属性）。

​

​

RequiredParameters

​

​

参数

​

类型

​

示例

​

说明

​

type

​

String

​

string

​

该参数的类型。

​

items

​

Object of

OpenAPIParameter

​

{"type":"image"}

​

当参数类型为

array

时，该字段用于定义数组元素的子类型。

​

required

​

Boolean

​

true

​

标识输入参数是否为必填项。

​

true

：该参数为必填项。

​

false

：该参数为可选项。

​

properties

​

JSON Map

​

{ "arr_obj_num": { "required": false, "type": "number" } }

​

当参数类型为

object

时，该字段用于定义对象类型的子参数信息，采用键值对（key-value）结构，其中 key 为子参数的名称，value 为该子参数的定义信息（包含类型、是否必填等属性）。

​

description

​

String

​

上传的图片。

​

该参数的描述信息。

​

default_value

​

String

​

-

​

该参数配置的默认值。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/workflows/resume' \

​

--header 'Authorization

:

Bearer pat_I6w8e****' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"event_id"

:

"75683404684*****/25042098367****"

,

​

"interrupt_type"

:

2

,

​

"resume_data"

:

"{\"file_id\": \"1456234***\"}"

,

​

"workflow_id"

:

"73505836754923***"

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"debug_url"

:

"https://api.coze.cn/work_flow?execute_id=756949870377***&space_id=75687968944***&workflow_id=75688742653***&execute_mode=2"

,

​

"interrupt_data"

:

{

​

"data"

:

"{\"content_type\":\"text\",\"content\":\"[{\\\"type\\\":\\\"string\\\",\\\"name\\\":\\\"img\\\",\\\"required\\\":true,\\\"assistType\\\":2}]\"}"

,

​

"required_parameters"

:

{

​

"img"

:

{

​

"required"

:

true

,

​

"type"

:

"image"

​

}

​

},

​

"event_id"

:

"75694987037***/2691977632***"

,

​

"type"

:

5

​

},

​

"execute_id"

:

"7569498703774***"

,

​

"detail"

:

{

​

"logid"

:

"202511061720005429856FA5***"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

恢复运行工作流（流式响应）

下一篇

查询工作流异步运行结果
============================================================
# 查询工作流异步运行结果
来源: https://www.coze.cn/open/docs/developer_guides/workflow_history
============================================================

查询工作流异步运行结果

工作流异步运行后，查看执行结果。

​

接口说明

​

调用

执行工作流

或

恢复运行工作流

API 时，如果选择异步运行工作流，响应信息中会返回 execute_id，开发者可以通过本 API 查询指定事件的执行结果。

​

限制说明

​

本 API 的流控限制请参见

API 介绍

。

​

工作流的

输出节点

的输出数据最多保存 24 小时，

结束节点

为 7 天。

​

输出节点的输出内容超过 1MB 时，无法保证返回内容的完整性。

​

基础信息

​

​

请求方式

​

GET

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/workflows/:workflow_id/run_histories/:execute_id

​

权限

​

listRunHistory

​

确保调用该接口使用的访问令牌开通了

listRunHistory

权限，详细信息参考

鉴权方式

。

​

接口说明

​

工作流异步运行后，查看执行结果。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

workflow_id

​

String

​

可选

​

73505836754923***

​

待执行的 Workflow ID，此工作流应已发布。

​

进入 Workflow 编排页面，在页面 URL 中，workflow 参数后的数字就是 Workflow ID。例如

https://www.coze.com/work_flow?space_id=42463***&workflow_id=73505836754923***

，Workflow ID 为

73505836754923***

。

​

execute_id

​

String

​

可选

​

743104097880585****

​

工作流执行 ID。调用接口

执行工作流

，如果选择异步执行工作流，响应信息中会返回 execute_id。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Array of

WorkflowExecuteHistory

​

\

​

异步工作流的执行结果。

​

每次只能查询一个异步事件的执行结果，所以此数组只有一个对象。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

本次请求的执行详情。

​

​

WorkflowExecuteHistory

​

​

参数

​

类型

​

示例

​

说明

​

execute_id

​

String

​

743104097880585****

​

工作流执行 ID。

​

execute_status

​

String

​

Success

​

执行状态。

​

Success：执行成功。

​

Running：执行中。

​

Fail：执行失败。

​

bot_id

​

String

​

75049216555930****

​

执行工作流时指定的 Agent ID。返回 0 表示未指定智能体 ID。

​

connector_id

​

String

​

1024

​

智能体的发布渠道 ID，默认仅显示 Agent as API 渠道，渠道 ID 为 1024。

​

connector_uid

​

String

​

123

​

用户 UID，执行工作流时通过 ext 字段指定的 user_id。如果未指定，则返回 Token 申请人的扣子用户 UID。

​

run_mode

​

Integer

​

0

​

工作流的运行方式：

​

0：同步运行。

​

1：流式运行。

​

2：异步运行。

​

output

​

String

​

{\"Output\":\"{\\\"content_type\\\":1,\\\"data\\\":\\\"来找姐姐有什么事呀\\\",\\\"original_result\\\":null,\\\"type_for_model\\\":2}\"}

​

工作流的输出，通常为 JSON 序列化字符串，也有可能是非 JSON 结构的字符串。

​

工作流输出的内容包括：

​

输出节点的输出。

​

结束节点的输出。在扣子编程代码中，结束节点的输出是通过键（key）

Output

来标识。

​

工作流输出的结构如下所示：

​

​

JSON

复制

{

​

"Output"

:

"结束节点的输出内容"

,

​

"输出节点_1"

:

"输出节点_1的输出内容"

,

​

"输出节点_2"

:

"输出节点_2的输出内容"

​

}

​

​

create_time

​

Long

​

1730174063

​

工作流运行开始时间，Unixtime 时间戳格式，单位为秒。

​

update_time

​

Long

​

1730174063

​

工作流的恢复运行时间，Unixtime 时间戳格式，单位为秒。

​

node_execute_status

​

JSON Map

​

\

​

输出节点的运行情况。字段的格式为：

key:node_status,value:map[node_title]*nodeExecuteStatus{}

。

​

key

为节点的名称，如果节点运行了多次，则会随机生成节点名称。

​

说明

当输出节点的输出内容超过 1MB 时，调用本 API 会导致返回内容不完整，建议通过

查询工作流节点的输出

API 逐一查询各节点的输出内容。

​

​

error_code

​

String

​

""

​

执行失败调用状态码。0 表示调用成功。其他值表示调用失败。你可以通过 error_message 字段判断详细的错误原因。

​

debug_url

​

String

​

https://www.coze.cn/work_flow?execute_id=743104097880585****&space_id=730976060439760****&workflow_id=742963539464539****

​

工作流试运行调试页面。访问此页面可查看每个工作流节点的运行结果、输入输出等信息。

​

说明

debug_url 的访问有效期为 7 天，过期后将无法访问。

​

​

usage

​

Object of

Usage

​

{"input_count":50,"token_count":150,"output_count":100}

​

本次 API 调用消耗的 Token 数量。

​

此处大模型返回的消耗 Token 仅供参考，以

火山引擎账单

实际为准。

​

is_output_trimmed

​

Boolean

​

false

​

标识工作流的输出内容是否因过大而不完整。

​

true

：输出内容因过大被截断。

​

false

：输出内容完整。

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

error_message

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

interrupt_data

​

Object of

Interrupt

​

{"data":"{\"content_type\":\"text\",\"content\":\"请输入您的姓名\"}","type":2,"event_id":"740483198820252***","required_parameters":{"name":{"type":"string","required":true}}}

​

中断事件的详细信息，包含中断控制内容、中断类型和事件 ID 等信息。

​

​

NodeExecuteStatus

​

​

参数

​

类型

​

示例

​

说明

​

node_id

​

String

​

node_123

​

工作流中的节点 ID。

​

is_finish

​

Boolean

​

true

​

工作流中的节点是否已经运行结束。

​

loop_index

​

Long

​

2

​

当前节点在循环节点中的循环次数。

​

第一次循环时值为

0

。

​

说明

仅当节点为循环节点，且未嵌套子工作流时，才会返回该参数。

​

​

batch_index

​

Long

​

3

​

当前节点在批处理节点中的执行次数。

​

第一次执行时值为

0

。

​

说明

仅当节点为批处理节点，且未嵌套子工作流时，才会返回该参数。

​

​

update_time

​

Long

​

1730174063

​

工作流上次运行的时间，采用 Unix 时间戳格式，单位为秒。

​

sub_execute_id

​

String

​

743104097880585****

​

子工作流执行的 ID。

​

node_execute_uuid

​

String

​

78923456777*****

​

节点每次执行的 ID，用于追踪和识别工作流中特定节点的单次执行情况。

​

​

Usage

​

​

参数

​

类型

​

示例

​

说明

​

input_count

​

Integer

​

50

​

输入内容所消耗的 Token 数，包含对话上下文、系统提示词、用户当前输入等所有输入类的 Token 消耗。

​

output_count

​

Integer

​

100

​

大模型输出的内容所消耗的 Token 数。

​

token_count

​

Integer

​

150

​

本次 API 调用消耗的 Token 总量，包括输入和输出两部分的消耗。

​

​

Interrupt

​

​

参数

​

类型

​

示例

​

说明

​

data

​

String

​

{\"content_type\":\"text\",\"content\":\"[{\\\"type\\\":\\\"string\\\",\\\"name\\\":\\\"img\\\",\\\"required\\\":true,\\\"assistType\\\":2}]\"}

​

中断控制内容，用于在工作流中断时传递控制信息。当工作流需要用户输入或执行特定操作时，通过此字段传递相关信息。

​

type

​

Integer

​

2

​

工作流中断类型，调用

恢复运行工作流

API 恢复运行时应回传此字段。

​

枚举值：

​

6

：端插件触发中断。

​

2

：问答节点触发中断。

​

5

：输入节点触发中断。

​

7

：OAuth 插件触发中断。

​

event_id

​

String

​

740483198820252***

​

工作流中断事件 ID，调用

恢复运行工作流

API 恢复运行时应回传此字段。

​

required_parameters

​

JSON Map

​

{ "img": { "required": true, "type": "image" } }

​

工作流中断时需要补充的参数信息，采用键值对（key-value）结构，其中 key 为输入节点对应的参数名称，value 为该参数的定义信息（包含类型、是否必填等属性）。

​

​

RequiredParameters

​

​

参数

​

类型

​

示例

​

说明

​

type

​

String

​

string

​

该参数的类型。

​

items

​

Object of

OpenAPIParameter

​

{"type":"image"}

​

当参数类型为

array

时，该字段用于定义数组元素的子类型。

​

required

​

Boolean

​

true

​

标识输入参数是否为必填项。

​

true

：该参数为必填项。

​

false

：该参数为可选项。

​

properties

​

JSON Map

​

{ "arr_obj_num": { "required": false, "type": "number" } }

​

当参数类型为

object

时，该字段用于定义对象类型的子参数信息，采用键值对（key-value）结构，其中 key 为子参数的名称，value 为该子参数的定义信息（包含类型、是否必填等属性）。

​

description

​

String

​

上传的图片。

​

该参数的描述信息。

​

default_value

​

String

​

-

​

该参数配置的默认值。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v1/workflows/742963539464539****/run_histories/743104097880585****' \

​

--header 'Authorization

:

Bearer pat_xitq9LWlowpX3qGCih1lwpAdzvXNqgmpfhpV28HLWFypY37xR5Uaj2GioN****' \

​

--header 'Content-Type

:

application/json'

​

​

返回示例

​

​

JSON

复制

{

​

"detail"

:

{

​

"logid"

:

"20241029152003BC531DC784F1897B****"

​

},

​

"code"

:

0

,

​

"msg"

:

""

,

​

"data"

:

[

​

{

​

"update_time"

:

1730174065

,

​

"usage"

:

{

​

"input_count"

:

50

,

​

"token_count"

:

150

,

​

"output_count"

:

100

​

},

​

"output"

:

"{\"Output\":\"{\\\"content_type\\\":1,\\\"data\\\":\\\"来找姐姐有什么事呀\\\",\\\"original_result\\\":null,\\\"type_for_model\\\":2}\"}"

,

​

"bot_id"

:

"742963486232569****"

,

​

"token"

:

"0"

,

​

"execute_status"

:

"Success"

,

​

"connector_uid"

:

"223687073464****"

,

​

"run_mode"

:

0

,

​

"connector_id"

:

"1024"

,

​

"logid"

:

"20241029115423ED85C3401395715F726E"

,

​

"debug_url"

:

"https://www.coze.cn/work_flow?execute_id=743104097880585****&space_id=730976060439760****&workflow_id=742963539464539****"

,

​

"error_code"

:

""

,

​

"error_message"

:

""

,

​

"execute_id"

:

"743104097880585****"

,

​

"create_time"

:

1730174063

​

}

​

]

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

恢复运行工作流

下一篇

执行对话流
============================================================
# 执行对话流
来源: https://www.coze.cn/open/docs/developer_guides/workflow_chat
============================================================

执行对话流

执行已发布的对话流。

​

接口说明

​

对话流是基于对话场景的特殊工作流，专门

用于处理对话类请求。对话流通过对话的方式和用户交互，并完成复杂的业务逻辑。

在应用中添加对话流，将对话中的用户指令拆分为一个个步骤节点，并为其设计用户界面，你可以搭建出适用于移动端或网页端的对话式 AI 应用，

实现自动化、智能化的对话流程。

关于对话流的详细说明可参考

​

工作流与对话流

。

​

此接口为流式响应模式，允许客户端在接收到完整的数据流之前就开始处理数据，例如在对话界面实时展示回复内容，减少客户端等待模型完整回复的时间。

​

此接口支持包括问答节点、输入节点等可能导致对话中断的节点，对话中断时只需再次调用对话流，在 additional_messages 中指定输入内容，即可继续对话。

​

说明

如果对话流的输入中包含文件、图片等多模态内容，需要先上传多模态内容以获取文件 ID 或 URL 地址，再将其作为对话流的输入。上传方式包括：

​

调用

上传文件

API，获取文件 ID，将此 ID 作为对话流的输入。

​

上传到第三方存储工具中，并获取一个公开可访问的 URL 地址，将此 URL 作为对话流的输入。

​

调用接口后，你可以从响应的 Done 事件中获得 debug_url，访问链接即可通过可视化界面查看对话流的试运行过程，其中包含每个执行节点的输入输出等详细信息，帮助你在线调试或排障。debug_url 的访问有效期为 7 天，过期后将无法访问。

​

​

此接口可用于调用空间资源库中的对话流，或低代码应用中的对话流。调用这两种对话流时，入参不同：

​

​

入参

​

资源库对话流

​

​

低代码应用中的对话流

​

​

在智能体中执行

​

在低代码应用中执行

​

​

workflow_id

​

必选

​

必选

​

必选

​

app_id

​

不传

​

必选

​

必选

​

bot_id

​

必选

​

不传

​

不传

​

conversation_id

​

可选

​

可选

​

可选

​

​

限制说明

​

通过 API 方式执行对话流前，应确认此对话流已发布，执行从未发布过的对话流时会返回错误码 4200。如果是低代码应用中的对话流，应先发布低代码应用为 API 服务；如果是空间资源库中的对话流，应先在资源库中发布对话流。

​

此接口暂不支持异步运行。

​

对话流中不支持提交端插件结果。

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

​

Plain Text

复制

https://

api.coze.cn

/v1/workflows/chat

​

​

权限

​

run

​

确保调用该接口使用的令牌开通了

run

权限，详细信息参考

​

鉴权方式概述

。

​

接口说明

​

执行已发布的对话流。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

​

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

workflow_id

​

String

​

必选

​

73505836754923***

​

待执行的对话流 ID，此对话流应已发布。

​

进入对话流编排页面，在页面 URL 中，

workflow

参数后的数字就是 Workflow ID。例如

https://

www.coze.cn

/work_flow?space_id=42463***&workflow_id=73505836754923***

，Workflow ID 为

73505836754923***

。

​

additional_messages

​

​

​

Array of additional_messages object

​

​

必选

​

​

[ { "role": "user", "content_type": "text", "content": "你好" } ]

​

对话中用户问题和历史消息。数组长度限制为 50，即最多传入 50 条消息。

​

你需要通过此字段传入本次对话中用户的问题，也就是对话流的输入参数 USER_INPUT 的值。

​

可以同时传入多条历史消息，也就是本次对话的上下文。多条消息应按对话顺序排列，最后一条消息应为 role=user 的记录，也就是本次对话中用户的问题；其他消息为历史消息。

​

说明

对话流执行到问答节点、输入节点等节点时可能导致对话中断，此时只需再次调用对话流，在 additional_messages 中指定输入内容即可继续对话。

​

​

parameters

​

map[String]any

​

必选

​

{"image": "{\"file_id\":\"1122334455\"}","user_name":"George"}

​

设置对话流输入参数中的自定义参数。以 JSON 序列化字符串形式传入。你可以在指定对话流的编排页面查看自定义输入参数列表。

​

设置文件类型的自定义参数

​

如果对话流输入参数为 Image 等类型的文件，你可以传入文件 URL 或调用

上传文件

API 获取 file_id 后传入 file_id。示例：

​

上传文件并传入 file_id：

​

单个文件示例：

"parameters": { "image": "{\"file_id\":\"1122334455\"}" }

​

文件数组示例：

"parameters": { "image": [ "{\"file_id\":\"1122334455\"}" ] }

。

​

传入文件 URL：

“parameters” :{"input":"请总结图片内容", "image": "

https://example.com/tos-cn-i-mdko3gqilj/example.png

" }

​

会话名称绑定

​

你可以通过输入参数中的

CONVERSATION_NAME

绑定对应的会话名称，对话流产生的消息将保存到该会话中。推荐使用

conversation_id

绑定会话。

​

生效范围

：此设置仅对低代码应用中的对话流生效。对于资源库对话流，你需要同时传入

app_id

以关联一个低代码应用，该设置才会生效。

​

获取方法

：你可以在应用编排页面的会话管理中查看会话名称，或通过工作流中的

查询会话列表

节点查询会话名称。

​

​

​

​

​

​

说明

对话流的输入参数  USER_INPUT 应在 additional_messages 中传入，在 parameters 中的 USER_INPUT 不生效。

​

如果 parameters 中未指定 CONVERSATION_NAME 或自定义输入参数，则使用参数默认值运行对话流；如果指定了这些参数，则使用指定值。

​

​

app_id

​

String

​

可选

​

744208683**

​

需要关联的低代码应用 ID。调用对话流时，必须指定 app_id 或 bot_id，便于模型调用智能体或应用的数据库、变量等数据处理问题。

​

进入应用开发界面，开发页面URL中的project-ide参数后的数字就是AppID，例如

https://

www.coze.cn

/space/74421656*****/project-ide/744208683**

，低代码应用 ID 为

744208683**

。

​

说明

运行低代码应用中的对话流时，app_id 必选。详细说明可参考

​

接口说明

。

​

​

bot_id

​

​

String

​

​

可选

​

​

75049216555930****

​

需要关联的智能体 ID。 调用对话流时，必须指定 app_id 或 bot_id，便于模型调用智能体或应用的数据库、变量等数据处理问题。

​

进入智能体开发页面，开发页面 URL 中

bot

参数后的数字就是智能体 ID。例如

https://

www.coze.cn

/space/73428668341****/bot/73428668*****

，bot ID 为

73428668*****

。

​

说明

运行资源库中的对话流时，根据对话流执行的位置（智能体或低代码应用）选择设置 bot_id 还是 app_id。详细说明可参考

​

接口说明

。

​

​

conversation_id

​

String

​

可选

​

748348012449138****

​

对话流对应的会话 ID，对话流产生的消息会保存到此会话中。会话默认为开始节点设置的 CONVERSATION_NAME，也可以通过 conversation_id 参数指定会话。

​

说明

指定 conversation_id 时，parameters 中设置的 CONVERSATION_NAME 不生效。

​

会话的创建者必须和执行对话流的用户一致，即 API 访问令牌的创建者一致，否则无法执行对话流。

​

会话与 app_id、渠道匹配，不同渠道的会话隔离。

​

指定 bot_id 时，如果没有传入 conversation_id ，扣子编程会创建一个新的 conversation_id。不支持同时指定 bot_id 和 app_id。详细说明可参考

​

接口说明

。

​

​

ext

​

Map[String][String]

​

​

可选

​

{"latitude":"39.9042","longitude":"116.4074","user_id":"123456789"}

​

用于指定一些额外的字段，以 Map[String][String] 格式传入。例如某些插件会隐式用到的经纬度等字段。

​

目前仅支持以下字段：

​

latitude：String 类型，表示纬度。

​

longitude：String 类型，表示经度。

​

user_id：String 类型，表示用户 ID。

​

workflow_version

​

​

​

String

​

​

可选

​

​

v0.0.5

​

对话流的版本号，仅当运行的对话流属于资源库对话流时有效。未指定版本号时默认执行最新版本的对话流。

​

​

connector_id

​

String

​

​

可选

​

​

1024

​

​

渠道 ID，用于配置该对话流在什么渠道执行。

​

当智能体或低代码应用发布到某个渠道后，可以通过该参数指定对话流在对应的渠道执行。

​

扣子编程的渠道 ID 包括：

​

1024（默认值）：API 渠道。

​

999：Chat SDK。

​

998：WebSDK。

​

10000122：扣子商店。

​

10000113：微信客服。

​

10000120：微信服务号。

​

10000121：微信订阅号。

​

10000126：抖音小程序。

​

10000127：微信小程序。

​

10000011：飞书。

​

10000128：飞书多维表格。

​

10000117：掘金。

​

自定义渠道 ID。自定义渠道 ID 的获取方式如下：在扣子编程左下角单击头像，在

账号设置

>

发布渠道

>

企业自定义渠道管理

页面查看渠道 ID。

​

说明

不同渠道的用户数据、会话记录等相互隔离，进行数据分析统计时，不支持跨渠道数据调用。

​

​

additional_messages object

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

role

​

String

​

必选

​

user

​

发送这条消息的实体。取值：

​

user

：代表该条消息内容是用户发送的。

​

assistant

：代表该条消息内容是模型发送的。

​

type

​

​

String

​

可选

​

​

question

​

消息类型。默认为

question。

​

question

：用户输入内容。

​

answer

：模型返回给用户的消息内容，支持增量返回。如果对话流绑定了输出节点，可能会存在多 answer 场景，此时可以用流式返回的结束标志来判断所有 answer 完成。

​

function_call

：智能体对话过程中调用函数（function call）的中间结果。

​

tool_response

：调用工具 （function call）后返回的结果。

​

content

​

String

​

可选

​

北京今天的天气怎么样

​

消息的内容，仅支持纯文本。

​

如果需要通过

输入节点

输入消息，可通过如下两种格式：

​

JSON 格式的键值对，例如：

{"input":"北京今天的天气怎么样"}

。

​

用

\n

分隔的键值对，例如：

{key1:val1\nkey2:val2\nkey3:val3}

。

​

说明

暂不支持在

content

中输入多模态（文本、图片、文件混合输入）、卡片等类型的内容。

​

如果需要传入图片、文件等多模态内容，你可以在

parameters

中传入对应的自定义参数及其值。

​

​

content_type

​

String

​

可选

​

text

​

消息内容的类型。

​

content_type

固定为 text，表示普通文本。

​

说明

指定 content 时，应同时设置 content_type。

​

​

meta_data

​

Map

​

可选

​

{"key1":"value1", "key2":"value2"}

​

创建消息时的附加消息，获取消息时也会返回此附加消息。

​

自定义键值对，应指定为 Map 对象格式。长度为 16 对键值对，其中键（key）的长度范围为 1～64 个字符，值（value）的长度范围为 1～512 个字符。

​

​

返回参数

​

流式响应允许客户端在接收到完整的数据流之前就开始处理数据，例如在对话界面实时展示回复内容，减少客户端等待模型完整回复的时间。

​

流式响应的整体流程如下：

​

流式响应流程

流式响应示例

​

Plain Text

复制

######### 整体概览 （chat, MESSAGE 两级）

​

# chat - 开始

​

# chat - 处理中

​

#   MESSAGE - 知识库召回

​

#   MESSAGE - function_call

​

#   MESSAGE - tool_output

​

#   MESSAGE - answer is normal text

​

#   MESSAGE - 多 answer 的情况下，会继续有 message.delta

​

# chat - 完成

​

# 流结束 event: done

​

#########

​

​

​

返回的事件消息体结构如下：

​

​

参数

​

类型

​

说明

​

event

​

String

​

当前流式返回的数据包事件。在流式响应中，服务端不会一次性发送所有数据，而是以数据流的形式逐条发送数据给客户端，数据流中包含对话过程中触发的各种事件（event），直至处理完毕或处理中断。处理结束后，服务端会通过 conversation.message.completed 事件返回拼接后完整的模型回复信息。各个事件的说明可参考下表。

​

data

​

Object

​

消息内容。其中，chat 事件和 message 事件的格式不同。

​

chat 事件中，data 为

Chat

Object

。

​

message 事件中，data 为

Message

Object

。

​

​

流式响应事件列表：

​

​

事件（event）名称

​

说明

​

conversation.chat.created

​

创建对话的事件，表示对话开始。

​

conversation.chat.in_progress

​

服务端正在处理对话。

​

conversation.message.delta

​

增量消息，通常是 type=answer 时的增量消息。

​

conversation.message.completed

​

message 已回复完成。此时流式包中带有所有 message.delta 的拼接结果，且每个消息均为 completed 状态。

​

conversation.chat.completed

​

对话完成。

​

conversation.chat.failed

​

此事件用于标识对话失败。

​

conversation.chat.requires_action

​

对话中断，需要使用方上报工具的执行结果。通常是触发了问答节点或输入节点，需要再次调用此接口继续对话。

​

error

​

流式响应过程中的错误事件。关于 code 和 msg 的详细说明，可参考

​

错误码

。

​

done

​

本次会话的流式返回正常结束。

​

​

Chat Object

​

​

参数

​

类型

​

是否可选

​

说明

​

id

​

String

​

必填

​

对话 ID，即对话的唯一标识。

​

conversation_id

​

String

​

必填

​

会话 ID，即会话的唯一标识。

​

bot_id

​

String

​

必填

​

要进行会话聊天的智能体 ID。

​

created_at

​

Integer

​

选填

​

对话创建的时间。格式为 10 位的 Unixtime 时间戳，单位为秒。

​

completed_at

​

Integer

​

选填

​

对话结束的时间。格式为 10 位的 Unixtime 时间戳，单位为秒。

​

failed_at

​

Integer

​

选填

​

对话失败的时间。格式为 10 位的 Unixtime 时间戳，单位为秒。

​

meta_data

​

Map<String,String>

​

选填

​

创建消息时的附加消息，用于传入使用方的自定义数据，获取消息时也会返回此附加消息。

​

自定义键值对，应指定为 Map 对象格式。长度为 16 对键值对，其中键（key）的长度范围为 1～64 个字符，值（value）的长度范围为 1～512 个字符。

​

last_error

​

​

Object

​

选填

​

对话运行异常时，此字段中返回详细的错误信息，包括：

​

Code：错误码。Integer 类型。0 表示成功，其他值表示失败。

​

Msg：错误信息。String 类型。

​

说明

对话正常运行时，此字段返回 null。

​

suggestion 失败不会被标记为运行异常，不计入 last_error。

​

​

status

​

​

String

​

必填

​

对话的运行状态。取值为：

​

created：对话已创建。

​

in_progress：智能体正在处理中。

​

completed：智能体已完成处理，本次对话结束。

​

failed：对话失败。

​

requires_action：对话中断，需要进一步处理。

​

canceled：对话已取消。

​

required_action

​

Object

​

选填

​

需要运行的信息详情。

​

usage

​

Object

​

选填

​

Token 消耗的详细信息。实际的 Token 消耗以对话结束后返回的值为准。

​

»token_count

​

Integer

​

选填

​

本次对话消耗的 Token 总数，包括 input 和 output 部分的消耗。

​

»output_count

​

Integer

​

选填

​

output 部分消耗的 Token 总数。

​

»input_count

​

Integer

​

选填

​

input 部分消耗的 Token 总数。

​

​

Chat Object 的示例如下：

​

​

JSON

复制

{

​

// 在 chat 事件里，data 字段中的 id 为 Chat ID，即会话 ID。

​

"id"

:

"737662389258662****"

,

​

"conversation_id"

:

"737554565555041****"

,

​

"bot_id"

:

"736661612448078****"

,

​

"completed_at"

:

1717508113

,

​

"last_error"

:

{

​

"code"

:

0

,

​

"msg"

:

""

​

},

​

"status"

:

"completed"

,

​

"usage"

:

{

​

"token_count"

:

6644

,

​

"output_count"

:

766

,

​

"input_count"

:

5878

​

}

​

}

​

​

Message Object

​

​

参数

​

类型

​

说明

​

id

​

String

​

Message ID，即消息的唯一标识。

​

conversation_id

​

String

​

此消息所在的会话 ID。

​

bot_id

​

String

​

编写此消息的智能体ID。此参数仅在对话产生的消息中返回。

​

chat_id

​

String

​

Chat ID。此参数仅在对话产生的消息中返回。

​

meta_data

​

Map

​

创建消息时的附加消息，获取消息时也会返回此附加消息。

​

role

​

String

​

发送这条消息的实体。取值：

​

user

：代表该条消息内容是用户发送的。

​

assistant

：代表该条消息内容是智能体发送的。

​

content

​

String

​

消息的内容，支持纯文本、多模态（文本、图片、文件混合输入）等多种类型的内容。

​

content_type

​

String

​

消息内容的类型，取值包括：

​

text：文本。

​

object_string：多模态内容，即文本和文件的组合、文本和图片的组合。

​

created_at

​

Integer

​

消息的创建时间，格式为 10 位的 Unixtime 时间戳，单位为秒（s）。

​

updated_at

​

Integer

​

消息的更新时间，格式为 10 位的 Unixtime 时间戳，单位为秒（s）。

​

type

​

String

​

消息类型。

​

question

：用户输入内容。

​

answer

：智能体返回给用户的消息内容，支持增量返回。如果对话流绑定了 messge 节点，可能会存在多 answer 场景，此时可以用流式返回的结束标志来判断所有 answer 完成。

​

function_call

：智能体对话过程中调用函数（function call）的中间结果。

​

tool_response

：调用工具 （function call）后返回的结果。

​

section_id

​

String

​

预留字段，仅在调用

​

发起对话

API 时的部分场景下返回，无需关注。

​

​

示例

​

请求示例

​

执行应用对话流

执行资源库对话流

执行低代码应用中的对话流时，需要通过 app_id 指定应用 ID。

​

示例如下：

​

​

Shell

复制

curl --location 'https://

api.coze.cn

/v1/workflows/chat' \

​

--header 'Authorization: Bearer pat_*****' \

​

--header 'Content-Type: application/json' \

​

--data '{

​

"workflow_id": "74423***",

​

"app_id": "7439828073***",

​

"additional_messages": [

​

{

​

"role": "user",

​

"content_type": "text",

​

"content": "你好"

​

}

​

],

​

"parameters": {

​

"image":"{\"file_id\":\"1122334455\"}"

​

}

​

}'

​

​

​

返回示例

​

执行成功

执行失败

​

JSON

复制

# chat - 开始

​

event

:

conversation.chat.created

​

data

:

{

"last_error"

:{

"msg"

:

""

,

"code"

:

0

},

"usage"

:{

"token_count"

:

0

,

"output_count"

:

0

,

"input_count"

:

0

},

"id"

:

"75598600924738*****"

,

"conversation_id"

:

"75598599835687*****"

,

"section_id"

:

"75598599835687*****"

,

"status"

:

"created"

,

"created_at"

:

1760167093

}

​

# chat - 处理中

​

event

:

conversation.chat.in_progress

​

data

:

{

"usage"

:{

"token_count"

:

0

,

"output_count"

:

0

,

"input_count"

:

0

},

"conversation_id"

:

"75598599835687*****"

,

"id"

:

"75598600924738*****"

,

"section_id"

:

"75598599835687*****"

,

"last_error"

:{

"code"

:

0

,

"msg"

:

""

},

"status"

:

"in_progress"

,

"created_at"

:

1760167093

}

​

​

event

:

conversation.message.delta

​

data

:

{

"conversation_id"

:

"75598599835687*****"

,

"role"

:

"assistant"

,

"section_id"

:

"75598599835687*****"

,

"chat_id"

:

"75598600924738*****"

,

"id"

:

"75598601273532*****"

,

"type"

:

"answer"

,

"content"

:

"那我给你讲"

,

"content_type"

:

"text"

}

​

​

event

:

conversation.message.delta

​

data

:

{

"content"

:

"个会冒冷气的笑话哦！从前有只小企鹅问"

,

"content_type"

:

"text"

,

"section_id"

:

"75598599835687*****"

,

"conversation_id"

:

"75598599835687*****"

,

"type"

:

"answer"

,

"chat_id"

:

"75598600924738*****"

,

"id"

:

"75598601273532*****"

,

"role"

:

"assistant"

}

​

​

event

:

conversation.message.delta

​

data

:

{

"id"

:

"75598601273532*****"

,

"conversation_id"

:

"75598599835687*****"

,

"role"

:

"assistant"

,

"content_type"

:

"text"

,

"chat_id"

:

"75598600924738*****"

,

"type"

:

"answer"

,

"content"

:

"妈妈：\"为什么我们住在南极呀"

,

"section_id"

:

"75598599835687*****"

}

​

​

event

:

conversation.message.delta

​

data

:

{

"content"

:

"？\"妈妈摸着它的圆脑袋说"

,

"role"

:

"assistant"

,

"conversation_id"

:

"75598599835687*****"

,

"type"

:

"answer"

,

"content_type"

:

"text"

,

"chat_id"

:

"75598600924738*****"

,

"section_id"

:

"75598599835687*****"

,

"id"

:

"75598601273532*****"

}

​

​

event

:

conversation.message.delta

​

data

:

{

"role"

:

"assistant"

,

"type"

:

"answer"

,

"chat_id"

:

"75598600924738*****"

,

"section_id"

:

"75598599835687*****"

,

"id"

:

"75598601273532*****"

,

"conversation_id"

:

"75598599835687*****"

,

"content"

:

"：\"因为这里有好多好多鱼呀~\"小"

,

"content_type"

:

"text"

}

​

​

event

:

conversation.message.delta

​

data

:

{

"role"

:

"assistant"

,

"chat_id"

:

"75598600924738*****"

,

"id"

:

"75598601273532*****"

,

"conversation_id"

:

"75598599835687*****"

,

"type"

:

"answer"

,

"content"

:

"企鹅眨巴眨巴眼睛：\"可是北极熊住在"

,

"content_type"

:

"text"

,

"section_id"

:

"75598599835687*****"

}

​

​

event

:

conversation.message.delta

​

data

:

{

"content"

:

"北极也有鱼呀！\"妈妈突然把翅膀"

,

"chat_id"

:

"75598600924738*****"

,

"section_id"

:

"75598599835687*****"

,

"role"

:

"assistant"

,

"type"

:

"answer"

,

"content_type"

:

"text"

,

"id"

:

"75598601273532*****"

,

"conversation_id"

:

"75598599835687*****"

}

​

​

event

:

conversation.message.delta

​

data

:

{

"id"

:

"75598601273532*****"

,

"conversation_id"

:

"75598599835687*****"

,

"role"

:

"assistant"

,

"type"

:

"answer"

,

"section_id"

:

"75598599835687*****"

,

"content"

:

"搭在它肩上，压低声音说"

,

"content_type"

:

"text"

,

"chat_id"

:

"75598600924738*****"

}

​

​

event

:

conversation.message.delta

​

data

:

{

"role"

:

"assistant"

,

"type"

:

"answer"

,

"content"

:

"：\"傻孩子...因为如果我们搬到北极，就"

,

"content_type"

:

"text"

,

"id"

:

"75598601273532*****"

,

"conversation_id"

:

"75598599835687*****"

,

"chat_id"

:

"75598600924738*****"

,

"section_id"

:

"75598599835687*****"

}

​

​

event

:

conversation.message.delta

​

data

:

{

"conversation_id"

:

"75598599835687*****"

,

"role"

:

"assistant"

,

"type"

:

"answer"

,

"content_type"

:

"text"

,

"section_id"

:

"75598599835687*****"

,

"id"

:

"75598601273532*****"

,

"content"

:

"会变成'北极大企鹅啦！"

,

"chat_id"

:

"75598600924738*****"

}

​

​

# MESSAGE - 消息结束

​

event

:

conversation.message.completed

​

data

:

{

"chat_id"

:

"75598600924738*****"

,

"created_at"

:

1760167105

,

"id"

:

"75598601273532*****"

,

"content"

:

"那我给你讲个会冒冷气的笑话哦！从前有只小企鹅问妈妈：\"为什么我们住在南极呀？\"妈妈摸着它的圆脑袋说：\"因为这里有好多好多鱼呀~\"小企鹅眨巴眨巴眼睛：\"可是北极熊住在北极也有鱼呀！\"妈妈突然把翅膀搭在它肩上，压低声音说：\"傻孩子...因为如果我们搬到北极，就会变成'北极大企鹅'啦！\""

,

"content_type"

:

"text"

,

"section_id"

:

"75598599835687*****"

,

"conversation_id"

:

"75598599835687*****"

,

"role"

:

"assistant"

,

"type"

:

"answer"

}

​

​

event

:

conversation.message.completed

​

data

:

{

"updated_at"

:

1760167107

,

"id"

:

"75598601516393*****"

,

"role"

:

"assistant"

,

"content_type"

:

"text"

,

"chat_id"

:

"75598600924738*****"

,

"created_at"

:

1760167107

,

"conversation_id"

:

"75598599835687*****"

,

"type"

:

"verbose"

,

"content"

:

"{\"msg_type\":\"empty result\",\"data\":\"empty result\",\"from_module\":null,\"from_unit\":null}"

,

"section_id"

:

"75598599835687*****"

}

​

​

event

:

conversation.message.completed

​

data

:

{

"updated_at"

:

1760167107

,

"id"

:

"75598601569435*****"

,

"content"

:

"{\"msg_type\":\"generate_answer_finish\",\"data\":\"{\\\"finish_reason\\\":0,\\\"FinData\\\":\\\"\\\"}\",\"from_module\":null,\"from_unit\":null}"

,

"content_type"

:

"text"

,

"chat_id"

:

"75598600924738*****"

,

"section_id"

:

"75598599835687*****"

,

"created_at"

:

1760167107

,

"conversation_id"

:

"75598599835687*****"

,

"role"

:

"assistant"

,

"type"

:

"verbose"

}

​

# chat - 结束

​

event

:

conversation.chat.completed

​

data

:

{

"status"

:

"completed"

,

"usage"

:{

"token_count"

:

1736

,

"output_count"

:

498

,

"input_count"

:

1238

},

"created_at"

:

1760167093

,

"id"

:

"75598600924738*****"

,

"section_id"

:

"75598599835687*****"

,

"completed_at"

:

1760167107

,

"conversation_id"

:

"75598599835687*****"

,

"last_error"

:{

"code"

:

0

,

"msg"

:

""

}}

​

​

event

:

done

​

data

:

{

"debug_url"

:

"https://www.coze.cn/work_flow?execute_id=75598600951038*****&space_id=74982048832804*****&workflow_id=75228046974940*****&execute_mode=2"

}

​

​

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

​

错误码

文档查看对应的解决方法。

​

​

​

上一篇

查询工作流异步运行结果

下一篇

查询输出节点的执行结果
============================================================
# 查询输出节点的执行结果
来源: https://www.coze.cn/open/docs/developer_guides/get_node_execute_history_response
============================================================

查询输出节点的执行结果

查询输出节点的执行结果。

​

接口描述

​

通过

查询工作流异步执行结果

API 查询工作流执行结果时，如果工作流输出节点的输出内容超过 1MB，查询工作流异步执行结果 API 无法返回完整的输出节点内容。需要调用本 API，根据工作流的执行 ID 以及

查询工作流异步执行结果

API 返回的节点执行 UUID，逐一查询每个节点的输出内容。

​

接口限制

​

本 API 的流控限制请参见

API 介绍

。

​

输出节点的输出数据最多保存 24 小时。

​

仅支持查询输出节点的执行结果，不支持查询结束节点的执行结果。

​

输出节点的输出内容超过1MB 时，无法保证返回内容的完整性。

​

基础信息

​

​

请求方式

​

GET

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/workflows/:workflow_id/run_histories/:execute_id/execute_nodes/:node_execute_uuid

​

权限

​

listRunHistory

​

确保调用该接口使用的访问令牌开通了

listRunHistory

权限，详细信息参考

鉴权方式

。

​

接口说明

​

查询输出节点的执行结果。

​

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

workflow_id

​

String

​

必选

​

73505836754923***

​

要执行的 Workflow ID，需要先完成发布 Workflow 的操作。

​

进入 Workflow 编排页，在页面 URL 中，workflow 参数后的数字就是 Workflow ID。例如：

​

https://www.coze.com/work_flow?space_id=73119690542463***&workflow_id=73505836754923***

, Workflow ID 为 73505836754923*** 。

​

execute_id

​

String

​

必选

​

743104097880585****

​

工作流的执行 ID。调用接口

执行工作流

，如果选择异步执行工作流，响应信息中会返回 execute_id。

​

node_execute_uuid

​

String

​

必选

​

78923456777*****

​

工作流异步执行结果

API 中返回的节点执行 uuid。

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

WorkflowNodeExecuteHistory

​

\

​

节点的执行结果。

​

detail

​

Object of

ResponseDetail

​

{ "logid": "202410242028595CCF353CEC86A8*****" }

​

该请求的响应信息。

​

​

WorkflowNodeExecuteHistory

​

​

参数

​

类型

​

示例

​

说明

​

is_finish

​

Boolean

​

true

​

节点是否执行完成。

​

true

表示执行已完成。

​

false

表示执行未完成。

​

node_output

​

String

​

0《零的奇妙冒险》\n\n在一个神秘而遥远的数字王国里，有一个特殊的数字——零。

​

节点的执行结果输出信息。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v1/workflows/74730423****702316/run_histories/75142305***8428/execute_nodes/63c7f****6d2' \

​

--header 'Authorization

:

Bearer pat_uk74546778ffgd****' \

​

--header 'Content-Type

:

application/json'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"data"

:

{

​

"is_finish"

:

false

,

​

"node_output"

:

"0《零的奇妙冒险》\n\n在一个神秘而遥远的数字王国里，有一个特殊的数字——零。零一直觉得自己很渺小，没有什么特别之处，常常感到很孤独。\n\n有一天，零百无聊赖地在数字王国的小路上游荡。突然，它听到了一阵哭声。零好奇地顺着哭声找去，发现是数字一在角落里哭泣。\n\n“你怎么了，一？”零关心地问。\n\n一抽噎着说：“大家都觉得我很孤单，很弱小，没有什么用处。我也不知道自己能做什么。”\n\n零听了，心中涌起一股同情。它笑着对一说：“别难过，一。其实我们可以一起变得很强大。你看，当我和你站在一起的时候，我们就变成了十。”\n\n一惊讶地看着零，眼中渐渐燃起了希望。从那以后，零和一成为了好朋友，它们一起在数字王国里探索。\n\n不久，它们遇到了数字二。二正为自己不能变成更大的数字而苦恼。零和一相视一笑，走过去对二说：“别担心，我们可以一起组成十二。”\n\n数字二高兴极了，加入了它们的队伍。随着它们的冒险继续，越来越多的数字加入了零的小团队。它们发现，只要零和其他数字在一起，就能创造出无数的可能。\n\n有一次，数字王国遭遇了一场巨大的危机。一个邪恶的数字巫师出现了，他想要把所有的数字都变成他的奴隶，让数字王国陷入黑暗。\n\n零和它的朋友们决定挺身而出，保卫数字王国。它们齐心协力，运用各自的力量，与数字巫师展开了一场激烈的战斗。\n\n零虽然本身没有很大的力量，但它却能让其他数字发挥出更大的作用。在关键时刻，零带领着大家组成了一个巨大的数字组合，成功地击败了数字巫师。\n\n数字王国恢复了往日的和平与欢乐。零也不再觉得自己渺小和孤独了。它明白了，每个数字都有自己的价值，而当大家团结在一起的时候，就能创造出无穷的奇迹。\n\n从那以后，零成为了数字王国里最受欢迎的数字之一。它和它的朋友们继续在数字王国里冒险，用它们的团结和智慧，为数字王国带来更多的美好。\n\n在这个充满奇幻的数字王国里，零的故事告诉我们，即使是最渺小的存在，也能在合适的时候发挥出巨大的作用。只要我们相信自己，勇敢地去探索，去团结他人，就能创造出属于我们自己的精彩世界。而零，也将继续带着它的勇气和善良，在数字王国里书写更多的传奇故事。"

​

},

​

"detail"

:

{

​

"logid"

:

"202506112018****AB2ADDA"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

执行对话流

下一篇

查询工作流列表
============================================================
# 查询工作流列表
来源: https://www.coze.cn/open/docs/developer_guides/get_workflow_list
============================================================

查询工作流列表

查询指定工作空间中的工作流列表及其基本信息。

​

你可以查询某个工作空间中的所有工作流或对话流、某个应用关联的工作流或对话流。

​

基础信息

​

​

请求方式

​

GET

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/workflows

​

​

权限

​

listWorkflow

​

确保调用该接口使用的访问令牌开通了

listWorkflow

权限，详细信息参考

鉴权方式

。

​

接口说明

​

查询指定工作空间中的工作流列表及其基本信息。

​

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

workspace_id

​

String

​

必选

​

736163827687053****

​

工作空间 ID，用于指定要查询的工作空间。

​

进入指定空间，空间页面 URL 中

w

参数后的数字就是 工作空间 ID。例如

https://code.coze.cn/w/75814654762959***/projects

，工作空间 ID 为

75814654762959***

。

​

page_num

​

Integer

​

必选

​

1

​

查询结果分页展示时，此参数用于设置查看的页码。最小值为 1。

​

page_size

​

Integer

​

可选

​

20

​

查询结果分页展示时，此参数用于设置每页返回的数据量。取值范围为 1 ~ 30，默认为 10。

​

workflow_mode

​

String

​

可选

​

workflow

​

工作流类型，默认为空，即查询所有工作流类型。枚举值：

​

workflow

：工作流。

​

chatflow

：对话流。

​

app_id

​

String

​

可选

​

744208683**

​

扣子应用 ID，用于查询指定应用关联的工作流。默认为空，即不指定应用。

​

进入应用开发界面，开发页面 URL 中的

project-ide

参数后的数字就是 AppID，例如

https://

www.coze.cn

/space/74421656*****/project-ide/744208683**

，扣子应用 ID 为

744208683**

。

​

publish_status

​

String

​

可选

​

all

​

工作流的发布状态，用于筛选不同发布状态的版本。枚举值：

​

all ：所有状态。

​

published_online ：（默认值）已发布的正式版。

​

unpublished_draft ：草稿状态。

​

​

​

返回参数

​

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Object of

OpenAPIWorkflowList

​

{"items":[{"app_id":"744208683**","creator":{"id":"2478774393***","name":"user41833***"},"icon_url":"

https://example.com/icon/workflow_123.png

","created_at":"1700000000","updated_at":"1701234567","description":"工作流测试","workflow_id":"73505836754923***","workflow_name":"workflow_example"}],"has_more":false}

​

工作流列表及其详细信息。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

OpenAPIWorkflowList

​

​

参数

​

类型

​

示例

​

说明

​

items

​

Array of

OpenAPIWorkflowBasic

​

[{"app_id":"744208683**","creator":{"id":"2478774393***","name":"user41833***"},"icon_url":"

https://example.com/icon/workflow_123.png

","created_at":"1700000000","updated_at":"1701234567","description":"工作流测试","workflow_id":"73505836754923***","workflow_name":"workflow_example"}]

​

工作流的基础信息。

​

has_more

​

Boolean

​

false

​

标识当前返回的工作流列表是否还有更多数据未返回。

​

true

：还有更多未返回的回调应用。

​

false

：已返回所有数据。

​

​

OpenAPIWorkflowBasic

​

​

参数

​

类型

​

示例

​

说明

​

app_id

​

String

​

744208683**

​

工作流关联的应用 ID。若工作流未关联任何应用，则该字段值为

0

。

creator

​

Object of

OpenAPIUserInfo

​

{"id":"2478774393***","name":"user41833***"}

​

工作流创建者的信息，包含创建者的用户 ID 和用户名。

icon_url

​

String

​

https://example.com/icon/workflow_123.png

​

工作流图标的 URL 地址。

​

created_at

​

String

​

1752060786

​

工作流的创建时间，以 Unix 时间戳表示，单位为秒。

updated_at

​

String

​

1752060827

​

工作流的最后更新时间，以 Unix 时间戳表示，单位为秒。

description

​

String

​

生成音乐的工作流

​

工作流的描述。

​

workflow_id

​

String

​

73505836754923***

​

工作流 ID。

​

workflow_name

​

String

​

workflow_example

​

工作流名称。

​

​

OpenAPIUserInfo

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

2478774393***

​

工作流创建者的扣子用户 UID。

​

name

​

String

​

user41833***

​

工作流创建者的扣子用户名。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v1/workflows?page_num=1&workspace_id=74496******2844844' \

​

--header 'authorization

:

Bearer pat_hBHquB***' \

​

--header 'Content-Type

:

application/json'

​

​

返回示例

​

​

JSON

复制

{

​

"data"

:

{

​

"has_more"

:

true

,

​

"items"

:

[

​

{

​

"updated_at"

:

"1752060827"

,

​

"workflow_id"

:

"7524966*******"

,

​

"description"

:

"Description"

,

​

"app_id"

:

"0"

,

​

"created_at"

:

"1752060786"

,

​

"icon_url"

:

"https://tosv.****/workflow.png"

,

​

"creator"

:

{

​

"id"

:

"26150****"

,

​

"name"

:

"alan"

​

},

​

"workflow_name"

:

"workflow_Name"

​

}

​

]

​

},

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20250716215828******"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

查询输出节点的执行结果

下一篇

查询工作流基本信息
============================================================
# 查询工作流基本信息
来源: https://www.coze.cn/open/docs/developer_guides/get_workflow_info
============================================================

查询工作流基本信息

查询工作流的基本信息，包括工作流名称、描述、创建者信息等。

​

基础信息

​

​

请求方式

​

GET

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/workflows/:workflow_id

​

​

权限

​

getMetaData

​

确保调用该接口使用的访问令牌开通了

getMetaData

权限，详细信息参考

鉴权方式

。

​

接口说明

​

查询工作流基本信息。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

workflow_id

​

String

​

必选

​

73505836754923***

​

工作流 ID。

​

进入工作流编排页面，在页面 URL 中，workflow 参数后的数字就是 Workflow ID。例如

https://www.coze.com/work_flow?space_id=42463***&workflow_id=73505836754923***

，Workflow ID 为 73505836754923***。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

include_input_output

​

Boolean

​

可选

​

true

​

是否在返回结果中返回输入和输出参数的结构体。

​

true

：返回输入输出参数结构体

​

false

：不返回输入输出参数结构体

​

默认值为

false

。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

WorkflowInfo

​

\

​

工作流的详细信息。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含本次请求的日志信息，用于问题排查和技术支持。

​

WorkflowInfo

​

​

参数

​

类型

​

示例

​

说明

​

input

​

Object of

OpenAPIWorkflowInput

​

\

​

工作流开始节点的输入参数的结构体。

​

output

​

Object of

OpenAPIWorkflowOutput

​

{ "parameters": { "arr_obj_num": { "required": false, "type": "number" } }, "terminate_plan": "use_answer_content", "content": "输出为{{output}}" }

​

工作流结束节点的输出参数的结构体。

​

workflow_detail

​

Object of

OpenAPIWorkflowBasic

​

{"app_id":"744208683**","creator":{"id":"2478774393***","name":"user41833***"},"icon_url":"

https://example.com/icon/workflow_123.png

","created_at":1700000000,"updated_at":"1701234567","description":"工作流测试","workflow_id":"73505836754923***","workflow_name":"workflow_example"}

​

工作流的详细信息。

​

​

OpenAPIWorkflowInput

​

​

参数

​

类型

​

示例

​

说明

​

parameters

​

JSON Map

​

{ "CONVERSATION_NAME": { "required": false, "description": "", "default_value": "", "type": "string" }}

​

开始节点的输入参数结构体。

​

​

Parameters

​

​

参数

​

类型

​

示例

​

说明

​

type

​

String

​

string

​

该参数的类型。

​

items

​

Object of

OpenAPIParameter

​

{"type":"image"}

​

当参数类型为

array

时，该字段用于定义数组元素的子类型。

​

required

​

Boolean

​

true

​

标识输入参数是否为必填项。

​

true

：该参数为必填项。

​

false

：该参数为可选项。

​

properties

​

JSON Map

​

{ "arr_obj_num": { "required": false, "type": "number" } }

​

当参数类型为

object

时，该字段用于定义对象类型的子参数信息，采用键值对（key-value）结构，其中 key 为子参数的名称，value 为该子参数的定义信息（包含类型、是否必填等属性）。

​

description

​

String

​

上传的图片。

​

该参数的描述信息。

​

default_value

​

String

​

-

​

该参数配置的默认值。

​

​

OpenAPIWorkflowOutput

​

​

参数

​

类型

​

示例

​

说明

​

content

​

String

​

数量为{{arr_obj_num}}

​

工作流结束节点返回文本时，智能体回复内容的结构。仅当

terminate_plan

为

use_answer_content

时会返回。

​

parameters

​

JSON Map

​

{ "output": { "type": "string" } }

​

工作流结束节点输出变量的数组。以键值对形式存储，格式为

{ "变量名称": { "type": "变量类型" } }

。

​

terminate_plan

​

String

​

return_variables

​

结束节点的返回类型，枚举值：

​

return_variables

：返回变量。

​

use_answer_content

：返回文本。

​

​

OpenAPIWorkflowBasic

​

​

参数

​

类型

​

示例

​

说明

​

app_id

​

String

​

744208683**

​

工作流关联的应用 ID。若工作流未关联任何应用，则该字段值为

0

。

creator

​

Object of

OpenAPIUserInfo

​

{"id":"2478774393***","name":"user41833***"}

​

工作流创建者的信息，包含创建者的用户 ID 和用户名。

icon_url

​

String

​

https://example.com/icon/workflow_123.png

​

工作流图标的 URL 地址。

​

created_at

​

String

​

1752060786

​

工作流的创建时间，以 Unix 时间戳表示，单位为秒。

updated_at

​

String

​

1752060827

​

工作流的最后更新时间，以 Unix 时间戳表示，单位为秒。

description

​

String

​

生成音乐的工作流

​

工作流的描述。

​

workflow_id

​

String

​

73505836754923***

​

工作流 ID。

​

workflow_name

​

String

​

workflow_example

​

工作流名称。

​

​

OpenAPIUserInfo

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

2478774393***

​

工作流创建者的扣子用户 UID。

​

name

​

String

​

user41833***

​

工作流创建者的扣子用户名。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v1/workflows/7493*****453978?include_input_output=true' \

​

--header 'Authorization

:

Bearer pat_h******' \

​

--header 'Content-Type

:

application/json'

​

​

返回示例

​

​

JSON

复制

{

​

"data"

:

{

​

"workflow_detail"

:

{

​

"workflow_name"

:

"workflow_image"

,

​

"app_id"

:

"7493481****8294"

,

​

"creator"

:

{

​

"id"

:

"44246792*****"

,

​

"name"

:

"张三"

​

},

​

"updated_at"

:

1747983675

,

​

"workflow_id"

:

"750712******91219"

,

​

"description"

:

"统计图片数量"

,

​

"icon_url"

:

"https://*****pi.com/ocean-cloud-tos/plugin_icon/chatflow-icon.png?****"

,

​

"created_at"

:

1747888248

​

},

​

"input"

:

{

​

"parameters"

:

{

​

"CONVERSATION_NAME"

:

{

​

"required"

:

false

,

​

"description"

:

""

,

​

"default_value"

:

""

,

​

"type"

:

"string"

​

},

​

"USER_INPUT"

:

{

​

"type"

:

"string"

,

​

"required"

:

false

​

}

​

}

​

},

​

"output"

:

{

​

"parameters"

:

{

​

"arr_obj_num"

:

{

​

"type"

:

"number"

​

}

​

},

​

"terminate_plan"

:

"use_answer_content"

,

​

"content"

:

"数量为{{arr_obj_num}}"

​

}

​

},

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"2025071621341*******4D"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

查询工作流列表

下一篇

查询工作流的版本列表
============================================================
# 查询工作流的版本列表
来源: https://www.coze.cn/open/docs/developer_guides/list_workflow_version
============================================================

查询工作流的版本列表

查询工作流的版本列表。

​

你可以通过本 API 查询某个工作流的所有历史版本记录，包括版本号、版本描述、操作者和发布时间等。

​

基础信息

​

​

请求方式

​

GET

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/workflows/:workflow_id/versions

​

​

权限

​

listVersion

​

确保调用该接口使用的访问令牌开通了

listVersion

权限，详细信息参考

鉴权方式

。

​

接口说明

​

查询工作流的版本列表。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

workflow_id

​

String

​

必选

​

73505836754923***

​

待查询的 Workflow ID。

​

进入 Workflow 编排页面，在页面 URL 中，workflow 参数后的数字就是 Workflow ID。例如

https://www.coze.com/work_flow?space_id=42463***&workflow_id=73505836754923***

，Workflow ID 为 73505836754923***。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

publish_status

​

String

​

可选

​

all

​

工作流的发布状态，用于筛选不同发布状态的版本。枚举值：

​

all ：所有状态。

​

published_online ：（默认值）已发布的正式版。

​

unpublished_draft ：草稿状态。

​

page_size

​

Integer

​

可选

​

20

​

查询结果分页展示时，此参数用于设置每页返回的数据量。取值范围为 1 ~ 30，默认为 10。

​

page_token

​

String

​

可选

​

1752666079000

​

分页查询时的翻页标识，表示下一页的起始位置。默认为

""

，即从第一页数据开始返回。如果要查询下一页，需要使用上一次返回的

next_page_token

作为这次请求的入参。

​

include_input_output

​

Boolean

​

可选

​

true

​

是否在返回结果中返回输入和输出参数的结构体。

​

true

：返回输入输出参数结构体

​

false

：不返回输入输出参数结构体

​

默认值为

false

。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Object of

OpenAPIListVersionData

​

{"items":[{"creator":{"id":"2478774393***","name":"user41833***"},"version":"v1.0.0","created_at":"1700000000","updated_at":"1701234567","description":"工作流测试","workflow_id":"73505836754923***"}],"has_more":false,"next_page_token":"73505836754923***"}

​

包含工作流列表及其相关信息的对象，用于返回查询结果。

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

OpenAPIListVersionData

​

​

参数

​

类型

​

示例

​

说明

​

items

​

Array of

OpenAPIVersionMetaInfo

​

\

​

工作流的历史版本列表。

​

has_more

​

Boolean

​

false

​

标识当前返回的版本列表是否还有更多数据未返回。

​

true

：还有更多未返回的回调应用。

​

false

：已返回所有数据。

​

next_page_token

​

String

​

73505836754923***

​

翻页标识，表示下一页的起始位置。当

has_more

为

true

时，表示还有更多数据未返回，可以通过此令牌获取下一页数据。首次请求不填或置空，后续翻页需使用上一次返回的

next_page_token

。

​

​

OpenAPIVersionMetaInfo

​

​

参数

​

类型

​

示例

​

说明

​

input

​

Object of

OpenAPIWorkflowInput

​

{ "parameters": { "USER_INPUT": { "type": "string", "required": false }, "CONVERSATION_NAME": { "type": "string", "required": false, "description": "", "default_value": "" } } }

​

工作流开始节点的输入参数的结构体。

​

output

​

Object of

OpenAPIWorkflowOutput

​

{ "parameters": { "arr_obj_num": { "required": false, "type": "number" } }, "terminate_plan": "use_answer_content", "content": "输出为{{output}}" }

​

工作流结束节点的输出参数的结构体。

​

creator

​

Object of

OpenAPIUserInfo

​

{"id":"2478774393***","name":"user41833***"}

​

工作流操作者的信息，包含操作者的用户 UID 和用户名。

​

version

​

String

​

v0.0.2

​

工作流的版本号，用于标识工作流的不同版本。

created_at

​

String

​

1700000000

​

工作流的创建时间，以 Unix 时间戳表示，单位为秒。

updated_at

​

String

​

1701234567

​

工作流的最后更新时间，以 Unix 时间戳表示，单位为秒。

description

​

String

​

工作流测试

​

工作流的描述。

​

workflow_id

​

String

​

73505836754923***

​

工作流 ID。

​

​

OpenAPIWorkflowInput

​

​

参数

​

类型

​

示例

​

说明

​

parameters

​

JSON Map

​

{ "CONVERSATION_NAME": { "required": false, "description": "", "default_value": "", "type": "string" }}

​

开始节点的输入参数结构体。

​

​

Parameters

​

​

参数

​

类型

​

示例

​

说明

​

type

​

String

​

string

​

该参数的类型。

​

items

​

Object of

OpenAPIParameter

​

{"type":"image"}

​

当参数类型为

array

时，该字段用于定义数组元素的子类型。

​

required

​

Boolean

​

true

​

标识输入参数是否为必填项。

​

true

：该参数为必填项。

​

false

：该参数为可选项。

​

properties

​

JSON Map

​

{ "arr_obj_num": { "required": false, "type": "number" } }

​

当参数类型为

object

时，该字段用于定义对象类型的子参数信息，采用键值对（key-value）结构，其中 key 为子参数的名称，value 为该子参数的定义信息（包含类型、是否必填等属性）。

​

description

​

String

​

上传的图片。

​

该参数的描述信息。

​

default_value

​

String

​

-

​

该参数配置的默认值。

​

​

OpenAPIWorkflowOutput

​

​

参数

​

类型

​

示例

​

说明

​

content

​

String

​

数量为{{arr_obj_num}}

​

工作流结束节点返回文本时，智能体回复内容的结构。仅当

terminate_plan

为

use_answer_content

时会返回。

​

parameters

​

JSON Map

​

{ "output": { "type": "string" } }

​

工作流结束节点输出变量的数组。以键值对形式存储，格式为

{ "变量名称": { "type": "变量类型" } }

。

​

terminate_plan

​

String

​

return_variables

​

结束节点的返回类型，枚举值：

​

return_variables

：返回变量。

​

use_answer_content

：返回文本。

​

​

OpenAPIUserInfo

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

2478774393***

​

工作流操作者的扣子用户 UID。

​

name

​

String

​

user41833***

​

工作流操作者的扣子用户名。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET  'https

:

//api.coze.cn/v1/workflows/74800714******84300/versions?page_size=1&page_token=175266607***0&include_input_output=true' \

​

--header 'authorization

:

Bearer pat_A*******' \

​

--header 'Content-Type

:

application/json'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"data"

:

{

​

"has_more"

:

false

,

​

"next_page_token"

:

"17552****000"

,

​

"items"

:

[

​

{

​

"workflow_id"

:

"7538347*****8076"

,

​

"version"

:

"v0.0.1"

,

​

"description"

:

"统计图片数量"

,

​

"created_at"

:

"1755251584"

,

​

"updated_at"

:

"1755****12"

,

​

"creator"

:

{

​

"id"

:

"3361****58211"

,

​

"name"

:

"张三"

​

},

​

"input"

:

{

​

"parameters"

:

{

​

"USER_INPUT"

:

{

​

"type"

:

"string"

,

​

"required"

:

false

​

},

​

"CONVERSATION_NAME"

:

{

​

"type"

:

"string"

,

​

"required"

:

false

,

​

"description"

:

"本次请求绑定的会话，会自动写入消息、会从该会话读对话历史。"

,

​

"default_value"

:

""

​

}

​

}

​

},

​

"output"

:

{

​

"terminate_plan"

:

"use_answer_content"

,

​

"content"

:

"数量为{{obj_num}}"

,

​

"parameters"

:

{

​

"obj_num"

:

{

​

"type"

:

"number"

,

​

"required"

:

false

​

}

​

}

​

}

​

}

​

]

​

},

​

"detail"

:

{

​

"logid"

:

"202508221521****5C3B159FCD2"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

查询工作流基本信息

下一篇

开启或关闭工作流多人协作
============================================================
# 开启或关闭工作流多人协作
来源: https://www.coze.cn/open/docs/developer_guides/switch_workflow_develop_mode
============================================================

开启或关闭工作流多人协作

开启或关闭工作流、对话流多人协作。

​

开启多人协作后，你才能调用

添加工作流的协作者

API 为工作流添加协作者。

​

接口限制

​

套餐限制

：扣子企业版（企业标准版、企业旗舰版）。

​

只有资源库中的工作流和对话流支持添加多人协作，扣子应用中的工作流不支持开启多人协作模式，否则会报 4000 错误。

​

不支持渠道类型 OAuth 应用。使用 OAuth JWT 应用和服务访问令牌时，只需要有对应权限点即可。其余认证方式，只有

工作流所有者

能开启或关闭工作流的多人协作模式。

​

关闭工作流多人协作前，需要先调用

删除工作流协作者

API 删除所有协作者。

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/workflows/:workflow_id/collaboration_mode

​

​

权限

​

Workflow.switchDevelopMode

​

确保调用该接口使用的访问令牌开通了

Workflow.switchDevelopMode

权限，详细信息参考

鉴权方式

。

​

接口说明

​

开启或关闭工作流多人协作。

​

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

workflow_id

​

String

​

可选

​

73505836754923***

​

需要设置协作模式的工作流 ID。

​

进入工作流编排页面，在页面 URL 中，workflow 参数后的数字就是 Workflow ID。例如

https://www.coze.com/work_flow?space_id=42463***&workflow_id=73505836754923***

，Workflow ID 为

73505836754923***

。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

collaboration_mode

​

String

​

可选

​

collaboration

​

工作流的协作模式，枚举值：

​

single

：单用户模式。

​

collaboration

：多人协作模式。

​

说明

如需将工作流多人协作模式变更为单用户模式，需要先调用

删除工作流协作者

API 删除所有协作者。

​

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含本次请求的日志信息，用于问题排查和技术支持。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/workflows/73505836754923***/collaboration_mode' \

​

--header 'Authorization

:

Bearer pat_Osa******' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"collaboration_mode"

:

"collaboration"

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

查询工作流的版本列表

下一篇

添加工作流协作者
============================================================
# 添加工作流协作者
来源: https://www.coze.cn/open/docs/developer_guides/add_workflow_collaborator
============================================================

添加工作流协作者

添加工作流协作者。

​

接口限制

​

套餐限制：扣子企业版（企业标准版、企业旗舰版）。

​

每次请求只能添加一位协作者。如需添加多位，请依次发送请求。

​

协作者只能是该工作空间的成员。

​

主账号内的所有子账号共享同一 API 的流控额度，单个 API 的流控限制为 5 QPS。

​

不支持渠道类型 OAuth 应用。使用 OAuth JWT 应用和服务访问令牌时，只需要有对应权限点即可。其余认证方式，只有

工作流的所有者和协作者

有权添加。

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/workflows/:workflow_id/collaborators

​

​

权限

​

Workflow.addCollaborator

​

确保调用该接口使用的访问令牌开通了

Bot.addCollaborator

权限，详细信息参考

鉴权方式

。

​

接口说明

​

添加工作流协作者。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

workflow_id

​

String

​

必选

​

73505836754923***

​

需要添加协作者的工作流 ID。

​

进入工作流编排页面，在页面 URL 中，

workflow

参数后的数字就是 Workflow ID。例如

https://www.coze.com/work_flow?space_id=42463***&workflow_id=73505836754923***

，Workflow ID 为

73505836754923***

。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

collaborators

​

Array of

CollaboratorAddData

​

必选

​

[{"user_id":"411479148551****"}]

​

工作流资源协作者列表。单次最多添加

1

个协作者。

​

​

CollaboratorAddData

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

user_id

​

String

​

必选

​

411479148551****

​

协作者的扣子用户 UID。你只能添加对应工作空间中的成员作为协作者。

​

在扣子编程平台左下角单击头像，选择

账号设置

，查看账号的 UID。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/workflows/73505836754923***/collaborators' \

​

--header 'Authorization

:

Bearer pat_hfwkehfncaf****' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"collaborators"

:

[

​

{

​

"user_id"

:

"411479148551****"

​

}

​

]

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

开启或关闭工作流多人协作

下一篇

删除工作流协作者
============================================================
# 删除工作流协作者
来源: https://www.coze.cn/open/docs/developer_guides/remove_workflow_collaborator
============================================================

删除工作流协作者

删除工作流协作者。

​

接口限制

​

每次请求只能删除一位协助者。如需删除多位，请依次发送请求。

​

主账号内的所有子账号共享同一 API 的流控额度，单个 API 的流控限制为 5 QPS。

​

不支持渠道类型 OAuth 应用。使用 OAuth JWT 应用和服务访问令牌时，只需要有对应权限点即可。其余认证方式，只有

工作流的所有者和协作者

有权删除。

​

基础信息

​

​

请求方式

​

DELETE

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/workflows/:workflow_id/collaborators/:user_id

​

​

权限

​

Workflow.removeCollaborator

​

确保调用该接口使用的访问令牌开通了

Workflow.removeCollaborator

权限，详细信息参考

鉴权方式

。

​

接口说明

​

删除工作流协作者。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

workflow_id

​

String

​

必选

​

73505836754923***

​

需要删除协作者的工作流 ID。

​

进入工作流编排页面，在页面 URL 中，

workflow

参数后的数字就是 Workflow ID。例如

https://www.coze.com/work_flow?space_id=42463***&workflow_id=73505836754923***

，Workflow ID 为

73505836754923***

。

​

user_id

​

String

​

必选

​

411479148551****

​

待删除的协作者的扣子用户 UID。

​

在扣子编程平台左下角单击头像，选择

账号设置

，查看账号的 UID。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request DELETE 'https

:

//api.coze.cn/v1/workflows/73505836754923***/collaborators/411479148551****' \

​

--header 'Authorization

:

Bearer pat_Osa******' \

​

--header 'Content-Type

:

application/json' \

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

添加工作流协作者

下一篇

上传文件
============================================================
# 上传文件
来源: https://www.coze.cn/open/docs/developer_guides/upload_files
============================================================

上传文件

调用接口上传文件到扣子编程。

​

接口说明

​

消息中无法直接使用本地文件，创建消息或对话前，需要先调用此接口上传本地文件到扣子编程。上传文件后，你可以在消息中通过指定 file_id 的方式在多模态内容中直接使用此文件。此接口上传的文件可用于

发起对话

等 API 中传入文件等多模态内容。使用方式可参考

object_string object

。

​

使用限制

​

​

限制

​

说明

​

文件大小

​

该 API 允许上传的最大文件大小为 512 MB。然而，在与智能体对话时，实际可使用的文件大小取决于智能体的模型版本。

​

上传方式

​

必须使用 multipart/form-data 方式上传文件。

​

有效期

​

普通上传的文件将保存在扣子编程服务端，有效期为 3 个月。

​

若上传的文件被用作扣子头像，则永久有效。

​

使用限制

​

上传到扣子编程的文件仅限本账号查看或使用。

​

调用此接口上传文件只能获得文件的

file_id

，如需获取文件的 URL，建议将文件上传到专业的存储工具中。

​

不支持下载已上传的文件。用户仅可在对话、工作流、端插件、RTC 和 WebSocket 中通过

file.id

访问和使用文件。

​

API 流控

​

个人版：10 QPS。

​

企业版：20 QPS。

​

​

支持的文件格式

​

​

文件类型

​

支持的格式

​

文档

​

DOC、DOCX、XLS、XLSX、PPT、PPTX、PDF、Numbers、CSV

​

文本文件

​

CPP、PY、JAVA、C

​

图片

​

JPG、JPG2、PNG、GIF、WEBP、HEIC、HEIF、BMP、PCD、TIFF

​

音频

​

WAV、MP3、FLAC、M4A、AAC、OGG、WMA、MIDI

​

视频

​

MP4、AVI、MOV、3GP、3GPP、FLV、WEBM、WMV、RMVB、M4V、MKV

​

压缩文件

​

RAR、ZIP、7Z、GZ、GZIP、BZ2

​

​

​

基础信息

​

​

请求方式

​

POST

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/files/upload

​

权限

​

uploadFile

​

确保调用该接口使用的访问令牌开通了

uploadFile

权限，详细信息参考

鉴权方式

。

​

接口说明

​

调用接口上传文件到扣子编程。

​

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

multipart/form-data

​

解释请求正文的方式。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

Data

​

File

​

必选

​

@"/test/1120.jpeg"'

​

待上传文件的二进制数据。

​

开发者需要在前端应用中实现文件选择功能，获取用户选择的文件后，将文件的二进制内容直接设置为 HTTP 请求体。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Object of

File

​

{ "bytes": 152236, "created_at": 1715847583, "file_name": "1120.jpeg", "id": "736949598110202****" }

​

已上传的文件信息。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

​

File

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

736949598110202****

​

已上传的文件 ID。

​

bytes

​

Long

​

152236

​

文件的总字节数。

​

file_name

​

String

​

1120.jpeg

​

文件名称。

​

created_at

​

Long

​

1715847583

​

文件的上传时间，格式为 10 位的 Unixtime 时间戳，单位为秒（s）。

​

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/files/upload' \

​

--header 'Authorization

:

Bearer pat_O******' \

​

--header 'Content-Type

:

multipart/form-data' \

​

--form 'file=@

"/test/1120.jpeg"

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"data"

:

{

​

"bytes"

:

152236

,

​

"created_at"

:

1715847583

,

​

"file_name"

:

"1120.jpeg"

,

​

"id"

:

"736949598110202****"

​

},

​

"msg"

:

""

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

删除工作流协作者

下一篇

查看文件详情
============================================================
# 查看文件详情
来源: https://www.coze.cn/open/docs/developer_guides/retrieve_files
============================================================

查看文件详情

查看已上传的文件详情。

​

基础信息

​

​

请求方式

​

GET

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/files/retrieve

​

​

权限

​

retrieveFile

​

确保调用该接口使用的个人令牌开通了

retrieveFile

权限，详细信息参考

鉴权方式

。

​

接口说明

​

查看已上传的文件详情。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

file_id

​

String

​

必选

​

7369495981102022700

​

已上传的文件 ID。你可以通过

上传文件

API 的返回信息中查看文件 ID。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Object of

File

​

{"id":"736949598110202****","bytes":152236,"file_name":"1120.jpeg","created_at":1715847583}

​

已上传的文件信息，包含文件 ID、文件大小、文件名和上传时间等详细信息。

​

detail

​

Object of

ResponseDetail

​

{ "logid": "20250106172024B5F607030EFFAD653960" }

​

响应详情信息。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

​

File

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

736949598110202****

​

已上传的文件 ID。

​

bytes

​

Long

​

152236

​

文件的总字节数。

​

file_name

​

String

​

1120.jpeg

​

文件名称。

​

created_at

​

Long

​

1715847583

​

文件的上传时间，格式为 10 位的 Unixtime 时间戳，单位为秒（s）。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v1/files/retrieve?file_id=7369495981102022700' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json' \

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"data"

:

{

​

"bytes"

:

152236

,

​

"created_at"

:

1715847583

,

​

"file_name"

:

"1120.jpeg"

,

​

"id"

:

"736949598110202****"

​

},

​

"msg"

:

""

​

}

​

{

​

"code"

:

0

,

​

"data"

:

{

​

"bytes"

:

152236

,

​

"created_at"

:

1715847583

,

​

"file_name"

:

"1120.jpeg"

,

​

"id"

:

"736949598110202****"

​

},

​

"msg"

:

""

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

上传文件

下一篇

查看音色列表
============================================================
# 查看音色列表
来源: https://www.coze.cn/open/docs/developer_guides/list_voices
============================================================

查看音色列表

查看可用的音色列表，包括系统预置音色和自定义音色。

​

接口说明

​

调用此 API 可查看当前扣子用户可使用的音色列表，包括：

​

系统预置音色：扣子编程提供的默认音色。

​

自定义音色：当前扣子用户通过

复刻音色

API 复刻的音色、当前账号加入的所有工作空间中其他扣子用户复刻的音色。

​

基础信息

​

​

请求方式

​

GET

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/audio/voices

​

权限

​

listVoice

​

确保调用该接口使用的个人令牌开通了

listVoice

权限，详细信息参考

鉴权方式

。

接口说明

​

查看可用的音色列表，包括系统预置音色和自定义音色。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

filter_system_voice

​

Boolean

​

可选

​

false

查看音色列表时是否过滤掉系统音色。

​

true：过滤系统音色

​

false：（默认）不过滤系统音色

​

model_type

​

String

​

可选

​

big

​

音色模型的类型，如果不填，默认都返回。可选值包括：

​

big：大模型

​

small：小模型

​

voice_state

​

String

​

可选

​

cloned

音色克隆状态，用于筛选特定状态的音色。可选值包括：

​

init：待克隆。

​

cloned：（默认值）已克隆。

​

all：全部。

​

page_num

​

Integer

​

可选

​

1

查询结果分页展示时，此参数用于设置查看的页码。最小值为 1，默认为 1。

​

page_size

​

Integer

​

可选

​

100

查询结果分页展示时，此参数用于设置每页返回的数据量。取值范围为 1~100，默认为 100。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

状态码。

​

0

代表调用成功。

data

​

Object of

ListVoiceData

​

参见响应参数

​

音色的详细信息。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{ "logid": "2024102916355736DC98FBC4D32FD7E59C" }

​

本次请求的详细信息。

​

​

ListVoiceData

​

​

参数

​

类型

​

示例

​

说明

​

has_more

​

Boolean

​

false

​

标识是否还有未返回的音色数据。

​

true

：当前返回的音色列表未包含所有符合条件的音色。

​

false

：表示已返回所有符合条件的音色数据。

​

voice_list

​

Array of

OpenAPIVoiceData

​

参见响应参数

​

音色列表详情。

​

​

OpenAPIVoiceData

​

​

参数

​

类型

​

示例

​

说明

​

name

​

String

​

开朗大男孩

​

音色的名称。

​

state

​

String

​

cloned

​

音色克隆状态。枚举值：

​

init：待克隆。

​

cloned：已克隆。

​

voice_id

​

String

​

734829333445931****

​

音色的 ID。

​

model_name

​

String

​

​

模型类型字符串

​

model_type

​

String

​

big

​

音色模型的类型，枚举值：

​

big：大模型

​

small：小模型

​

create_time

​

Integer

​

1729686510

​

音色的创建时间，格式为 11 位的 Unixtime 时间戳。

​

update_time

​

Integer

​

1729686510

​

音色的更新时间，格式为 11 位的 Unixtime 时间戳。

​

preview_text

​

String

​

你好呀

​

此音色预览音频对应的文案。

​

language_code

​

String

​

zh

​

此音色的语种代号。

​

language_name

​

String

​

中文

​

此音色的语种名称。

​

preview_audio

​

String

​

https://lf3-appstore-sign.oceancloudapi.com/ocean-cloud-tos/VolcanoUserVoice/xxxxxx.mp3?lk3s=da27ec82&x-expires=1730277357&x-signature=xu2O6Gp5RvTyJOawqjAfsJZvifc%3D

​

此音色的预览音频。通常是一个公开可访问的网络地址。

​

is_system_voice

​

Boolean

​

false

​

标识当前音色是否为系统预置音色。

​

true

：系统预置音色。

​

false

：用户自定义音色。

​

support_emotions

​

Array of

EmotionInfo

​

[{"emotion":"happy","display_name":"开心","emotion_scale_interval":{"max":5,"min":1,"default":4}},{"emotion":"sad","display_name":"悲伤","emotion_scale_interval":{"max":5,"min":1,"default":3}}]

​

音色支持的情感类型列表，仅当音色为多情感音色时返回。

​

available_training_times

​

Integer

​

6

​

当前音色还可训练的次数。包括首次复刻音色在内，每个自定义音色最多被训练 10 次。

​

​

EmotionInfo

​

​

参数

​

类型

​

示例

​

说明

​

emotion

​

String

​

happy

​

音色支持的情感类型标识符，仅当音色为多情感音色时返回。枚举值如下：

​

happy

：开心。

​

sad

：悲伤。

​

angry

：愤怒。

​

surprised

：惊讶。

​

fear

：恐惧。

​

hate

：厌恶。

​

excited

：兴奋。

​

coldness

：冷漠。

​

neutral

：中性。

​

display_name

​

String

​

开心

​

音色支持的情感类型的中文显示名称，用于直观展示情感类型。

​

emotion_scale_interval

​

Object of

Interval

​

{"max":5,"min":1,"default":4}

​

情感强度的取值范围，用于量化情感的强度。

​

​

Interval

​

​

参数

​

类型

​

示例

​

说明

​

max

​

Double

​

5

​

情感强度的最大值。

​

min

​

Double

​

1

​

情感强度的最小值。

​

default

​

Double

​

4

​

情感强度的默认值。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v1/audio/voices?filter_system_voice=false&model_type=big&voice_state=&page_num=1&page_size=100' \

​

--header 'Authorization

:

Bearer Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json'

​

​

返回示例

​

​

JSON

复制

{

​

"detail"

:

{

​

"logid"

:

"2024102916355736DC98FBC4D32F***"

​

},

​

"data"

:

{

​

"voice_list"

:

[

​

{

​

"preview_audio"

:

"https://lf3-appstore-sign.oceancloudapi.com/ocean-cloud-tos/VolcanoUserVoice/xxxxxx.mp3?lk3s=da27ec82&x-expires=1730277357&x-signature=xu2O6Gp5RvTyJOawqjAfsJZvifc%3D"

,

​

"language_name"

:

"中文"

,

​

"is_system_voice"

:

false

,

​

"preview_text"

:

"你好，欢迎来到AI世界，我是你的专属AI克隆声音，希望未来可以一起好好相处。"

,

​

"create_time"

:

1729686510

,

​

"update_time"

:

1729686510

,

​

"name"

:

"jay"

,

// 音色名称

​

"language_code"

:

"zh"

,

​

"voice_id"

:

"12344"

,

​

"available_training_times"

:

6

,

// 当前音色还可以训练的次数

​

"model_type"

:

"big"

​

}

​

],

​

"has_more"

:

false

​

},

​

"code"

:

0

,

​

"msg"

:

""

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

查看文件详情

下一篇

语音合成
============================================================
# 语音合成
来源: https://www.coze.cn/open/docs/developer_guides/text_to_speech
============================================================

语音合成

将指定文本合成为音频文件。

​

接口描述

​

此 API 用于将指定文本内容合成为自然流畅的音频，同步返回合成的音频文件，适用于有声书合成、智能客服语音、音视频配音等场景。合成音频文件之前，可以先调用

查看音色列表

API，查看所有可用音色。

​

注意

调用语音合成 API 会产生

语音合成费用

，具体费用详情请参考

音视频费用

。

​

​

基础信息

​

​

请求方式

​

POST

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/audio/speech

​

权限

​

createSpeech

​

确保调用该接口使用的个人令牌开通了

createSpeech

权限，详细信息参考

鉴权方式

。

​

接口说明

​

将指定文本合成为音频文件。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

input

​

String

​

必选

​

今天天气怎么样

​

合成语音的文本，经由 UTF-8 编码。长度限制为 1024 字节。

​

voice_id

​

String

​

必选

​

742894********

​

音频文件使用的音色 ID。

​

调用

查看音色列表

API，可查看所有可用音色。

​

emotion

​

String

​

可选

​

happy

​

设置多情感音色的情感类型，仅当

voice_id

为多情感音色时才支持设置情感类型。不同音色支持的情感范围不同，可以通过

系统音色列表

查看各音色支持的情感。默认为空。枚举值如下：

​

happy

：开心。

​

sad

：悲伤。

​

angry

：愤怒。

​

surprised

：惊讶。

​

fear

：恐惧。

​

hate

：厌恶。

​

excited

：兴奋。

​

coldness

：冷漠。

​

neutral

：中性。

​

emotion_scale

​

Double

​

可选

​

3

​

情感值用于量化情感的强度。数值越高，情感表达越强烈，例如： “开心” 的情感值 5 比 1 更显兴奋。

​

取值范围：1.0~5.0，默认值：4.0。

​

response_format

​

String

​

可选

​

mp3

​

音频文件的编码格式，支持设置为：

​

wav：返回二进制 wav 音频。

​

pcm：返回二进制 pcm 音频。

​

ogg_opus：返回多段含 opus 压缩分片音频。

​

mp3：（默认）返回二进制 mp3 音频。

​

speed

​

Double

​

可选

​

1

​

语速，大模型音色的取值范围为 0.5~2，小模型音色的取值范围为 0.2~3，通常保留一位小数即可。

​

其中 0.2 表示 0.2 倍速，3 表示 3 倍速。默认为 1，表示 1 倍速。

​

sample_rate

​

Integer

​

可选

​

24000

​

音频采样率，单位为 Hz。

​

8000：8k

​

16000：16k

​

22050：22.05k

​

24000：（默认）24k

​

32000：32k

​

44100：44.1k

​

48000：48k

​

loudness_rate

​

Integer

​

可选

​

30

​

音频输出音量的增益或衰减比例，以百分比形式表示。取值范围为

-50

~

100

，默认值为 0，表示原始音量。

​

负值表示衰减：

-50

表示音量降低 50%（即 0.5 倍）。

​

正值表示增益：

100

表示音量提升 100%（即 2 倍）。

​

context_texts

​

String

​

可选

​

用低沉沙哑的语气、带着沧桑与绝望地说

​

语音合成的辅助信息，用于控制合成语音的整体情绪（如悲伤、生气）、方言（如四川话、北京话）、语气（如撒娇、暧昧、吵架、夹子音）、语速（快慢）及音调（高低）等。

​

默认为空。

​

说明

仅当

voice_id

为豆包语音合成大模型 2.0 音色时才支持该参数，具体音色列表请参见

系统音色列表

。

​

更多关于豆包语音合成 2.0 的

context_texts

示例和效果可参考

语音指令-示例库

。

​

​

​

​

返回参数

​

如果成功调用此 API，接口会直接返回语音文件的内容。

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/audio/speech' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json' \

​

-d '

{

​

"input"

:

"你好呀"

,

​

"voice_id"

:

"742894*********"

,

​

"response_format"

:

"wav"

​

}

'

​

--output speech.wav

​

​

返回示例

​

无

​

错误码

​

如果调用此 API 失败，返回信息中包含 code 和 msg 字段。其中 code 为非 0 的错误码，表示接口调用失败；msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

查看音色列表

下一篇

语音识别
============================================================
# 语音识别
来源: https://www.coze.cn/open/docs/developer_guides/audio_transcriptions
============================================================

语音识别

将音频文件转录为文本。

​

接口描述

​

此 API 用于将指定音频文件转录为文本。

​

注意

调用语音识别 API 会产生

语音识别费用

，具体费用详情请参考

音视频费用

。

​

​

语音文件的具体限制如下：

​

​

限制

​

说明

​

文件格式

​

大模型语音识别支持的文件格式：opus、ogg、mp3、wav、m4a、mp4、pcm、raw、spx、aac、amr。

​

小模型语音识别支持的文件格式：ogg、mp3、wav、mp4、m4a。

​

文件大小

​

每个音频文件最大为 10 MB，并且时长需小于 30 分钟。

​

​

说明

上传的音频文件的采样率和码率等参数无限制。

​

如果语音文件过大，建议调用 WebSocket 的

双向流式语音识别 API

分片上传文件。

​

​

基础信息

​

​

请求方式

​

POST

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/audio/transcriptions

​

权限

​

createTranscription

​

确保调用该接口使用的个人令牌开通了

createTranscription

权限，详细信息参考

鉴权方式

。

​

接口说明

​

将音频文件转录为文本。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

multipart/form-data

​

解释请求正文的方式。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

body

​

File

​

必选

​

-

​

需要语音识别的音频文件的二进制数据，具体文件格式和大小限制请参考接口说明部分。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

状态码。

​

0

代表调用成功。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

AudioTranscriptionsData

​

{"text":"你好，请问有什么可以帮您的吗？"}

​

语音文件对应的文本内容，即语音识别后转换成的文字结果。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

AudioTranscriptionsData

​

​

参数

​

类型

​

示例

​

说明

​

text

​

String

​

你好，请问有什么可以帮您的吗？

​

语音文件对应的文本内容，即语音识别后转换成的文字结果。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/audio/transcriptions' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

multipart/form-data' \

​

--form 'file=@

"/xx/xx/xx/jay.MP3"

'

​

​

返回示例

​

​

JSON

复制

{

​

"detail"

:

{

​

"logid"

:

"202410291302044CD1CC3B4AE0897***"

​

},

​

"data"

:

{

​

"text"

:

"你好呀"

​

},

​

"code"

:

0

,

​

"msg"

:

""

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

语音合成

下一篇

复刻音色
============================================================
# 复刻音色
来源: https://www.coze.cn/open/docs/developer_guides/clone_voices
============================================================

复刻音色

复刻指定音频文件中人声的音色。

​

接口说明

​

注意

仅扣子企业版（企业标准版、企业旗舰版）用户可以使用音色复刻功能。

​

企业版订阅套餐中默认赠送了一个复刻音色，如需调用复刻音色 OpenAPI 复刻更多音色，请联系超级管理员或管理员购买音色复刻扩容包，具体步骤请参见

购买音色复刻扩容包

。  音色复刻涉及

音色数量费用

和

音色模型存储数费用

，详细的费用信息可参考

音视频费用

。

​

调用此 API 之前请确认账户中资源点或余额充足，以免账号欠费导致服务中断

。

​

​

和扣子智能体进行实时的智能语音通话时，你可以选择智能体使用的音色，支持使用扣子编程提供系统内置音色，或通过

复刻音色

API 复刻出的自定义音色。

​

此 API 用于上传音频文件复刻一个新的音色。调用此 API 时需要上传一个音频文件作为音色复刻的素材。扣子编程会自动复刻音频文件中的人声音色，并将音色保存在当前账号的音色列表中。复刻出的音色可以用于合成语音，或者在扣子编程实时通话中作为智能体的音色。

​

说明

在工作空间中复刻的音色资源仅限于该工作空间的成员使用。即使在同一个企业中，不同工作空间复刻的音色资源是独立的，不允许跨空间使用。

​

同一个音色 ID 最多复刻 10 次。为节省音色成本，你可以调用此接口训练自己已复刻的音色，即录制一个新的音频文件重新复刻音色，训练后的音色会覆盖原音色，但音色 ID 不变。例如，购买一个音色后，你可以对这个音色重新免费复刻 9 次。

​

必须使用 multipart/form-data 方式上传音频文件。

​

​

音色复刻素材要求

​

上传的音频文件素材应符合以下要求：

​

​

类别

​

说明

​

文件格式

​

wav、mp3、ogg、m4a、aac、pcm。其中 pcm 仅支持 24k 采样率，单通道。

​

文件大小

​

最大不超过 10MB。每次最多上传1个音频文件。

​

音频时长

​

建议 10s~30s。

​

语种

​

支持中文、英文、日语、西班牙语、印度尼西亚语葡萄牙语。

​

文件录制

​

录制环境：选择安静的空间，建议将麦克风放置在离说话人50厘米以内的位置，尽量保持自然的发声状态，避免刻意改变声线或呢喃，这样得到的音色会更加自然。

​

音频质量：确保录音中只包含一个人的声音，说话人应保持清晰的发音和音质、稳定的音量和语速，保持姿态稳定。

​

录制内容：避免说话时韵律过于平淡，尽量让语调、节奏和强度有所变化，尽量不要尝试复刻小孩或老人的声音。

​

​

​

基础信息

​

​

请求方式

​

POST

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/audio/voices/clone

​

权限

​

createVoice

​

确保调用该接口使用的个人令牌开通了

createVoice

权限，详细信息参考

鉴权方式

。

​

接口说明

​

复刻指定音频文件中人声的音色。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

voice_name

​

String

​

必选

​

开朗大男孩

​

此音色的名称，长度限制为 128 字节。

​

text

​

String

​

可选

​

你好呀

​

音频文件对应的文案。需要和音频文件中人声朗读的内容大致一致，扣子编程服务会对比音频与该文本的差异，若差异过大会报错 1109 WERError。最大长度为 1024 字节。

​

language

​

String

​

可选

​

zh

​

音频文件中的语种，支持以下语种：

​

zh：中文

​

en：英文

​

ja：日语

​

es：西班牙语

​

id：印度尼西亚语

​

pt：葡萄牙语

​

voice_id

​

String

​

可选

​

734829333445931****

​

需要训练的音色 ID，扣子编程支持重新复刻音色，也就是训练音色，训练后的音色会覆盖原有的音色。

​

仅在训练音色时需要指定此参数。如果复刻一个新的音色，则无需指定此参数，扣子编程会为新音色分配一个音色 ID。

​

preview_text

​

String

​

可选

​

你好，我是你的专属AI克隆声音

​

预览音频的文案。如果成功复刻音色，扣子编程会根据此文案生成一段新音色的预览音频。

​

未指定文案时，使用默认文案“你好，我是你的专属AI克隆声音，希望未来可以一起好好相处哦"。

​

space_id

​

String

​

可选

​

736163827687053****

​

克隆音色保存的扣子编程工作空间 ID，默认保存在当前账号的个人空间中。

​

获取方式：进入指定空间，空间页面 URL 中

w

参数后的数字就是 工作空间 ID。例如

https://code.coze.cn/w/75814654762959***/projects

，工作空间 ID 为

75814654762959***

。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

状态码。

​

0

代表调用成功。

​

data

​

Object of

CloneVoiceData

​

{ "voice_id": "xxx" }

​

新音色的详细信息。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

CloneVoiceData

​

​

参数

​

类型

​

示例

​

说明

​

voice_id

​

String

​

734829333445931****

​

复刻后的音色 ID，后续语音生成或重新克隆音色时需要传入该音色 ID。请妥善保存该 ID。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/audio/voices/clone' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json' \

​

--form 'voice_name=

"jay"

' \

​

--form 'preview_text=

"你好，欢迎来到AI世界，我是你的专属AI克隆声音，希望未来可以一起好好相处。"

' \

​

--form 'audio_format=

"mp3"

' \

​

--form 'file=@

"/xx/xx/xx/jay.MP3"

'

​

​

返回示例

​

​

JSON

复制

{

​

"detail"

:

{

​

"logid"

:

"202410242028595CCF353CEC86A8*****"

​

},

​

"data"

:

{

​

"voice_id"

:

"xxx"

// 复刻后音色ID，请保存好，后续语音生成或者重新克隆音色需要传入

​

},

​

"code"

:

0

,

​

"msg"

:

""

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

语音识别

下一篇

创建房间
============================================================
# 创建房间
来源: https://www.coze.cn/open/docs/developer_guides/create_room
============================================================

创建房间

创建房间，并将智能体加入房间。

​

接口描述

​

注意

调用创建房间 API 之后，智能体随即加入房间并开始计费，包括智能体的

对话式 Al-音频费用

和

语音通话费用

，具体费用详情请参考

音视频费用

。

为避免不必要的费用产生，请在调用接口前仔细了解费用详情，并合理控制创建房间接口的调用频率。

​

用户未加入房间与智能体进行对话时，智能体会在房间等待用户 3 分钟，这期间会产生 3 分钟的最低费用。

​

​

扣子智能语音功能通过 RTC 技术实现用户和智能体的实时语音通话。在 RTC 领域中，房间是一个虚拟的概念，类似逻辑上的分组，同一个房间内的用户才能互相接收和交换音视频数据、实现音视频通话。

​

此 API 用于创建一个房间，并将智能体加入房间，然后才能调用 RTC SDK 和智能体开始语音通话。

​

基础信息

​

​

请求方式

​

POST

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/audio/rooms

​

权限

​

createRoom

​

确保调用该接口使用的令牌开通了

createRoom

权限，详细信息参考

鉴权方式

。

​

接口说明

​

创建房间，并将智能体加入房间。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

bot_id

​

String

​

必选

​

73428668*****

​

智能体 ID。

​

进入智能体的开发页面，开发页面 URL 中 bot 参数后的数字就是智能体 ID。例如

https://www.coze.com/space/341****/bot/73428668*****

，bot ID 为

73428668*****

。

​

conversation_id

​

String

​

可选

​

734829333445931****

​

会话 ID。后续调用发起对话 API 产生的消息记录都会保存在此对话中。

​

调用

创建会话

API 可以创建一个会话。若未指定会话 ID，扣子编程会默认创建一个新的会话。

​

voice_id

​

String

​

可选

​

734829333445931****

​

智能体使用的音色 ID，默认为

柔美女友

音色。

​

你可以通过

查看音色列表

API 获取音色 ID。

​

config

​

Object of

RoomConfig

​

可选

​

-

​

房间内的音视频参数配置。

​

uid

​

String

​

可选

​

uid_123

​

标识当前与智能体对话的用户，由使用方自行定义、生成与维护。uid 用于标识对话中的不同用户，不同的 uid，其对话的数据库等对话记忆数据互相隔离。如果不需要用户数据隔离，可以不传此参数。

​

​

RoomConfig

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

room_mode

​

String

​

可选

​

default

​

房间模式，默认值为

default

。枚举值：

​

default

：对话模式。

​

podcast

：播客模式。

​

audio_config

​

Object of

AudioConfig

​

可选

​

\

​

房间音频配置。

​

video_config

​

Object of

VideoConfig

​

可选

​

\

​

房间视频配置。

​

turn_detection

​

Object of

TurnDetectionConfig

​

可选

​

{"type":"server_vad"}

​

语音检测配置，用于控制语音交互的检测方式。

​

prologue_content

​

String

​

可选

​

\

​

自定义开场白。

​

prologue_delay_duration_ms

​

Integer

​

可选

​

100

​

在进房后等待多长时间播放开场白，单位：ms。

​

默认为 500ms，取值范围为 0~5000。

​

​

AudioConfig

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

codec

​

String

​

可选

​

OPUS

​

房间音频编码格式，支持设置为：

​

AACLC：AAC-LC 编码格式。

​

G711A：G711A 编码格式。

​

OPUS：（默认）Opus 编码格式。

​

G722：G.722 编码格式。

​

​

VideoConfig

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

codec

​

String

​

可选

​

H264

​

房间视频编码格式，支持设置为：

​

H264：（默认）H264 编码格式。

​

BYTEVC1：火山引擎自研的视频编码格式。

​

video_frame_rate

​

Integer

​

可选

​

15

​

每秒抽帧数，在视频通话过程中，摄像头/屏幕共享捕捉画面的频率。捕捉到的画面会作为视觉模型的输入。

​

默认值为

1

，取值范围为 1~24。

​

stream_video_type

​

String

​

可选

​

main

​

房间视频流类型, 支持 main 和 screen。

​

main：主流，包括通过摄像头/麦克风的内部采集机制获取的流，以及通过自定义采集方式获取的流。

​

screen：屏幕流，用于屏幕共享或屏幕录制的视频流。

​

video_frame_expire_duration

​

Integer

​

可选

​

5

​

用户开始说话前，抽取多少秒画面。主要是兼容连贯动作的场景。用于帮模型理解用户没开始说话前在做什么。

​

单位为秒，默认值为

1

，取值范围为 1~10。

​

​

TurnDetectionConfig

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

type

​

String

​

可选

​

server_vad

​

语音检测类型，用于控制语音交互的检测方式，默认值为

server_vad

。枚举值：

​

server_vad

：自由对话模式，扣子编程云端通过语音活动检测（VAD）自动判断语音的开始和结束，实现无缝的自然对话体验。

​

client_interrupt

：按键说话模式，由客户端控制语音的开始与结束，需配合 Realtime 上行事件

input_audio_buffer.start

和

input_audio_buffer.complete

使用。

​

semantic_vad

：采用语义判停的自由对话模式（

此功能仅对企业旗舰版用户开放

），由服务端识别语义来判断是否停止说话。

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

状态码。

​

0

代表调用成功。

​

data

​

Object of

CreateRoomData

​

-

​

接口返回的业务数据。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{ "logid": "202410291302044CD1CC3B4AE0897***" }

​

本次请求的详细信息。

​

​

CreateRoomData

​

​

参数

​

类型

​

示例

​

说明

​

uid

​

String

​

uid_123

​

进入房间的用户 ID，和入参中 uid 一致。

​

token

​

String

​

token123

​

房间密钥，用户加入房间和智能体对话时需要通过 token 进行身份认证和鉴权。

​

app_id

​

String

​

app_id

​

RTC 应用 ID。

​

room_id

​

String

​

room_id_123

​

已创建的 RTC 房间的房间 ID。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/audio/rooms' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"bot_id"

:

"734829333445931****"

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"detail"

:

{

​

"logid"

:

"202410291302044CD1CC3B4AE0897***"

​

},

​

"data"

:

{

​

"room_id"

:

"room_id_743105798342***"

,

// 房间 id

​

"app_id"

:

"6705332c79516e01****"

,

// app_id

​

"token"

:

"0016705*****NzkxMxcANTE1MjkFAAAAAAAAAAEAAAAAACAA58QEAvxd****/VB4b1xEFA="

,

​

"uid"

:

"uid_74310579834270***"

​

},

​

"code"

:

0

,

​

"msg"

:

""

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

复刻音色

下一篇

Realtime 上行事件
============================================================
# Realtime 上行事件
来源: https://www.coze.cn/open/docs/developer_guides/signaling_uplink_event
============================================================

Realtime 上行事件

本文介绍扣子编程智能语音信令事件中的上行事件。智能体进房后才能发送上行事件，具体请参见

​

集成音视频 Realtime Web SDK

。

​

说明

事件 ID：每个上行事件 ID 建议不要重复，故障排查场景下便于定位问题。

​

事件发送时机：确保在监听到 Realtime SDK 的 onUserJoined 回调智能体进房后再发送上行事件。

​

事件发送对象：需要发送给房间内的智能体，需要指定传入的 user_id 为创建房间接口传入的 bot_id，而不是创建房间接口返回的 uid。

​

​

更新房间配置

​

事件类型

：

session.update

​

事件说明

：此事件可更新房间内的配置项。

​

传入哪个字段就改哪个字段，填空值也会更新；若不想修改某个字段，则不要传入该字段更新 RTC 房间的配置信息。支持更新智能体音色、语速等配置，也可以修改 meta_data 等对话配置。 所有参数都是可选的，如果不需要修改某个配置，可以省略对应的参数。

​

若更新成功，会收到下行事件 "session.updated"，否则，会收到下行事件 "error"。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

必填

session.update

。

​

data

​

Object

​

可选

​

事件数据，包含会话配置的详细信息。

​

data.speech_rate

​

Integer

​

可选

​

模型回复的语速，取值范围 [-50, 100]，默认为 0。-50 表示 0.5 倍速，100 表示 2 倍速。

​

data.loudness_rate

​

Integer

​

可选

​

输出音频的音量，取值范围 [-50, 100]，默认为 0。-50 表示 0.5 倍音量，100 表示 2 倍音量。

​

data.longest_silence_ms

​

Integer

​

可选

​

当智能体处于长时间沉默状态时，房间将自动解散。此时间以毫秒（ms）为单位计量，默认时长为 180,000 毫秒。

​

data.event_subscriptions

​

Array<String>

​

可选

​

需要订阅下行事件的事件类型列表。不设置或者设置为空为订阅所有下行事件。

​

data.chat_config

​

Object

​

可选

​

会话配置。

​

data.chat_config.meta_data

​

Map<String, String>

​

可选

​

附加信息，通常用于封装一些业务相关的字段。查看对话消息详情时，系统会透传此附加信息。自定义键值对，应指定为 Map 对象格式。长度为 16 对键值对，其中键（key）的长度范围为 1～64 个字符，值（value）的长度范围为 1～512 个字符。

​

data.chat_config.custom_variables

​

Map<String, String>

​

可选

​

智能体中定义的变量。在智能体 prompt 中设置变量 {{key}} 后，可以通过该参数传入变量值，同时支持 Jinja2 语法。变量名只支持英文字母和下划线。

​

data.chat_config.extra_params

​

Map<String, String>

​

可选

​

附加参数，通常用于特殊场景下指定一些必要参数供模型判断，例如指定经纬度，并询问智能体此位置的天气。自定义键值对格式，其中键（key）仅支持设置为：

​

latitude

：纬度，此时值（Value）为纬度值，例如 39.9800718。

​

longitude

：经度，此时值（Value）为经度值，例如 116.309314。

​

data.chat_config.plugin_interrupt_mode

​

String

​

可选

​

端插件执行模式，可选值有

blocking

/

nonblocking

，默认为

nonblocking

。

​

blocking

模式下，遇到端插件执行后，会阻塞后续的对话，直到提交端插件结果。

​

nonblocking

模式下，遇到端插件执行后，若未提交端插件结果继续对话，则端插件请求会被丢弃。

​

data.chat_config.allow_voice_interrupt

​

Boolean

​

可选

​

是否打开语音打断功能，默认为

true

。

​

data.chat_config.interrupt_config

​

Object

​

可选

​

语音打断配置，仅在 allow_voice_interrupt 为

true

时生效

​

data.chat_config.interrupt_config.mode

​

String

​

必选

​

语音打断模式，可选值有

all

/

keyword_contains

/

keyword_prefix

，默认为

all

。

​

all

模式下，任意内容都可以打断模型回复。

​

keyword_contains

模式下，说话内容

包含

关键词才会打断模型回复。例如关键词"扣子"，用户正在说“你好呀扣子......” / “扣子你好呀”，模型回复都会被打断。

​

keyword_prefix

模式下，说话内容

前缀匹配

关键词才会打断模型回复。例如关键词"扣子"，用户正在说“扣子你好呀......”，模型回复就会被打断，而用户说“你好呀扣子......”，模型回复不会被打断。

​

data.chat_config.interrupt_config.keywords

​

Array<String>

​

可选

​

关键词列表，每个关键词长度不超过8个字，最多10个关键词，仅在

keyword_contains

/

keyword_prefix

模式下生效。

​

data.chat_config.parameters

​

Map<String, Any>

​

可选

​

设置对话流的自定义输入参数的值并传递给对话流，具体用法和示例代码可参考

​

为自定义参数赋值

。

​

data.turn_detection

​

Object

​

可选

​

声音检测配置。

​

data.turn_detection.type

​

String

​

可选

​

语音检测模式，默认为

server_vad

，可选项包括：

​

server_vad

：语音活动检测由扣子编程服务端完成，客户端将音频流持续发送到服务端，服务端在接收到音频后，通过服务端 VAD 检测语音的开始和结束。

​

client_vad

：客户端使用自己的 VAD 检测语音的开始和结束，并将检测到的语音片段发送到服务器进行识别。

​

semantic_vad

：采用语义判停的自由对话模式（

此功能仅对企业旗舰版用户开放

），由服务端识别语义来判断是否停止说话。

​

详细的检测逻辑请参见

​

如何设置扣子的语音检测模式？

。

​

data.turn_detection.prefix_padding_ms

​

Integer

​

可选

​

VAD 检测到语音之前要包含的音频量，单位为 ms。默认为 600ms。

​

data.turn_detection.silence_duration_ms

​

Integer

​

可选

​

server_vad

模式下，检测语音停止的静音持续时间，单位为 ms。取值范围为 200~2000，默认为 500ms。

​

data.turn_detection.semantic_vad_config

​

Object

​

可选

​

semantic_vad

模式下，配置判定语音停止的语义检测策略。

​

data.turn_detection.semantic_vad_config.silence_threshold_ms

​

Integer

​

可选

​

当用户暂停说话时，持续静音多久后，触发语义判停检测。单位为 ms。默认为 300ms。

​

data.turn_detection.semantic_vad_config.semantic_unfinished_wait_time_ms

​

Integer

​

可选

​

当语义检测判断该语句未结束时，持续静音多久后，扣子编程认定语音结束。单位为 ms。默认为 500ms。取值范围为 100~2000。

​

data.asr_config.stream_mode

​

String

​

可选

​

ASR 识别的模式。

​

output_no_stream

：不会逐字返回语音识别结果，而是等整段语音结束后统一输出完整文本。异步语音消息场景中推荐使用该模式，会整合整句音频信息做上下文分析，减少实时截断导致的误差，提升准确率。

​

bidirectional_stream

（默认值）：逐字的返回语音识别的结果。

​

data.asr_config.context

​

String

​

可选

​

上下文，限制 800 tokens，超出后自动截断。

​

data.asr_config.enable_itn

​

Boolean

​

可选

​

将语音转为文本时，是否开启文本规范化（ITN）处理，将识别结果转换为更符合书面表达习惯的格式以提升可读性。默认为

true

。

​

开启后，会将口语化数字转换为标准数字格式，示例：

​

将

两点十五分

转换为

14:15

。

​

将

一百美元

转换为

$100

。

​

data.asr_config.enable_punc

​

Boolean

​

可选

​

将语音转为文本时，是否给文本加上标点符号。默认为

true

。

​

data.asr_config.enable_ddc

​

Boolean

​

可选

​

将语音转为文本时，是否启用顺滑，默认为

true

。

​

true

：系统在进行语音处理时，会去掉识别结果中诸如 “啊”“嗯” 等语气词，使得输出的文本语义更加流畅自然，符合正常的语言表达习惯，尤其适用于对文本质量要求较高的场景，如正式的会议记录、新闻稿件生成等。

​

false

：系统不会对识别结果中的语气词进行处理，识别结果会保留原始的语气词。

​

data.asr_config.enable_nostream

​

Boolean

​

可选

​

是否开启

二次识别模式

：

​

true

：会实时返回逐字识别的文本；当一句话结束时，会结合整句音频进行上下文分析并重新识别，生成优化后的识别结果并返回。这种机制既能满足客户实时上屏的需求，又能确保最终结果的识别准确率。

​

false

（默认值）：仅进行一次实时识别，逐字返回文本，不会在一句话结束时重新识别分句，可能存在一定的识别误差。

​

data.asr_config.enable_emotion

​

Boolean

​

可选

​

识别说话人的情绪

。仅在

data.asr_config.stream_mode

为

output_no_stream

时生效。默认为

false

。

​

支持的情绪标签包括：

​

angry

：表示情绪为生气

​

happy

：表示情绪为开心

​

neutral

：表示情绪为平静或中性

​

sad

：表示情绪为悲伤

​

surprise

：表示情绪为惊讶

​

data.asr_config.enable_gender

​

Boolean

​

可选

​

是否开启识别说话人的性别（male/female），仅在

data.asr_config.stream_mode

为

output_no_stream

时生效。默认为

false

。

​

data.asr_config.sensitive_words_filter

​

Object

​

可选

​

敏感词过滤功能，支持以下 3 种过滤方式：

​

过滤系统敏感词，并替换为

*

。

​

过滤自定义敏感词，并替换为空。

​

过滤自定义敏感词，并替换为

*

。

​

data.asr_config.sensitive_words_filter.system_reserved_filter

​

Boolean

​

可选

​

是否过滤系统自带的敏感词，并将

匹配到的敏感词替换为

*

。（系统自带敏感词主要包含一些限制级词汇）。默认为

false

。

​

data.asr_config.sensitive_words_filter.filter_with_empty

​

Array<string>

​

可选

​

自定义需替换为空的敏感词列表。

​

data.asr_config.sensitive_words_filter.filter_with_signed

​

Array<string>

​

可选

​

自定义需替换为

*

的敏感词列表。

​

data.voice_print_config

​

Object

​

可选

​

声纹识别配置。

​

data.voice_print_config.group_id

​

String

​

可选

​

声纹组 ID。语音通话时，扣子编程会在该声纹组内进行查找匹配对应的声纹，当声纹匹配度高于

score

阈值，则认为是同一个人的声音。

​

你可以通过

查看声纹组列表

API 查看声纹组 ID。

​

data.voice_print_config.score

​

Integer

​

可选

​

声纹匹配的命中阈值，即声音匹配度的最低标准。当声音匹配度达到或超过该阈值时，扣子编程才会认定声纹匹配成功。你可以根据应用的安全性要求进行自定义设置。如果匹配了多轮声纹，扣子编程会取相似度最高的一个。

​

取值范围：0~100，默认值：40。

​

data.voice_print_config.reuse_voice_info

​

Boolean

​

可选

​

当本轮对话未命中任何声纹时，是否沿用历史声纹信息。

​

true

：未命中声纹时，智能体将返回上一次命中的声纹。适用于连续对话场景，当收音不好等情况导致声纹没能正确被识别时，保障对话的连贯性。

​

false

：（默认值）未命中声纹时，智能体返回空的声纹信息。

​

data.voice_id

​

String

​

可选

​

音色 ID。

​

data.tts_config

​

Object

​

可选

​

配置语音合成的相关参数，用于控制合成语音的整体风格与情感表达，包括辅助信息（如情绪、方言、语气等）、多情感音色的情感类型及强度等。

​

data.tts_config.context_texts

​

String

​

可选

​

语音合成的辅助信息，用于控制合成语音的整体情绪（如悲伤、生气）、方言（如四川话、北京话）、语气（如撒娇、暧昧、吵架、夹子

音）、语速（快慢）及音调（高低）等。默认为空。

​

示例：用低沉沙哑的语气、带着沧桑与绝望地说。

​

说明

仅当

voice_id

为

豆包语音合成大模型 2.0 音色

时才支持该参数，具体支持的音色列表请参见

​

系统音色列表

。

​

更多关于豆包语音合成 2.0 的

context_texts

示例和效果可参考

语音指令-示例库

。

​

​

data.tts_config.emotion

​

String

​

可选

​

设置多情感音色的情感类型，仅当

voice_id

为多情感音色时才需要设置。

​

不同音色支持的情感范围不同，可以通过

系统音色列表

查看各音色支持的情感。默认为空。枚举值如下：

​

happy-开心

​

sad-悲伤

​

angry-生气

​

surprised-惊讶

​

fear-恐惧

​

hate-厌恶

​

excited-激动

​

coldness-冷漠

​

neutral-中性

​

data.tts_config.emotion_scale

​

Float

​

可选

​

情感值用于量化情感的强度。数值越高，情感表达越强烈，例如： “开心” 的情感值 5 比 1 更显兴奋。

​

仅当

voice_id

为多情感音色时才需要设置。

​

取值范围：1.0~5.0，默认值：4.0。

​

data.voice_processing_config

​

Object

​

可选

​

语音降噪配置。默认不启用降噪。

​

说明

仅扣子企业旗舰版支持该配置。

​

​

data.voice_processing_config.enable_ans

​

Boolean

​

可选

​

主动噪声抑制。自动识别并过滤掉背景环境中的各种噪音（如键盘声、空调声、街道嘈杂声），让说话者的声音更清晰。

​

此功能与下面的

enable_pdns

（声纹降噪）只能

二选一开启

，不能同时使用。

​

data.voice_processing_config.enable_pdns

​

Boolean

​

可选

​

声纹降噪。专门针对

特定说话人

的声音进行优化，能更精准地保留目标人声。

​

此功能与上面的

enable_ans

只能

二选一开启

，不能同时使用。

​

提供两种模式，你可以根据需要选择：

​

自动提取：设置简单，开箱即用。默认为该模式。

降噪生效稍微有延迟

，服务端需要先听你说一会儿话才能提取出你的声纹特征，在此期间降噪效果可能不佳。另外，提取声纹会受到用户说话场景影响，准确性上可能会弱于主动设置。

​

主动设置：

降噪效果更精准、更快速

，在对话开始时就立即生效。不过需要提前录制声纹并在

voice_print_feature_id

中设置声纹 ID。

​

data.voice_print_config.feature_id

​

String

​

可选

​

目标说话人的声纹 ID。当你选择开启

enable_pdns

（声纹降噪）并希望使用

主动设置

模式时，需要在此处填入你提前录制好的声纹 ID。

​

你可以通过扣子编程录制声纹，具体请参见

​

声纹识别

，或通过

​

创建声纹

API 上传声纹并获取声纹 ID。

​

​

事件示例：

​

​

JSON

复制

{

​

"id"

:

"7446668538246561828"

,

​

"event_type"

:

"session.update"

,

​

"data"

:

{

​

"voice_id"

:

"7426720361733046281"

,

// 音色 ID

​

"speech_rate"

:

0

,

// [-50, 100]

​

"longest_silence_ms"

:

180000

,

​

"event_subscriptions"

:

[

"error"

],

​

"chat_config"

:

{

​

"meta_data"

:

{

​

"a"

:

"123"

​

},

​

"custom_variables"

:

{

​

"a"

:

"123"

​

},

​

"extra_params"

:

{

​

"a"

:

"123"

​

},

​

"plugin_interrupt_mode"

:

"nonblocking"

,

// 控制收到端插件执行中断信号后，没有提交端执行请求时的模型

​

// 端插件的执行模型，默认不阻塞，blocking/nonblocking，阻塞的场景如果不提交端执行请求就会让语音链路一直block住

​

"allow_voice_interrupt"

:

true

,

​

"interrupt_config"

:

{

​

"mode"

:

"keyword_prefix"

,

​

"keywords"

:

[

"扣子"

]

​

},

​

"parameters"

:

{

​

"a"

:

123

,

​

"b"

:

"abc"

​

}

​

},

​

"turn_detection"

:

{

​

"type"

:

"server_vad"

,

// server_vad/client_vad

​

"prefix_padding_ms"

:

600

,

​

"silence_duration_ms"

:

500

​

},

​

"asr_config"

:

{

​

"hot_words"

:

[

"扣子"

],

​

"enable_itn"

:

true

,

​

"enable_punc"

:

true

,

​

"enable_ddc"

:

true

​

}

​

}

​

}

​

​

提交端插件执行结果

​

事件类型

：

conversation.chat.submit_tool_outputs

​

事件说明

：你可以将需要客户端执行的操作定义为插件，对话中如果触发这个插件，会收到一个

event_type = “conversation.chat.requires_action”

的下行事件，此时需要执行客户端的操作后，通过此上行事件来提交插件执行后的结果。作用等同于

​

提交工具执行结果

API。

​

事件结构

：

​

​

参数

​

​

类型

​

是否必选

​

说明

​

id

​

​

String

​

必选

​

事件 ID，也就是事件的唯一标识。由客户端生成，在故障排查场景下用于定位具体的事件，便于排查问题。

​

event_type

​

​

String

​

必选

​

固定为 conversation.chat.submit_tool_outputs。

​

data

​

chat_id

​

String

​

必选

​

对话 ID。

​

​

tool_outputs

​

JSON Array

​

必选

​

工具执行结果。具体的结构定义可参考

​

提交工具执行结果

API。

​

​

tool_outputs.tool_call_id

​

String

​

必选

​

上报运行结果的 ID。你可以在

端插件请求

事件的 tool_calls 字段下查看此 ID。

​

​

tool_outputs.output

​

String

​

必选

​

工具的执行结果。

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"7446668538246561829"

,

​

"event_type"

:

"conversation.chat.submit_tool_outputs"

,

​

"data"

:

{

​

"chat_id"

:

"7446675275930271785"

,

​

"tool_outputs"

:

[

​

{

​

"tool_call_id"

:

"BUJJRUUVEhJGERVeEkRDFV5HEkJAXktLQBZeEEAXREpLSxZFR****="

,

​

"output"

:

"{\"url\":\"https://lf3-bot-platform-tos-sign.coze.cn/bot-studio-bot-platform/bot_files/323733792754532/image/jpeg/7446661351415529491/blob****\"}"

​

}

​

]

​

}

​

}

​

​

中断 Agent 语音输出

​

事件类型

：

conversation.chat.cancel

​

事件说明

：发送此事件可取消正在进行的对话。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

string

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

string

​

必选

​

固定为conversation.chat.cancel。

​

​

事件示例：

​

​

JSON

复制

{

​

"id"

:

"7446668538246561827"

,

​

"event_type"

:

"conversation.chat.cancel"

,

​

"data"

:

{}

​

}

​

​

手动提交对话内容

​

事件类型

：conversation.message.create

​

事件说明

：

​

若 role=user，提交事件后就会生成语音回复，适合如下的场景，比如帮我解析xx链接，帮我分析这个图片的内容等。

​

若 role=assistant，提交事件后会加入到对话的上下文。

​

事件结构

：

​

​

参数

​

​

类型

​

是否必选

​

说明

​

id

​

​

string

​

必

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

​

string

​

必选

​

固定为conversation.message.create。

​

data

​

role

​

string

​

​

必选

​

发送这条消息的实体。取值：

​

user

：代表该条消息内容是用户发送的。

​

assistant

：代表该条消息内容是智能体发送的。

​

​

content_type

​

​

string

​

必选

​

消息内容的类型，支持设置为：

​

text：文本

​

object_string：多模态内容，即文本和文件的组合、文本和图片的组合，参考

​

​

content

​

string

​

必选

​

消息的内容，支持纯文本、多模态（文本、图片、文件混合输入）、卡片等多种类型的内容。参考

object_string object

。

​

​

事件示例：

​

​

JSON

复制

{

​

"id"

:

"7446668538246561826"

,

​

"event_type"

:

"conversation.message.create"

,

​

"data"

:

{

​

"role"

:

"user"

,

// user/assistant

​

"content_type"

:

"object_string"

,

// text/object_string

​

"content"

:

"[{\"type\":\"text\",\"text\":\"帮我看看这个PDF里有什么内容？\"},{\"type\":\"file\",\"file_url\":\"https://lf3-appstore-sign.oceancloudapi.com/ocean-cloud-tos/eaafba63-0d96-4ea6-b60c-fbadcf2c25e9.?lk3s=edeb9e45&x-expires=1718296132&x-signature=YtlsUsvSeLJi6x31I%2F4S9X53Y6Y%3D\"}]"

​

}

​

}

​

​

客户端 VAD 检测

​

事件类型

：

client.vad

​

事件说明

：客户端侧的 VAD 检测结果，仅在

turn_detection.type="client_vad"

时生效。

​

事件结构

：

​

​

参数

​

​

类型

​

是否必选

​

说明

​

id

​

​

string

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

​

string

​

必选

​

固定为client.vad。

​

data

​

vad

​

boolean

​

必选

​

客户端自行检测的 vad 值，只需在变化时上传。

​

​

事件示例：

​

​

JSON

复制

{

​

"id"

:

"74466685382465618283"

,

​

"event_type"

:

"client.vad"

,

​

"data"

:

{

​

"vad"

:

true

/

false

​

}

​

}

​

​

更新安抚配置

​

事件类型

：

session.pre_answer.update

​

事件说明

：此事件可更新房间内的安抚配置，若更新成功，会收到下行事件 "session.pre_answer.updated"，否则，会收到下行事件 "error"。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

session.pre_answer.update

。

​

data

​

Object

​

必选

​

事件数据，包含安抚配置的详细信息。

​

data.pre_answer

​

Object

​

必选

​

安抚配置。

​

data.pre_answer.type

​

String

​

必选

​

安抚生成类型，可选类型有

none

/

audio

/

text

/

bot

。

​

none

：取消安抚策略，默认值。

​

audio

：根据用户上传的音频文件作为安抚语。

​

text

：根据用户输入的文本生成安抚语。

​

bot

：指定另一个智能体作为安抚语的生成载体。

​

data.pre_answer.file_id

​

String

​

可选

​

仅在

audio

模式下生效，用户需要先通过上传文件接口上传一个音频文件，传入该接口返回的

file_id

。当前仅支持

wav

\

mp3

音频文件。

​

data.pre_answer.pre_answer_list

​

Array<String>

​

可选

​

仅在

text

模式下生效，用户可以输入一批文本，会在触发安抚策略时随机选取一段文本作为安抚语播放。每段文本的长度上限为 10 个字符。

​

data.pre_answer.bot_id

​

String

​

可选

​

仅在

bot

模式下生效，ASR 识别的文本会同时请求这个

BotID

，并将该智能体回复的内容作为安抚语。传入的智能体必须是属于当前用户的智能体。该策略会消耗额外的 Token。

​

data.trigger

​

Object

​

可选

​

触发相关配置。

​

data.trigger.type

​

String

​

必选

​

安抚策略的触发类型，可选类型有

mandatory

/

time-trigger

/

event-driven

。

​

mandatory

：必定触发安抚策略，默认值。

​

time-trigger

：一段时间后模型没有生成回复，就会触发安抚策略。

​

event-driven

：模型触发 function call 就会触发安抚策略。

​

data.trigger.time_after

​

Integer

​

可选

​

仅在

time-trigger

模式下生效，指定在等待多长时间后触发安抚策略，单位为 ms，取值范围 [0, 3000]，默认值为 1500ms。

​

​

事件示例：

​

​

JSON

复制

{

​

"id"

:

"7446668538246561822"

,

​

"event_type"

:

"session.pre_answer.update"

,

​

"data"

:

{

​

"pre_answer"

:

{

​

"type"

:

"none"

,

​

"file_id"

:

""

,

​

"pre_answer_list"

:

[

""

],

​

"bot_id"

:

""

​

},

​

"trigger"

:

{

​

"type"

:

"mandatory"

,

​

"time_after"

:

1500

​

}

​

}

​

}

​

​

更新房间模式

​

事件类型

：

mode.update

​

事件说明

：更新房间的模式，若更新成功，会收到

mode.updated

下行事件，否则，会收到下行事件 "error"。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

mode.update

。

​

data

​

Object

​

必选

​

事件数据，包含房间模式和对话设置。

​

data.mode

​

String

​

必选

​

房间模式。

​

默认为

chat

，即对话模式，跟智能体进行聊天。

​

data.mode.chat

​

Object

​

可选

​

对话模式下的设置，仅当

mode

为

chat

时生效。

​

data.chat.user_language

​

String

​

可选

​

用户说话的语种，默认为

common

支持

中英文、上海话、闽南语，四川、陕西、粤语

识别。

仅在

data.asr_config.stream_mode

为

output_no_stream

时可以指定设置语种。

当将其设置为下方特定键时，它可以识别指定语言。

​

英语：en-US

​

日语：ja-JP

​

印尼语：id-ID

​

西班牙语：es-MX

​

葡萄牙语：pt-BR

​

德语：de-DE

​

法语：fr-FR

​

韩语：ko-KR

​

菲律宾语：fil-PH

​

马来语：ms-MY

​

泰语：th-TH

​

阿拉伯语：ar-SA

​

例如，如果输入音频是德语，则此参数传入de-DE

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

事件示例

：

​

​

​

JSON

复制

{

​

"id"

:

""

,

​

"event_type"

:

"mode.update"

,

​

"data"

:

{

​

"mode"

:

"chat"

,

​

"chat"

:

{

​

"user_language"

:

"common"

​

}

​

}

​

}

​

​

语音合成

​

事件类型

：

input_text.generate_audio

​

事件说明

：你可以主动提交一段文字用来做语音合成，提交的消息不会触发智能体的回复，只会合成音频内容下发到客户端。提交事件的时候如果智能体正在输出语音会被中断输出。适合在和智能体聊天过程中客户端长时间没有响应，智能体可以主动说话暖场的场景。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

input_text.generate_audio

。

​

data

​

Object

​

必选

​

事件数据。

​

data.mode

​

String

​

必选

​

消息内容的类型，支持设置为：

​

text

：文本

​

data.text

​

string

​

可选

​

当

mode == text

时候必填。长度限制 (0, 1024) 字节

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"744666853824656xxxx"

,

​

"event_type"

:

"input_text.generate_audio"

,

​

"data"

:

{

​

"mode"

:

"text"

,

​

"text"

:

"亲，你怎么不说话了。"

​

}

​

}

​

​

用户开始说话

​

事件类型

：

input_audio_buffer.start

​

事件说明

：发送此事件表示用户开始说话。仅在

按键说话

模式下生效。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

string

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

string

​

必选

​

固定为

input_audio_buffer.start

。

​

​

事件示例：

​

​

JSON

复制

{

​

"id"

:

"7446668538246561827"

,

​

"event_type"

:

"input_audio_buffer.start"

,

​

"data"

:

{}

​

}

​

​

用户结束说话

​

事件类型

：

input_audio_buffer.complete

​

事件说明

：发送此事件表示用户结束说话。仅在

按键说话

模式下生效。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

string

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

string

​

必选

​

固定为

input_audio_buffer.complete

。

​

​

事件示例：

​

​

JSON

复制

{

​

"id"

:

"7446668538246561827"

,

​

"event_type"

:

"input_audio_buffer.complete"

,

​

"data"

:

{}

​

}

​

​

​

上一篇

创建房间

下一篇

Realtime 下行事件
============================================================
# Realtime 下行事件
来源: https://www.coze.cn/open/docs/developer_guides/signaling_downlink_event
============================================================

Realtime 下行事件

本文介绍扣子编程智能语音信令事件中的下行事件。

​

房间配置成功

​

事件类型

：

session.created

​

事件说明

：用户成功进房后会发送此事件。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

服务端生成的唯一 ID。

​

event_type

​

String

​

必选

​

固定为

session.created

。

​

data

​

Object

​

必选

​

事件数据，包含对话的详细信息。

​

data.voice_id

​

String

​

必选

​

音色 ID。

​

data.log_id

​

String

​

必选

​

服务端日志 ID，用于查找问题。

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"7446668538246561800"

,

​

"event_type"

:

"session.created"

,

​

"data"

:

{

​

"voice_id"

:

"134"

,

​

"log_id"

:

"xxx"

​

}

​

}

​

​

房间配置更新成功

​

事件类型

：

session.updated

​

事件说明

：房间内的配置更新成功，返回房间内最新的配置。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

服务端生成的唯一 ID。

​

event_type

​

String

​

必选

​

固定为

session.updated

。

​

data

​

Object

​

必选

​

事件数据，包含对话的详细信息。

​

data.voice_id

​

String

​

必选

​

音色 ID。

​

data.speech_rate

​

Integer

​

必选

​

模型回复的语速，取值范围 [-50, 100]，默认为 0。-50 表示 0.5 倍速，100 表示 2 倍速。

​

data.loudness_rate

​

Integer

​

可选

​

输出音频的音量，取值范围 [-50, 100]，默认为 0。-50 表示 0.5 倍音量，100 表示 2 倍音量。

​

data.longest_silence_ms

​

Integer

​

可选

​

当智能体处于长时间沉默状态时，房间将自动解散。此时间以毫秒（ms）为单位计量，默认时长为 180,000 毫秒。

​

data.event_subscriptions

​

Array<String>

​

可选

​

订阅的下行事件的事件类型列表。

​

data.chat_config

​

Object

​

必选

​

聊天配置信息。

​

data.chat_config.meta_data

​

Map<String, String>

​

必选

​

附加信息，通常用于封装一些业务相关的字段。查看对话消息详情时，系统会透传此附加信息。自定义键值对，应指定为 Map 对象格式。长度为 16 对键值对，其中键（key）的长度范围为 1～64 个字符，值（value）的长度范围为 1～512 个字符。

​

data.chat_config.custom_variables

​

Map<String, String>

​

必选

​

智能体中定义的变量。在智能体 prompt 中设置变量 {{key}} 后，可以通过该参数传入变量值，同时支持 Jinja2 语法。变量名只支持英文字母和下划线。

​

data.chat_config.extra_params

​

Map<String, String>

​

必选

​

附加参数，通常用于特殊场景下指定一些必要参数供模型判断，例如指定经纬度，并询问智能体此位置的天气。自定义键值对格式，其中键（key）仅支持设置为：

​

latitude（纬度，值为纬度值，例如 39.9800718）

​

longitude（经度，值为经度值，例如 116.309314）。

​

data.chat_config.plugin_interrupt_mode

​

String

​

必选

​

端插件执行模式，可选值有

blocking

/

nonblocking

，默认为

nonblocking

。

​

blocking

模式下，遇到端插件执行后，会阻塞后续的对话，直到提交端插件结果。

​

nonblocking

模式下，遇到端插件执行后，若未提交端插件结果继续对话，则端插件请求会被丢弃。

​

data.chat_config.allow_voice_interrupt

​

Boolean

​

可选

​

是否打开语音打断功能，默认为

true

。

​

data.chat_config.interrupt_config

​

Object

​

可选

​

语音打断配置，仅在 allow_voice_interrupt 为

true

时生效

​

data.chat_config.interrupt_config.mode

​

String

​

必选

​

语音打断模式，可选值有

all

/

keyword_contains

/

keyword_prefix

，默认为

all

。

​

all

模式下，任意内容都可以打断模型回复。

​

keyword_contains

模式下，说话内容

包含

关键词才会打断模型回复。

​

keyword_prefix

模式下，说话内容

前缀匹配

关键词才会打断模型回复。

​

data.chat_config.interrupt_config.keywords

​

Array<String>

​

可选

​

关键词列表，每个关键词长度不超过8个字，最多10个关键词，仅在

keyword_contains

/

keyword_prefix

模式下生效。

​

data.turn_detection

​

Object

​

可选

​

声音检测配置。

​

data.turn_detection.type

​

String

​

可选

​

语音检测模式，默认为

server_vad

，可选项包括：

​

server_vad

：语音活动检测由扣子编程服务端完成，客户端将音频流持续发送到服务端，服务端在接收到音频后，通过服务端 VAD 检测语音的开始和结束。

​

client_vad

：客户端使用自己的 VAD 检测语音的开始和结束，并将检测到的语音片段发送到服务器进行识别。

​

semantic_vad

：采用语义判停的自由对话模式（

此功能仅对企业旗舰版用户开放

），由服务端识别语义来判断是否停止说话。

​

详细的检测逻辑请参见

​

如何设置扣子的语音检测模式？

。

​

data.turn_detection.silence_duration_ms

​

Integer

​

可选

​

server_vad

模式下，检测语音停止的静音持续时间，单位为 ms。默认为 500ms。

​

data.turn_detection.semantic_vad_config

​

Object

​

可选

​

semantic_vad

模式下，配置判定语音停止的语义检测策略。

​

data.turn_detection.semantic_vad_config.silence_threshold_ms

​

Integer

​

可选

​

当用户暂停说话时，持续静音多久后，触发语义判停检测。单位为 ms。默认为 300ms。

​

data.turn_detection.semantic_vad_config.semantic_unfinished_wait_time_ms

​

Integer

​

可选

​

当语义检测判断该语句未结束时，持续静音多久后，扣子编程认定语音结束。单位为 ms。默认为 500ms。

​

data.asr_config.enable_itn

​

Boolean

​

可选

​

将语音转为文本时，是否开启文本规范化（ITN）处理，将识别结果转换为更符合书面表达习惯的格式以提升可读性。默认为

true

。

​

开启后，会将口语化数字转换为标准数字格式，示例：

​

将

两点十五分

转换为

14:15

。

​

将

一百美元

转换为

$100

。

​

data.asr_config.enable_punc

​

Boolean

​

可选

​

将语音转为文本时，是否给文本加上标点符号。默认为

true

。

​

data.asr_config.enable_ddc

​

Boolean

​

可选

​

将语音转为文本时，是否启用顺滑，默认为

true

。

​

true

：系统在进行语音处理时，会去掉识别结果中诸如 “啊”“嗯” 等语气词，使得输出的文本语义更加流畅自然，符合正常的语言表达习惯，尤其适用于对文本质量要求较高的场景，如正式的会议记录、新闻稿件生成等。

​

false

：系统不会对识别结果中的语气词进行处理，识别结果会保留原始的语气词。

​

data.asr_config.enable_nostream

​

Boolean

​

可选

​

当前是否开启

二次识别模式

，枚举值：

​

true

：已开启二次识别模式。会实时返回逐字识别的文本；当一句话结束时，会结合整句音频进行上下文分析并重新识别，生成优化后的识别结果并返回。这种机制既能满足客户实时上屏的需求，又能确保最终结果的识别准确率。

​

false

：未开启二次识别模式。仅进行一次实时识别，逐字返回文本，不会在一句话结束时重新识别分句，可能存在一定的识别误差。

​

data.asr_config.enable_emotion

​

Boolean

​

可选

​

当前是否开启说话人情绪识别功能，枚举值：

​

true

：已开启情绪识别，会返回说话人的情绪标签，仅在

data.asr_config.stream_mode

为

output_no_stream

时生效。

​

false

：未开启情绪识别。

​

支持的情绪标签包括：

​

angry

：表示情绪为生气

​

happy

：表示情绪为开心

​

neutral

：表示情绪为平静或中性

​

sad

：表示情绪为悲伤

​

surprise

：表示情绪为惊讶

​

data.asr_config.enable_gender

​

Boolean

​

可选

​

当前是否开启说话人性别识别功能，枚举值：

​

true

：已开启性别识别，会返回说话人性别（

male

/

female

），仅在

data.asr_config.stream_mode

为

output_no_stream

时生效。

​

false

：未开启性别识别。

​

data.asr_config.sensitive_words_filter

​

Object

​

可选

​

当前敏感词过滤功能的配置状态，支持以下 3 种过滤方式：

​

过滤系统敏感词，并替换为

*

。

​

过滤自定义敏感词，并替换为空。

​

过滤自定义敏感词，并替换为

*

。

​

data.asr_config.sensitive_words_filter.system_reserved_filter

​

Boolean

​

可选

​

当前是否启用系统自带敏感词过滤（匹配到的敏感词替换为

*

），枚举值：

​

true

：已启用，系统会过滤系统自带敏感词（主要包含限制级词汇）并替换为

*

。

​

false

：未启用系统自带敏感词的过滤。

​

data.asr_config.sensitive_words_filter.filter_with_empty

​

Array<string>

​

可选

​

自定义的需替换为空的敏感词列表。

​

data.asr_config.sensitive_words_filter.filter_with_signed

​

Array<string>

​

可选

​

自定义的需替换为

*

的敏感词列表。

​

data.voice_print_config

​

Array<String>

​

可选

​

声纹识别配置。

​

data.voice_print_config.group_id

​

String

​

可选

​

声纹组 ID。语音通话时，扣子编程会在该声纹组内进行查找匹配对应的声纹，当声纹匹配度高于

score

阈值，则认为是同一个人的声音。

​

data.voice_print_config.score

​

Integer

​

可选

​

声纹匹配的命中阈值，即声音匹配度的最低标准。当声音匹配度达到或超过该阈值时，扣子编程才会认定声纹匹配成功。你可以根据应用的安全性要求进行自定义设置。如果匹配了多轮声纹，扣子编程会取相似度最高的一个。

​

取值范围：0~100，默认值：40。

​

data.voice_print_config.reuse_voice_info

​

Boolean

​

可选

​

当本轮对话未命中任何声纹时，是否沿用历史声纹信息。默认为

false

。

​

true

：未命中声纹时，智能体将返回上一次命中的声纹。适用于连续对话场景，当收音不好等情况导致声纹没能正确被识别时，保障对话的连贯性。

​

false

：未命中声纹时，智能体返回空的声纹信息。

​

data.voice_processing_config

​

Object

​

可选

​

语音降噪配置。默认不启用降噪。

​

说明

仅扣子企业旗舰版支持该配置。

​

data.voice_processing_config.enable_ans

​

Boolean

​

可选

​

主动噪声抑制。自动识别并过滤掉背景环境中的各种噪音（如键盘声、空调声、街道嘈杂声），让说话者的声音更清晰。

​

此功能与下面的

enable_pdns

（声纹降噪）只能

二选一开启

，不能同时使用。

​

data.voice_processing_config.enable_pdns

​

Boolean

​

可选

​

声纹降噪。专门针对

特定说话人

的声音进行优化，能更精准地保留目标人声。

​

此功能与上面的

enable_ans

只能

二选一开启

，不能同时使用。

​

提供两种模式，你可以根据需要选择：

​

自动提取：设置简单，开箱即用。默认为该模式。

降噪生效稍微有延迟

，服务端需要先听你说一会儿话才能提取出你的声纹特征，在此期间降噪效果可能不佳。另外，提取声纹会受到用户说话场景影响，准确性上可能会弱于主动设置。

​

主动设置：

降噪效果更精准、更快速

，在对话开始时就立即生效。不过需要提前录制声纹并在

voice_print_feature_id

中设置声纹 ID。

​

data.voice_print_config.feature_id

​

String

​

可选

​

目标说话人的声纹 ID。当你选择开启

enable_pdns

（声纹降噪）并希望使用

主动设置

模式时，需要在此处填入你提前录制好的声纹 ID。

​

​

事件示例

：

​

​

会话创建成功

​

事件类型

：

conversation.created

​

事件说明

：用户成功进房后会发送此事件，收到此事件即表明

房间初始化完成。

​

事件结构

：

​

​

事件示例

：

​

​

对话开始

​

事件类型

：

conversation.chat.created

​

事件说明

：创建对话的事件，表示对话开始。

​

事件结构

：

​

​

事件示例

：

​

​

对话处理中

​

事件类型

：

conversation.chat.in_progress

​

事件说明

：服务端正在处理对话。

​

事件结构

：

​

​

事件示例

：

​

​

增量消息

​

事件类型

：

conversation.message.delta

​

事件说明

：增量消息，通常是

type=answer

时的增量消息。

​

事件结构

：

​

​

事件示例

：

​

​

消息已完成

​

事件类型

：

conversation.message.completed

​

事件说明

：消息已完成（用户或智能体）。此时事件中带有所有

message.delta

的拼接结果，且每个消息均为

completed

状态。

​

事件结构

：

​

​

事件示例：

​

​

对话完成

​

事件类型

：

conversation.chat.completed

​

事件说明

：表示对话已完成。

​

事件结构

：

​

​

事件示例

：

​

​

端插件请求

​

事件类型

：conversation.chat.requires_action

​

事件说明

：对话中断，需要使用方上报工具的执行结果。

​

事件结构

：

​

​

事件示例

：

​

​

对话失败

​

事件类型

：

conversation.chat.failed

​

事件说明

：此事件用于标识对话失败。

​

事件结构

：

​

​

事件示例

：

​

​

用户开始说话

​

事件类型

：

audio.user.speech_started

​

事件说明

：此事件表示服务端识别到用户正在说话。

​

事件结构

：

​

​

事件示例

：

​

​

用户结束说话

​

事件类型

：

audio.user.speech_stopped

​

事件说明

：此事件表示服务端识别到用户已停止说话。

​

事件结构

：

​

​

事件示例

：

​

​

智能体开始说话

​

事件类型

：

audio.agent.speech_started

​

事件说明

：此事件表示智能体正在说话。

​

事件结构

：

​

​

事件示例

：

​

​

智能体结束说话

​

事件类型

：

audio.agent.speech_stopped

​

事件说明

：此事件表示智能体已停止说话。

​

事件结构

：

​

​

事件示例

：

​

​

安抚配置更新成功

​

事件类型

：

session.pre_answer.updated

​

事件说明

：房间内的安抚配置更新成功，返回房间内最新的安抚配置。

​

事件结构

：

​

​

事件示例

：

​

​

安抚已生成

​

事件类型

：

conversation.chat.pre_answer

​

事件说明

：此事件表明触发了安抚策略。

​

事件结构

：

​

​

事件示例

：

​

​

用户语音识别字幕

​

事件类型

：

conversation.audio_transcript.delta

​

事件说明

：用户语音识别的中间值，每次返回都是全量文本。

​

事件结构

：

​

​

事件示例

：

​

​

更新房间模式成功

​

事件类型

：

mode.updated

​

事件说明

：房间模式更新成功，返回最新的房间模式设置。

​

事件结构

：

​

​

事件示例

：

​

​

用户开始说话

​

事件类型

：

input_audio_buffer.started

​

事件说明

：表示服务端成功处理用户开始说话事件。

​

事件结构

：

​

​

事件示例：

​

​

用户结束说话

​

事件类型

：

input_audio_buffer.completed

​

事件说明

：表示服务端成功处理用户结束说话事件。

​

事件结构

：

​

​

事件示例：

​

​

​

发生错误

​

事件类型

：

error

​

事件说明

：对话过程中的错误事件。

​

事件结构

：

​

​

事件示例

：

​

​

​

​

上一篇

Realtime 上行事件

下一篇

Realtime 事件错误码
============================================================
# Realtime 事件错误码
来源: https://www.coze.cn/open/docs/developer_guides/realtime_error_codes
============================================================

Realtime 事件错误码

本文介绍音视频通话过程中下行事件返回的错误码及其解决方案。

​

​

​

code

​

msg

​

说明

​

4027

​

Your account has an overdue payment, please recharge immediately.

​

原因：账户欠费。

​

解决方案：请检查

账户余额

。

​

4028

​

Insufficient coze credits balance, please wait for the quota refresh or upgrade to paid version.

​

原因：免费版资源点不足。

​

解决方案：请检查

账户余额

。

​

4029

​

The connection was closed due to prolonged user inactivity. Please retry your request.

​

原因: 房间长时间没有对话，自动退出。

​

解决方案:  通过

​

Realtime 上行事件

修改 longest_silence_ms 提高房间的静默时间（默认 3 分钟）。退出房间后需要重新创建房间。

​

​

​

上一篇

Realtime 下行事件

下一篇

双向流式语音识别
============================================================
# 双向流式语音识别
来源: https://www.coze.cn/open/docs/developer_guides/asr_api
============================================================

双向流式语音识别

扣子编程提供流式语音识别 WebSocket OpenAPI，可以将指定的音频判断转为文字，支持识别中英文双语种。

​

双向流式语音识别场景下的各类事件详细信息可参考

​

双向流式语音识别事件

。

​

接口信息

​

​

URL

​

wss://

ws.coze.cn/v1/audio/transcriptions

​

Headers

​

Authorization Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息请参考

准备工作

。

​

权限

​

createTranscription

​

接口说明

​

将指定的音频判断转为文字，支持识别中英文双语种。

​

​

建连示例代码

​

ws module(Node.js)

websocket-client(Python)

Websocket(browsers)

​

​

JavaScript

复制

import

WebSocket

from

'ws'

;

​

​

const

url =

`wss://

ws.coze.cn/v1/audio/transcriptions?authorization=Bearer

${ACCESS_TOKEN}

`

;

​

const

ws =

new

WebSocket

(url);

​

​

ws.

on

(

'open'

,

function

open

() {

​

console

.

log

(

'Connected to server.'

);

​

});

​

​

ws.

on

(

'message'

,

function

incoming

(

message

) {

​

console

.

log

(

JSON

.

parse

(message.

toString

()));

​

});

​

​

​

​

API 时序图

​

交互流程如下：

​

​

​

​

​

​

​

​

上一篇

Realtime 事件错误码

下一篇

双向流式语音识别事件
============================================================
# 双向流式语音识别事件
来源: https://www.coze.cn/open/docs/developer_guides/asr_event
============================================================

双向流式语音识别事件

上行事件

​

更新语音识别配置

​

事件类型

：

transcriptions.update

​

事件说明

：更新语音识别配置。若更新成功，会收到

transcriptions.updated

的下行事件，否则，会收到

error

下行事件。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

transcriptions.update

。

​

data

​

Object

​

可选

​

事件数据，包含语音识别配置的详细信息。

​

data.input_audio

​

Object

​

可选

​

输入音频格式。

​

data.input_audio.format

​

String

​

可选

​

输入音频的格式，支持

pcm

、

wav

、

ogg

。默认为

wav

。

​

data.input_audio.codec

​

String

​

可选

​

输入音频的编码，支持

pcm

、

opus

。默认为

pcm

。

​

data.input_audio.sample_rate

​

Integer

​

可选

​

输入音频的采样率，默认 24000。

​

data.input_audio.channel

​

Integer

​

可选

​

输入音频的声道数，默认是 1（单声道）。

​

data.input_audio.bit_depth

​

Integer

​

可选

​

输入音频的位深，默认是 16。

​

data.asr_config

​

Object

​

可选

​

语音识别配置，包括热词和上下文信息，以便优化语音识别的准确性和相关性。

​

data.asr_config.hot_words

​

Array<String>

​

可选

​

输入热词列表，以便提升这些词汇的识别准确率。

​

所有热词加起来最多100个 Tokens，超出部分将自动截断。

​

data.asr_config.context

​

String

​

可选

​

输入上下文信息。

​

最多输入 800 个 Tokens，超出部分将自动截断。

​

data.asr_config.user_language

​

String

​

可选

​

用户说话的语种，默认为

common

。选项包括：

​

common：大模型语音识别，可自动识别中英粤。

​

zh：小模型语音识别，中文。

​

cant：小模型语音识别，粤语。

​

sc：小模型语音识别，川渝。

​

en：小模型语音识别，英语。

​

ja：小模型语音识别，日语。

​

ko：小模型语音识别，韩语。

​

fr：小模型语音识别，法语。

​

id：小模型语音识别，印尼语。

​

es：小模型语音识别，西班牙语。

​

pt：小模型语音识别，葡萄牙语。

​

ms：小模型语音识别，马来语。

​

ru：小模型语音识别，俄语。

​

data.asr_config.enable_ddc

​

Boolean

​

可选

​

将语音转为文本时，是否启用语义顺滑。默认为

true

。

​

true

：系统在进行语音处理时，会去掉识别结果中诸如 “啊”“嗯” 等语气词，使得输出的文本语义更加流畅自然，符合正常的语言表达习惯，尤其适用于对文本质量要求较高的场景，如正式的会议记录、新闻稿件生成等。

​

false

：系统不会对识别结果中的语气词进行处理，识别结果会保留原始的语气词。

​

data.asr_config.enable_itn

​

Boolean

​

可选

​

将语音转为文本时，是否开启文本规范化（ITN）处理，将识别结果转换为更符合书面表达习惯的格式以提升可读性。默认为

true

。

​

开启后，会将口语化数字转换为标准数字格式，示例：

​

将

两点十五分

转换为

14:15

。

​

将

一百美元

转换为

$100

。

​

data.asr_config.enable_punc

​

Boolean

​

可选

​

将语音转为文本时，是否给文本加上标点符号。默认为

true

。

​

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"event_id"

,

​

"event_type"

:

"transcriptions.update"

,

​

"data"

:

{

​

"input_audio"

:

{

​

"format"

:

"pcm"

,

​

"codec"

:

"pcm"

,

​

"sample_rate"

:

24000

,

​

"channel"

:

1

,

​

"bit_depth"

:

16

​

}

​

}

​

}

​

​

流式上传音频片段

​

事件类型

：

input_audio_buffer.append

​

事件说明

：流式向服务端提交音频的片段。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

input_audio_buffer.append

。

​

data

​

Object

​

必选

​

事件数据，包含音频片段信息。

​

data.delta

​

String

​

必选

​

base64 编码后的音频片段。

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"event_id"

,

​

"event_type"

:

"input_audio_buffer.append"

,

​

"data"

:

{

​

"delta"

:

"base64EncodedAudioDelta"

​

}

​

}

​

​

提交音频

​

事件类型

：

input_audio_buffer.complete

​

事件说明

：客户端发送

input_audio_buffer.complete

事件来告诉服务端提交音频缓冲区的数据。服务端提交成功后会返回

input_audio_buffer.completed

事件。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

input_audio_buffer.complete

。

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"event_id"

,

​

"event_type"

:

"input_audio_buffer.complete"

​

}

​

​

清除缓冲区音频

​

事件类型

：

input_audio_buffer.clear

​

事件说明

：客户端发送

input_audio_buffer.clear

事件来告诉服务端清除缓冲区的音频数据。服务端清除完后将返回

input_audio_buffer.cleared

事件。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

input_audio_buffer.clear

。

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"event_1"

,

​

"event_type"

:

"input_audio_buffer.clear"

​

}

​

​

下行事件

​

连接成功

​

事件类型

：

transcriptions.created

​

事件说明

：语音识别连接成功后，返回此事件。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

服务端生成的唯一 ID。

​

event_type

​

String

​

必选

​

固定为

transcriptions.created

。

​

detail

​

Object

​

必选

​

事件详情。

​

detail.logid

​

String

​

必选

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考获取帮助和技术支持。

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"7446668538246561xxxx"

,

​

"event_type"

:

"transcriptions.created"

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2F3***"

​

}

​

}

​

​

配置更新成功

​

事件类型

：

transcriptions.updated

​

事件说明

：配置更新成功后，会返回最新的配置。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

transcriptions.updated

。

​

data

​

Object

​

必选

​

事件数据，包含语音识别配置的详细信息。

​

data.input_audio

​

Object

​

必选

​

输入音频格式。

​

data.input_audio.format

​

String

​

必选

​

输入音频的格式，支持

pcm

、

wav

、

ogg

。默认为

wav

。

​

data.input_audio.codec

​

String

​

必选

​

输入音频的编码，支持

pcm

、

opus

。默认为

pcm

。

​

data.input_audio.sample_rate

​

Integer

​

必选

​

输入音频的采样率，默认 24000。

​

data.input_audio.channel

​

Integer

​

必选

​

输入音频的声道数，默认是 1（单声道）。

​

data.input_audio.bit_depth

​

Integer

​

必选

​

输入音频的位深，默认是 16。

​

detail

​

Object

​

必选

​

事件详情。

​

detail.logid

​

String

​

必选

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考获取帮助和技术支持。

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"event_id"

,

​

"event_type"

:

"transcriptions.updated"

,

​

"data"

:

{

​

"input_audio"

:

{

​

"format"

:

"pcm"

,

​

"codec"

:

"pcm"

,

​

"sample_rate"

:

24000

,

​

"channel"

:

1

,

​

"bit_depth"

:

16

​

}

​

},

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2F3***"

​

}

​

}

​

​

音频提交完成

​

事件类型

：

input_audio_buffer.completed

​

事件说明

：流式提交的音频完成后，返回此事件。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

input_audio_buffer.completed

。

​

detail

​

Object

​

必选

​

事件详情。

​

detail.logid

​

String

​

必选

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考获取帮助和技术支持。

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"event_id"

,

​

"event_type"

:

"input_audio_buffer.completed"

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2F3***"

​

}

​

}

​

​

音频清除成功

​

事件类型

：

input_audio_buffer.cleared

​

事件说明

：清除缓冲区音频成功后，返回此事件。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

input_audio_buffer.cleared

。

​

detail

​

Object

​

必选

​

事件详情。

​

detail.logid

​

String

​

必选

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考获取帮助和技术支持。

​

​

事件示例

：

​

​

Python

复制

{

​

"id"

:

"event_id"

,

​

"event_type"

:

"input_audio_buffer.cleared"

,

​

"detail"

: {

​

"logid"

:

"20241210152726467C48D89D6DB2F3***"

​

}

​

}

​

​

识别出文字

​

事件类型

：

transcriptions.message.update

​

事件说明

：语音识别出文字后，返回此事件，每次都返回全量的识别出来的文字。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

transcriptions.message.update

。

​

data

​

Object

​

必选

​

事件数据，包含识别出的文字。

​

data.content

​

String

​

必选

​

识别出的文字。

​

detail

​

Object

​

必选

​

事件详情。

​

detail.logid

​

String

​

必选

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考获取帮助和技术支持。

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"event_id"

,

​

"event_type"

:

"transcriptions.message.update"

,

​

"data"

:

{

​

"content"

:

"text"

​

},

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2F3***"

​

}

​

}

​

​

识别完成

​

事件类型

：

transcriptions.message.completed

​

事件说明

：语音识别完成后，返回此事件。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

transcriptions.message.completed

。

​

detail

​

Object

​

必选

​

事件详情。

​

detail.logid

​

String

​

必选

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考获取帮助和技术支持。

​

​

事件示例

：

​

​

HTTP

复制

{

​

"id": "event_id",

​

"event_type": "transcriptions.message.completed",

​

"detail": {

​

"logid": "20241210152726467C48D89D6DB2F3***"

​

}

​

}

​

​

发生错误

​

事件类型

：

error

​

事件说明

：识别过程中的错误事件。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

服务端生成的唯一 ID。

​

event_type

​

String

​

必选

​

固定为

error

。

​

data

​

Object

​

必选

​

事件数据，包含错误信息。

​

data.code

​

Integer

​

必选

​

错误码。

​

data.msg

​

String

​

必选

​

错误信息。

​

detail

​

Object

​

必选

​

事件详情。

​

detail.logid

​

String

​

必选

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考获取帮助和技术支持。

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"event_1"

,

​

"event_type"

:

"error"

,

​

"data"

:

{

​

"code"

:

1

,

​

"msg"

:

"发生异常"

​

},

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2F3***"

​

}

​

}

​

​

上一篇

双向流式语音识别

下一篇

双向流式语音合成
============================================================
# 双向流式语音合成
来源: https://www.coze.cn/open/docs/developer_guides/tts_api
============================================================

双向流式语音合成

扣子编程提供流式语音合成 WebSocket OpenAPI，可以将文字信息转为指定音色的语音片段。

​

双向流式语音合成场景下的各类事件详细信息可参考

​

双向流式语音合成事件

。

​

接口信息

​

​

URL

​

wss://

ws.coze.cn/v1/audio/

speech

​

Headers

​

Authorization Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息请参考

准备工作

。

​

权限

​

createSpeech

​

接口说明

​

将文字信息转为指定音色的语音片段。

​

​

限制说明

​

单次请求的文字信息长度最大为 1024 个字节。超过上限时会提示

3010

错误。

​

建议一次性不要传输太多文字。

​

建连示例代码

​

ws module(Node.js)

websocket-client(Python)

Websocket(browsers)

​

​

JavaScript

复制

import

WebSocket

from

'ws'

;

​

​

const

url =

`wss://

ws.coze.cn/v1/audio/

speech

?authorization=Bearer

${ACCESS_TOKEN}

`

;

​

const

ws =

new

WebSocket

(url);

​

​

ws.

on

(

'open'

,

function

open

() {

​

console

.

log

(

'Connected to server.'

);

​

});

​

​

ws.

on

(

'message'

,

function

incoming

(

message

) {

​

console

.

log

(

JSON

.

parse

(message.

toString

()));

​

});

​

​

​

​

API 时序图

​

交互流程如下：

​

​

​

​

​

​

​

上一篇

双向流式语音识别事件

下一篇

双向流式语音合成事件
============================================================
# 双向流式语音合成事件
来源: https://www.coze.cn/open/docs/developer_guides/tts_event
============================================================

双向流式语音合成事件

上行事件

​

更新语音合成配置

​

事件类型

：

speech.update

​

事件说明

：更新流式语音合成配置。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

speech.update

。

​

data

​

Object

​

可选

​

事件数据，包含语音合成配置的详细信息。

​

data.output_audio

​

Object

​

可选

​

输出音频格式。

​

data.output_audio.codec

​

String

​

可选

​

输出音频编码，支持

pcm

、

opus

。默认是

pcm

。

​

data.output_audio.pcm_config

​

Object

​

可选

​

当

codec

设置为

opus

时，不需要设置此字段。

​

说明

当

codec

设置为

pcm

时，返回的 PCM 数据将固定为单声道，采样深度为 16 位。

​

​

data.output_audio.pcm_config.sample_rate

​

Integer

​

可选

​

输出

pcm

音频的采样率，默认 24000。

​

data.output_audio.pcm_config.frame_size_ms

​

Float

​

可选

​

输出每个 pcm 包的时长，单位 ms，默认不限制。

​

data.output_audio.pcm_config. limit_config

​

Object

​

可选

​

输出音频限流配置，默认不限制。

​

data.output_audio.pcm_config. limit_config.period

​

Integer

​

可选

​

周期的时长，单位为秒。例如设置为 10 秒，则以 10 秒作为一个周期。

​

data.output_audio.pcm_config. limit_config.max_frame_num

​

Integer

​

可选

​

周期内，最大返回 pcm 包数量。

​

data.output_audio.opus_config

​

Object

​

可选

​

当

codec

设置为

pcm

时，不需要设置此字段。

​

data.output_audio.opus_config.bitrate

​

Integer

​

可选

​

输出

opus

的码率，默认 48000。

​

data.output_audio.opus_config.use_cbr

​

Boolean

​

可选

​

输出

opus

是否使用 CBR 编码，默认为

false

。

​

data.output_audio.opus_config.frame_size_ms

​

Float

​

可选

​

输出

opus

的帧长，默认是 10。可选值：

​

2.5、5、10、20、40、60

​

data.output_audio.opus_config.limit_config

​

Object

​

可选

​

输出音频限流配置，默认不限速。

​

data.output_audio.opus_config.limit_config.period

​

Integer

​

可选

​

周期的时长，单位为秒。例如设置为 10 秒，则以 10 秒作为一个周期。

​

data.output_audio.opus_config.limit_config.max_frame_num

​

Integer

​

可选

​

周期内最大返回的 Opus 帧数量。

​

data.output_audio.speech_rate

​

Integer

​

可选

​

输出音频的语速，取值范围 [-50, 100]，默认为 0。-50 表示 0.5 倍速，100 表示 2 倍速。

​

data.output_audio.loudness_rate

​

Integer

​

可选

​

输出音频的音量，取值范围 [-50, 100]，默认为 0。-50 表示 0.5 倍音量，100 表示 2 倍音量。不支持复刻音色。

​

data.output_audio.voice_id

​

String

​

可选

​

输出音频的音色 ID。默认音色为"柔美女友"。你可以调用

​

查看音色列表

API 查看当前可用的所有音色 ID。

​

data.output_audio.context_texts

​

String

​

可选

​

语音合成的辅助信息，用于控制合成语音的整体情绪（如悲伤、生气）、方言（如四川话、北京话）、语气（如撒娇、暧昧、吵架、夹子音）、语速（快慢）及音调（高低）等。默认为空。

​

示例：用低沉沙哑的语气、带着沧桑与绝望地说。

​

说明

仅当

voice_id

为豆包语音合成大模型 2.0 音色时才支持该参数，具体音色列表请参见

​

系统音色列表

。

​

更多关于豆包语音合成 2.0 的

context_texts

示例和效果可参考

语音指令-示例库

。

​

data.output_audio.emotion_config

​

Object

​

可选

​

设置多情感音色的情感类型和情感值，仅当

voice_id

为多情感音色时才需要设置。

​

data.output_audio.emotion_config.emotion

​

String

​

可选

​

设置多情感音色的情感类型。不同音色支持的情感范围不同，可以通过

系统音色列表

查看各音色支持的情感。默认为空。枚举值如下：

​

happy-开心

​

sad-悲伤

​

angry-生气

​

surprised-惊讶

​

fear-恐惧

​

hate-厌恶

​

excited-激动

​

coldness-冷漠

​

neutral-中性

​

data.output_audio.emotion_config.emotion_scale

​

Float

​

可选

​

情感值用于量化情感的强度。数值越高，情感表达越强烈，例如： “开心” 的情感值 5 比 1 更显兴奋。

​

取值范围：1.0~5.0，默认值：4.0。

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"event_id"

,

​

"event_type"

:

"speech.update"

,

​

"data"

:

{

​

"output_audio"

:

{

​

"codec"

:

"pcm"

,

​

"pcm_config"

:

{

​

"sample_rate"

:

24000

​

},

​

"speech_rate"

:

50

,

​

"voice_id"

:

"音色id"

​

}

​

}

​

}

​

​

流式输入文字

​

事件类型

：

input_text_buffer.append

​

事件说明

：流式向服务端提交文字的片段。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

input_text_buffer.append

。

​

data

​

Object

​

必选

​

事件数据，包含文字片段。

​

data.delta

​

String

​

必选

​

需要合成语音的文字片段。

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"event_id"

,

​

"event_type"

:

"input_text_buffer.append"

,

​

"data"

:

{

​

"delta"

:

"text"

​

}

​

}

​

​

提交文字

​

事件类型

：

input_text_buffer.complete

​

事件说明

：提交

append

的文本，发送后将收到

input_text_buffer.completed

的下行事件。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

input_text_buffer.complete

。

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"event_id"

,

​

"event_type"

:

"input_text_buffer.complete"

​

}

​

​

下行事件

​

连接成功

​

事件类型

：

speech.created

​

事件说明

：语音合成连接成功后，返回此事件。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

服务端生成的唯一 ID。

​

event_type

​

String

​

必选

​

固定为

speech.created

。

​

detail

​

Object

​

必选

​

事件详情。

​

detail.logid

​

String

​

必选

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考获取帮助和技术支持。

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"7446668538246561xxxx"

,

​

"event_type"

:

"speech.created"

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2F3***"

​

}

​

}

​

​

配置更新完成

​

事件类型

：

speech.updated

​

事件说明

：配置更新成功后，会返回最新的配置。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

speech.updated

。

​

data

​

Object

​

必选

​

事件数据，包含语音合成配置的详细信息。

​

data.output_audio

​

Object

​

必选

​

输出音频格式。

​

data.output_audio.codec

​

String

​

必选

​

输出音频编码，支持

pcm

、

opus

。默认是

pcm

。

​

data.output_audio.pcm_config

​

Object

​

可选

​

当

codec

设置为

opus

时，不需要设置此字段。

​

data.output_audio.pcm_config.sample_rate

​

Integer

​

可选

​

输出

pcm

音频的采样率，默认 24000。

​

data.output_audio.opus_config

​

Object

​

可选

​

当

codec

设置为

pcm

时，不需要设置此字段。

​

data.output_audio.opus_config.bitrate

​

Integer

​

可选

​

输出

opus

的码率，默认 48000。

​

data.output_audio.opus_config.use_cbr

​

Boolean

​

可选

​

输出

opus

是否使用 CBR 编码，默认为

false

。

​

data.output_audio.opus_config.frame_size_ms

​

Float

​

可选

​

输出

opus

的帧长，默认是 10。

​

data.output_audio.speech_rate

​

Integer

​

必选

​

输出音频的语速，取值范围 [-50, 100]，默认为 0。-50 表示 0.5 倍速，100 表示 2 倍速。

​

data.output_audio.voice_id

​

String

​

必选

​

输出音频的音色 ID。

​

detail

​

Object

​

必选

​

事件详情。

​

detail.logid

​

String

​

必选

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考获取帮助和技术支持。

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"event_id"

,

​

"event_type"

:

"speech.updated"

,

​

"data"

:

{

​

"output_audio"

:

{

​

"codec"

:

"pcm"

,

​

"pcm_config"

:

{

​

"sample_rate"

:

24000

​

},

​

"speech_rate"

:

50

,

​

"voice_id"

:

"音色id"

​

}

​

},

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2F3***"

}

​

}

​

​

input_text_buffer

提交完成

​

事件类型

：

input_text_buffer.completed

​

事件说明

：流式提交的文字完成后，返回此事件。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

input_text_buffer.completed

。

​

detail

​

Object

​

必选

​

事件详情。

​

detail.logid

​

String

​

必选

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考获取帮助和技术支持。

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"event_id"

,

​

"event_type"

:

"input_text_buffer.completed"

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2F3***"

​

}

​

}

​

​

合成增量语音

​

事件类型

：

speech.audio.update

​

事件说明

：语音合成产生增量语音时，返回此事件。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

speech.audio.update

。

​

data

​

Object

​

必选

​

事件数据，包含音频片段信息。

​

data.delta

​

String

​

必选

​

base64 编码后的音频片段。

​

detail

​

Object

​

必选

​

事件详情。

​

detail.logid

​

String

​

必选

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考获取帮助和技术支持。

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"event_id"

,

​

"event_type"

:

"speech.audio.update"

,

​

"data"

:

{

​

"delta"

:

"base64EncodedAudioDelta"

​

},

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2F3***"

}

​

}

​

​

合成完成

​

事件类型

：

speech.audio.completed

​

事件说明

：语音合成完成后，返回此事件。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

speech.audio.completed

。

​

detail

​

Object

​

必选

​

事件详情。

​

detail.logid

​

String

​

必选

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考获取帮助和技术支持。

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"event_id"

,

​

"event_type"

:

"speech.audio.completed"

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2F3***"

​

}

​

}

​

​

发生错误

​

事件类型

：

error

​

事件说明

：对话过程中的错误事件。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

服务端生成的唯一 ID。

​

event_type

​

String

​

必选

​

固定为

error

。

​

data

​

Object

​

必选

​

事件数据，包含错误信息。

​

data.code

​

Integer

​

必选

​

错误码。

​

data.msg

​

String

​

必选

​

错误信息。

​

detail

​

Object

​

必选

​

事件详情。

​

detail.logid

​

String

​

必选

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考获取帮助和技术支持。

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"event_1"

,

​

"event_type"

:

"error"

​

"data"

:

{

​

"code"

:

1

,

​

"msg"

:

"发生异常"

​

},

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2F3***"

​

}

​

}

​

​

上一篇

双向流式语音合成

下一篇

双向流式语音对话
============================================================
# 双向流式语音对话
来源: https://www.coze.cn/open/docs/developer_guides/streaming_chat_api
============================================================

双向流式语音对话

扣子编程提供流式语音对话 WebSocket OpenAPI，向指定的智能体发起语音对话。

​

双向流式语音对话场景下的各类事件详细信息可参考

​

双向流式对话上行事件

。

​

接口信息

​

​

URL

​

wss://

ws.coze.cn/v1/

chat

​

Headers

​

Authorization Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息请参考

准备工作

。

​

权限

​

chat

​

接口说明

​

向指定的智能体发起语音对话。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

说明

​

bot_id

​

​

String

​

​

必选

​

​

需要关联的智能体 ID。

​

进入智能体的开发页面，开发页面 URL 中

bot

参数后的数字就是智能体 ID。例如

https://www.coze.com/space/341****/bot/73428668*****

，Bot ID 为

73428668*****

。

​

说明

确保调用该接口使用的令牌开通了此智能体所在空间的权限。

​

确保该智能体已发布为 API 服务。

​

​

device_id

​

String

​

可选

​

设备的唯一标识符，在建立 Websocket 连接时建议带上此参数，便于排查问题。

​

说明

device_id

的格式为

int64 数字类型

的字符串。如果设备 ID 是纯数字，  可直接填写该数字作为

device_id

。如果设备 ID 包含非数字字符，则需先将其转换为纯数字字符串，再填写到

device_id

中。

​

​

​

建连示例代码

​

ws module(Node.js)

websocket-client(Python)

Websocket(browsers)

​

​

JavaScript

复制

import

WebSocket

from

'ws'

;

​

​

const

url =

`wss://

ws.coze.cn/v1/chat?bot_id=

${BOT_ID}

&authorization=Bearer

${ACCESS_TOKEN}

`

;

​

const

ws =

new

WebSocket

(url);

​

​

ws.

on

(

'open'

,

function

open

() {

​

console

.

log

(

'Connected to server.'

);

​

});

​

​

ws.

on

(

'message'

,

function

incoming

(

message

) {

​

console

.

log

(

JSON

.

parse

(message.

toString

()));

​

});

​

​

​

​

API 时序图

​

交互流程如下：

​

​

​

​

​

​

​

上一篇

双向流式语音合成事件

下一篇

双向流式对话上行事件
============================================================
# 双向流式对话上行事件
来源: https://www.coze.cn/open/docs/developer_guides/streaming_chat_event
============================================================

双向流式对话上行事件

本文介绍扣子编程 WebSocket 双向流式对话事件中的上行事件，双向流式对话下行事件请参见

​

双向流式对话下行事件

。

​

更新对话配置

​

事件类型

：

chat.update

​

事件说明

：此事件可以更新当前对话连接的配置项，若更新成功，会收到

chat.updated

的下行事件，否则，会收到

error

下行事件。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

chat.update

。

​

data

​

Object

​

可选

​

事件数据，包含对话配置的详细信息。

​

data.chat_config

​

Object

​

可选

​

对话配置。

​

data.chat_config.meta_data

​

Map<String, String>

​

可选

​

附加信息，通常用于封装一些业务相关的字段。查看对话消息详情时，系统会透传此附加信息。自定义键值对，应指定为 Map 对象格式。长度为 16 对键值对，其中键（key）的长度范围为 1～64 个字符，值（value）的长度范围为 1～512 个字符。

​

data.chat_config.custom_variables

​

Map<String, String>

​

可选

​

智能体中定义的变量。在智能体 prompt 中设置变量 {{key}} 后，可以通过该参数传入变量值，同时支持 Jinja2 语法。详细说明可参考变量示例。变量名只支持英文字母和下划线。

​

data.chat_config.extra_params

​

Map<String, String>

​

可选

​

附加参数，通常用于特殊场景下指定一些必要参数供模型判断，例如指定经纬度，并询问智能体此位置的天气。自定义键值对格式，其中键（key）仅支持设置为：

​

latitude

（纬度，此时值（Value）为纬度值，例如 39.9800718）。

​

longitude

（经度，此时值（Value）为经度值，例如 116.309314）。

​

data.chat_config.user_id

​

String

​

可选

​

标识当前与智能体的用户，由使用方自行定义、生成与维护。

user_id

用于标识对话中的不同用户，不同的

user_id

，其对话的上下文消息、数据库等对话记忆数据互相隔离。如果不需要用户数据隔离，可将此参数固定为一个任意字符串，例如 123，abc 等。

​

data.chat_config.conversation_id

​

String

​

可选

​

标识对话发生在哪一次会话中。会话是智能体和用户之间的一段问答交互。一个会话包含一条或多条消息。对话是会话中对智能体的一次调用，智能体会将对话中产生的消息添加到会话中。可以使用已创建的会话，会话中已存在的消息将作为上下文传递给模型。创建会话的方式可参考创建会话。对于一问一答等不需要区分 conversation 的场合可不传该参数，系统会自动生成一个会话。不传的话会默认创建一个新的 conversation。

​

data.chat_config.auto_save_history

​

Boolean

​

可选

​

是否保存本次对话记录。

​

true

：（默认）会话中保存本次对话记录，包括本次对话的模型回复结果、模型执行中间结果。

​

false

：会话中不保存本次对话记录，后续也无法通过任何方式查看本次对话信息、消息详情。在同一个会话中再次发起对话时，本次会话也不会作为上下文传递给模型。

​

data.chat_config.parameters

​

Map<String, any>

​

可选

​

设置对话流的自定义输入参数的值，具体用法和示例代码可参考

​

为自定义参数赋值

。

​

对话流的输入参数 USER_INPUT 应在

additional_messages

中传入，在 parameters 中的 USER_INPUT 不生效。

​

如果

parameters

中未指定

CONVERSATION_NAME

或其他输入参数，则使用参数默认值运行对话流；如果指定了这些参数，则使用指定值。

​

data.input_audio

​

Object

​

可选

​

输入音频格式。

​

data.input_audio.format

​

String

​

可选

​

输入音频的格式，支持

pcm

、

wav

、

ogg

。默认为

wav

。

​

data.input_audio.codec

​

String

​

可选

​

输入音频的编码，支持

pcm

、

opus

、

g711a

、

g711u

。默认为

pcm

。

​

如果音频编码格式为

g711a

或

g711u

，

format

请设置为

pcm

。

​

data.input_audio.sample_rate

​

Integer

​

可选

​

输入音频的采样率，默认是 24000。支持 8000、16000、22050、24000、32000、44100、48000。

​

如果音频编码格式

codec

为

g711a

或

g711u

，音频采样率需设置为 8000。

​

data.input_audio.channel

​

Integer

​

可选

​

输入音频的声道数，支持 1（单声道）、2（双声道）。默认是 1（单声道）。

​

data.input_audio.bit_depth

​

Integer

​

可选

​

输入音频的位深，默认是 16，支持8、16和24。

​

data.output_audio

​

Object

​

可选

​

输出音频格式。

​

data.output_audio.codec

​

String

​

可选

​

输出音频编码，支持

pcm

、

g711a

、

g711u

、

opus

、

mp3

。默认是

pcm

。

​

说明

当

codec

设置为

pcm

、

g711a

或

g711u

时，你可以通过

pcm_config

配置 PCM 音频参数。

​

​

data.output_audio.pcm_config

​

Object

​

可选

​

当

codec

设置为

pcm

、

g711a

或

g711u

时，用于配置 PCM 音频参数。

​

当

codec

设置为

opus

、

mp3

时，不需要设置此字段。

​

说明

当

codec

设置为

pcm

时，返回的 PCM 数据将固定为单声道，采样深度为 16 位。

​

当

codec

设置为

g711a

或

g711u

时，返回的数据将是 8000kHz 采样率，单声道，采样深度为 8 位。

​

​

data.output_audio.pcm_config.sample_rate

​

Integer

​

可选

​

输出

pcm

音频的采样率，默认是 24000。支持 8000、16000、22050、24000、32000、44100、48000。

​

说明

当

codec

设置为

g711a

或

g711u

时，sample_rate 自动设置为 8000，且不能更改。

​

​

data.output_audio.pcm_config.frame_size_ms

​

Float

​

可选

​

输出每个 pcm 包的时长，单位 ms，默认不限制。取值范围：0~1000。

​

data.output_audio.pcm_config. limit_config

​

Object

​

可选

​

输出音频限流配置，默认不限制。

​

说明

如需实现输出 PCM 音频限流，还需要配置

​

data.output_audio.pcm_config.frame_size_ms

参数。

​

​

data.output_audio.pcm_config. limit_config.period

​

Integer

​

可选

​

周期的时长，单位为秒。例如设置为 10 秒，则以 10 秒作为一个周期。

​

data.output_audio.pcm_config. limit_config.max_frame_num

​

Integer

​

可选

​

周期内，最大返回 pcm 包数量。

​

data.output_audio.opus_config

​

Object

​

可选

​

当

codec

设置为

pcm

、

mp3

时，不需要设置此字段。

​

data.output_audio.opus_config.sample_rate

​

Integer

​

可选

​

编码成

opus

时的 pcm 采样率，默认 24k。支持 8000、12000、16000、24000、48000。

​

data.output_audio.opus_config.bitrate

​

Integer

​

可选

​

输出

opus

的码率，默认 48000。

​

data.output_audio.opus_config.use_cbr

​

Boolean

​

可选

​

输出

opus

是否使用 CBR 编码，默认为

false

。

​

data.output_audio.opus_config.frame_size_ms

​

Float

​

可选

​

输出

opus

的帧长，默认是 10。可选值：

​

2.5、5、10、20、40、60

​

data.output_audio.opus_config.limit_config

​

Object

​

可选

​

输出音频限流配置，默认不限速。

​

data.output_audio.opus_config.limit_config.period

​

Integer

​

可选

​

周期的时长，单位为秒。例如设置为 10 秒，则以 10 秒作为一个周期。

​

data.output_audio.opus_config.limit_config.max_frame_num

​

Integer

​

可选

​

周期内最大返回的 Opus 帧数量。

​

data.output_audio.mp3_config

​

Object

​

可选

​

当

codec

设置为

mp3

时，用于配置 mp3 音频参数。

​

当

codec

设置为

opus

、

pcm

、

g711a

、

g711u

时，不需要设置此字段。

​

data.output_audio.mp3_config.sample_rate

​

Integer

​

可选

​

输出

mp3

音频的采样率，默认是 44100。支持 32000、44100、48000。

​

data.output_audio.mp3_config.bit_rate

​

Integer

​

可选

​

输出

mp3

音频的码率，支持 8000~1600000。

​

data.output_audio.speech_rate

​

Integer

​

可选

​

输出音频的语速，取值范围 [-50, 100]，默认为 0。-50 表示 0.5 倍速，100 表示 2 倍速。

​

data.output_audio.loudness_rate

​

Integer

​

可选

​

输出音频的音量，取值范围 [-50, 100]，默认为 0。-50 表示 0.5 倍音量，100 表示 2 倍音量。

​

data.output_audio.voice_id

​

String

​

可选

​

输出音频的音色 ID，默认是柔美女友音色。你可以调用

​

查看音色列表

API 查看当前可用的所有音色 ID。

​

data.output_audio.context_texts

​

String

​

可选

​

语音合成的辅助信息，用于控制合成语音的整体情绪（如悲伤、生气）、方言（如四川话、北京话）、语气（如撒娇、暧昧、吵架、夹子音）、语速（快慢）及音调（高低）等。默认为空。

​

示例：用低沉沙哑的语气、带着沧桑与绝望地说。

​

说明

仅当

voice_id

为豆包语音合成大模型 2.0 音色时才支持该参数，具体音色列表请参见

​

系统音色列表

。

​

更多关于豆包语音合成 2.0 的

context_texts

示例和效果可参考

语音指令-示例库

​

​

data.output_audio.emotion_config

​

Object

​

可选

​

设置多情感音色的情感和情感值，仅当

voice_id

为多情感音色时才支持该配置。

​

data.output_audio.emotion_config.emotion

​

String

​

可选

​

设置多情感音色的情感类型。不同音色支持的情感范围不同，可以通过

系统音色列表

查看各音色支持的情感。默认为空。枚举值如下：

​

happy-开心

​

sad-悲伤

​

angry-生气

​

surprised-惊讶

​

fear-恐惧

​

hate-厌恶

​

excited-激动

​

coldness-冷漠

​

neutral-中性

​

说明

你需要在对话流开始节点的输入参数中增加

_voice_emotion

参数，用于向对话流传递多情感音色的情感类型配置。

​

​

data.output_audio.emotion_config.emotion_scale

​

Float

​

可选

​

情感值用于量化情感的强度。数值越高，情感表达越强烈，例如： “开心” 的情感值 5 比 1 更显兴奋。

​

取值范围：1.0~5.0，默认值：4.0。

​

data.voice_processing_config

​

Object

​

可选

​

语音处理能力配置。

​

说明

仅扣子企业旗舰版支持该配置。

​

​

data.voice_processing_config.enable_ans

​

Boolean

​

可选

​

主动噪声抑制。自动识别并过滤掉背景环境中的各种噪音（如键盘声、空调声、街道嘈杂声），让说话者的声音更清晰。

​

此功能与下面的

enable_pdns

（声纹降噪）只能

二选一开启

，不能同时使用。

​

data.voice_processing_config.enable_pdns

​

Boolean

​

可选

​

声纹降噪。专门针对

特定说话人

的声音进行优化，能更精准地保留目标人声。

​

此功能与上面的

enable_ans

只能

二选一开启

，不能同时使用。

​

提供两种模式，你可以根据需要选择：

​

自动提取：设置简单，开箱即用。默认为该模式。

降噪生效稍微有延迟

，服务端需要先听你说一会儿话才能提取出你的声纹特征，在此期间降噪效果可能不佳。另外，提取声纹会受到用户说话场景影响，准确性上可能会弱于主动设置。

​

主动设置：

降噪效果更精准、更快速

，在对话开始时就立即生效。不过需要提前录制声纹并在

voice_print_feature_id

中设置声纹 ID。

​

data.voice_processing_config.voice_print_feature_id

​

String

​

可选

​

目标说话人的声纹 ID

。当你选择开启

enable_pdns

（声纹降噪）并希望使用

主动设置

模式时，需要在此处填入你提前录制好的声纹 ID。

​

你可以通过扣子编程录制声纹，具体请参见

​

声纹识别

，或通过

​

创建声纹

API 上传声纹并获取声纹 ID。

​

data.event_subscriptions

​

Array<String>

​

可选

​

需要订阅下行事件的事件类型列表。不设置或者设置为空为订阅所有下行事件。

​

data.need_play_prologue

​

Boolean

​

可选

​

是否需要播放开场白，默认为 false。

​

data.prologue_content

​

String

​

可选

​

自定义开场白，need_play_prologue 设置为 true 时生效。如果不设定自定义开场白则使用智能体上设置的开场白。

​

data.turn_detection

​

Object

​

可选

​

转检测配置。

​

data.turn_detection.type

​

String

​

可选

​

语音检测类型，用于控制语音交互的检测方式，枚举值：

​

server_vad

：自由对话模式，语音数据会传输到服务器端进行实时分析，服务器端的语音活动检测算法会判断用户是否在说话。

​

client_interrupt

：（默认）按键说话模式，由客户端控制语音的开始与结束。

​

semantic_vad

：采用语义判停的自由对话模式（

此功能仅对企业旗舰版用户开放

），由服务端识别语义来判断是否停止说话。

​

data.turn_detection.prefix_padding_ms

​

Integer

​

可选

​

server_vad

模式下，VAD 检测到语音之前要包含的音频量，单位为 ms。默认为 600ms。

​

data.turn_detection.silence_duration_ms

​

Integer

​

可选

​

server_vad

模式下，检测语音停止的静音持续时间，单位为 ms。默认为 500ms。

​

data.turn_detection.semantic_vad_config

​

Object

​

可选

​

semantic_vad

模式下，配置判定语音停止的语义检测策略。

​

data.turn_detection.semantic_vad_config.silence_threshold_ms

​

Integer

​

可选

​

当用户暂停说话时，持续静音多久后，触发语义判停检测。

单位为 ms。

默认为 300ms。

​

data.turn_detection.semantic_vad_config.semantic_unfinished_wait_time_ms

​

Integer

​

可选

​

当语义检测判断该语句未结束时，持续静音多久后，扣子编程认定语音结束

。

单位为 ms。默认为 500ms。取值范围为 100~2000。

​

data.turn_detection.interrupt_config

​

Object

​

可选

​

server_vad

模式下，配置语音对话的打断策略。

​

默认采用发声即打断模式，即在检测到语音输入时会中断智能体的输出。

​

data.turn_detection.interrupt_config.mode

​

String

​

可选

​

配置通过关键词打断，包括:

​

keyword_contains

模式下，说话内容

包含

关键词才会打断模型回复。例如关键词"扣子"，用户正在说“你好呀扣子......” / “扣子你好呀”，模型回复都会被打断。

​

keyword_prefix

模式下，说话内容

前缀匹配

关键词才会打断模型回复。例如关键词"扣子"，用户正在说“扣子你好呀......”，模型回复就会被打断，而用户说“你好呀扣子......”，模型回复不会被打断。

​

详细配置方法请参见

​

通过关键词打断语音对话

。

​

data.turn_detection.interrupt_config.keywords

​

Array<String>

​

可选

​

打断的关键词配置，最多同时限制 5 个关键词，每个关键词限定长度在 6~24 个字节以内（2~8个汉字以内），不能有标点符号。

​

data.asr_config

​

Object

​

可选

​

语音识别配置，包括热词和上下文信息，以便优化语音识别的准确性和相关性。

​

data.asr_config.hot_words

​

Array<String>

​

可选

​

请输入热词列表，以便提升这些词汇的识别准确率。如果设置的热词数量超出以下数量限制，超出部分将自动截断。

​

data.asr_config.stream_mode

为

output_no_stream

时：hot_words 支持 5000 tokens。

​

data.asr_config.stream_mode

为

bidirectional_stream

时： hot_words 支持 100 tokens。

​

data.asr_config.context

​

String

​

可选

​

请输入上下文信息。

​

最多输入 800 个 Tokens，超出部分将自动截断。

​

data.asr_config.user_language

​

String

​

可选

​

用户说话的语种，默认为

common

支持

中英文、上海话、闽南语，四川、陕西、粤语

识别。

仅在

data.asr_config.stream_mode

为

output_no_stream

时可以指定设置语种。

当将其设置为下方特定键时，它可以识别指定语言。

​

英语：en-US

​

日语：ja-JP

​

印尼语：id-ID

​

西班牙语：es-MX

​

葡萄牙语：pt-BR

​

德语：de-DE

​

法语：fr-FR

​

韩语：ko-KR

​

菲律宾语：fil-PH

​

马来语：ms-MY

​

泰语：th-TH

​

阿拉伯语：ar-SA

​

例如，如果输入音频是德语，则此参数传入de-DE

​

data.asr_config.enable_ddc

​

Boolean

​

可选

​

将语音转为文本时，是否启用语义顺滑。默认为

true

。

​

true

：系统在进行语音处理时，会去掉识别结果中诸如 “啊”“嗯” 等语气词，使得输出的文本语义更加流畅自然，符合正常的语言表达习惯，尤其适用于对文本质量要求较高的场景，如正式的会议记录、新闻稿件生成等。

​

false

：系统不会对识别结果中的语气词进行处理，识别结果会保留原始的语气词。

​

data.asr_config.enable_itn

​

Boolean

​

可选

​

将语音转为文本时，是否开启文本规范化（ITN）处理，将识别结果转换为更符合书面表达习惯的格式以提升可读性。默认为

true

。

​

开启后，会将口语化数字转换为标准数字格式，示例：

​

将

两点十五分

转换为

14:15

。

​

将

一百美元

转换为

$100

。

​

data.asr_config.enable_punc

​

Boolean

​

可选

​

将语音转为文本时，是否给文本加上标点符号。默认为

true

。

​

data.asr_config.stream_mode

​

String

​

可选

​

ASR 识别的模式。

​

output_no_stream

：不会逐字返回语音识别结果，而是等整段语音结束后统一输出完整文本。异步语音消息场景中推荐使用该模式，会整合整句音频信息做上下文分析，减少实时截断导致的误差，提升准确率。

​

bidirectional_stream

（默认值）：逐字的返回语音识别的结果。

​

data.asr_config.enable_nostream

​

Boolean

​

可选

​

是否开启

二次识别模式

：

​

true

：会实时返回逐字识别的文本；当一句话结束时，会结合整句音频进行上下文分析并重新识别，生成优化后的识别结果并返回。这种机制既能满足客户实时上屏的需求，又能确保最终结果的识别准确率。

​

false

（默认值）：仅进行一次实时识别，逐字返回文本，不会在一句话结束时重新识别分句，可能存在一定的识别误差。

​

data.asr_config.enable_emotion

​

Boolean

​

可选

​

识别说话人的情绪。仅在

data.asr_config.stream_mode

为

output_no_stream

时生效。默认为

false

。

​

支持的情绪标签包括：

​

angry

：表示情绪为生气

​

happy

：表示情绪为开心

​

neutral

：表示情绪为平静或中性

​

sad

：表示情绪为悲伤

​

surprise

：表示情绪为惊讶

​

data.asr_config.enable_gender

​

Boolean

​

可选

​

是否开启识别说话人的性别（male/female），仅在

data.asr_config.stream_mode

为

output_no_stream

时生效。默认为

false

。

​

说明

你需要在对话流开始节点的输入参数中增加

_voice_gender

参数，以便对话流获取识别后的说话人性别。

​

​

data.asr_config.sensitive_words_filter

​

Object

​

可选

​

敏感词过滤功能，支持以下 3 种过滤方式：

​

过滤系统敏感词，并替换为

*

。

​

过滤自定义敏感词，并替换为空。

​

过滤自定义敏感词，并替换为

*

。

​

data.asr_config.sensitive_words_filter.system_reserved_filter

​

Boolean

​

可选

​

是否过滤系统自带的敏感词，并将匹配到的敏感词替换为

*

。（系统自带敏感词主要包含一些限制级词汇）。默认为

false

。

​

data.asr_config.sensitive_words_filter.filter_with_empty

​

Array<string>

​

可选

​

自定义需替换为空的敏感词列表。

​

data.asr_config.sensitive_words_filter.filter_with_signed

​

Array<string>

​

可选

​

自定义需替换为

*

的敏感词列表。

​

data.voice_print_config

​

Object<String>

​

可选

​

声纹识别配置。

​

data.voice_print_config.group_id

​

String

​

可选

​

声纹组 ID。语音通话时，扣子编程会在该声纹组内进行查找匹配对应的声纹，当声纹匹配度高于

score

阈值，则认为是同一个人的声音。

​

你可以通过

查看声纹组列表

API 查看声纹组 ID。

​

data.voice_print_config.score

​

Integer

​

可选

​

声纹匹配的命中阈值，即声音匹配度的最低标准。当声音匹配度达到或超过该阈值时，扣子编程才会认定声纹匹配成功。你可以根据应用的安全性要求进行自定义设置。如果匹配了多轮声纹，扣子编程会取相似度最高的一个。

​

取值范围：0~100，默认值：40。

​

data.voice_print_config.reuse_voice_info

​

Boolean

​

可选

​

当本轮对话未命中任何声纹时，是否沿用历史声纹信息。

​

true

：未命中声纹时，智能体将返回上一次命中的声纹。适用于连续对话场景，当收音不好等情况导致声纹没能正确被识别时，保障对话的连贯性。

​

false

：（默认值）未命中声纹时，智能体返回空的声纹信息。

​

​

事件示例

：

​

​

输出音频为 pcm

输出音频为 opus

​

​

JSON

复制

{

​

"id"

:

"event_id"

,

​

"event_type"

:

"chat.update"

,

​

"data"

:

{

​

"chat_config"

:

{

​

"auto_save_history"

:

true

,

// 保存历史记录。默认 true

​

"conversation_id"

:

"xxxx"

,

// conversation_id

​

"user_id"

:

"xxx"

,

// 标识当前与智能体的用户，由使用方自行定义、生成与维护。user_id 用于标识对话中的不同用户，不同的 user_id，其对话的上下文消息、数据库等对话记忆数据互相隔离。如果不需要用户数据隔离，可将此参数固定为一个任意字符串

​

"meta_data"

:

{},

// 附加信息,通常用于封装一些业务相关的字段。查看对话消息详情时,系统会透传此附加信息。

​

"custom_variables"

:

{},

// 智能体中定义的变量。在智能体prompt中设置变量{{key}}后,可以通过该参数传入变量值,同时支持Jinja2语法。详细说明可参考变量示例。变量名只支持英文字母和下划线。

​

"extra_params"

:

{},

// 附加参数,通常用于特殊场景下指定一些必要参数供模型判断,例如指定经纬度,并询问智能体此位置的天气。自定义键值对格式,其中键(key)仅支持设置为:latitude:纬度,此时值(Value)为纬度值,例如39.9800718。longitude:经度,此时值(Value)为经度值,例如116.309314。

​

"parameters"

:

{

"custom_var_1"

:

"测试"

}

​

},

​

"input_audio"

:

{

// 输入音频格式

​

"format"

:

"pcm"

,

// 输入音频格式，支持 pcm/wav/ogg。默认 wav

​

"codec"

:

"pcm"

,

// 输入音频编码。 pcm/opus。默认 pcm

​

"sample_rate"

:

24000

,

// 采样率

​

"channel"

:

1

,

// 通道数

​

"bit_depth"

:

16

// 位深

​

},

​

"output_audio"

:

{

// 输出音频格式

​

"codec"

:

"pcm"

,

​

"pcm_config"

:

{

​

"sample_rate"

:

16000

,

// 默认  24000

​

"frame_size_ms"

:

50

,

​

"limit_config"

:

{

​

"period"

:

1

,

​

"max_frame_num"

:

22

​

}

​

},

​

"speech_rate"

:

0

,

// 回复的语速，取值范围 [-50, 100]，默认为 0，-50 表示 0.5 倍速，100 表示 2倍速

​

"voice_id"

:

"7426720361733046281"

​

}

​

}

​

}

​

​

​

​

流式上传音频片段

​

事件类型

：

input_audio_buffer.append

​

事件说明

：流式向服务端提交音频的片段。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

input_audio_buffer.append

。

​

data

​

Object

​

必选

​

事件数据，包含音频片段信息。

​

data.delta

​

String

​

必选

​

base64 编码后的音频片段。

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"event_id"

,

​

"event_type"

:

"input_audio_buffer.append"

,

​

"data"

:

{

​

"delta"

:

"base64EncodedAudioDelta"

​

}

​

}

​

​

提交音频

​

事件类型

：

input_audio_buffer.complete

​

事件说明

：客户端发送

input_audio_buffer.complete

事件来告诉服务端提交音频缓冲区的数据。服务端提交成功后会返回

input_audio_buffer.completed

事件。在

server_vad

模式下，提交此事件无效。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

input_audio_buffer.complete

。

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"event_id"

,

​

"event_type"

:

"input_audio_buffer.complete"

​

}

​

​

清除缓冲区音频

​

事件类型

：

input_audio_buffer.clear

​

事件说明

：客户端发送

input_audio_buffer.clear

事件来告诉服务端清除缓冲区的音频数据。服务端清除完后将返回

input_audio_buffer.cleared

事件。在

server_vad

模式下，提交此事件无效。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

input_audio_buffer.clear

。

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"event_1"

,

​

"event_type"

:

"input_audio_buffer.clear"

​

}

​

​

手动提交对话内容

​

事件类型

：

conversation.message.create

​

事件说明

：若

role=user

，提交事件后就会生成语音回复，适合如下的场景，比如帮我解析 xx 链接，帮我分析这个图片的内容等。若

role=assistant

，提交事件后会加入到对话的上下文。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

conversation.message.create

。

​

data

​

Object

​

必选

​

事件数据，包含对话内容的详细信息。

​

data.role

​

String

​

必选

​

发送这条消息的实体。取值：

user

（代表该条消息内容是用户发送的）、

assistant

（代表该条消息内容是智能体发送的）。

​

data.content_type

​

String

​

必选

​

消息内容的类型，支持设置为：

​

text

：文本

​

object_string

：多模态内容，即文本和文件的组合、文本和图片的组合。

​

data.content

​

String

​

必选

​

消息的内容，支持纯文本、多模态（文本、图片、文件混合输入）、卡片等多种类型的内容。当 content_type 为

object_string

时，content 的结构和详细参数说明请参见

​

object_string object

。

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"7446668538246561826"

,

​

"event_type"

:

"conversation.message.create"

,

​

"data"

:

{

​

"role"

:

"user"

,

// user/assistant

​

"content_type"

:

"object_string"

,

// text/object_string

​

"content"

:

"[{\"type\":\"text\",\"text\":\"帮我看看这个PDF里有什么内容？\"},{\"type\":\"file\",\"file_url\":\"<url id=\\\"cumqdq0onf4lro6iakgg\\\" type=\\\"url\\\" status=\\\"failed\\\" title=\\\"\\\" wc=\\\"0\\\">https://lf3-appstore-sign.oceancloudapi.com/ocean-cloud-tos/eaafba63-0d96-4ea6-b60c-fbadcf2c25e9.?lk3s=edeb9e45&x-expires=1718296132&x-signature=YtlsUsvSeLJi6x31I%2F4S9X53Y6Y%3D</url> \"}]"

​

}

​

}

​

​

清除上下文

​

事件类型

：

conversation.clear

​

事件说明

：清除上下文，会在当前 conversation 下新增一个 section，服务端处理完后会返回

conversation.cleared

事件。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

conversation.clear

。

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"event_1"

,

​

"event_type"

:

"conversation.clear"

​

}

​

​

提交端插件执行结果

​

事件类型

：

conversation.chat.submit_tool_outputs

​

事件说明

：你可以将需要客户端执行的操作定义为插件，对话中如果触发这个插件，会收到一个

event_type = "conversation.chat.requires_action"

的下行事件，此时需要执行客户端的操作后，通过此上行事件来提交插件执行后的结果。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

conversation.chat.submit_tool_outputs

。

​

data

​

Object

​

必选

​

事件数据，包含工具执行结果的详细信息。

​

data.chat_id

​

String

​

必选

​

对话的唯一标识。你可以在扣子编程智能语音对话下行的

conversation.chat.requires_action

事件，通过

data.id

字段查看此 ID。

​

data.tool_outputs

​

Array

​

必选

​

工具执行结果。

​

data.tool_outputs[].tool_call_id

​

String

​

必选

​

上报运行结果的 ID。你可以在扣子编程智能语音对话信令事件的

tool_calls

字段下查看此 ID。

​

data.tool_outputs[].output

​

String

​

必选

​

工具的执行结果。

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"744666853824656xxxx"

,

​

"event_type"

:

"conversation.chat.submit_tool_outputs"

,

​

"data"

:

{

​

"chat_id"

:

"74466752759xxxx"

,

​

"tool_outputs"

:

[

​

{

​

"tool_call_id"

:

"BUJJRUUVEhJGERVeEkRDFV5HEkJAXktLQBZeEEAXREpLSxZFR****="

,

​

"output"

:

"{\"url\":\"<url id=\\\"cumqdq0onf4lro6iakh0\\\" type=\\\"url\\\" status=\\\"failed\\\" title=\\\"\\\" wc=\\\"0\\\">https://lf3-bot-platform-tos-sign.coze.cn/bot-studio-bot-platform/bot_files/323733792754xxx/image/jpeg/7446661351415529491/blob</url> ****\"}"

​

}

​

]

​

}

​

}

​

​

打断智能体输出

​

事件类型

：

conversation.chat.cancel

​

事件说明

：发送此事件可取消正在进行的对话，中断后，服务端将会返回

conversation.chat.canceled

事件。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

必填

conversation.chat.cancel

。

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"7446668538246561827"

,

​

"event_type"

:

"conversation.chat.cancel"

​

}

​

​

语音合成

​

事件类型

：

input_text.generate_audio

​

事件说明

：你可以主动提交一段文字用来做语音合成，提交的消息不会触发智能体的回复，只会合成音频内容下发到客户端。提交事件的时候如果智能体正在输出语音会被中断输出。适合在和智能体聊天过程中客户端长时间没有响应，智能体可以主动说话暖场的场景。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

input_text.generate_audio

。

​

data

​

Object

​

必选

​

事件数据。

​

data.mode

​

String

​

必选

​

消息内容的类型，支持设置为：

​

text

：文本

​

data.text

​

string

​

可选

​

当

mode == text

时候必填。长度限制 (0, 1024) 字节

​

​

事件示例

：

​

​

JSON

复制

{

​

"id"

:

"744666853824656xxxx"

,

​

"event_type"

:

"input_text.generate_audio"

,

​

"data"

:

{

​

"mode"

:

"text"

,

​

"text"

:

"亲，你怎么不说话了。"

​

}

​

}

​

​

​

上一篇

双向流式语音对话

下一篇

双向流式对话下行事件
============================================================
# 双向流式对话下行事件
来源: https://www.coze.cn/open/docs/developer_guides/streaming_chat_downlink_event
============================================================

双向流式对话下行事件

本文介绍扣子 WebSocket 双向流式对话事件中的下行事件。

​

对话连接成功

​

事件类型

：

chat.created

​

事件说明

：流式对话接口成功建立连接后服务端会发送此事件。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

服务端生成的唯一 ID。

​

event_type

​

String

​

必选

​

固定为

chat.created

。

​

detail

​

Object

​

必选

​

事件详情。

​

detail.logid

​

String

​

必选

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考获取帮助和技术支持。

​

​

事件示例：

​

​

JSON

复制

{

​

"id": "7446668538246561xxxx",

​

"event_type": "chat.created",

​

"detail": {

​

"logid": "20241210152726467C48D89D6DB2F3***"    }

​

}

​

​

对话配置成功

​

事件类型

：

chat.updated

​

事件说明

：对话配置更新成功后，会返回最新的配置。

​

事件结构

：

​

​

参数

​

类型

​

是否必选

​

说明

​

id

​

String

​

必选

​

客户端自行生成的事件 ID，方便定位问题。

​

event_type

​

String

​

必选

​

固定为

chat.updated

。

​

data

​

Object

​

必选

​

事件数据，包含对话配置的详细信息。

​

data.chat_config

​

Object

​

可选

​

对话配置。

​

data.chat_config.meta_data

​

Map<String, String>

​

可选

​

附加信息，通常用于封装一些业务相关的字段。查看对话消息详情时，系统会透传此附加信息。自定义键值对，应指定为 Map 对象格式。长度为 16 对键值对，其中键（key）的长度范围为 1～64 个字符，值（value）的长度范围为 1～512 个字符。

​

data.chat_config.custom_variables

​

Map<String, String>

​

可选

​

智能体中定义的变量。在智能体 prompt 中设置变量 {{key}} 后，可以通过该参数传入变量值，同时支持 Jinja2 语法。详细说明可参考变量示例。变量名只支持英文字母和下划线。

​

data.chat_config.extra_params

​

Map<String, String>

​

可选

​

附加参数，通常用于特殊场景下指定一些必要参数供模型判断，例如指定经纬度，并询问智能体此位置的天气。自定义键值对格式，其中键（key）仅支持设置为：

latitude

（纬度，此时值（Value）为纬度值，例如 39.9800718）、

longitude

（经度，此时值（Value）为经度值，例如 116.309314）。

​

data.chat_config.user_id

​

String

​

可选

​

标识当前与智能体的用户，由使用方自行定义、生成与维护。

user_id

用于标识对话中的不同用户，不同的

user_id

，其对话的上下文消息、数据库等对话记忆数据互相隔离。如果不需要用户数据隔离，可将此参数固定为一个任意字符串，例如 123，abc 等。

​

data.chat_config.conversation_id

​

String

​

可选

​

标识对话发生在哪一次会话中。会话是智能体和用户之间的一段问答交互。一个会话包含一条或多条消息。对话是会话中对智能体的一次调用，智能体会将对话中产生的消息添加到会话中。可以使用已创建的会话，会话中已存在的消息将作为上下文传递给模型。创建会话的方式可参考创建会话。对于一问一答等不需要区分 conversation 的场合可不传该参数，系统会自动生成一个会话。不传的话会默认创建一个新的 conversation。

​

data.chat_config.auto_save_history

​

Boolean

​

可选

​

是否保存本次对话记录。

​

true

：（默认）会话中保存本次对话记录，包括本次对话的模型回复结果、模型执行中间结果。

​

false

：会话中不保存本次对话记录，后续也无法通过任何方式查看本次对话信息、消息详情。在同一个会话中再次发起对话时，本次会话也不会作为上下文传递给模型。

​

data.chat_config.parameters

​

Map<String, any>

​

可选

​

设置对话流的输入参数。

​

对话流的输入参数 USER_INPUT 应在 additional_messages 中传入，在 parameters 中的 USER_INPUT 不生效。

​

如果 parameters 中未指定 CONVERSATION_NAME 或其他输入参数，则使用参数默认值运行对话流；如果指定了这些参数，则使用指定值。

​

data.input_audio

​

Object

​

必选

​

输入音频格式。

​

data.input_audio.format

​

String

​

必选

​

输入音频的格式，支持

pcm

、

wav

、

ogg

。默认为

wav

。

​

data.input_audio.codec

​

String

​

必选

​

输入音频的编码，支持

pcm

、

opus

。默认为

pcm

。

​

data.input_audio.sample_rate

​

Integer

​

必选

​

输入音频的采样率，默认 24000。

​

data.input_audio.channel

​

Integer

​

必选

​

输入音频的声道数，默认是 1（单声道）。

​

data.input_audio.bit_depth

​

Integer

​

必选

​

输入音频的位深，默认是 16。

​

data.output_audio

​

Object

​

必选

​

输出音频格式。

​

data.output_audio.codec

​

String

​

必选

​

输出音频编码，支持

pcm

、

g711a

、

g711u

、

opus

、

mp3

。默认是

pcm

。

​

data.output_audio.pcm_config

​

Object

​

可选

​

当

codec

设置为

opus

时，不需要设置此字段。

​

data.output_audio.pcm_config.sample_rate

​

Integer

​

可选

​

输出

pcm

音频的采样率，默认 24000。

​

data.output_audio.pcm_config.frame_size_ms

​

Float

​

可选

​

输出每个 pcm 包的时长，单位 ms，默认不限制。

​

data.output_audio.pcm_config.limit_config

​

Object

​

可选

​

输出音频限流配置，默认不限制。

​

data.output_audio.pcm_config.limit_config.period

​

Integer

​

可选

​

周期的时长，单位为秒。例如设置为 10 秒，则以 10 秒作为一个周期。

​

data.output_audio.pcm_config.limit_config.max_frame_num

​

Integer

​

可选

​

周期内，最大返回 pcm 包数量。

​

data.output_audio.opus_config

​

Object

​

可选

​

当

codec

设置为

pcm

时，不需要设置此字段。

​

data.output_audio.opus_config.bitrate

​

Integer

​

可选

​

输出

opus

的码率，默认 48000。

​

data.output_audio.opus_config.use_cbr

​

Boolean

​

可选

​

输出

opus

是否使用 CBR 编码，默认为

false

。

​

data.output_audio.opus_config.frame_size_ms

​

Float

​

可选

​

输出

opus

的帧长，默认是 10。

​

data.output_audio.opus_config.limit_config

​

Object

​

可选

​

输出音频限流配置。

​

data.output_audio.opus_config.limit_config.period

​

Integer

​

可选

​

周期的时长，单位为秒。例如设置为 10 秒，则以 10 秒作为一个周期。

​

data.output_audio.opus_config.limit_config.max_frame_num

​

Integer

​

可选

​

周期内最大返回的 Opus 帧数量。

​

data.output_audio.mp3_config

​

Object

​

可选

​

当

codec

设置为

mp3

时，用于配置 mp3 音频参数。

​

当

codec

设置为

opus

、

pcm

、

g711a

、

g711u

时，不需要设置此字段。

​

data.output_audio.mp3_config.sample_rate

​

Integer

​

可选

​

输出

mp3

音频的采样率，默认是 44100。支持 32000，44100，48000。

​

data.output_audio.mp3_config.bit_rate

​

Integer

​

可选

​

输出

mp3

音频的码率，支持 8000~1600000。

​

data.output_audio.loudness_rate

​

Integer

​

可选

​

输出音频的音量，取值范围 [-50, 100]，默认为 0。-50 表示 0.5 倍音量，100 表示 2 倍音量。

​

data.output_audio.speech_rate

​

Integer

​

必选

​

输出音频的语速，取值范围 [-50, 100]，默认为 0。-50 表示 0.5 倍速，100 表示 2 倍速。

​

data.output_audio.voice_id

​

String

​

可选

​

输出音频的音色 ID。

​

data.output_audio.emotion_config

​

Object

​

可选

​

设置多情感音色的情感和情感值，仅当

voice_id

为多情感音色时才支持该配置。

​

data.output_audio.emotion_config.emotion

​

String

​

可选

​

设置多情感音色的情感类型。不同音色支持的情感范围不同，可以通过

系统音色列表

查看各音色支持的情感。默认为空。枚举值如下：

​

happy-开心

​

sad-悲伤

​

angry-生气

​

surprised-惊讶

​

fear-恐惧

​

hate-厌恶

​

excited-激动

​

coldness-冷漠

​

neutral-中性

​

data.output_audio.emotion_config.emotion_scale

​

Float

​

可选

​

情感值用于量化情感的强度。数值越高，情感表达越强烈，例如： “开心” 的情感值 5 比 1 更显兴奋。

​

取值范围：1.0~5.0，默认值：4.0。

​

data.voice_processing_config

​

Object

​

可选

​

语音处理能力配置。

​

说明

仅扣子企业旗舰版支持该配置。

​

data.voice_processing_config.enable_ans

​

Boolean

​

可选

​

主动噪声抑制。自动识别并过滤掉背景环境中的各种噪音（如键盘声、空调声、街道嘈杂声），让说话者的声音更清晰。

​

此功能与下面的

enable_pdns

（声纹降噪）只能

二选一开启

，不能同时使用。

​

data.voice_processing_config.enable_pdns

​

Boolean

​

可选

​

声纹降噪。专门针对

特定说话人

的声音进行优化，能更精准地保留目标人声。

​

此功能与上面的

enable_ans

只能

二选一开启

，不能同时使用。

​

提供两种模式：

​

自动提取：设置简单，开箱即用。默认为该模式。

降噪生效稍微有延迟

，服务端需要先听你说一会儿话才能提取出你的声纹特征，在此期间降噪效果可能不佳。另外，提取声纹会受到用户说话场景影响，准确性上可能会弱于主动设置。

​

主动设置：

降噪效果更精准、更快速

，在对话开始时就立即生效。不过需要提前录制声纹并在

voice_print_feature_id

中设置声纹 ID。

​

data.voice_processing_config.voice_print_feature_id

​

String

​

可选

​

目标说话人的声纹 ID。当你选择开启

enable_pdns

（声纹降噪）并希望使用

主动设置

模式时，需要在此处填入你提前录制好的声纹 ID。

​

data.turn_detection

​

Object

​

可选

​

转检测配置。

​

data.turn_detection.type

​

String

​

可选

​

语音检测类型，用于控制语音交互的检测方式，枚举值：

​

server_vad

：自由对话模式，语音数据会传输到服务器端进行实时分析，服务器端的语音活动检测算法会判断用户是否在说话。

​

client_interrupt

：（默认）按键说话模式，由客户端控制语音的开始与结束。

​

semantic_vad

：采用语义判停的自由对话模式（

此功能仅对企业旗舰版用户开放

），由服务端识别说话人的说话的语义判断是否停止说话。

​

data.turn_detection.prefix_padding_ms

​

Integer

​

可选

​

server_vad

模式下，VAD 检测到语音之前要包含的音频量，单位为 ms。默认为 600ms。

​

data.turn_detection.silence_duration_ms

​

Integer

​

可选

​

server_vad

模式下，检测语音停止的静音持续时间，单位为 ms。默认为 500ms。

​

data.turn_detection.semantic_vad_config

​

Object

​

可选

​

semantic_vad

模式下，配置判定语音停止的语义检测策略。

​

data.turn_detection.semantic_vad_config.silence_threshold_ms

​

Integer

​

可选

​

当用户暂停说话时，持续静音多久后，触发语义判停检测。单位为 ms。默认为 300ms。

​

data.turn_detection.semantic_vad_config.semantic_unfinished_wait_time_ms

​

Integer

​

可选

​

当语义检测判断该语句未结束时，持续静音多久后，扣子认定语音结束。单位为 ms。默认为 500ms。

​

data.turn_detection.interrupt_config

​

Object

​

可选

​

server_vad

模式下，配置语音对话的打断策略。

​

默认采用发声即打断模式，即在检测到语音输入时会中断智能体的输出。

​

data.turn_detection.interrupt_config.mode

​

String

​

可选

​

配置通过关键词打断，包括:

​

keyword_contains

模式下，说话内容

包含

关键词才会打断模型回复。例如关键词"扣子"，用户正在说“你好呀扣子......” / “扣子你好呀”，模型回复都会被打断。

​

keyword_prefix

模式下，说话内容

前缀匹配

关键词才会打断模型回复。例如关键词"扣子"，用户正在说“扣子你好呀......”，模型回复就会被打断，而用户说“你好呀扣子......”，模型回复不会被打断。

​

详细配置方法请参见

​

通过关键词打断语音对话

。

​

data.turn_detection.interrupt_config.keywords

​

Array<String>

​

可选

​

打断的关键词配置，最多同时限制 5 个关键词，每个关键词限定长度在 6~24 个字节以内（2~8个汉字以内），不能有标点符号。

​

data.asr_config

​

Object

​

可选

​

语音识别配置，包括热词和上下文信息，以便优化语音识别的准确性和相关性。

​

data.asr_config.hot_words

​

Array<String>

​

可选

​

请输入热词列表，以便提升这些词汇的识别准确率。如果设置的热词数量超出以下数量限制，超出部分将自动截断。

​

data.asr_config.stream_mode

为

output_no_stream

时：hot_words 支持 5000 tokens。

​

data.asr_config.stream_mode

为

bidirectional_stream

时： hot_words 支持 100 tokens。

​

data.asr_config.context

​

String

​

可选

​

请输入上下文信息。

​

最多输入 800 个 Tokens，超出部分将自动截断。

​

data.asr_config.user_language

​

String

​

可选

​

用户说话的语种，默认为

common

。选项包括：

​

common：大模型语音识别，支持中英文、上海话、闽南语，四川、陕西、粤语识别。

​

英语：en-US

​

日语：ja-JP

​

印尼语：id-ID

​

西班牙语：es-MX

​

葡萄牙语：pt-BR

​

德语：de-DE

​

法语：fr-FR

​

韩语：ko-KR

​

菲律宾语：fil-PH

​

马来语：ms-MY

​

泰语：th-TH

​

阿拉伯语：ar-SA

​

data.asr_config.enable_ddc

​

Boolean

​

可选

​

将语音转为文本时，是否启用语义顺滑。默认为

true

。

​

true

：系统在进行语音处理时，会去掉识别结果中诸如 “啊”“嗯” 等语气词，使得输出的文本语义更加流畅自然，符合正常的语言表达习惯，尤其适用于对文本质量要求较高的场景，如正式的会议记录、新闻稿件生成等。

​

false

：系统不会对识别结果中的语气词进行处理，识别结果会保留原始的语气词。

​

data.asr_config.enable_itn

​

Boolean

​

可选

​

将语音转为文本时，是否开启文本规范化（ITN）处理，将识别结果转换为更符合书面表达习惯的格式以提升可读性。默认为

true

。

​

开启后，会将口语化数字转换为标准数字格式，示例：

​

将

两点十五分

转换为

14:15

。

​

将

一百美元

转换为

$100

。

​

data.asr_config.enable_punc

​

Boolean

​

可选

​

将语音转为文本时，是否给文本加上标点符号。默认为

true

。

​

data.asr_config.stream_mode

​

String

​

可选

​

ASR 识别的模式。

​

output_no_stream

：不会逐字返回语音识别结果，而是等整段语音结束后统一输出完整文本。异步语音消息场景中推荐使用该模式，会整合整句音频信息做上下文分析，减少实时截断导致的误差，提升准确率。

​

bidirectional_stream

（默认值）：逐字的返回语音识别的结果。

​

data.asr_config.enable_nostream

​

Boolean

​

可选

​

是否开启

二次识别模式

：

​

true

：会实时返回逐字识别的文本；当一句话结束时，会结合整句音频进行上下文分析并重新识别，生成优化后的识别结果并返回。这种机制既能满足客户实时上屏的需求，又能确保最终结果的识别准确率。

​

false

（默认值）：仅进行一次实时识别，逐字返回文本，不会在一句话结束时重新识别分句，可能存在一定的识别误差。

​

data.asr_config.enable_emotion

​

Boolean

​

可选

​

识别说话人的情绪。仅在

data.asr_config.stream_mode

为

output_no_stream

时生效。默认为

false

。

​

支持的情绪标签包括：

​

angry

：表示情绪为生气

​

happy

：表示情绪为开心

​

neutral

：表示情绪为平静或中性

​

sad

：表示情绪为悲伤

​

surprise

：表示情绪为惊讶

​

data.asr_config.enable_gender

​

Boolean

​

可选

​

是否开启识别说话人的性别（male/female），仅在

data.asr_config.stream_mode

为

output_no_stream

时生效。默认为

false

。

​

data.asr_config.sensitive_words_filter

​

Object

​

可选

​

敏感词过滤功能，支持以下 3 种过滤方式：

​

过滤系统敏感词，并替换为

*

。

​

过滤自定义敏感词，并替换为空。

​

过滤自定义敏感词，并替换为

*

。

​

data.asr_config.sensitive_words_filter.system_reserved_filter

​

Boolean

​

可选

​

是否过滤系统自带的敏感词，并将匹配到的敏感词替换为

*

。（系统自带敏感词主要包含一些限制级词汇）。默认为

false

。

​

data.asr_config.sensitive_words_filter.filter_with_empty

​

Array<string>

​

可选

​

自定义需替换为空的敏感词列表。

​

data.asr_config.sensitive_words_filter.filter_with_signed

​

Array<string>

​

可选

​

自定义需替换为

*

的敏感词列表。

​

data.voice_print_config

​

Object<String>

​

可选

​

声纹识别配置。

​

data.voice_print_config.group_id

​

String

​

可选

​

声纹组 ID。语音通话时，扣子会在该声纹组内进行查找匹配对应的声纹，当声纹匹配度高于

score

阈值，则认为是同一个人的声音。

​

data.voice_print_config.score

​

Integer

​

可选

​

声纹匹配的命中阈值，即声音匹配度的最低标准。当声音匹配度达到或超过该阈值时，扣子才会认定声纹匹配成功。你可以根据应用的安全性要求进行自定义设置。如果匹配了多轮声纹，扣子会取相似度最高的一个。

​

取值范围：0~100，默认值：40。

​

data.voice_print_config.reuse_voice_info

​

Boolean

​

可选

​

当本轮对话未命中任何声纹时，是否沿用历史声纹信息。

​

true

：未命中声纹时，智能体将返回上一次命中的声纹。适用于连续对话场景，当收音不好等情况导致声纹没能正确被识别时，保障对话的连贯性。

​

false

：（默认值）未命中声纹时，智能体返回空的声纹信息。

​

detail

​

Object

​

必选

​

事件详情。

​

detail.logid

​

String

​

必选

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考获取帮助和技术支持。

​

​

事件示例

：

​

​

对话开始

​

事件类型

：

conversation.chat.created

​

事件说明

：创建对话的事件，表示对话开始。

​

事件结构

：

​

​

事件示例

：

​

​

对话正在处理

​

事件类型

：

conversation.chat.in_progress

​

事件说明

：服务端正在处理对话。

​

事件结构

：

​

​

事件示例

：

​

​

增量消息

​

事件类型

：

conversation.message.delta

​

事件说明

：增量消息，通常是

type=answer

时的增量消息。

​

事件结构

：

​

​

事件示例

：

​

​

增量语音字幕

​

事件类型：

conversation.audio.sentence_start

​

事件说明

：一条新的字幕句子，后续的

conversation.audio.delta

增量语音均属于当前字幕句子，可能有多个增量语音共同对应此句字幕的文字内容。

​

事件结构：

​

​

事件示例

：

​

​

增量语音

​

事件类型

：

conversation.audio.delta

​

事件说明

：增量语音，通常是

type=answer

时的增量语音。

​

事件结构

：

​

​

事件示例

：

​

​

消息完成

​

事件类型

：

conversation.message.completed

​

事件说明

：消息已回复完成。此时事件中带有所有

message.delta

的拼接结果，且每个消息均为

completed

状态。

​

事件结构

：

​

​

事件示例

：

​

​

语音回复完成

​

事件类型

：

conversation.audio.completed

​

事件说明

：音频回复完成。

​

事件结构

：

​

​

事件示例

：

​

​

对话完成

​

事件类型

：

conversation.chat.completed

​

事件说明

：表示对话已完成。

​

事件结构

：

​

​

事件示例

：

​

​

对话失败

​

事件类型

：

conversation.chat.failed

​

事件说明

：此事件用于标识对话失败。

​

事件结构

：

​

​

事件示例

：

​

​

发生错误

​

事件类型

：

error

​

事件说明

：对话过程中的错误事件。

​

事件结构

：

​

​

事件示例

：

​

​

input_audio_buffer

提交成功

​

事件类型

：

input_audio_buffer.completed

​

事件说明

：流式提交的音频完成后，返回此事件。

​

事件结构

：

​

​

事件示例

：

​

​

input_audio_buffer

清除成功

​

事件类型

：

input_audio_buffer.cleared

​

事件说明

：清除缓冲区音频成功后，返回此事件。

​

事件结构

：

​

​

事件示例

：

​

​

上下文清除完成

​

事件类型

：

conversation.cleared

​

事件说明

：清除上下文成功后，返回此事件。

​

事件结构

：

​

​

事件示例

：

​

​

智能体输出中断

​

事件类型

：

conversation.chat.canceled

​

事件说明

：客户端提交

conversation.chat.cancel

事件，服务端完成中断后，将返回此事件。

​

事件结构

：

​

​

事件示例

：

​

​

用户语音识别字幕

​

事件类型

：

conversation.audio_transcript.update

​

事件说明

：用户语音识别的中间值，每次返回都是全量文本。

​

事件结构

：

​

​

事件示例

：

​

​

用户语音识别完成

​

事件类型

：

conversation.audio_transcript.completed

​

事件说明

：用户语音识别完成。

​

事件结构

：

​

​

事件示例

：

​

​

端插件请求

​

事件类型

：

conversation.chat.requires_action

​

事件说明

：对话中断，需要使用方上报工具的执行结果。

​

事件结构

：

​

​

事件示例

：

​

​

用户开始说话

​

事件类型

：

input_audio_buffer.speech_started

​

事件说明

：此事件表示服务端识别到用户正在说话。只有在

server_vad

模式下，才会返回此事件。

​

事件结构

：

​

​

事件示例

：

​

​

用户结束说话

​

事件类型

：

input_audio_buffer.speech_stopped

​

事件说明

：此事件表示服务端识别到用户已停止说话。只有在

server_vad

模式下，才会返回此事件。

​

事件结构

：

​

​

事件示例

：

​

​

上一篇

双向流式对话上行事件

下一篇

创建声纹组
============================================================
# 创建声纹组
来源: https://www.coze.cn/open/docs/developer_guides/create_voiceprint_group
============================================================

创建声纹组

创建声纹组。

​

接口描述

​

声纹组是声纹的集合单元，例如，你可以为每个设备分别创建一个声纹组。声纹识别时，扣子编程会在指定的声纹组中匹配声纹。

​

默认最多可创建 1000 个声纹组。如需提高配额，需要升级至扣子企业旗舰版，并联系对应销售申请配额扩容。

​

基础信息

​

​

请求方式

​

POST

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/audio/voiceprint_groups

​

权限

​

createVoiceprintGroup

​

确保调用该接口使用的个人令牌开通了

createVoiceprintGroup

权限，详细信息参考

鉴权方式

。

​

接口说明

​

创建声纹组。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

name

​

String

​

必选

​

音箱2的声纹组

​

声纹组的名称，用于标识和管理不同的声纹组，长度不超过

20

个字符。

desc

​

String

​

可选

​

该声纹组用于客厅智能音箱的用户语音识别，支持多用户语音指令区分。

​

声纹组的描述信息，用于详细说明该声纹组的用途或特点，长度不超过

500

个字符。

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

CreateVoicePrintGroupData

​

{"id":"426614174000"}

​

声纹组的信息。

​

detail

​

Object of

ResponseDetail

​

{ "logid": "202410242028595CCF353CEC86A8*****" }

​

响应详情信息。

​

​

CreateVoicePrintGroupData

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

426614174000

​

声纹组 ID。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/audio/voiceprint_groups' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json'

​

{

​

"name"

:

"音箱1的声纹组"

,

​

"desc"

:

"音箱1的声纹组"

​

}

​

返回示例

​

​

JSON

复制

{

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"202506091635425D49D29729AD9****"

​

},

​

"data"

:

{

​

"id"

:

"75138649771889***"

​

},

​

"code"

:

0

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

双向流式对话下行事件

下一篇

查询声纹组列表
============================================================
# 查询声纹组列表
来源: https://www.coze.cn/open/docs/developer_guides/list_voiceprint_group
============================================================

查询声纹组列表

查询已创建的声纹组列表。

​

接口描述

​

支持通过名称模糊匹配、用户ID、声纹组 ID 进行精确匹配。返回结果包括声纹组的详细信息，包括声纹组的创建者、创建时间等信息。

​

你可以查询团队或企业中的全部声纹组，或查询本人创建的声纹组。

​

基础信息

​

​

请求方式

​

GET

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/audio/voiceprint_groups

​

权限

​

listVoiceprintGroup

​

确保调用该接口使用的个人令牌开通了

listVoiceprintGroup

权限，详细信息参考

鉴权方式

。

​

接口说明

​

查询已创建的声纹组列表。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

page_num

​

Long

​

可选

​

1

​

查询结果分页展示时，此参数用于设置查看的页码。最小值为 1，默认为 1。

​

page_size

​

Long

​

可选

​

20

​

查询结果分页展示时，此参数用于设置每页返回的数据量。取值范围为 1~200，默认为 10。

​

name

​

String

​

可选

​

声纹组

​

用于根据声纹组名称前缀进行模糊匹配筛选，支持输入部分名称前缀进行查询。

​

user_id

​

String

​

可选

​

757378***

​

声纹创建者的扣子用户 UID。

​

若指定用户 ID，则只能填写本人的用户 ID，即仅能查询本人创建的声纹组。

​

如果不填写，则查询团队或企业中的所有声纹组。

​

你可以单击扣子编程左下角的头像，选择

账号设置

，在页面底部查看扣子用户的 UID。

​

​

​

​

​

​

group_id

​

String

​

可选

​

75143038117378***

​

声纹组 ID，用于指定查询特定的声纹组。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

GetVoicePrintGroupListData

​

\

​

返回的声纹组列表及相关信息。

​

detail

​

Object of

ResponseDetail

​

{logid": "202410242028595CCF353CEC86A8*****" }

​

本次请求返回的详细信息。

​

​

GetVoicePrintGroupListData

​

​

参数

​

类型

​

示例

​

说明

​

items

​

Array of

VoicePrintGroup

​

\

​

声纹组列表，包含多个声纹组的详细信息。

​

total

​

Long

​

5

​

声纹组数量。

​

​

VoicePrintGroup

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

75143038117378***

​

声纹组的 ID。

​

desc

​

String

​

声纹组1

​

声纹组的描述。

​

name

​

String

​

声纹组1

​

声纹组名称。

​

icon_url

​

String

​

https://example.com/avatar/751427391012944***.jpg

​

声纹组的头像 URL。

​

user_info

​

Object of

UserInfo

​

{"id":"324566624","name":"小王","nickname":"小王","avatar_url":"

https://example.com/avatar/751427391012944***.jpg

"}

​

声纹组创建者的信息。

​

created_at

​

Long

​

1714567890123

​

声纹组的创建时间，以 Unix 时间戳格式表示，单位为秒。

​

updated_at

​

Long

​

1714567890223

​

声纹组的更新时间，以 Unix 时间戳格式表示，单位为秒。

​

feature_count

​

Integer

​

3

​

声纹组中包含的声纹数量。

​

​

UserInfo

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

324566624

​

声纹组创建者的用户 ID。

​

name

​

String

​

小王

​

声纹组创建者的用户名。

​

nickname

​

String

​

小王

​

声纹组创建者的用户昵称。

​

avatar_url

​

String

​

https://example.com/avatar/751427391012944***.jpg

​

声纹组创建者的用户头像。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

GET 'https

:

//api.coze.cn/v1/audio/voiceprint_groups?page_num=1&page_size=10&group_id=7511988408546279468' \

​

--header 'Authorization

:

Bearer pat_gJUE27xgjJxfeH4ZtgrwrJHDnHPD5VTHfmA9IpBMfImgdcAQCzNLXDwm***' \

​

--header 'Content-Type

:

application/json'

​

​

返回示例

​

​

JSON

复制

{

​

"detail"

:

{

​

"logid"

:

"2025060415553824EF7ACB121****"

​

},

​

"data"

:

{

​

"total"

:

1

,

​

"items"

:

[

​

{

​

"feature_count"

:

0

,

​

"desc"

:

"This is a test group"

,

​

"name"

:

"test_group"

,

​

"icon_url"

:

"https://example.***/obj/ocean-cloud-tos/voiceprint/default_voiceprint_group_icon.png"

,

​

"user_info"

:

{

​

"avatar_url"

:

"https://p3-passport.byteacctimg.com/img/user-avatar/assets/e7b19241fb224cea967dfa****_1080_1080.png~0x0.image"

,

​

"id"

:

14891859095

***

,

​

"name"

:

"testcase1"

,

​

"nickname"

:

"5707"

​

},

​

"id"

:

"751198840854***"

,

​

"created_at"

:

1749021940

,

​

"updated_at"

:

1749021940

​

}

​

]

​

},

​

"code"

:

0

,

​

"msg"

:

""

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

创建声纹组

下一篇

更新声纹组信息
============================================================
# 更新声纹组信息
来源: https://www.coze.cn/open/docs/developer_guides/update_voiceprint_group
============================================================

更新声纹组信息

更新声纹组的名称或描述。

​

接口描述

​

创建声纹组后，你可以调用本 API 更新指定声纹组的名称和描述。

​

基础信息

​

​

请求方式

​

PUT

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/audio/voiceprint_groups/:group_id

​

权限

​

updateVoiceprintGroup

​

确保调用该接口使用的个人令牌开通了

updateVoiceprintGroup

权限，详细信息参考

鉴权方式

。

​

接口说明

​

更新声纹组的名称或描述。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

group_id

​

Integer

​

必选

​

751430381173789****

​

待更新的声纹组的 ID。你可以通过

查看声纹组列表

API 查看声纹组 ID。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

name

​

String

​

可选

​

音箱2的声纹组

​

更新后的声纹组名称，最长 20 个字符。

​

desc

​

String

​

可选

​

音箱2的声纹组

​

更新后的声纹组描述，最长 500 个字符。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{ "logid": "202410242028595CCF353CEC86A8*****" }

​

本次请求的详细信息。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request PUT 'https

:

//api.coze.cn/v1/audio/voiceprint_groups/7513864977188***' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json'

​

{

​

"name"

:

"音箱2的声纹组"

,

​

"desc"

:

"音箱2的声纹组"

​

}

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20250609164004CE42B51AC168FD***"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

查询声纹组列表

下一篇

删除声纹组
============================================================
# 删除声纹组
来源: https://www.coze.cn/open/docs/developer_guides/delete_voiceprint_group
============================================================

删除声纹组

删除声纹组。

​

接口描述

​

声纹组的创建者能删除对应的声纹组。删除声纹组会同时删除声纹组中的所有声纹。

​

基础信息

​

​

请求方式

​

DELETE

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/audio/voiceprint_groups/:group_id

​

权限

​

deleteVoiceprintGroup

​

确保调用该接口使用的个人令牌开通了

deleteVoiceprintGroup

权限，详细信息参考

鉴权方式

。

​

接口说明

​

删除声纹组。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

group_id

​

Integer

​

必选

​

751430381173789***

​

待删除的声纹组 ID。你可以通过

查看声纹组列表

API 查看声纹组 ID。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{ "logid": "202410242028595CCF353CEC86A8*****" }

​

本次请求返回的详细信息。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request DELETE 'https

:

//api.coze.cn/v1/audio/voiceprint_groups/7509775482326****' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json' \

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210191248C8EF7607554A6****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

更新声纹组信息

下一篇

创建声纹
============================================================
# 创建声纹
来源: https://www.coze.cn/open/docs/developer_guides/create_voiceprint
============================================================

创建声纹

创建声纹。

​

接口描述

​

创建声纹组后，你可以在对应的声纹组中创建声纹，上传本地预先录制好的音频文件进行创建声纹，扣子将通过该音频文件创建声纹。

​

接口限制

​

每个声纹组中最多可创建 10 个声纹。

​

声纹文件的具体限制如下：

​

​

限制

​

说明

​

文件格式

​

支持的文件格式包括 wav 和 pcm。其中 pcm 仅支持 16kHz 采样率、单声道、16 位采样深度。

​

文件大小

​

每个音频文件最大为 4 MB。

​

文件录制

​

录制环境：选择安静的空间，建议将麦克风放置在离说话人 50 厘米以内的位置，尽量保持自然的发声状态，避免刻意改变声线或呢喃，这样得到的声音会更加自然。尽量减少杂音、噪音和混响的干扰。

​

音频质量：确保录音中只包含一个人的声音。

​

​

​

基础信息

​

​

请求方式

​

POST

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/audio/voiceprint_groups/:group_id/features

​

权限

​

createVoiceprintFeature

​

确保调用该接口使用的个人令牌开通了

createVoiceprintFeature

权限，详细信息参考

鉴权方式

。

​

接口说明

​

创建声纹。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

multipart/form-data

​

文件类型。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

group_id

​

Integer

​

必选

​

75143038117378***

​

声纹所属的声纹组 ID。你可以通过

查看声纹组列表

API 查看声纹组 ID。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

file

​

File

​

必选

​

无

​

上传本地预先录制好的音频文件。

​

name

​

String

​

必选

​

妈妈

​

声纹的名称。

​

desc

​

String

​

可选

​

妈妈的声音

​

声纹的描述。

​

sample_rate

​

Integer

​

可选

​

16000

​

采样率，单位：Hz。当文件类型为 pcm 时需传入该参数。

​

默认为 16kHz 采样率。

​

channel

​

Integer

​

可选

​

1

​

声道数，当文件类型为 pcm 时需传入该参数。

​

默认为单声道。

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

CreateVoicePrintGroupFeatureData

​

{"id":"751427391012944***"}

​

返回的声纹信息。

​

detail

​

Object of

ResponseDetail

​

{ "logid": "202410242028595CCF353CEC86A8*****" }

​

本次请求返回的详细信息。

​

​

CreateVoicePrintGroupFeatureData

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

751427391012944***

​

声纹的 ID。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

POST https

:

//api.coze.cn/v1/audio/voiceprint_groups/75143038117378***/features \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

multipart/form-data' \

​

-F 'file=@/voice_test_data/test_1.wav;type=audio/wav' \

​

-F 'name=妈妈的声音' \

​

-F 'desc=妈妈的声音'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"202506091643272FB1EDC9CA****"

​

},

​

"data"

:

{

​

"id"

:

"75138652833128***"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

删除声纹组

下一篇

更新声纹
============================================================
# 更新声纹
来源: https://www.coze.cn/open/docs/developer_guides/update_voiceprint
============================================================

更新声纹

更新指定声纹组中的声纹。

​

接口描述

​

创建声纹

后，你可以调用本 API 更新声纹组中对应声纹的名称或重新上传声纹的音频数据，更新后的声纹将覆盖原有声纹。

​

仅声纹创建者可以更新对应的声纹。

​

上传的声纹文件的具体限制如下：

​

​

限制

​

说明

​

文件格式

​

支持的文件格式包括 wav 和 pcm。其中 pcm 仅支持 16kHz 采样率、单声道、16 位采样深度。

​

文件大小

​

每个音频文件最大为 4 MB。

​

文件录制

​

录制环境：选择安静的空间，建议将麦克风放置在离说话人 50 厘米以内的位置，尽量保持自然的发声状态，避免刻意改变声线或呢喃，这样得到的声音会更加自然。尽量减少杂音、噪音和混响的干扰。

​

音频质量：确保录音中只包含一个人的声音。

​

​

​

基础信息

​

​

请求方式

​

PUT

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/audio/voiceprint_groups/:group_id/features/:feature_id

​

权限

​

updateVoiceprintFeature

​

确保调用该接口使用的个人令牌开通了

updateVoiceprintFeature

权限，详细信息参考

鉴权方式

。

​

接口说明

​

更新指定声纹组中的声纹。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

multipart/form-data

​

文件类型。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

group_id

​

Integer

​

必选

​

75143038117378***

​

声纹所属的声纹组 ID。你可以通过

查看声纹组列表

API 查看声纹组 ID。

​

feature_id

​

Integer

​

必选

​

75142739101294****

​

待更新的声纹 ID。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

file

​

File

​

可选

​

@/voice_test_data/test_1.wav;type=audio/wav

​

上传本地预先录制好的更新的音频文件。

​

name

​

String

​

可选

​

妈妈

​

更新后的声纹的名称。

​

desc

​

String

​

可选

​

妈妈的声音

​

更新后的声纹的描述。

​

sample_rate

​

Integer

​

可选

​

16000

​

采样率，单位：Hz。当文件类型为 pcm 时需传入该参数。

​

默认为 16kHz 采样率。

​

channel

​

Integer

​

可选

​

1

​

声道数，当文件类型为 pcm 时需传入该参数。

​

默认为单声道。

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{ "logid": "202410242028595CCF353CEC86A8*****" }

​

该请求返回的详细信息。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request PUT

"https://api.coze.cn/v1/audio/v1/audio/voiceprint_groups/751198840854627***/features/75119956441528***"

\

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

multipart/form-data' \

​

-F 'file=@/voice_test_data/test_1.wav;type=audio/wav' \

​

-F 'name=妈妈的声音' \

​

-F 'desc=妈妈的声音'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"202506091643272FB1EDC9***"

​

},

​

"data"

:

{

​

"id"

:

"751386528331282****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

创建声纹

下一篇

查询声纹列表
============================================================
# 查询声纹列表
来源: https://www.coze.cn/open/docs/developer_guides/list_voiceprint
============================================================

查询声纹列表

查询指定声纹组中的声纹列表。

​

基础信息

​

​

请求方式

​

GET

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/audio/voiceprint_groups/:group_id/features

​

权限

​

listVoiceprintFeature

​

确保调用该接口使用的个人令牌开通了

listVoiceprintFeature

权限，详细信息参考

鉴权方式

。

​

接口说明

​

查询声纹组中的声纹列表。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

group_id

​

Integer

​

必选

​

75143038117378***

​

声纹组 ID。你可以通过

查看声纹组列表

API 查看声纹组 ID。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

page_num

​

Long

​

可选

​

1

​

查询结果分页展示时，此参数用于设置查看的页码。最小值为 1，默认为 1。

​

page_size

​

Long

​

可选

​

5

​

查询结果分页展示时，此参数用于设置每页返回的数据量。取值范围为 1~200，默认为 10。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

GetVoicePrintGroupFeatureListData

​

\

​

返回的声纹列表及相关信息。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

GetVoicePrintGroupFeatureListData

​

​

参数

​

类型

​

示例

​

说明

​

items

​

Array of

VoicePrintGroupFeature

​

\

​

声纹列表，包含多个声纹的详细信息。

​

total

​

Long

​

5

​

声纹数量。

​

​

VoicePrintGroupFeature

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

751427391012944***

​

声纹的 ID。

​

desc

​

String

​

妈妈的声纹

​

声纹的描述。

​

name

​

String

​

妈妈

​

声纹的名称。

​

group_id

​

String

​

75143038117378***

​

声纹组的 ID。

​

icon_url

​

String

​

https://example.com/voiceprint/default_voiceprint_group_feature_icon.png

​

声纹的头像 URL。

​

audio_url

​

String

​

https://example.com/audio/751427391012944***.

pcm

​

声纹原始音频的 URL 地址，用于访问或下载该声纹对应的音频文件。

​

user_info

​

Object of

UserInfo

​

{"id":"324566624","name":"小王","nickname":"小王","avatar_url":"

https://example.com/avatar/751427391012944***.image

"}

​

声纹创建者的用户信息。

​

created_at

​

Long

​

1714567890123

​

声纹的创建时间，以 Unix 时间戳格式表示，单位为秒。

​

updated_at

​

Long

​

1714567890223

​

声纹的更新时间，以 Unix 时间戳格式表示，单位为秒。

​

​

UserInfo

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

14891859095***

​

声纹创建者的扣子用户的 UID。

​

name

​

String

​

小王

​

声纹创建者的扣子用户名。

​

nickname

​

String

​

小王

​

声纹创建者的扣子用户昵称。

​

avatar_url

​

String

​

https://example.com/e7b19241fb224cea967df

****

_1080_1080.png~0x0.image

​

声纹创建者的扣子用户头像。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl -X POST 'https

:

//api.coze.cn/v1/audio/voiceprint_groups/7511988408546279468/features?page_num=1&page_size=10' \

​

--header 'Authorization

:

Bearer pat_aqtInOKBi7ThceVOrVvm51kguh39iXlvHxvjr9NtZ8pe20xh2qLniSZWeq***' \

​

--header 'Content-Type

:

application/json' \

​

​

返回示例

​

​

JSON

复制

{

​

"detail"

:

{

​

"logid"

:

"20250604160710FB81ACE4CFC****"

​

},

​

"data"

:

{

​

"total"

:

1

,

​

"items"

:

[

​

{

​

"id"

:

"7511995644152****"

,

​

"name"

:

"test_feature"

,

​

"user_info"

:

{

​

"id"

:

14891859095

***

,

​

"name"

:

"testcase1"

,

​

"nickname"

:

"5707"

,

​

"avatar_url"

:

"https://example.com/img/user-avatar/assets/e7b19241fb224cea967dfa****_1080_1080.png~0x0.image"

​

},

​

"audio_url"

:

"https://example.com/voiceprint/9a71240d-f316-4bb6-8a5f-8a****"

,

​

"desc"

:

"This is a test feature"

,

​

"icon_url"

:

"https://example.com/voiceprint/default_voiceprint_group_feature_icon.png"

,

​

"group_id"

:

"75119884085462***"

,

​

"created_at"

:

1749024396

,

​

"updated_at"

:

1749024396

​

}

​

]

​

},

​

"code"

:

0

,

​

"msg"

:

""

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

更新声纹

下一篇

删除声纹
============================================================
# 删除声纹
来源: https://www.coze.cn/open/docs/developer_guides/delete_voiceprint
============================================================

删除声纹

删除声纹。

​

接口限制

​

只有声纹创建者能删除对应的声纹。

​

基础信息

​

​

请求方式

​

DELETE

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/audio/voiceprint_groups/:group_id/features/:feature_id

​

权限

​

deleteVoiceprintFeature

​

确保调用该接口使用的个人令牌开通了

deleteVoiceprintFeature

权限，详细信息参考

鉴权方式

。

​

接口说明

​

删除声纹。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

group_id

​

Integer

​

必选

​

75143038117378***

​

声纹所属的声纹组 ID。你可以通过

查看声纹组列表

API 查看声纹组 ID。

​

feature_id

​

Integer

​

必选

​

75142739101294****

​

待删除的声纹 ID。你可以通过

查看声纹列表

API 查看声纹 ID。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{ "logid": "202410242028595CCF353CEC86A8*****" }

​

该请求返回的详细信息。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request DELETE 'https

:

//api.coze.cn/v1/audio/voiceprint_groups/75119884085462****/features/75119956441531****' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json' \

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"202506041638009B2412738DD***"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

查询声纹列表

下一篇

声纹特征比对
============================================================
# 声纹特征比对
来源: https://www.coze.cn/open/docs/developer_guides/identify_voiceprint
============================================================

声纹特征比对

声纹特征比对。

​

接口说明

​

注意

声纹特征比对将产生声纹识别费用，详细费用说明可参考

音视频费用

。

​

​

你可以调用本 API 识别说话者的身份。上传说话者的音频，扣子编程将根据该音频与指定声纹组中已有的声纹进行对比，计算相似度，并返回与各声纹的匹配度列表。

​

上传的音频文件的限制如下：

​

​

限制

​

说明

​

文件格式

​

支持的文件格式包括 wav 和 pcm。其中 pcm 仅支持 16kHz 采样率、单声道、16 位采样深度。

​

文件大小

​

每个音频文件最大为 4 MB。

​

文件录制

​

录制环境：选择安静的空间，建议将麦克风放置在离说话人 50 厘米以内的位置，尽量保持自然的发声状态，避免刻意改变声线或呢喃，这样得到的声音会更加自然。尽量减少杂音、噪音和混响的干扰。

​

音频质量：确保录音中只包含一个人的声音。

​

​

​

基础信息

​

​

请求方式

​

POST

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/audio/voiceprint_groups/:group_id/speaker_identify

​

权限

​

identifyInVoiceprintGroup

​

确保调用该接口使用的个人令牌开通了

identifyInVoiceprintGroup

权限，详细信息参考

鉴权方式

。

​

接口说明

​

声纹特征比对。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

application/json

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

multipart/form-data

​

文件类型。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

group_id

​

Integer

​

可选

​

75143038117378***

​

声纹所属的声纹组 ID。你可以通过

查看声纹组列表

API 查看声纹组 ID。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

file

​

File

​

必选

​

@/voice_test_data/test_1.wav;type=audio/wav

​

上传需要进行声纹特征比对的音频文件。

​

top_k

​

Interger

​

可选

​

5

​

返回特征匹配度最高的前 k 项结果。若未指定，则默认返回全部匹配结果。

​

sample_rate

​

Integer

​

可选

​

16000

​

采样率，单位：Hz。当文件类型为 pcm 时需传入该参数。

​

默认的采样率为 16kHz。

​

channel

​

Integer

​

可选

​

1

​

声道数，当文件类型为 pcm 时需传入该参数。

​

默认为单声道。

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

SpeakerIdentifyData

​

[{"score":60,"feature_id":"751427391012944***","feature_desc":"妈妈的声音","feature_name":"妈妈"}]

​

声纹匹配度列表，包含测试音频与声纹库中已有声纹的匹配信息。

​

detail

​

Object of

ResponseDetail

​

{ "logid": "202410242028595CCF353CEC86A8*****" }

​

本次请求返回的详细信息。

​

​

SpeakerIdentifyData

​

​

参数

​

类型

​

示例

​

说明

​

feature_score_list

​

Array of

FeatureScore

​

{"score":60,"feature_id":"751427391012944***","feature_desc":"妈妈的声音","feature_name":"妈妈"}

​

声纹匹配度列表，包含测试音频与声纹库中已有声纹的匹配信息。

​

​

FeatureScore

​

​

参数

​

类型

​

示例

​

说明

​

score

​

Double

​

60

​

声纹匹配度。表示测试音频与声纹库中已有声纹的匹配程度，数值范围为 0~100，数值越高表示匹配度越高。

​

feature_id

​

String

​

751427391012944***

​

与测试音频匹配的声纹的 ID。

​

feature_desc

​

String

​

妈妈的声音

​

声纹的描述。

​

feature_name

​

String

​

妈妈

​

声纹的名称。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/audio/voiceprint_groups/7513864977189*****/speaker_identify' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

multipart/form-data' \

​

-F 'file=@/voice_test_data/test_3.wav;type=audio/wav'

​

​

返回示例

​

​

JSON

复制

{

​

"data"

:

{

​

"feature_score_list"

:

[

​

{

​

"score"

:

23.139079321463843

,

​

"feature_name"

:

"妈妈的声音"

,

​

"feature_desc"

:

"妈妈的声音"

,

​

"feature_id"

:

"7513865283312***"

​

}

​

]

​

},

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"202506091647409DF126AF380****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

删除声纹

下一篇

创建知识库
============================================================
# 创建知识库
来源: https://www.coze.cn/open/docs/developer_guides/create_dataset
============================================================

创建知识库

调用此接口以创建一个扣子知识库。

​

调用此 API，你可以创建一个文本知识库或图片知识库。新知识库默认为空，需要通过 API

创建知识库文件

上传文本或图片。

​

说明

知识库分为扣子知识库和火山知识库，该 API 仅用于创建扣子知识库，不支持火山知识库的创建，如果需要创建火山知识库，请参见

创建火山知识库 API 文档

。

​

暂不支持通过 API 创建表格知识库。

​

创建知识库时如需设置知识库图标，需要提前调用 API

上传文件

，将图片文件上传至扣子编程。

​

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/datasets

​

​

权限

​

createKnowledge

​

确保调用该接口使用的访问令牌开通了

createKnowledge

权限，详细信息参考

鉴权方式

。

​

接口说明

​

调用此接口创建知识库。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

请求正文的方式。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

name

​

String

​

必选

​

产品文档

​

知识库名称，长度不超过 100 个字符。

​

space_id

​

String

​

必选

​

744632974166804****

​

知识库所在的空间的工作空间 ID。Space ID 是空间的唯一标识。

​

进入指定空间，空间页面 URL 中

w

参数后的数字就是 工作空间 ID。例如

https://code.coze.cn/w/75814654762959***/projects

，Space ID 为

75814654762959***

。

​

format_type

​

Integer

​

必选

​

2

​

知识库类型。取值包括：

​

0：文本类型

​

2：图片类型

​

description

​

String

​

可选

​

A 的产品文档

​

知识库描述信息。

​

file_id

​

String

​

可选

​

744667846938145****

​

知识库图标，应传入

上传文件

接口中获取的 file_id。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Object of

CreateDatasetOpenApiData

​

{ "dataset_id": "744668935865830****" }

​

返回内容

​

code

​

Long

​

0

​

状态码。

​

0 代表调用成功。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

20241210160547B25AEC1917B03A2F1F07

​

本次请求的日志 ID。

​

​

CreateDatasetOpenApiData

​

​

参数

​

类型

​

示例

​

说明

​

dataset_id

​

String

​

744668935865830****

​

新知识库的 ID。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/datasets' \

​

--header 'Authorization

:

Bearer pat_xitq9LWlowpX3qGCih1lwpAdzvXN****' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"name"

:

"产品文档"

,

​

"description"

:

"产品文档"

,

​

"space_id"

:

"731121948439879****"

,

​

"format_type"

:

2

,

​

"file_id"

:

"744667846938145****"

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"data"

:

{

​

"dataset_id"

:

"744668935865830****"

​

},

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210160547B25AEC1917B0***"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

声纹特征比对

下一篇

查看知识库列表
============================================================
# 查看知识库列表
来源: https://www.coze.cn/open/docs/developer_guides/list_dataset
============================================================

查看知识库列表

调用此接口查看指定空间资源库下的全部知识库。

​

此接口可查看工作空间下，空间资源库中的全部知识库，包括扣子知识库和火山知识库，无论知识库是否归本人所有。

​

说明

暂不支持通过 API 查看低代码应用中的知识库。

​

暂不支持通过该 API 查看火山知识库中的文件列表等详细信息。

​

​

基础信息

​

​

请求方式

​

GET

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/datasets

​

​

权限

​

listKnowledge

​

确保调用该接口使用的个人令牌开通了

listKnowledge

权限，详细信息参考

鉴权方式

。

​

接口说明

​

调用此接口查看指定空间下的全部知识库。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

请求正文的方式。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

space_id

​

String

​

必选

​

731121948439879****

​

知识库所在的空间的 Space ID。Space ID 是空间的唯一标识。

​

进入指定空间，空间页面 URL 中

w

参数后的数字就是 工作空间 ID。例如

https://code.coze.cn/w/75814654762959***/projects

，工作空间 ID 为

75814654762959***

。

​

name

​

String

​

可选

​

知识库

​

知识库名称，支持模糊搜索。

​

format_type

​

Integer

​

可选

​

2

​

类型

​

page_num

​

Integer

​

可选

​

1

​

查询结果分页展示时，此参数用于设置查看的页码。最小值为 1，默认为 1。

​

page_size

​

Integer

​

可选

​

5

​

查询结果分页展示时，此参数用于设置每页返回的数据量。取值范围为 1~300，默认为 10。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Object of

ListDatasetOpenApiData

​

参考请求示例部分

​

接口响应的业务信息。

​

code

​

Long

​

4000

​

状态码。

​

0 代表调用成功。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{ "logid": "20250106172024B5F607030EFFAD653960" }

​

响应详情信息。

​

​

ListDatasetOpenApiData

​

​

参数

​

类型

​

示例

​

说明

​

total_count

​

Integer

​

1

​

空间中的知识库总数量。

​

dataset_list

​

Array of

Dataset

​

参考请求示例部分

​

知识库详情。

​

​

Dataset

​

​

参数

​

类型

​

示例

​

说明

​

name

​

String

​

openapi

​

知识库名称。

​

status

​

Integer

​

1

​

知识库状态，取值包括：

​

1：启用中

​

3：未启用

​

can_edit

​

Boolean

​

true

​

当前用户是否为该知识库的所有者。

​

icon_uri

​

String

​

FileBizType.BIZ_DATASET_ICON/217526895615****.jpg

​

知识库图标的 uri。

​

icon_url

​

String

​

https://lf3-appstore-sign.oceancloudapi.com/ocean-cloud-tos/FileBizType.BIZ_DATASET_ICON/217526895615****.jpg?lk3s=5ec9c6e9&x-expires=1733821937&x-signature=U6X%2BhLXnRk8%2FHr1xP7wiMJ3IE****

​

知识库图标的 URL。

​

space_id

​

String

​

731121948439879****

​

知识库所在空间的空间 ID。

​

doc_count

​

Integer

​

2

​

知识库中的文件数量。

​

file_list

​

Array of String

​

["8f6a939c9aad434fa81624556abf8a62****.png","9k7a939c9aad434fa81624556abf8a62****.png"]

​

知识库中的文件列表。

​

hit_count

​

Integer

​

0

​

知识库命中总次数。

​

avatar_url

​

String

​

https://p6-passport.byteacctimg.com/img/user-avatar/assets/e7b19241fb224cea967****.png~300x300.image

​

知识库创建者的头像 url。

​

creator_id

​

String

​

217526895615****

​

知识库创建者的扣子用户 UID。

​

dataset_id

​

String

​

744668935865830****

​

知识库 ID。

​

create_time

​

Integer

​

1733817948

​

知识库创建时间，秒级时间戳。

​

description

​

String

​

description

​

知识库描述信息。

​

format_type

​

Integer

​

2

​

知识库类型，包括：

​

0：文本类型

​

1：表格类型

​

2：图片类型

​

slice_count

​

Integer

​

1

​

知识库分段总数。

​

update_time

​

Integer

​

1733817948

​

知识库的更新时间，秒级时间戳。

​

creator_name

​

String

​

your name

​

知识库创建者的用户名。

​

all_file_size

​

Long

​

0

​

知识库中已存文件的总大小。

​

bot_used_count

​

Integer

​

0

​

知识库已绑定的智能体数量。

​

chunk_strategy

​

Object of

ChunkStrategy

​

{“chunk_type”: 0}

​

知识库的切片规则。

​

failed_file_list

​

Array of String

​

["8f6a939c9aad434fa81624556abf8a62****.png","9k7a939c9aad434fa81624556abf8a62****.png"]

​

处理失败的文件列表。

​

processing_file_list

​

Array of String

​

["8f6a939c9aad434fa81624556abf8a62****.png","9k7a939c9aad434fa81624556abf8a62****.png"]

​

处理中的文件名。

​

processing_file_id_list

​

Array of String

​

["744779282568390****"]

​

处理中的文件 ID。

​

​

ChunkStrategy

​

​

参数

​

类型

​

示例

​

说明

​

chunk_type

​

Integer

​

0

​

分段设置。取值包括：

​

0：自动分段与清洗。采用扣子编程预置规则进行数据分段与处理。

​

1：自定义。此时需要通过 separator、max_tokens、remove_extra_spaces 和 remove_urls_emails 分段规则细节。

​

separator

​

String

​

#

​

分段标识符。

​

在 chunk_type=1 时必选。

​

max_tokens

​

Long

​

800

​

最大分段长度，取值范围为 100~2000。

​

在 chunk_type=1 时必选。

​

remove_extra_spaces

​

Boolean

​

true

​

是否自动过滤连续的空格、换行符和制表符。取值包括：

​

true：自动过滤

​

false：（默认）不自动过滤

​

在 chunk_type=1 时生效。

​

remove_urls_emails

​

Boolean

​

true

​

是否自动过滤所有 URL 和电子邮箱地址。取值包括：

​

true：自动过滤

​

false：（默认）不自动过滤

​

在 chunk_type=1 时生效。

​

caption_type

​

Integer

​

0

​

图片知识库的标注方式：

​

0：（默认）系统自动标注描述信息

​

1：手工标注。上传图片后需要再次调用 API

更新知识库图片描述

来手动设置标注。

​

说明

在空的知识库中首次上传图片时，需要手工设置

caption_type

参数的值，否则会报错。

​

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v1/datasets?space_id=731121948439879****&name=知识库&format_type=&page_num=1&page_size=5' \

​

--header 'Authorization

:

Bearer pat_O******' \

​

--header 'Content-Type

:

application/json'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"data"

:

{

​

"total_count"

:

1

,

​

"dataset_list"

:

[

​

{

​

"hit_count"

:

0

,

​

"doc_count"

:

0

,

​

"status"

:

1

,

​

"icon_url"

:

"https://lf3-appstore-sign.oceancloudapi.com/ocean-cloud-tos/FileBizType.BIZ_DATASET_ICON/217526895615****.jpg?lk3s=5ec9c6e9&x-expires=1733821937&x-signature=U6X%2BhLXnRk8%2FHr1xP7wiMJ3IE****"

,

​

"creator_name"

:

"xxx"

,

​

"avatar_url"

:

"https://p6-passport.byteacctimg.com/img/user-avatar/assets/e7b19241fb224cea967****.png~300x300.image"

,

​

"can_edit"

:

true

,

​

"space_id"

:

"731121948439879****"

,

​

"failed_file_list"

:

[],

​

"processing_file_id_list"

:

[],

​

"description"

:

"openapi"

,

​

"chunk_strategy"

:

{},

​

"create_time"

:

1733817948

,

​

"slice_count"

:

0

,

​

"name"

:

"openapi_img3"

,

​

"format_type"

:

2

,

​

"project_id"

:

""

,

​

"all_file_size"

:

"0"

,

​

"update_time"

:

1733817948

,

​

"creator_id"

:

"217526895615****"

,

​

"file_list"

:

[],

​

"processing_file_list"

:

[],

​

"icon_uri"

:

"FileBizType.BIZ_DATASET_ICON/217526895615****.jpg"

,

​

"dataset_id"

:

"744668935865830****"

,

​

"bot_used_count"

:

0

​

}

​

]

​

},

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210161217C90C9ABB86428***"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

创建知识库

下一篇

修改知识库信息
============================================================
# 修改知识库信息
来源: https://www.coze.cn/open/docs/developer_guides/update_dataset
============================================================

修改知识库信息

调用此接口修改扣子知识库信息。

​

说明

此接口会全量刷新知识库的 name、file_id 和 description 配置，如果未设置这些参数，参数将恢复默认配置。

​

知识库分为扣子知识库和火山知识库，该 API 仅用于修改扣子知识库，不支持修改火山知识库，如果需要修改火山知识库的信息，请参见

修改火山知识库信息 API 文档

。

​

仅支持修改本人为所有者的知识库信息，包括知识库名称、图标、描述等信息。

​

如需修改知识库图标，需要先调用 API

上传文件

，将图片文件上传至扣子编程。

​

​

基础信息

​

​

请求方式

​

PUT

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/datasets/:dataset_id

​

​

权限

​

update

​

确保调用该接口使用的个人令牌开通了

update

权限，详细信息参考

鉴权方式

。

​

接口说明

​

调用此接口修改知识库信息。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

dataset_id

​

String

​

必选

​

744632974166804****

​

知识库 ID。

​

在扣子编程中打开指定知识库页面，页面 URL 中

knowledge

参数后的数字就是知识库 ID。例如

https://www.coze.cn/space/736142423532160****/knowledge/738509371792341****

，知识库 ID 为

738509371792341****

。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

name

​

String

​

必选

​

knowledge

​

知识库名称，长度不超过 100 个字符。

​

file_id

​

String

​

可选

​

744667846938145****

​

知识库图标，应传入

上传文件

接口中获取的 file_id。

​

description

​

String

​

可选

​

description of knowledge

​

知识库描述信息。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

4000

​

状态码。

​

0 代表调用成功。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{ "logid": "20250106172024B5F607030EFFAD653960" }

​

响应详情信息。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request PUT 'https

:

//api.coze.cn/v1/datasets/:dataset_id' \

​

--header 'Authorization

:

Bearer pat_qad2rHYNqKnCmRYZW4PhVRibaS***' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"name"

:

"AI知识库"

,

​

"file_id"

:

"74466784693814***"

,

​

"description"

:

"这是一个关于人工智能的知识库，包含机器学习、深度学习等内容。"

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210191248C8EF7607554A****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

查看知识库列表

下一篇

删除知识库
============================================================
# 删除知识库
来源: https://www.coze.cn/open/docs/developer_guides/delete_dataset
============================================================

删除知识库

调用此接口删除扣子知识库。

​

说明

空间管理员可以删除团队中所有知识库，其他成员只能删除本人为所有者的知识库，

​

删除知识库时，会同时删除知识库中已上传的所有文件，且绑定此知识库的智能体会自动解绑。

​

此 API 仅支持删除扣子知识库，不适用于火山知识库。如需删除火山知识库，请参考

删除火山知识库

。

​

​

基础信息

​

​

请求方式

​

DELETE

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/datasets/:dataset_id

​

​

权限

​

delete

​

确保调用该接口使用的个人令牌开通了

delete

权限，详细信息参考

鉴权方式

。

​

接口说明

​

调用此接口以删除本人持有的知识库信息。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

dataset_id

​

String

​

必选

​

744632974166804****

​

扣子知识库 ID。

​

在扣子编程中打开指定知识库页面，页面 URL 中

knowledge

参数后的数字就是知识库 ID。例如

https://www.coze.cn/space/736142423532160****/knowledge/738509371792341****

，知识库 ID 为

738509371792341****

。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

状态码。

​

0 代表调用成功。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

-

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request DELETE  'https

:

//api.coze.cn/v1/datasets/744668935865830****' \

​

--header 'Authorization

:

Bearer pat_O******' \

​

--header 'Content-Type

:

application/json'

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210191248C8EF7607554A***"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

修改知识库信息

下一篇

创建知识库文件
============================================================
# 创建知识库文件
来源: https://www.coze.cn/open/docs/developer_guides/create_knowledge_files
============================================================

创建知识库文件

调用此 API 向指定的扣子知识库上传文件。

​

接口说明

​

通过此 API，你可以向文本或图片知识库中上传文件。

​

暂不支持通过 API 创建表格知识库。

​

本 API 仅适用于扣子知识库的文件上传操作，不适用于火山知识库上传文件。火山知识库上传文件请参见

火山知识库上传文件

。

​

上传图片到图片知识库时，可以通过

caption_type

参数设置系统标注或手动标注，如果选择手动标注，还需要调用

更新知识库图片描述

API 手动设置标注。

​

支持的上传方式如下：

​

​

上传方式

​

文本知识库

​

图片知识库

​

通过 Base 64 上传本地文件

​

✅

​

格式支持 pdf、txt、doc、docx 类型。

​

❌

​

上传在线网页

​

✅

​

❌

​

通过

上传文件

上传

​

❌

​

✅

​

​

注意事项

​

每次最多可上传 10 个文件。

​

必须上传和知识库类型匹配的文件，例如 txt 等文档类型的文件只能上传到文档知识库中，不可上传到表格知识库中。

​

每个请求只能选择一种上传方式，不支持同时上传在线网页和本地文档。

​

仅知识库的所有者可以向知识库中上传文件。

​

基础信息

​

​

请求方式

​

POST

请求地址

​

​

Plain Text

复制

https://api.coze.cn/open_api/knowledge/document/create

​

权限

​

createDocument

​

确保调用该接口使用的服务令牌开通了

createDocument

权限，详细信息参考

鉴权方式

。

​

接口说明

​

调用此接口向指定知识库中上传文件。

​

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

请求正文的方式。

​

Agw-Js-Conv

​

str

​

防止丢失数字类型参数的精度。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

dataset_id

​

String

​

必选

​

736356924530694****

​

扣子知识库 ID。

​

在扣子编程中打开指定知识库页面，页面 URL 中

knowledge

参数后的数字就是知识库 ID。例如

https://www.coze.cn/space/736142423532160****/knowledge/738509371792341****

，知识库 ID 为

738509371792341****

。

​

document_bases

​

Array of

DocumentBase

​

必选

​

[ { "name": "Coze.pdf", "source_info": { "file_base64": "5rWL6K+V5LiA5LiL5ZOm", "file_type": "pdf" } } ]

​

待上传文件的元数据信息。数组最大长度为 10，即每次最多上传 10 个文件。

​

支持的上传方式如下：

​

文本知识库：

​

通过 Base64 上传本地文件。

​

上传在线网页。

​

图片知识库：通过

上传文件

API 获取的 file_id 上传图片。

​

chunk_strategy

​

Object of

ChunkStrategy

​

必选

​

{

​

"separator":

"

\n\n",

​

"max_tokens": 800,

​

"remove_extra_spaces": false,

​

"remove_urls_emails": false,

​

"chunk_type": 1

​

}

​

分段规则。详见

ChunkStrategy object

​

Tip

每次都需要传入

​

​

format_type

​

Integer

​

必选

​

2

​

知识库类型。取值包括：

​

0：文本类型

​

2：图片类型

​

​

DocumentBase

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

name

​

String

​

必选

​

Coze.pdf

​

文件名称。

​

source_info

​

Object of

SourceInfo

​

必选

​

{ "file_base64": "5rWL6K+V5LiA5LiL5ZOm", "file_type": "pdf" }

​

文件的元数据信息。

​

不同的上传方式需要指定不同参数：

​

本地文件

：Base64 形式上传，需要设置参数 file_base64、file_type。

​

在线网页

：需要设置参数 web_url、document_source。

​

file_id

：需要设置参数 source_file_id、document_source。其中 source_file_id 为

上传文件

API 的响应参数 file_id。

​

update_rule

​

Object of

UpdateRule

​

可选

​

{"update_type": 0}

​

在线网页的更新策略。默认不自动更新。仅上传在线网页时需要设置。

​

caption

​

String

​

可选

​

可爱的

​

当知识库类型为图片类型时，通过该字段设置图片描述。

​

​

SourceInfo

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

file_base64

​

String

​

可选

​

5rWL6K+V5LiA5LiL5ZOm

​

本地文件的 Base64 编码。

​

说明

上传本地文件时必选。

​

​

file_type

​

String

​

可选

​

pdf

​

本地文件格式，即文件后缀，例如 txt。格式支持 pdf、txt、doc、docx 类型。

​

上传的文件类型应与知识库类型匹配，例如 txt 文件只能上传到文档类型的知识库中。

​

说明

上传本地文件时必选。

​

​

web_url

​

String

​

可选

​

https://docs.coze.cn/developer_guides/upload_files

​

网页的 URL 地址。

​

说明

上传在线网页时必选。

​

​

document_source

​

Integer

​

可选

​

1

​

文件的上传方式。支持设置为：

​

0：本地文件上传。

​

1：上传在线网页。

​

5：通过

上传文件

上传图片。

​

source_file_id

​

String

​

可选

​

736949598110202****

​

通过

上传文件

接口获取的文件 ID。

​

​

UpdateRule

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

update_type

​

Integer

​

可选

​

1

​

在线网页是否自动更新。取值包括：

​

0：（默认）不自动更新

​

1：自动更新

​

update_interval

​

Integer

​

可选

​

24

​

在线网页自动更新的频率。单位为小时，最小值为 24。

​

​

ChunkStrategy

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

chunk_type

​

Integer

​

可选

​

0

​

分段设置。取值包括：

​

0：自动分段与清洗。采用扣子编程预置规则进行数据分段与处理。

​

1：自定义。此时需要通过 separator、max_tokens、remove_extra_spaces 和 remove_urls_emails 分段规则细节。

​

separator

​

String

​

可选

​

#

​

分段标识符。

​

在 chunk_type=1 时必选。

​

max_tokens

​

Long

​

可选

​

800

​

最大分段长度，取值范围为 100~2000。

​

在 chunk_type=1 时必选。

​

remove_extra_spaces

​

Boolean

​

可选

​

true

​

是否自动过滤连续的空格、换行符和制表符。取值包括：

​

true：自动过滤

​

false：（默认）不自动过滤

​

在 chunk_type=1 时生效。

​

remove_urls_emails

​

Boolean

​

可选

​

true

​

是否自动过滤所有 URL 和电子邮箱地址。取值包括：

​

true：自动过滤

​

false：（默认）不自动过滤

​

在 chunk_type=1 时生效。

​

caption_type

​

Integer

​

可选

​

0

​

图片知识库的标注方式：

​

0：（默认）系统自动标注描述信息

​

1：手工标注。上传图片后需要再次调用 API

更新知识库图片描述

来手动设置标注。

​

说明

在空的知识库中首次上传图片时，需要手工设置

caption_type

参数的值，否则会报错。

​

​

​

​

返回参数

​

​

​

参数

​

类型

​

示例

​

说明

​

document_infos

​

Array of

DocumentInfo

​

-

​

已上传文件的基本信息。

​

code

​

Long

​

0

​

状态码。

​

0 代表调用成功。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{ "logid": "20250106172024B5F607030EFFAD653960" }

​

响应详情信息。

​

​

DocumentInfo

​

​

参数

​

类型

​

示例

​

说明

​

char_count

​

Integer

​

4

​

文件内容的总字符数量。

​

chunk_strategy

​

Object of

ChunkStrategy

​

{ "chunk_type": 1, "max_tokens": 800, "remove_extra_spaces": false, "remove_urls_emails": false, "separator": "#" }

​

分段规则。

​

create_time

​

Integer

​

1719907964

​

文件的上传时间，格式为 10 位的 Unixtime 时间戳。

​

document_id

​

String

​

738694205603010****

​

文件的 ID。

​

format_type

​

Integer

​

0

​

文件的格式类型。取值包括：

​

0：文档类型，例如 txt 、pdf 、在线网页等格式均属于文档类型。

​

1：表格类型，例如 xls 表格等格式属于表格类型。

​

2：照片类型，例如 png 图片等格式属于照片类型。

​

hit_count

​

Integer

​

0

​

被对话命中的次数。

​

name

​

String

​

Coze.pdf

​

文件的名称。

​

size

​

Integer

​

14164

​

文件的大小，单位为字节。

​

slice_count

​

Integer

​

1

​

文件的分段数量。

​

source_type

​

Integer

​

0

​

文件的上传方式。取值包括：

​

0：上传本地文件。

​

1：上传在线网页。

​

status

​

Integer

​

1

​

文件的处理状态。取值包括：

​

0：处理中

​

1：处理完毕

​

9：处理失败，建议重新上传

​

type

​

String

​

pdf

​

本地文件格式，即文件后缀，例如 txt。格式支持 pdf、txt、doc、docx 类型。

​

update_interval

​

Integer

​

0

​

在线网页自动更新的频率。单位为小时。

​

update_time

​

Integer

​

1719907969

​

文件的最近一次修改时间，格式为 10 位的 Unixtime 时间戳。

​

update_type

​

Integer

​

0

​

在线网页是否自动更新。取值包括：

​

0：不自动更新

​

1：自动更新

​

tos_uri

​

String

​

FileBizType.BIZ_BOT_DATASET/847077809337655_1727579972975689529_0ytrdq****.docx

​

上传的本地文档的唯一标识。

​

​

ChunkStrategy

​

​

参数

​

类型

​

示例

​

说明

​

chunk_type

​

Integer

​

0

​

分段设置。取值包括：

​

0：自动分段与清洗。采用扣子编程预置规则进行数据分段与处理。

​

1：自定义。此时需要通过 separator、max_tokens、remove_extra_spaces 和 remove_urls_emails 分段规则细节。

​

separator

​

String

​

#

​

分段标识符。

​

在 chunk_type=1 时必选。

​

max_tokens

​

Long

​

800

​

最大分段长度，取值范围为 100~2000。

​

在 chunk_type=1 时必选。

​

remove_extra_spaces

​

Boolean

​

true

​

是否自动过滤连续的空格、换行符和制表符。取值包括：

​

true：自动过滤

​

false：（默认）不自动过滤

​

在 chunk_type=1 时生效。

​

remove_urls_emails

​

Boolean

​

true

​

是否自动过滤所有 URL 和电子邮箱地址。取值包括：

​

true：自动过滤

​

false：（默认）不自动过滤

​

在 chunk_type=1 时生效。

​

caption_type

​

Integer

​

0

​

图片知识库的标注方式：

​

0：（默认）系统自动标注描述信息

​

1：手工标注。上传图片后需要再次调用 API

更新知识库图片描述

来手动设置标注。

​

说明

在空的知识库中首次上传图片时，需要手工设置

caption_type

参数的值，否则会报错。

​

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

​

​

示例

​

请求示例

​

上传本地文件

上传在线网页

通过 file_id 上传图片

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/open_api/knowledge/document/create' \

​

--data-raw '

{

​

"dataset_id"

:

"736356924530694****"

,

​

"document_bases"

:

[

​

{

​

"name"

:

"Coze.pdf"

,

​

"source_info"

:

{

​

"file_base64"

:

"5rWL6K+V5LiA5LiL5ZOm"

,

​

"file_type"

:

"pdf"

​

}

​

}

​

],

​

"chunk_strategy"

:

{

​

"separator"

:

"\n\n"

,

​

"max_tokens"

:

800

,

​

"remove_extra_spaces"

:

false

,

​

"remove_urls_emails"

:

false

,

​

"chunk_type"

:

1

​

}

​

}

'

​

​

​

返回示例

​

​

JSON

复制

{

​

"document_infos"

:

[

​

{

​

"name"

:

"Coze.pdf"

,

​

"size"

:

14164

,

​

"type"

:

"pdf"

,

​

"status"

:

1

,

​

"tos_uri"

:

"FileBizType.BIZ_BOT_DATASET/847077809337655_1727579972975689529_0ytrdq****.docx"

,

​

"hit_count"

:

0

,

​

"char_count"

:

4

,

​

"create_time"

:

1719907964

,

​

"document_id"

:

"738694205603010****"

,

​

"format_type"

:

2

,

​

"slice_count"

:

1

,

​

"source_type"

:

null

,

​

"update_time"

:

1719907969

,

​

"update_type"

:

null

,

​

"chunk_strategy"

:

{

​

"chunk_type"

:

1

,

​

"max_tokens"

:

800

,

​

"remove_extra_spaces"

:

false

,

​

"remove_urls_emails"

:

false

,

​

"separator"

:

"\n\n"

​

},

​

"update_interval"

:

0

​

}

​

],

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20250106172024B5F607030EFFA***"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

删除知识库

下一篇

修改知识库文件
============================================================
# 修改知识库文件
来源: https://www.coze.cn/open/docs/developer_guides/modify_knowledge_files
============================================================

修改知识库文件

调用接口修改扣子知识库文件名称和更新策略。

​

说明

调用接口修改扣子知识库文件名称和更新策略。

​

知识库分为扣子知识库和火山知识库，该 API 仅用于创建扣子知识库，不支持火山知识库的创建，如果需要创建火山知识库，请参见

创建火山知识库 API 文档

。

​

​

基础信息

​

​

请求方式

​

POST

请求地址

​

​

Plain Text

复制

https://api.coze.cn/open_api/knowledge/document/update

​

权限

​

updateDocument

​

确保调用该接口使用的个人令牌开通了

updateDocument

权限，详细信息参考

鉴权方式

。

接口说明

​

调用接口修改知识库文件名称和更新策略。

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

请求正文的方式。

​

Agw-Js-Conv

​

str

​

防止丢失数字类型参数的精度。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

document_id

​

String

​

可选

​

738694205603010****

​

待修改的知识库文件 ID。

document_name

​

String

​

可选

​

cozeoverview

​

知识库文件的新名称。

update_rule

​

Object of

UpdateRule

​

可选

​

{"update_type":1,"update_interval":1}

​

在线网页的更新配置。

​

​

UpdateRule

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

update_type

​

Integer

​

可选

​

1

​

在线网页是否自动更新。取值包括：

​

0：（默认）不自动更新

​

1：自动更新

​

update_interval

​

Integer

​

可选

​

24

​

在线网页自动更新的频率。单位为小时，最小值为 24。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

document_info

​

Object of

DocumentInfo

​

-

​

deprecated 兼容老接口，更新内容时会返回。

​

code

​

Long

​

0

​

状态码。

​

0 代表调用成功。

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

DocumentInfo

​

​

参数

​

类型

​

示例

​

说明

​

char_count

​

Integer

​

4

​

文件内容的总字符数量。

​

chunk_strategy

​

Object of

ChunkStrategy

​

{ "chunk_type": 1, "max_tokens": 800, "remove_extra_spaces": false, "remove_urls_emails": false, "separator": "#" }

​

分段规则。

​

create_time

​

Integer

​

1719907964

​

文件的上传时间，格式为 10 位的 Unixtime 时间戳。

​

document_id

​

String

​

738694205603010****

​

文件的 ID。

​

format_type

​

Integer

​

0

​

文件的格式类型。取值包括：

​

0：文档类型，例如 txt 、pdf 、在线网页等格式均属于文档类型。

​

1：表格类型，例如 xls 表格等格式属于表格类型。

​

2：照片类型，例如 png 图片等格式属于照片类型。

​

hit_count

​

Integer

​

0

​

被对话命中的次数。

​

name

​

String

​

Coze.pdf

​

文件的名称。

​

size

​

Integer

​

14164

​

文件的大小，单位为字节。

​

slice_count

​

Integer

​

1

​

文件的分段数量。

​

source_type

​

Integer

​

0

​

文件的上传方式。取值包括：

​

0：上传本地文件。

​

1：上传在线网页。

​

status

​

Integer

​

1

​

文件的处理状态。取值包括：

​

0：处理中

​

1：处理完毕

​

9：处理失败，建议重新上传

​

type

​

String

​

pdf

​

本地文件格式，即文件后缀，例如 txt。格式支持 pdf、txt、doc、docx 类型。

​

update_interval

​

Integer

​

0

​

在线网页自动更新的频率。单位为小时。

​

update_time

​

Integer

​

1719907969

​

文件的最近一次修改时间，格式为 10 位的 Unixtime 时间戳。

​

update_type

​

Integer

​

0

​

在线网页是否自动更新。取值包括：

​

0：不自动更新

​

1：自动更新

​

tos_uri

​

String

​

FileBizType.BIZ_BOT_DATASET/847077809337655_1727579972975689529_0ytrdq****.docx

​

上传的本地文档的唯一标识。

​

​

ChunkStrategy

​

​

参数

​

类型

​

示例

​

说明

​

chunk_type

​

Integer

​

0

​

分段设置。取值包括：

​

0：自动分段与清洗。采用扣子编程预置规则进行数据分段与处理。

​

1：自定义。此时需要通过 separator、max_tokens、remove_extra_spaces 和 remove_urls_emails 分段规则细节。

​

separator

​

String

​

#

​

分段标识符。

​

在 chunk_type=1 时必选。

​

max_tokens

​

Long

​

800

​

最大分段长度，取值范围为 100~2000。

​

在 chunk_type=1 时必选。

​

remove_extra_spaces

​

Boolean

​

true

​

是否自动过滤连续的空格、换行符和制表符。取值包括：

​

true：自动过滤

​

false：（默认）不自动过滤

​

在 chunk_type=1 时生效。

​

remove_urls_emails

​

Boolean

​

true

​

是否自动过滤所有 URL 和电子邮箱地址。取值包括：

​

true：自动过滤

​

false：（默认）不自动过滤

​

在 chunk_type=1 时生效。

​

caption_type

​

Integer

​

0

​

图片知识库的标注方式：

​

0：（默认）系统自动标注描述信息

​

1：手工标注。上传图片后需要再次调用 API

更新知识库图片描述

来手动设置标注。

​

说明

在空的知识库中首次上传图片时，需要手工设置

caption_type

参数的值，否则会报错。

​

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/open_api/knowledge/document/update' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json' \

​

--header 'Agw-Js-Conv

:

str' \

​

--data-raw '

{

​

"document_id"

:

"738694205603010****"

,

​

"document_name"

:

"cozeoverview"

,

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

创建知识库文件

下一篇

查看知识库文件列表
============================================================
# 查看知识库文件列表
来源: https://www.coze.cn/open/docs/developer_guides/list_knowledge_files
============================================================

查看知识库文件列表

调用接口查看指定扣子知识库的文件列表，即文档、表格或图像列表。

​

说明

仅支持通过本 API 查看扣子知识库中的文件列表，不支持查看火山知识库中的文件列表。查看火山知识库中的文件列表请参见

查看火山知识库的文件列表

。

​

​

基础信息

​

​

请求方式

​

POST

请求地址

​

​

Plain Text

复制

https://api.coze.cn/open_api/knowledge/document/list

​

权限

​

listDocument

​

确保调用该接口使用的个人令牌开通了

listDocument

权限，详细信息参考

鉴权方式

。

接口说明

​

调用接口查看指定扣子知识库的内容列表，即文件、表格或图像列表。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

请求正文的方式。

​

Agw-Js-Conv

​

str

​

防止丢失数字类型参数的精度。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

dataset_id

​

String

​

必选

​

75034727177617***

​

待查看文件的扣子知识库 ID。

​

仅支持扣子知识库，不支持火山知识库。

​

在扣子编程中打开指定知识库页面，页面 URL 中

knowledge

参数后的数字就是知识库 ID。例如

https://www.coze.cn/space/736142423532160****/knowledge/738509371792341****

，知识库 ID 为

738509371792341****

。

​

page

​

Integer

​

可选

​

1

​

分页查询时的页码。默认为 1，即从第一页数据开始返回。

size

​

Integer

​

可选

​

20

​

分页大小。默认为 10，即每页返回 10 条数据。

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

状态码。

​

0 代表调用成功。

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

document_infos

​

Array of

DocumentInfo

​

[ ]

​

知识库文件列表。详细说明可参考

DocumentInfo object

。

total

​

Integer

​

20

​

指定知识库中的文件总数。

detail

​

Object of

ResponseDetail

​

"20241210152726467C48D89D6DB2****"

​

返回详情，包含本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此

logid

及错误码联系扣子团队获取帮助。

​

​

DocumentInfo

​

​

参数

​

类型

​

示例

​

说明

​

char_count

​

Integer

​

4

​

文件内容的总字符数量。

​

chunk_strategy

​

Object of

ChunkStrategy

​

{ "chunk_type": 1, "max_tokens": 800, "remove_extra_spaces": false, "remove_urls_emails": false, "separator": "#" }

​

分段规则。

​

create_time

​

Integer

​

1719907964

​

文件的上传时间，格式为 10 位的 Unixtime 时间戳。

​

document_id

​

String

​

738694205603010****

​

文件的 ID。

​

format_type

​

Integer

​

0

​

文件的格式类型。取值包括：

​

0：文档类型，例如 txt 、pdf 、在线网页等格式均属于文档类型。

​

1：表格类型，例如 xls 表格等格式属于表格类型。

​

2：照片类型，例如 png 图片等格式属于照片类型。

​

hit_count

​

Integer

​

0

​

被对话命中的次数。

​

name

​

String

​

Coze.pdf

​

文件的名称。

​

size

​

Integer

​

14164

​

文件的大小，单位为字节。

​

slice_count

​

Integer

​

1

​

文件的分段数量。

​

source_type

​

Integer

​

0

​

文件的上传方式。取值包括：

​

0：上传本地文件。

​

1：上传在线网页。

​

status

​

Integer

​

1

​

文件的处理状态。取值包括：

​

0：处理中

​

1：处理完毕

​

9：处理失败，建议重新上传

​

type

​

String

​

pdf

​

本地文件格式，即文件后缀，例如 txt。格式支持 pdf、txt、doc、docx 类型。

​

update_interval

​

Integer

​

0

​

在线网页自动更新的频率。单位为小时。

​

update_time

​

Integer

​

1719907969

​

文件的最近一次修改时间，格式为 10 位的 Unixtime 时间戳。

​

update_type

​

Integer

​

0

​

在线网页是否自动更新。取值包括：

​

0：不自动更新

​

1：自动更新

​

tos_uri

​

String

​

FileBizType.BIZ_BOT_DATASET/847077809337655_1727579972975689529_0ytrdq****.docx

​

上传的本地文档的唯一标识。

​

​

ChunkStrategy

​

​

参数

​

类型

​

示例

​

说明

​

chunk_type

​

Integer

​

0

​

分段设置。取值包括：

​

0：自动分段与清洗。采用扣子编程预置规则进行数据分段与处理。

​

1：自定义。此时需要通过 separator、max_tokens、remove_extra_spaces 和 remove_urls_emails 分段规则细节。

​

separator

​

String

​

#

​

分段标识符。

​

在 chunk_type=1 时必选。

​

max_tokens

​

Long

​

800

​

最大分段长度，取值范围为 100~2000。

​

在 chunk_type=1 时必选。

​

remove_extra_spaces

​

Boolean

​

true

​

是否自动过滤连续的空格、换行符和制表符。取值包括：

​

true：自动过滤

​

false：（默认）不自动过滤

​

在 chunk_type=1 时生效。

​

remove_urls_emails

​

Boolean

​

true

​

是否自动过滤所有 URL 和电子邮箱地址。取值包括：

​

true：自动过滤

​

false：（默认）不自动过滤

​

在 chunk_type=1 时生效。

​

caption_type

​

Integer

​

0

​

图片知识库的标注方式：

​

0：（默认）系统自动标注描述信息

​

1：手工标注。上传图片后需要再次调用 API

更新知识库图片描述

来手动设置标注。

​

说明

在空的知识库中首次上传图片时，需要手工设置

caption_type

参数的值，否则会报错。

​

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/open_api/knowledge/document/list' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json' \

​

--header 'Agw-Js-Conv

:

str' \

​

--data-raw '

{

​

"dataset_id"

:

"736356924530694****"

,

​

"page"

:

0

,

​

"size"

:

10

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"document_infos"

:

[

​

{

​

"char_count"

:

4

,

​

"chunk_strategy"

:

{

​

"chunk_type"

:

0

,

​

"max_tokens"

:

0

,

​

"remove_extra_spaces"

:

false

,

​

"remove_urls_emails"

:

false

,

​

"separator"

:

""

​

},

​

"create_time"

:

1719476392

,

​

"document_id"

:

"738508308097900****"

,

​

"format_type"

:

0

,

​

"hit_count"

:

0

,

​

"name"

:

"小猫的阳光午睡.pdf.pdf"

,

​

"size"

:

30142

,

​

"slice_count"

:

1

,

​

"source_type"

:

0

,

​

"status"

:

1

,

​

"type"

:

"pdf"

,

​

"update_interval"

:

0

,

​

"update_time"

:

1719476430

,

​

"update_type"

:

0

​

}

​

],

​

"msg"

:

""

,

​

"total"

:

1

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

修改知识库文件

下一篇

查看知识库文件上传进度
============================================================
# 查看知识库文件上传进度
来源: https://www.coze.cn/open/docs/developer_guides/get_dataset_progress
============================================================

查看知识库文件上传进度

调用此接口获取扣子知识库文件的上传进度。

​

此接口支持查看所有类型知识库文件的上传进度，例如文本、图片、表格。

​

支持批量查看多个文件的进度，多个文件必须位于同一个知识库中。

​

该 API 仅支持查看扣子知识库中的文件上传进度，不支持查看火山知识库中的文件上传进度。

​

基础信息

​

​

请求方式

​

POST

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/datasets/:dataset_id/process

​

权限

​

readDocumentProgress

​

确保调用该接口使用的访问令牌开通了

readDocumentProgress

权限，详细信息参考

鉴权方式

。

接口说明

​

调用此接口获取知识库文件的上传进度。

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

请求正文的方式。

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

dataset_id

​

String

​

必选

​

744258581358768****

​

扣子知识库 ID。不能填写火山知识库 ID。

​

在扣子编程中打开指定扣子知识库页面，页面 URL 中

knowledge

参数后的数字就是扣子知识库 ID。例如

https://www.coze.cn/space/736142423532160****/knowledge/738509371792341****

，扣子知识库 ID 为

738509371792341****

。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

document_ids

​

Array of String

​

必选

​

["744258581358768****", "744258581358768****"]

需要获取上传进度的文件 ID 列表。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Object of

GetDocumentProgressOpenApiData

​

参考返回示例

接口返回的业务信息。

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

GetDocumentProgressOpenApiData

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Array of

DocumentProgress

​

参考返回示例

​

文件的上传进度详情。

​

​

DocumentProgress

​

​

参数

​

类型

​

示例

​

说明

​

url

​

String

​

https://example.com/ocean-cloud-tos/FileBizType.BIZ_BOT_DATASET/217526895615***.jpg?lk3s=5ec9c6e9&x-expires=1733819246&x-signature=G9VVp2ObiCwUourS7rv44YLdh****

​

文件地址。

​

size

​

Long

​

171340

​

文件的大小，单位为字节。

​

type

​

String

​

jpg

​

本地文件格式，即文件后缀，例如 txt。格式支持 pdf、txt、doc、docx 类型。

​

status

​

Integer

​

1

​

文件的处理状态。取值包括：

​

0：处理中

​

1：处理完毕

​

9：处理失败，建议重新上传

​

progress

​

Integer

​

100

​

文件上传的进度。单位为百分比。

​

document_id

​

String

​

744667080521909***

​

文件的 ID。

​

update_type

​

Integer

​

0

​

在线网页是否自动更新。取值包括：

​

0：不自动更新

​

1：自动更新

​

document_name

​

String

​

test

​

文件名称。

​

remaining_time

​

Long

​

0

​

预期剩余时间，单位为秒。

​

status_descript

​

String

​

​

失败状态的详细描述，例如切片失败时返回失败信息。

​

仅文档处理失败时会返回此参数。

​

update_interval

​

Integer

​

0

​

在线网页自动更新的频率。单位为小时。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/datasets/:dataset_id/process' \

​

--header 'Authorization

:

Bearer pat_O******' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"document_ids"

:

[

​

"7442585813587***"

,

​

"7442585813668***"

​

]

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"data"

:

{

​

"data"

:

[

​

{

​

"progress"

:

100

,

​

"update_interval"

:

0

,

​

"status"

:

1

,

​

"type"

:

"jpg"

,

​

"update_type"

:

0

,

​

"document_id"

:

"744667080521909***"

,

​

"remaining_time"

:

0

,

​

"size"

:

171340

,

​

"document_name"

:

"test1"

,

​

"url"

:

"https://lf3-appstore-sign.oceancloudapi.com/ocean-cloud-tos/FileBizType.BIZ_BOT_DATASET/217526895615***.jpg?lk3s=5ec9c6e9&x-expires=1733819246&x-signature=G9VVp2ObiCwUourS7rv44YLdh****"

​

}

​

]

​

},

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6***"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

查看知识库文件列表

下一篇

更新知识库图片描述
============================================================
# 更新知识库图片描述
来源: https://www.coze.cn/open/docs/developer_guides/update_image_caption
============================================================

更新知识库图片描述

调用此接口更新扣子知识库中图片的描述信息。

​

接口限制

​

此 API 仅支持更新扣子知识库中的图片描述信息，不适用于火山知识库。

​

基础信息

​

​

请求方式

​

PUT

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/datasets/:dataset_id/images/:document_id

​

权限

​

updatePhoto

​

确保调用该接口使用的访问令牌开通了

updatePhoto

权限，详细信息参考

鉴权方式

。

​

接口说明

​

调用此接口更新扣子知识库中图片的描述信息。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

请求正文的方式。

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

document_id

​

String

​

必选

​

744667080521909****

​

待更新描述的图片 ID。

​

dataset_id

​

String

​

必选

​

"744632974166804****"

​

知识库 ID。

​

在扣子编程中打开指定知识库页面，页面 URL 中

knowledge

参数后的数字就是知识库 ID。例如

https://bots.bytedance.net/space/736142423532160****/knowledge/738509371792341****

，知识库 ID 为

738509371792341****

。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

caption

​

String

​

必选

​

小猫

图片的描述信息。

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

状态码。

​

0 代表调用成功。

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request PUT 'https

:

//api.coze.cn/v1/datasets/744632265564659****/images/744667080521911****' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"caption"

:

"小猫"

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"202412101551329A18A4BFB***"

​

},

​

"code"

:

0

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

查看知识库文件上传进度

下一篇

查看知识库图片列表
============================================================
# 查看知识库图片列表
来源: https://www.coze.cn/open/docs/developer_guides/get_images
============================================================

查看知识库图片列表

调用此接口查看图片类知识库中图片的详细信息。

​

查看图片时，支持通过图片的标注进行筛选。

​

接口限制

​

此 API 仅支持查看扣子知识库中的图片详细信息，不适用于火山知识库。

​

基础信息

​

​

请求方式

​

GET

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/datasets/:dataset_id/images

​

​

权限

​

listPhoto

​

确保调用该接口使用的访问令牌开通了

listPhoto

权限，详细信息参考

鉴权方式

。

​

接口说明

​

调用此接口查看图片类知识库中图片的详细信息。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

dataset_id

​

String

​

必选

​

744632974166804****

​

知识库 ID。

​

在扣子编程中打开指定知识库页面，页面 URL 中

knowledge

参数后的数字就是知识库 ID。例如

https://www.coze.cn/space/736142423532160****/knowledge/738509371792341****

，知识库 ID 为

738509371792341****

。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

page_num

​

Integer

​

可选

​

1

​

查询结果分页展示时，此参数用于设置查看的页码。最小值为 1，默认为 1。

​

page_size

​

Integer

​

可选

​

5

​

查询结果分页展示时，此参数用于设置每页返回的数据量。取值范围为 1~299，默认为 10。

​

keyword

​

String

​

可选

​

小猫

​

对图片描述进行搜索时，搜索的关键字。

​

has_caption

​

Boolean

​

可选

​

true

​

图片是否已设置了描述信息。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

data

​

Object of

ListPhotoOpenApiData

​

参考返回示例

​

返回内容

​

code

​

Long

​

0

​

状态码。

​

0 代表调用成功。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此

logid

及错误码联系扣子团队获取帮助。

​

​

ListPhotoOpenApiData

​

​

参数

​

类型

​

示例

​

说明

​

photo_infos

​

Array of

PhotoInfo

​

参考返回示例

​

图片的详细信息。

​

total_count

​

Integer

​

1

​

符合查询条件的图片总数量。

​

​

PhotoInfo

​

​

参数

​

类型

​

示例

​

说明

​

url

​

String

​

https://lf26-appstore-sign.oceancloudapi.com/ocean-cloud-tos/FileBizType.BIZ_BOT_DATASET/217526895615****.jpg?lk3s=5ec9c6e9&x-expires=1733821017&x-signature=KJbBgbcwSZYYh5Uf5gISU5HAPB****

​

图片链接。

​

name

​

String

​

test2

​

图片名。

​

size

​

Integer

​

171340

​

图片大小，单位为字节。

​

type

​

String

​

jpg

​

文件格式，即文件后缀，例如 jpg、png。

​

status

​

Integer

​

1

​

文件的状态。取值包括：

​

0：处理中

​

1：处理完毕

​

9：处理失败，建议重新上传

​

caption

​

String

​

小猫

​

图片描述信息。

​

creator_id

​

String

​

217526895615****

​

创建人的扣子 UID。

​

create_time

​

Integer

​

1733815232

​

图片的上传时间，格式为 10 位的 Unixtime 时间戳。

​

document_id

​

String

​

744667080521911****

​

图片的 ID。

​

source_type

​

Integer

​

5

​

上传方式。取值包括：

​

0：上传本地文件。

​

1：上传在线网页。

​

5：上传 file_id。

​

update_time

​

Integer

​

1733817093

​

更新时间，格式为 10 位的 Unixtime 时间戳。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v1/datasets/744632974166804****/images?page_num=1&page_size=5&keyword=小猫&has_caption=true' \

​

--header 'Authorization

:

Bearer pat_hfwkehfncaf****' \

​

--header 'Content-Type

:

application/json'

​

​

返回示例

​

​

JSON

复制

{

​

"detail"

:

{

​

"logid"

:

"2024121015565741D31B341C9C0***"

​

},

​

"data"

:

{

​

"total_count"

:

1

,

​

"photo_infos"

:

[

​

{

​

"name"

:

"test2"

,

​

"status"

:

1

,

​

"creator_id"

:

"217526895615****"

,

​

"create_time"

:

1733815232

,

​

"update_time"

:

1733817093

,

​

"size"

:

171340

,

​

"url"

:

"https://lf26-appstore-sign.oceancloudapi.com/ocean-cloud-tos/FileBizType.BIZ_BOT_DATASET/217526895615****.jpg?lk3s=5ec9c6e9&x-expires=1733821017&x-signature=KJbBgbcwSZYYh5Uf5gISU5HAPB****"

,

​

"caption"

:

"小猫"

,

​

"type"

:

"jpg"

,

​

"source_type"

:

5

,

​

"document_id"

:

"744667080521911****"

​

}

​

]

​

},

​

"code"

:

0

,

​

"msg"

:

""

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

更新知识库图片描述

下一篇

删除知识库文件
============================================================
# 删除知识库文件
来源: https://www.coze.cn/open/docs/developer_guides/delete_knowdge_files
============================================================

删除知识库文件

调用此接口删除扣子知识库中的文本、图片、表格等文件，支持批量删除。

​

说明

仅知识库的所有者可以删除知识库文件。

​

知识库分为扣子知识库和火山知识库，该 API 仅用于删除扣子知识库中的文件，不支持删除火山知识库中的文件，如果需要删除火山知识库中的文件，请参见

删除火山知识库文件

。

​

​

基础信息

​

​

请求方式

​

POST

请求地址

​

​

Plain Text

复制

https://api.coze.cn/open_api/knowledge/document/delete

​

权限

​

deleteDocument

​

确保调用该接口使用的访问令牌开通了

deleteDocument

权限，详细信息参考

鉴权方式

。

​

接口说明

​

调用此接口删除知识库中的文本、图片、表格等文件，支持批量删除。

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

请求正文的方式。

​

Agw-Js-Conv

​

str

​

防止丢失数字类型参数的精度。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

document_ids

​

Array of String

​

必选

​

["123"]

​

待删除的知识库文件列表。数组最大长度为 100，即一次性最多可删除 100 个文件。

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

状态码。

​

0 代表调用成功。

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

包含请求的详细信息，主要用于调试和问题排查。如果遇到异常报错场景，且反复重试仍然报错，可以根据此字段中的

logid

联系扣子团队获取帮助。

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/open_api/knowledge/document/delete' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json' \

​

--header 'Agw-Js-Conv

:

str' \

​

--data-raw '

{

​

"document_ids"

:

[

​

"123"

​

]

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

查看知识库图片列表

下一篇

查询付费插件列表
============================================================
# 查询付费插件列表
来源: https://www.coze.cn/open/docs/developer_guides/list_plugin
============================================================

查询付费插件列表

查询插件商店中的付费插件列表。

​

接口描述

​

查询插件商店中的付费插件列表，包括扣子编程官方插件和三方插件，或通过关键词模糊搜索相关插件。

​

基础信息

​

​

请求方式

​

GET

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/stores/plugins

​

​

权限

​

无

​

接口说明

​

查询插件商店中的付费插件列表。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

keyword

​

String

​

可选

​

语音识别

​

插件搜索的关键词，支持模糊匹配。

​

is_official

​

Boolean

​

可选

​

true

​

是否为扣子编程官方插件。默认返回官方插件和三方插件。

​

true

：官方插件。

​

false

：三方插件。

​

category_ids

​

Array of String

​

可选

​

747593003997698***,73271372757147***

​

插件分类 ID 列表，用于筛选指定多个分类下的插件。默认为空，即返回所有分类下的插件。可以通过

查询插件分类

API 获取对应的插件分类 ID。

​

page_num

​

Integer

​

可选

​

1

​

分页查询时的页码。默认为 1，即返回第一页数据。

​

page_size

​

Integer

​

可选

​

20

​

每页返回的数据条数，用于分页查询。默认值为 20，最大值为 100。

​

sort_type

​

String

​

可选

​

heat

​

排序类型，用于指定返回插件的排序方式。支持的排序方式如下所示：

​

heat

：最受欢迎。

​

newest

：最近发布。

​

relative

：相关性，仅用于搜索场景。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

ListPluginData

​

\

​

返回的插件列表及其相关信息的对象。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

ListPluginData

​

​

参数

​

类型

​

示例

​

说明

​

items

​

Array of

ProductPluginInfo

​

\

​

插件列表，包含多个插件项的数组。每个插件项包含插件的元信息和运行统计信息。

​

has_more

​

Boolean

​

true

​

是否已返回全部消息。

​

true：未返回全部信息，可再次调用此接口查看其他分页。

​

false：已返回全部信息。

​

​

ProductPluginInfo

​

​

参数

​

类型

​

示例

​

说明

​

metainfo

​

Object of

ProductMetainfo

​

\

​

插件的详细信息。

​

plugin_info

​

Object of

PluginInfo

​

{"heat":1500,"call_count":1000,"description":"该插件提供高质量的语音识别功能。","success_rate":0.95,"bots_use_count":7,"favorite_count":50,"total_tools_count":1,"avg_exec_duration_ms":120,"associated_bots_use_count":2}

​

插件的运行数据和统计信息，包括热度、调用次数、成功率、收藏数等指标，以及被智能体使用的情况。

​

​

ProductMetainfo

​

​

参数

​

类型

​

示例

​

说明

​

name

​

String

​

语音识别插件

​

插件的名称。

​

category

​

Object of

ProductCategory

​

{"id":"732713727571473***","name":"社交"}

​

插件所属的分类信息，包含分类 ID 和分类名称。

​

icon_url

​

String

​

https://example.com/plugins/voice-recognition/icon.png

​

插件的图标 URL。

​

entity_id

​

String

​

75464997639954***

​

插件 ID。

​

listed_at

​

Long

​

1757474787

​

插件上架时间，以 Unix 时间戳格式表示，单位为秒。

​

paid_type

​

String

​

paid

​

插件的付费类型，固定为

paid

，即付费插件。

​

user_info

​

Object of

ProductUserInfo

​

{"user_id":32351795934732,"nick_name":"开发者小张","user_name":"developer_zhang","avatar_url":"

https://example.com/img/user-avatar/e67e7ddd636a2087e79d624a64a***~300x300.image

"}

​

插件开发者的相关信息，包含开发者的用户 ID、昵称、用户名和头像 URL。

​

product_id

​

String

​

75462004326583***

​

商品的 ID，用于在插件商店中唯一标识该插件商品。

​

description

​

String

​

该插件提供高质量的语音识别功能。

​

插件的描述信息，用于说明插件的功能、用途和特点。

​

entity_type

​

String

​

plugin

​

实体类型，当前仅支持

plugin

，表示插件。

​

is_official

​

Boolean

​

true

​

标识插件是否为官方发布。

​

true

表示该插件由扣子编程官方发布。

​

false

表示由第三方开发者发布。

​

entity_version

​

String

​

0

​

插件的版本号，用于标识插件的当前版本。

​

​

ProductCategory

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

732713727571473***

​

插件分类 ID。

​

name

​

String

​

社交

​

插件分类名称。

​

​

ProductUserInfo

​

​

参数

​

类型

​

示例

​

说明

​

user_id

​

Long

​

32351795934732***

​

插件开发者的扣子用户 ID。

​

nick_name

​

String

​

开发者小张

​

插件开发者在扣子编程上的昵称。

​

user_name

​

String

​

developer_zhang

​

插件开发者在扣子编程上的用户名。

​

avatar_url

​

String

​

https://example.com/img/user-avatar/e67e7ddd636a2087e79d624a64a***~300x300.image

​

插件开发者在扣子编程上的头像 URL，用于展示开发者的头像信息。

​

​

PluginInfo

​

​

参数

​

类型

​

示例

​

说明

​

heat

​

Integer

​

1500

​

插件的热度值，用于表示该插件的受欢迎程度或使用频率。数值越大表示热度越高。

​

call_count

​

Long

​

1000

​

插件的调用量，表示该插件的累计调用次数。

​

description

​

String

​

该插件提供高质量的语音识别功能。

​

插件的详细描述信息，用于说明插件的功能、用途和特点。

​

success_rate

​

Double

​

0.95

​

插件的调用成功率，以小数形式表示，数值范围为 0 到 1。

​

bots_use_count

​

Long

​

7

​

该插件在智能体或工作流中的累计关联次数。

​

favorite_count

​

Integer

​

50

​

插件的收藏量，表示该插件被用户收藏的总次数。

​

is_call_available

​

Boolean

​

true

​

标识该插件当前是否可被调用。

​

true

：插件可正常调用。

​

false

：插件暂时不可用，例如已下架。

​

total_tools_count

​

Integer

​

1

​

插件包含的工具总数。

​

avg_exec_duration_ms

​

Double

​

120

​

插件执行的平均耗时，单位为毫秒。

​

associated_bots_use_count

​

Long

​

2

​

当前扣子商店中关联了该插件的智能体数量。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v1/stores/plugins' \

​

--header 'Authorization

:

Bearer pat_3UXDHN82MgQANqK59BIAeH****' \

​

--header 'Content-Type

:

application/json' \

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

" "

,

​

"data"

:

{

​

"items"

:

[

​

{

​

"metainfo"

:

{

​

"name"

:

"语音识别插件"

,

​

"category"

:

{

​

"id"

:

"7327137275714732069"

,

​

"name"

:

"社交"

​

},

​

"icon_url"

:

"https://example.com/plugins/voice-recognition/icon.png"

,

​

"entity_id"

:

"75464997639954***"

,

​

"listed_at"

:

1757474787

,

​

"paid_type"

:

"paid"

,

​

"user_info"

:

{

​

"user_id"

:

32351795934732

,

​

"nick_name"

:

"开发者小张"

,

​

"user_name"

:

"developer_zhang"

,

​

"avatar_url"

:

"https://example.com/img/user-avatar/e67e7ddd636a2087e79d624a64a***~300x300.image"

​

},

​

"product_id"

:

"75462004326583***"

,

​

"description"

:

"该插件提供高质量的语音识别功能。"

,

​

"entity_type"

:

"plugin"

,

​

"is_official"

:

true

,

​

"entity_version"

:

"0"

​

},

​

"plugin_info"

:

{

​

"heat"

:

1500

,

​

"call_count"

:

1000

,

​

"description"

:

"该插件提供高质量的语音识别功能。"

,

​

"success_rate"

:

0.95

,

​

"bots_use_count"

:

7

,

​

"favorite_count"

:

50

,

​

"total_tools_count"

:

1

,

​

"is_call_available"

:

true

,

​

"avg_exec_duration_ms"

:

120

,

​

"associated_bots_use_count"

:

2

​

}

​

}

​

],

​

"has_more"

:

false

​

},

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

上一篇

删除知识库文件

下一篇

查询插件分类
============================================================
# 查询插件分类
来源: https://www.coze.cn/open/docs/developer_guides/list_plugin_category
============================================================

查询插件分类

查询插件分类信息。

​

你可以通过本 API 获取插件的分类 ID，后续调用

查询插件列表

API 查询指定分类下的插件。

​

基础信息

​

​

请求方式

​

GET

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/stores/categories

​

​

权限

​

无

​

接口说明

​

查询插件分类信息。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

entity_type

​

String

​

必选

​

plugin

​

实体类型，当前仅支持

plugin

，表示插件。

​

page_num

​

Integer

​

可选

​

1

​

分页查询时的页码。默认为 1，即返回第一页数据。

​

page_size

​

Integer

​

可选

​

20

​

每页返回的数据条数，用于分页查询。默认值为 20，最大值为 100。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

ListCategoryData

​

{"items":[{"id":"732713727571473***","name":"社交"}],"has_more":false}

​

返回插件分类列表及相关分页信息。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含本次请求的详细日志信息，用于问题排查和技术支持。

​

​

ListCategoryData

​

​

参数

​

类型

​

示例

​

说明

​

items

​

Array of

ProductCategory

​

{ "id": "7475930039976984614", "name": "智能硬件" }

​

插件分类列表。

​

has_more

​

Boolean

​

false

​

是否已返回全部消息。

​

true：未返回全部数据，可再次调用此接口查看其他分页。

​

false：已返回全部数据。

​

​

ProductCategory

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

732713727571473***

​

插件分类 ID。

​

name

​

String

​

社交

​

插件分类名称。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v1/stores/categories?entity_type=plugin' \

​

--header 'Authorization

:

Bearer pat_O******' \

​

--header 'Content-Type

:

application/json' \

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"2025092517382882216851350ED***"

​

},

​

"data"

:

{

​

"has_more"

:

false

,

​

"items"

:

[

​

{

​

"id"

:

"7475930039976984614"

,

​

"name"

:

"智能硬件"

​

},

​

{

​

"id"

:

"7327137275714732069"

,

​

"name"

:

"新闻阅读"

​

},

​

{

​

"id"

:

"7327137275714781221"

,

​

"name"

:

"便利生活"

​

},

​

{

​

"id"

:

"7327137275714748453"

,

​

"name"

:

"图像"

​

},

​

{

​

"id"

:

"7327137275714764837"

,

​

"name"

:

"实用工具"

​

},

​

{

​

"id"

:

"7327137275714797605"

,

​

"name"

:

"网页搜索"

​

},

​

{

​

"id"

:

"7327137275714813989"

,

​

"name"

:

"科学与教育"

​

},

​

{

​

"id"

:

"7327137275714830373"

,

​

"name"

:

"社交"

​

}

​

]

​

}

​

}

​

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

查询付费插件列表

下一篇

查询插件详情
============================================================
# 查询插件详情
来源: https://www.coze.cn/open/docs/developer_guides/get_plugin
============================================================

查询插件详情

查询指定插件的详细信息。

​

接口描述

​

你可以调用本 API 查询指定插件的详细信息，支持查询官方插件、三方插件和资源库插件。返回信息包括插件工具列表（工具名称、描述、输入参数和返回参数），付费插件还支持返回 MCP Server 的配置信息，以便在 Trae 等外部平台配置 MCP 服务，并调用插件工具。

​

接口限制

​

不支持通过渠道 Token 调用该 API。

​

基础信息

​

​

请求方式

​

GET

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/plugins/:plugin_id

​

​

权限

​

Plugin.getPlugin

​

确保调用该接口使用的访问令牌开通了

Plugin.getPlugin

权限，详细信息参考

鉴权方式

。

​

接口说明

​

查询插件详细信息。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

plugin_id

​

String

​

必选

​

75458732632938***

​

待查询插件详情的插件 ID。支持查询官方插件、三方插件和资源库插件。

​

获取插件 ID 的方法如下：

​

调用

查询插件列表

API 获取对应的插件 ID，即

entity_id

的值。

​

资源库自定义插件：在插件编辑页面的 URL 中获取插件 ID。例如在 URL

https://www.coze.cn/space/74982048832804***/plugin/75331489586134***

中，

plugin

后面的数字即为插件 ID。

​

说明

不支持通过插件商店 URL 中的插件商品 ID 查询插件详情。

​

​

​

返回参数

​

​

​

参数

​

类型

​

示例

​

说明

​

data.tools

​

Array of

Tools

​

\

​

插件工具的详细信息，包括名称、描述、输入参数和返回参数。

​

data.mcp_json

​

String

​

{ "mcpServers": { "coze_plugin_***": { "url": "

https://mcp.coze.cn/v1/plugins/75458732632941***

", "headers": { "Authorization": "Bearer ${COZE_API_TOKEN}" } } } }

​

MCP Server 的配置信息，包含 MCP 服务器信息、插件 URL 和访问令牌。

​

说明

Authorization

中的访问令牌默认生成的是临时访问凭证，有效期为 1 天。

​

如需使用长期凭证，在 Trae 等支持 MCP Server 的平台配置 MCP 信息时，需要手动替换为你在扣子编程中生成的访问令牌。支持个人访问令牌（PAT）、服务访问令牌（SAT）和 OAuth 鉴权，具体参考

获取访问令牌

。

​

​

data.name_for_model

​

String

​

yuyinhecheng

​

插件在模型内部使用的唯一标识符，用于AI模型在调用插件时快速识别和定位目标插件。

​

data.icon_url

​

String

​

https://example.com/ocean-cloud-tos/plugin_icon/

example

.jpeg?lk3s=cd508e2b&x-expires=1763780763&x-signature=W0osLsZ

***

​

插件图标的 URL 链接。

​

data.is_call_available

​

Boolean

​

true

​

标识该插件当前是否可被调用。

​

true

：插件可正常调用。

​

false

：暂时无法调用，三方付费插件未签署协议。

​

data.created_at

​

Number

​

1759044695

​

插件创建时间，以 Unix 时间戳格式表示，单位为秒。

​

data.updated_at

​

Number

​

1761188383

​

插件最后更新时间，以 Unix 时间戳格式表示，单位为秒。

​

​

​

Tools

​

​

参数

​

类型

​

示例

​

说明

​

name

​

String

​

asr_lite

​

插件工具的名称。

​

description

​

String

​

准确地将语音内容转写成文字。

​

插件工具的描述。

​

inputSchema

​

Object

​

{ "required": [ "audio_url" ], "properties": { "audio_url": { "description": "音频文件地址，插件会尝试识别文件格式，对于无后缀的 URL 可能识别不到。文件类型支持 raw / wav / mp3 / ogg", "type": "string" } }, "type": "object" }

​

由插件开发者定义的插件工具的输入参数的数据结构，包含参数名称、参数说明、必填项、格式约束等。

​

outputSchema

​

Object

​

{ "properties": { "code": { "description": "运行状态。0 为成功，否则为报错码", "type": "number" }, "data": { "properties": { "text": { "description": "识别出的文本", "type": "string" } }, "type": "object" }, "log_id": { "type": "string" }, "msg": { "type": "string" } }, "type": "object" }

​

由插件开发者定义的插件工具的输出参数的数据结构，用于描述当前插件工具调用成功后，返回数据的结构，如字段名称、类型、嵌套关系等。

​

​

​

参数

​

类型

​

示例

​

说明

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v1/plugins/75458732632938906***' \

​

--header 'Authorization

:

Bearer pat_O******' \

​

--header 'Content-Type

:

application/json' \

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"data"

:

{

​

"tools"

:

[

​

{

​

"description"

:

"准确地将语音内容转写成文字。适用于录音质检、会议总结、音频内容分析、课堂内容分析等场景。按照时长计费，对应计费项“录音文件识别（极速版）”。计费项&免费额度说明：https://docs.coze.cn/coze_pro/asr_tts_fee"

,

​

"inputSchema"

:

{

​

"required"

:

[

​

"audio_url"

,

​

"language"

​

],

​

"properties"

:

{

​

"audio_url"

:

{

​

"description"

:

"音频文件地址，插件会尝试识别文件格式，对于无后缀的 URL 可能识别不到。文件类型支持 raw / wav / mp3 / ogg "

,

​

"type"

:

"string"

​

},

​

"language"

:

{

​

"description"

:

"音频语言，当前支持：普通话，粤语，四川话，上海话，英文，日语，法语，韩语，西班牙语，葡萄牙语，印尼语"

,

​

"type"

:

"string"

​

}

​

},

​

"type"

:

"object"

​

},

​

"name"

:

"asr_lite"

,

​

"outputSchema"

:

{

​

"properties"

:

{

​

"code"

:

{

​

"type"

:

"number"

​

},

​

"data"

:

{

​

"properties"

:

{

​

"text"

:

{

​

"description"

:

"识别出的文本"

,

​

"type"

:

"string"

​

}

​

},

​

"type"

:

"object"

​

},

​

"log_id"

:

{

​

"type"

:

"string"

​

},

​

"msg"

:

{

​

"type"

:

"string"

​

}

​

},

​

"type"

:

"object"

​

},

​

"tool_id"

:

"7506818401994***"

​

}

​

],

​

"mcp_json"

:

"{\"mcpServers\":{\"coze_plugin_yuyinshibie\":{\"url\":\"https://mcp.coze.cn/v1/plugins/7506818401994735616\",\"headers\":{\"Authorization\":\"Bearer ${COZE_API_TOKEN}\"}}}}"

,

​

"plugin_id"

:

"7506818401994***"

,

​

"name"

:

"语音识别"

,

​

"name_for_model"

:

"yuyinshibie"

,

​

"description"

:

"准确地将语音内容转写成文字。适用于录音质检、会议总结、音频内容分析、课堂内容分析等场景。按照时长计费，对应计费项“录音文件识别（极速版）”。计费项&免费额度说明：https://docs.coze.cn/coze_pro/asr_tts_fee"

,

​

"icon_url"

:

"https://example.com/ocean-cloud-tos/plugin_icon/example.jpeg?lk3s=cd508e2b&x-expires=1763792613&x-signature=Pn1***"

,

​

"is_call_available"

:

true

,

​

"created_at"

:

1759045245

,

​

"updated_at"

:

1761197207

​

},

​

"detail"

:

{

​

"logid"

:

"20251023142333EF26D5DA***"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

查询插件分类

下一篇

批量查询插件信息
============================================================
# 批量查询插件信息
来源: https://www.coze.cn/open/docs/developer_guides/batch_get_plugins_info
============================================================

批量查询插件信息

批量查询插件的详细信息。

​

接口描述

​

你可以调用本 API 批量查询插件的详细信息，支持查询官方插件、三方插件和资源库插件。返回信息包括插件工具列表（工具名称、描述、输入参数和返回参数），付费插件还支持返回 MCP Server 的配置信息，以便在 Trae 等外部平台配置 MCP 服务，并调用插件工具。

​

接口限制

​

单次请求最多支持查询 20 个插件。

​

不支持通过渠道 Token 调用该 API。

​

基础信息

​

​

请求方式

​

GET

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/plugins/mget

​

​

权限

​

Plugin.getPlugin

​

确保调用该接口使用的访问令牌开通了

Plugin.getPlugin

权限，详细信息参考

鉴权方式

。

​

接口说明

​

批量查询插件信息。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

ids

​

Array of String

​

必选

​

7506817938062819***,742665585406735***

​

待查询插件详情的插件 ID 列表，多个 ID 需以英文逗号分隔。支持查询官方插件、三方插件和资源库插件。

​

获取插件 ID 的方法如下：

​

调用

查询插件列表

API 获取对应的插件 ID，即

entity_id

的值。

​

资源库自定义插件：在插件编辑页面的 URL 中获取插件 ID。例如在 URL

https://www.coze.cn/space/74982048832804***/plugin/75331489586134***

中，

plugin

后面的数字即为插件 ID。

​

说明

单次请求最多支持输入 20 个插件ID。

​

不支持通过插件商店 URL 中的插件商品 ID 查询插件详情。

​

​

​

返回参数

​

​

​

参数

​

类型

​

示例

​

说明

​

data.tools

​

Array of

Tools

​

\

​

插件工具的详细信息，包括名称、描述、输入参数和返回参数。

​

data.mcp_json

​

String

​

{ "mcpServers": { "coze_plugin_***": { "url": "

https://mcp.coze.cn/v1/plugins/75458732632941***

", "headers": { "Authorization": "Bearer ${COZE_API_TOKEN}" } } } }

​

MCP Server 的配置信息，包含 MCP 服务器信息、插件 URL 和访问令牌。

​

说明

Authorization

中的访问令牌默认生成的是临时访问凭证，有效期为 1 天。

​

如需使用长期凭证，在 Trae 等支持 MCP Server 的平台配置 MCP 信息时，需要手动替换为你在扣子编程中生成的访问令牌。支持个人访问令牌（PAT）、服务访问令牌（SAT）和 OAuth 鉴权，具体参考

获取访问令牌

。

​

​

data.name_for_model

​

String

​

yuyinhecheng

​

插件在模型内部使用的唯一标识符，用于AI模型在调用插件时快速识别和定位目标插件。

​

data.icon_url

​

String

​

https://example.com/ocean-cloud-tos/plugin_icon/example.jpeg?lk3s=cd508e2b&x-expires=1763780763&x-signature=W0osLsZ

***

​

插件图标的 URL 链接。

​

data.is_call_available

​

Boolean

​

true

​

标识该插件当前是否可被调用。

​

true

：插件可正常调用。

​

false

：暂时无法调用，三方付费插件未签署协议。

​

data.created_at

​

Number

​

1759044695

​

插件创建时间，以 Unix 时间戳格式表示，单位为秒。

​

data.updated_at

​

Number

​

1761188383

​

插件最后更新时间，以 Unix 时间戳格式表示，单位为秒。

​

​

Tools

​

​

参数

​

类型

​

示例

​

说明

​

name

​

String

​

asr_lite

​

插件工具的名称。

​

description

​

String

​

准确地将语音内容转写成文字。

​

插件工具的描述。

​

inputSchema

​

Object

​

{ "required": [ "audio_url" ], "properties": { "audio_url": { "description": "音频文件地址，插件会尝试识别文件格式，对于无后缀的 URL 可能识别不到。文件类型支持 raw / wav / mp3 / ogg", "type": "string" } }, "type": "object" }

​

由插件开发者定义的插件工具的输入参数的数据结构，包含参数名称、参数说明、必填项、格式约束等。

​

outputSchema

​

Object

​

{ "properties": { "code": { "description": "运行状态。0 为成功，否则为报错码", "type": "number" }, "data": { "properties": { "text": { "description": "识别出的文本", "type": "string" } }, "type": "object" }, "log_id": { "type": "string" }, "msg": { "type": "string" } }, "type": "object" }

​

由插件开发者定义的插件工具的输出参数的数据结构，用于描述当前插件工具调用成功后，返回数据的结构，如字段名称、类型、嵌套关系等。

​

​

​

​

参数

​

类型

​

示例

​

说明

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v1/plugins/mget?ids=7506817938062819***,742665585406735***' \

​

--header 'Authorization

:

Bearer pat_O******' \

​

--header 'Content-Type

:

application/json' \

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"data"

:

{

​

"items"

:

[

​

{

​

"tools"

:

[

​

{

​

"description"

:

"相比传统模型有更高的准确率；对多语种多方言/口音/噪声和背景人声更准确；能根据上下文、用户输入、背景信息输入有更多理解。按照时长计费，对应计费项“大模型录音文件识别时长”。计费项&免费额度说明：https://docs.coze.cn/coze_pro/asr_tts_fee"

,

​

"inputSchema"

:

{

​

"required"

:

[

​

"audio_url"

​

],

​

"properties"

:

{

​

"audio_url"

:

{

​

"description"

:

"音频文件地址，插件会尝试识别文件格式，对于无后缀的 URL 可能识别不到。文件类型支持 raw / wav / mp3 / ogg"

,

​

"type"

:

"string"

​

}

​

},

​

"type"

:

"object"

​

},

​

"name"

:

"asr_llm"

,

​

"outputSchema"

:

{

​

"properties"

:

{

​

"code"

:

{

​

"description"

:

"运行状态。0 为成功，否则为报错码"

,

​

"type"

:

"number"

​

},

​

"data"

:

{

​

"properties"

:

{

​

"text"

:

{

​

"description"

:

"识别出的文本"

,

​

"type"

:

"string"

​

}

​

},

​

"type"

:

"object"

​

},

​

"log_id"

:

{

​

"type"

:

"string"

​

},

​

"msg"

:

{

​

"type"

:

"string"

​

}

​

},

​

"type"

:

"object"

​

},

​

"tool_id"

:

"75068179380628***"

​

}

​

],

​

"mcp_json"

:

"{\"mcpServers\":{\"coze_plugin_damoxingyuyinshibie\":{\"url\":\"https://mcp.coze.cn/v1/plugins/7506817938062819355\",\"headers\":{\"Authorization\":\"Bearer ${COZE_API_TOKEN}\"}}}}"

,

​

"plugin_id"

:

"75068179380628***"

,

​

"name"

:

"大模型语音识别"

,

​

"name_for_model"

:

"damoxingyuyinshibie"

,

​

"description"

:

"相比传统模型有更高的准确率；对多语种多方言/口音/噪声和背景人声更准确；能根据上下文、用户输入、背景信息输入有更多理解。按照时长计费，对应计费项“大模型录音文件识别时长”。计费项&免费额度说明：https://docs.coze.cn/coze_pro/asr_tts_fee"

,

​

"icon_url"

:

"https://example.com/ocean-cloud-tos/plugin_icon/example.jpeg?lk3s=cd508e2b&x-expires=1763780763&x-signature=W0osLsZ***"

,

​

"is_call_available"

:

true

,

​

"created_at"

:

1754644595

,

​

"updated_at"

:

1761197219

​

},

​

{

​

"tools"

:

[

​

{

​

"description"

:

"根据音色和文本合成音频。按照字符数计费，计费项&免费额度说明：https://docs.coze.cn/coze_pro/asr_tts_fee。使用资源库音色时，计费项为复刻音色文字转语音字数；使用预设音色时，模型为大模型对应系统音色文字转语音字数，小模型对应小模型合成次数 。"

,

​

"inputSchema"

:

{

​

"required"

:

[

​

"text"

​

],

​

"properties"

:

{

​

"voice_id"

:

{

​

"description"

:

"扣子编程音色 ID，支持选择扣子编程系统预置的音色或资源库中复刻的音色。 可以在操作页面直接选择音色，或通过系统音色列表https://docs.coze.cn/dev_how_to_guides/sys_voice查看音色 ID。"

,

​

"format"

:

"voice_id"

,

​

"type"

:

"string"

​

},

​

"emotion"

:

{

​

"description"

:

"语音情感"

,

​

"type"

:

"string"

​

},

​

"emotion_scale"

:

{

​

"description"

:

"调用emotion设置情感参数后可使用emotion_scale进一步设置情绪值，范围1~5，不设置时默认值为4。 注：理论上情绪值越大，情感越明显。但情绪值1~5实际为非线性增长，可能存在超过某个值后，情绪增加不明显，例如设置3和5时情绪值可能接近。"

,

​

"type"

:

"number"

​

},

​

"language"

:

{

​

"description"

:

"音色的语种，非必填，所有中文音色支持中英文混合场景。可参考系统音色列表https://docs.coze.cn/dev_how_to_guides/sys_voice查看各音色支持的语种。"

,

​

"type"

:

"string"

​

},

​

"speaker_id"

:

{

​

"description"

:

"音色ID，默认为爽快思思/Skye。详细音色列表参考 https://docs.coze.cn/guides/text_to_speech_plugin, default value is 爽快思思/Skye"

,

​

"type"

:

"string"

​

},

​

"speed_ratio"

:

{

​

"description"

:

"语速，范围是[0.2,3]，默认为1，通常保留一位小数即可, default value is 1"

,

​

"type"

:

"number"

​

},

​

"text"

:

{

​

"description"

:

"要合成音频的文本内容"

,

​

"type"

:

"string"

​

}

​

},

​

"type"

:

"object"

​

},

​

"name"

:

"speech_synthesis"

,

​

"outputSchema"

:

{

​

"properties"

:

{

​

"msg"

:

{

​

"type"

:

"string"

​

},

​

"code"

:

{

​

"type"

:

"number"

​

},

​

"data"

:

{

​

"properties"

:

{

​

"duration"

:

{

​

"description"

:

"音频时长，单位是s"

,

​

"type"

:

"number"

​

},

​

"link"

:

{

​

"type"

:

"string"

​

}

​

},

​

"type"

:

"object"

​

},

​

"log_id"

:

{

​

"type"

:

"string"

​

}

​

},

​

"type"

:

"object"

​

},

​

"tool_id"

:

"7426655854067***"

​

}

​

],

​

"mcp_json"

:

"{\"mcpServers\":{\"coze_plugin_yuyinhecheng\":{\"url\":\"https://mcp.coze.cn/v1/plugins/7426655854067351562\",\"headers\":{\"Authorization\":\"Bearer ${COZE_API_TOKEN}\"}}}}"

,

​

"plugin_id"

:

"742665585406***"

,

​

"name"

:

"语音合成"

,

​

"name_for_model"

:

"yuyinhecheng"

,

​

"description"

:

"根据音色和文本合成音频。按照字符数计费，计费项&免费额度说明：https://docs.coze.cn/coze_pro/asr_tts_fee。使用资源库音色时，计费项为复刻音色文字转语音字数；使用预设音色时，模型为大模型对应系统音色文字转语音字数，小模型对应小模型合成次数 。"

,

​

"icon_url"

:

"https://example.com/ocean-cloud-tos/plugin_icon/example.jpeg?lk3s=cd508e2b&x-expires=1763780763&x-signature=W0osLsZ***"

,

​

"is_call_available"

:

true

,

​

"created_at"

:

1759044695

,

​

"updated_at"

:

1761199709

​

}

​

]

​

},

​

"detail"

:

{

​

"logid"

:

"202510231410590AC026226***"

​

}

​

}

​

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

查询插件详情

下一篇

调用插件工具
============================================================
# 调用插件工具
来源: https://www.coze.cn/open/docs/developer_guides/call_plugin_tool
============================================================

调用插件工具

调用指定付费插件中的工具。

​

插件限制

​

套餐限制：仅付费版本支持此能力。

​

调用额度与 QPS 限制：请参见

通过 MCP 方式调用付费插件

。

​

插件类型：仅支持调用付费插件，包括扣子编程官方插件和三方插件。

​

Token 限制：不支持渠道 Token 调用该 API。

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/plugins/:plugin_id/tools/call

​

​

权限

​

Plugin.callTool

​

确保调用该接口使用的访问令牌开通了

Plugin.callTool

权限，详细信息参考

鉴权方式

。

​

接口说明

​

调用付费插件工具。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

plugin_id

​

String

​

必选

​

75458732632938***

​

待执行的插件 ID。你可以调用

查询插件列表

API 获取对应的插件 ID，即

entity_id

的值。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

tool_name

​

String

​

必选

​

getToutiaoNews

​

插件工具的名称。你可以通过

查询插件详情

API 获取。

​

arguments

​

Map[String, Any]

​

必选

​

{ "q": "杭州秋假" }

​

请根据对应插件工具的输入参数结构，输入相应参数的键值对。

​

你可以通过

查询插件详情

API 获取插件工具的输入参数结构体（

inputSchema

）。

​

​

返回参数

​

​

​

参数

​

类型

​

示例

​

说明

​

data.result

​

map

​

\

​

插件工具的返回结果，具体由插件的返回结构体定义。

​

​

​

参数

​

类型

​

示例

​

说明

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/plugins/7545873263293***/tools/call' \

​

--header 'Content-Type

:

application/json' \

​

--header 'Authorization

:

Bearer pat_3UXDHN82MgQANqK****' \

​

--data-raw '

{

​

"tool_name"

:

"getToutiaoNews"

,

​

"arguments"

:

{

​

"q"

:

"杭州秋假"

​

}

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"data"

:

{

​

"result"

:

{

​

"news"

:

[

​

{

​

"time"

:

"2025-09-19 15:02"

,

​

"url"

:

"https://toutiao.com/group/75516909358***/"

,

​

"summary"

:

"2025 年秋假安排：杭州市多城区 2025 年中小学秋假时间定为 9 月 28 日 - 30 日共 3 天，9 月 27 日上课。加上国庆、中秋假期，最长可连休 11 天"

,

​

"media_name"

:

"长江日报"

,

​

"categories"

:

[

​

"news_society/news_law/statute"

,

​

"news_society/negative_energy_society"

,

​

"news_society/news_law"

,

​

"legal"

,

​

"news_society"

​

],

​

"title"

:

"杭州中小学秋假相关信息"

,

​

"cover"

:

""

​

}

​

]

​

}

​

},

​

"detail"

:

{

​

"logid"

:

"20250926192926C176DEC5A***"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

批量查询插件信息

下一篇

申请插件扩容回调事件
============================================================
# 申请插件扩容回调事件
来源: https://www.coze.cn/open/docs/developer_guides/benefit_plugin_scale_requested
============================================================

申请插件扩容回调事件

如果三方付费插件支持扩容，插件开发者可以订阅

申请插件扩容回调事件

。当用户申请插件扩容时，扣子编程会向指定的回调地址推送回调消息，消息中包含插件扩容的详细信息。订阅回调的具体操作请参见

​

订阅回调

。

​

说明

申请插件扩容回调仅支持普通回调，不支持渠道回调。

​

​

触发条件

​

仅

插件开发者

可订阅，当用户申请插件扩容时，对应的回调地址会收到申请插件扩容回调事件。

​

回调结构体

​

回调消息的结构体 Body 中包含两个主要字段：

header

和

event

。

​

header

参数的参数说明请参见

​

回调事件

。

​

event

参数中包括以下参数：

​

​

字段

​

类型

​

说明

​

apply_id

​

String

​

扩容申请的 ID。

​

begin_at

​

Integer

​

扩容生效开始时间，采用 Unix 时间戳格式，单位：秒。

​

end_at

​

Integer

​

扩容过期时间，采用 Unix 时间戳格式，单位：秒。

​

resource_id

​

String

​

扩容插件的 ID。

​

usage_in_30d

​

Number

​

该用户在最近 30 天内调用该插件的次数。

​

applicant_info.user_id

​

Integer

​

发起扩容申请的扣子用户 ID。

​

applicant_info.user_name

​

String

​

发起扩容申请的扣子用户名称。

​

extension_type

​

String

​

扩容类型， 当前仅支持 QPS（Queries Per Second），即每秒最大请求数。

​

origin_capacity

​

Number

​

扩容前的原始 QPS。

​

target_capacity

​

Number

​

扩容后期望达到的目标 QPS。

​

​

回调结构体示例：

​

​

JSON

复制

{

​

"header"

:

{

​

"event_type"

:

"benefit.plugin.scale.requested"

,

//申请插件扩容回调事件

​

"event_id"

:

"83453324-0863-4abc-bcdf-80818705f29e-7545743825545740332"

,

// 此次触发的事件唯一ID，用户应该用这个ID做去重

​

"api_app_id"

:

"75457438255457***"

,

​

"created_at"

:

1757318670060

,

​

"coze_account_id"

:

""

​

},

​

"event"

:

{

​

"apply_id"

:

"754761756009177***"

,

// 申请单号

​

"begin_at"

:

1757318663

,

// 扩容生效时间，时间戳（秒）

​

"end_at"

:

1757664263

,

// 扩容过期时间，时间戳（秒）

​

"resource_id"

:

"75454180821776***"

,

// 扩容插件的 ID

​

"usage_in_30d"

:

0

,

// 该用户在最近 30 天内该插件的调用量

​

"applicant_info"

:

{

// 申请人信息

​

"user_id"

:

2100288

***

,

// 申请人的扣子用户ID

​

"user_name"

:

""

// 申请人的扣子用户名

​

},

​

"extension_type"

:

"QPS"

,

// 扩容类型：QPS（每秒最大请求数）

​

"origin_capacity"

:

20

,

// 扩容前的原始 QPS

​

"target_capacity"

:

30

// 扩容后期望达到的目标 QPS

​

}

​

}

​

​

响应回调

​

开发者服务器收到申请插件扩容回调后，应在 3 秒内响应，并返回 HTTP 状态码 200。

​

相关文档

​

​

订阅回调

​

​

接收并处理回调

​

上一篇

调用插件工具

下一篇

插件扩容到期回调事件
============================================================
# 插件扩容到期回调事件
来源: https://www.coze.cn/open/docs/developer_guides/benefit_plugin_scale_expired
============================================================

插件扩容到期回调事件

如果三方付费插件支持扩容，插件开发者可以订阅插件扩容到期回调事件，当扩容申请到期或用户主动取消扩容时，扣子编程会向指定的回调地址推送回调消息，消息中包含插件扩容的基本信息。订阅回调的具体操作请参见

​

订阅回调

。

​

说明

插件扩容到期回调仅支持普通回调，不支持渠道回调。

​

​

触发条件

​

仅

插件开发者

可订阅，当扩容申请到期或用户主动取消扩容时，对应的回调地址会收到插件扩容到期回调事件。

​

回调结构体

​

回调消息的结构体 Body 中包含两个主要字段：

header

和

event

。

​

header

参数的参数说明请参见

​

回调事件

。

​

event

参数中包括以下参数：

​

​

字段

​

类型

​

说明

​

apply_id

​

String

​

本次扩容到期申请的 ID。

​

resource_id

​

String

​

对应插件的 ID。

​

applicant_info.user_id

​

Integer

​

申请插件扩容的扣子用户 ID。

​

applicant_info.user_name

​

String

​

申请插件扩容的扣子用户名称。

​

extension_type

​

String

​

扩容类型， 当前仅支持 QPS（Queries Per Second），即每秒最大请求数。

​

expired_capacity

​

Number

​

本次到期所扣除的 QPS

容量

。

​

current_capacity

​

Number

​

释放后，插件当前可用的 QPS 限额。

​

​

回调结构体示例：

​

​

JSON

复制

{

​

"header"

:

{

​

"event_type"

:

"benefit.plugin.scale.expired"

,

// 事件类型：插件扩容到期事件

​

"event_id"

:

"6c2c25d4-e5c1-4bb4-9757-923ce88ddd12-7546444412004335643"

,

// 此次触发的事件唯一ID，用户应该用这个ID做去重

​

"created_at"

:

1757412006297

,

​

"coze_account_id"

:

""

,

// Coze账号ID

​

"api_app_id"

:

"754644441200***"

// 回调应用的 ID

​

},

​

"event"

:

{

​

"applicant_info"

:

{

// 扩容申请人信息

​

"user_id"

:

2102717852

,

// 申请人的扣子用户ID

​

"user_name"

:

""

// 申请人的扣子用户名

​

},

​

"apply_id"

:

"75476401436293**"

,

// 扩容申请单号

​

"resource_id"

:

"75460679235388**"

,

// 对应插件的 ID。

​

"extension_type"

:

"QPS"

,

// 扩容类型

​

"expired_capacity"

:

5

,

// 本次到期所扣除的 QPS 容量

​

"current_capacity"

:

21

// 释放后，插件当前可用的 QPS 限额

​

}

​

}

​

​

响应回调

​

开发者服务器收到插件扩容到期回调事件后，应在 3 秒内响应，并返回 HTTP 状态码 200。

​

相关文档

​

​

订阅回调

​

​

接收并处理回调

​

上一篇

申请插件扩容回调事件

下一篇

设置用户变量的值
============================================================
# 设置用户变量的值
来源: https://www.coze.cn/open/docs/developer_guides/update_variable
============================================================

设置用户变量的值

为智能体或应用中的用户变量设置变量值。

​

接口说明

​

当智能体或应用中已创建并开启用户变量时，你可以通过该 API 设置变量值，未开启的用户变量无法设置变量值。

​

设置用户变量值后，你可以调用

获取用户变量值

API 查询是否设置成功。

​

限制说明

​

仅支持为已发布 API、ChatSDK 的智能体或应用设置用户变量的值。

​

基础信息

​

​

请求方式

​

PUT

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/variables

​

权限

​

updateVariable

​

确保调用该 API 使用的访问令牌开通了

updateVariable

权限，详细信息参考

鉴权方式

。

​

接口说明

​

为智能体或应用中的用户变量设置变量值。

​

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

app_id

​

String

​

可选

​

7448857477636685850

​

如果需要为应用设置用户变量的值时，填入对应的应用ID。

​

你可以通过应用的业务编排页面 URL 中获取应用 ID，也就是 URL 中 project-ide 参数后的一串字符，例如

https://www.coze.

cn

/space/739174157340921****/

project

-ide/743996105122521****/workflow/744102227704147****

中，应用的 ID 为

743996105122521****

。

​

说明

app_id

和

bot_id

应至少填写一个，否则会报错。

​

​

bot_id

​

String

​

可选

​

7493151027400097829

​

需要为智能体设置用户设置变量的值时，填入对应的智能体 ID。

​

你可以通过智能体的编排页面获取智能体 ID，开发页面 URL 中 bot 参数后的数字就是智能体 ID。例如

https://www.coze.com/space/341****/bot/73428668*****

，bot ID 为

73428668*****

。

​

connector_id

​

String

​

可选

​

1024

​

智能体或应用的发布渠道 ID 列表。目前支持如下渠道：

​

API：（默认）1024

​

ChatSDK：999

​

connector_uid

​

String

​

必选

​

7432567

​

用户 ID，用于为指定的用户设置变量的值。用户 ID 对应

执行工作流

API 中

ext

字段指定的 user_id 或发起对话 API 中的 user_id。

​

data

​

Array of

KVItem

​

必选

​

[{"keyword":"name","value":""},{"keyword":"age","value":""}]

​

用户变量的数组，不能为空。

​

​

KVItem

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

value

​

String

​

必选

​

18

​

用户变量的值。

​

keyword

​

String

​

必选

​

age

​

用户变量的名称。

​

说明

keyword 必须为智能体或应用中已创建并开启的用户变量，不能设置为系统变量。

​

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{ "logid": "20250416125552EE59A23A87A***" }

​

返回详情。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request PUT 'https

:

//api.coze.cn/v1/variables' \

​

--header 'Authorization

:

Bearer pat_Q8LmOJU9mRCUzNCdnq6DMakFsmr***' \

​

--header 'Content-Type

:

application/json' \

​

--data '

{

​

"bot_id"

:

"749315102740009***"

,

​

"connector_id"

:

"1024"

,

​

"connector_uid"

:

"7432567"

,

​

"data"

:[

​

{

​

"keyword"

:

"name"

,

​

"value"

:

"小王"

​

},

​

{

​

"keyword"

:

"age"

,

​

"value"

:

"18"

​

}

​

]

​

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20250416125552EE59A23***"

​

}

​

}

​

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示 API 调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

插件扩容到期回调事件

下一篇

获取用户变量的值
============================================================
# 获取用户变量的值
来源: https://www.coze.cn/open/docs/developer_guides/read_variable
============================================================

获取用户变量的值

获取智能体或应用中设置的用户变量的值。

​

接口说明

​

通过

设置用户变量的值

API 设置变量值之后，可以通过本 API 查看智能体或应用中设置的用户变量的值。调用此 API 时可以查看指定变量的值，也可以将

keywords

指定为空，查看智能体或应用下的所有用户变量的值。如果输入的

keywords

在智能体或应用中不存在，扣子编程不会报错，但返回结果中不会包含相应的用户变量。

​

限制说明

​

仅支持获取已发布 API、ChatSDK 的智能体或应用中的用户变量的值。

​

用户变量按照

user_id

+

connector_uid

+

connector_id

+

bot_id

的组合进行隔离，因此在扣子编程站内设置的用户变量，在 API 渠道可能无法获取对应的值。不同渠道用户标识的规则存在差异，具体如下表所示。

​

​

参数

​

扣子编程站内

​

API 渠道

​

user_id

​

当前使用者的扣子用户 ID。

​

API Token 生成者的 ID。

​

connector_uid

​

当前使用者的扣子用户 ID。

​

用户在

发起对话

等 API 中输入的

user_id

。

​

​

基础信息

​

​

请求方式

​

GET

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/variables

​

权限

​

readVariable

​

确保调用该 API 使用的访问令牌开通了

readVariable

权限，详细信息参考

鉴权方式

。

​

接口说明

​

获取智能体或应用中设置的用户变量的值。

​

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $AccessToken

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

app_id

​

String

​

可选

​

744885747763***

​

如果需要获取应用中设置的用户变量的值，填入对应的应用ID。

​

你可以通过应用的业务编排页面 URL 中获取应用 ID，也就是 URL 中 project-ide 参数后的一串字符，例如

https://www.coze.

cn

/space/739174157340921****/

project

-ide/743996105122521****/workflow/744102227704147****

中，应用的 ID 为

743996105122521****

。

​

说明

app_id

和

bot_id

应至少填写一个，否则会报错。

​

​

bot_id

​

String

​

可选

​

749315102740***

​

如果需要获取智能体中设置的用户变量的值，填入对应的应用ID。

​

你可以通过智能体的开发页面获取智能体 ID，开发页面 URL 中 bot 参数后的数字就是智能体 ID。例如

https://www.coze.com/space/341****/bot/73428668*****

，bot ID 为

73428668*****

。

​

connector_id

​

String

​

可选

​

1024

​

智能体或应用的发布渠道 ID 列表。目前支持如下渠道：

​

API：1024

​

ChatSDK：999

​

connector_uid

​

String

​

必选

​

openAPI

​

查看指定用户 ID 的变量值。用户 ID 对应

执行工作流

API 中

ext

字段中的 user_id。

​

keywords

​

Array of String

​

可选

​

name,age

​

变量名称，多个变量用英文逗号分隔。

​

当

keywords

为空时，将返回用户在智能体或应用下的所有用户变量的值。如果输入的

keywords

在智能体或应用中不存在，则返回结果中不会包含相应的用户变量。

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

GetVariableData

​

-

​

用户变量数组。

​

detail

​

Object of

ResponseDetail

​

-

​

返回详情。

​

​

GetVariableData

​

​

参数

​

类型

​

示例

​

说明

​

items

​

Array of

KVItem

​

[{ "value": "小王", "create_time": 0, "update_time": 0, "keyword": "name" }]

​

用户变量数组。

​

​

KVItem

​

​

参数

​

类型

​

示例

​

说明

​

value

​

String

​

18

​

用户变量的值。

​

keyword

​

String

​

age

​

用户变量的名称。

​

说明

keyword 必须为智能体或应用中已创建并开启的用户变量，不能设置为系统变量。

​

​

create_time

​

Long

​

1744637812

​

首次设置变量值的时间。如果变量值为默认值，则

create_time

的值为 0。

​

Unixtime 时间戳格式，单位为秒。

​

update_time

​

Long

​

1744637812

​

更新时间，Unixtime 时间戳格式，单位为秒。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v1/variables?app_id=7448857477636685850&bot_id=74931510***9&connector_id=1024' \

​

--header 'Authorization

:

Bearer pat_Q8LmOJU9mRCUzNCdnq6DMakFsm*****'

​

--header 'Content-Type

:

application/json'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"data"

:

{

​

"items"

:

[

​

{

​

"value"

:

"小王"

,

​

"create_time"

:

0

,

​

"update_time"

:

0

,

​

"keyword"

:

"name"

​

},

​

{

​

"update_time"

:

1744637812

,

​

"keyword"

:

"age"

,

​

"value"

:

"18"

,

​

"create_time"

:

1744637812

​

}

​

]

​

},

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

设置用户变量的值

下一篇

更新审核结果
============================================================
# 更新审核结果
来源: https://www.coze.cn/open/docs/developer_guides/update_review_result
============================================================

更新审核结果

调用该接口更新智能体发布到自定义渠道的审核结果。

​

用户将智能体发布到自定义渠道后，如果触发了自定义渠道的审核流程，自定义渠道会通过回调消息返回审核结果。如果审核耗时较长，自定义渠道可以先在回调中返回审核中状态，审核结束后，再通过此 API 通知扣子此智能体的最终审核结果。

​

基础信息

​

​

请求方式

​

PUT

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/connectors/:connector_id/bots/:bot_id

​

权限

​

Connector.botUpdateProfile

​

确保调用该接口使用的访问令牌开通了

Connector.botUpdateProfile

权限，详细信息参考

鉴权

。

​

接口说明

​

更新智能体发布到自定义渠道的审核结果。

​

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $AccessToken

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

bot_id

​

String

​

可选

​

73428668*****

​

要更新的智能体 ID。

​

进入智能体的编排页面，编排页面 URL 中 bot 参数后的数字就是智能体 ID。例如

https://www.coze.cn/space/341****/bot/73428668*****

，智能体 ID 为

73428668*****

。

​

connector_id

​

String

​

可选

​

74202797******

​

渠道 ID。需要跟 token 的渠道一致。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

audit_status

​

Integer

​

可选

​

2

​

渠道审核状态。支持设置为：

​

1: 审核中

​

2: 审核通过

​

3: 审核不通过

​

reason

​

String

​

可选

​

头像无法通过审核

​

审核不通过的具体原因。

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。

​

0 表示调用成功。

​

其他值表示调用失败。你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request PUT 'https

:

//api.coze.cn/v1/connectors/74202797******/bots/73428668*****' \

​

--header 'Authorization

:

Bearer pat_Osa******' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"audit_status"

:

2

,

​

"reason"

:

"头像无法通过审核"

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"detail"

:

{

​

"logid"

:

"20250106172024B5F607030EFFAD***"

​

},

​

"code"

:

0

,

​

"msg"

:

""

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

获取用户变量的值

下一篇

添加发布平台
============================================================
# 添加发布平台
来源: https://www.coze.cn/open/docs/developer_guides/install_channel
============================================================

添加发布平台

为指定空间添加一个发布渠道。

​

接口说明

​

在扣子编程中发布智能体或应用时，可发布的渠道范围与工作空间有关。每个工作空间均配置了官方默认发布渠道，例如扣子商店、豆包、API 、SDK 等。除此之外，工作空间中还可以手动添加公共渠道和企业自定义渠道，按需拓展 AI 项目的分发渠道。添加渠道后，空间中的每个开发者都可以将自己的 AI 项目发布到这些渠道中。

​

说明

添加发布渠道之前，需要获取发布渠道的渠道 ID。

​

企业自定义渠道：在

我的

>

设置

>

发布渠道

>

我的渠道管理

页面查看当前登录用户已创建的渠道列表，列表中可查看渠道 ID。企业自定义渠道入驻扣子编程的方式可参考

渠道入驻

文档。

​

公开渠道：联系公开平台的管理员获取渠道 ID。

​

扣子企业版（企业标准版、企业旗舰版）中，仅

超级管理员和管理员

能添加企业的公共渠道和自定义渠道，成员只能给个人空间添加公共渠道和自定义渠道。

​

​

基础信息

​

​

请求方式

​

POST

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/connectors/:connector_id/install

​

权限

​

installConnector

​

确保调用该接口使用的访问令牌开通了

installConnector

权限，详细信息参考

鉴权

。

​

接口说明

​

为指定空间添加一个发布渠道。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

connector_id

​

String

​

必选

​

745264392345******

​

渠道 ID。

​

企业自定义渠道：在

我的

>

设置

>

发布渠道

>

我的渠道管理

页面查看当前登录用户已创建的渠道列表，列表中可查看渠道 ID。企业自定义渠道入驻扣子编程的方式可参考

渠道入驻

文档。

​

公开渠道：联系公开平台的管理员获取渠道 ID。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

workspace_id

​

String

​

必选

​

736163827687053****

​

需要添加新渠道的工作空间 ID。空间 ID 是空间的唯一标识。

​

进入指定空间，空间页面 URL 中

w

参数后的数字就是 工作空间 ID。例如

https://code.coze.cn/w/75814654762959***/projects

，工作空间 ID 为

75814654762959***

。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。

​

0 表示调用成功。

​

其他值表示调用失败。你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{ "logid": "202410242028595CCF353CEC86A8*****" }

​

本次请求的详细信息。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

安装渠道

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/connectors/745264392345******/install' \

​

--header 'Authorization

:

Bearer pat_Osa******' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"workspace_id"

:

"736163827687053****"

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"detail"

:

{

​

"logid"

:

"20241029152003BC531DC784F1897B****"

​

},

​

"code"

:

0

,

​

"msg"

:

""

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

更新审核结果

下一篇

绑定设备
============================================================
# 绑定设备
来源: https://www.coze.cn/open/docs/developer_guides/bind_connector_config
============================================================

绑定设备

将设备与自定义渠道绑定。

​

接口描述

​

硬件厂商可以调用本 API 将企业内的硬件设备与企业的自定义渠道绑定，当开发者发布智能体到该自定义渠道时，在发布配置页面的设备列表中选择对应的设备，即可快速发布到对应设备。

​

支持批量绑定多台设备。

​

说明

创建自定义渠道后，默认未开启 API 绑定设备的能力，如果需要调用本 API，你需要将自定义渠道的渠道 ID 提供给扣子商务经理，申请开通渠道设备绑定的能力，并由商务经理配置设备绑定的 key。

​

​

基础信息

​

​

请求方式

​

POST

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/connectors/:connector_id/user_configs

​

权限

​

bindConnectorConfig

​

确保调用该接口使用的访问令牌开通了

bindConnectorConfig

权限，详细信息参考

准备工作

。

​

接口说明

​

将设备与自定义渠道绑定。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

connector_id

​

String

​

必选

​

745264392345******

​

企业自定义渠道的渠道 ID。

​

自定义渠道 ID 的获取方式如下：在扣子编程左下角单击头像，在

账号设置

>

发布渠道

>

企业自定义渠道管理

页面查看渠道 ID。自定义渠道入驻扣子编程的方式可参考

渠道入驻

文档。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

configs

​

Array of

UserConfig

​

必选

​

[{"key":"device_id","enums":[{"label":"设备123","value":"1237824***"}]}]

​

设备配置信息列表。

​

user_id

​

String

​

可选

​

4497462571***

​

智能体开发者的扣子用户 UID，用于标识设备绑定的扣子用户。

​

你可以单击扣子编程左下角的头像，选择

账号设置

，在页面底部查看扣子用户的 UID。

​

​

UserConfig

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

key

​

String

​

必选

​

device_id

​

参数的键值，需要与提供给商务经理的

key

保持一致，用于标识设备配置信息的具体类型。

​

enums

​

Array of

UserConfigEnum

​

必选

​

[{"label":"设备123","value":"1237824***"}]

​

设备信息的数组，可以批量添加该渠道中的所有设备。

​

​

UserConfigEnum

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

label

​

String

​

必选

​

智能音箱-客厅

​

设备的显示名称，用于在用户界面中标识设备，方便用户识别和管理。

​

value

​

String

​

必选

​

51237824***

​

设备的 ID。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/connectors/745264392345******/user_configs' \

​

--header 'Authorization

:

Bearer pat_xitq****' \

​

--header 'Content-Type

:

application/json' \

​

--data-raw '

{

​

"configs"

:

[

​

{

​

"key"

:

"device_id"

,

​

"enums"

:

[

​

{

​

"label"

:

"智能音箱-客厅"

,

​

"value"

:

"51237824***"

​

},

​

{

​

"label"

:

"智能音箱-主卧"

,

​

"value"

:

"51237825***"

​

}

​

]

​

}

​

]

​

}

'

​

​

返回示例

​

​

JSON

复制

{

​

"detail"

:

{

​

"logid"

:

"20241029152003BC531DC784F1897B****"

​

},

​

"code"

:

0

,

​

"msg"

:

""

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

添加发布平台

下一篇

创建终端用户权益额度
============================================================
# 创建终端用户权益额度
来源: https://www.coze.cn/open/docs/developer_guides/create_device_quotas
============================================================

创建终端用户权益额度

创建终端用户的权益额度。

​

说明

套餐限制

：扣子企业旗舰版。

​

角色限制

：企业超级管理员和管理员可以调用该 API。

​

调用此 API 创建设备权益额度之前，需要确保企业下的设备已成功上报了设备信息，否则会导致权益额度对该设备无法生效，设备信息的配置方法可参考

设置设备信息

。

​

​

接口描述

​

你可以调用本 API 创建终端用户的权益额度，用于设置终端用户可使用的资源点或语音时长配额，以便用户在初始阶段免费体验设备功能，同时避免资源的过度使用。

​

生效对象：权益额度的生效对象可以设置为企业中的所有设备、所有自定义维度的实体、某个设备或某个自定义维度的实体。

​

额度类型：支持按资源点维度或语音通话时长维度设置配额，你可以为每个设备设置累计可用额度以及时间周期内的额度（例如每日 1000 资源点）。当设备在当前周期内的资源点使用达到周期上限或累计额度上限时，将无法继续使用，直至下一个周期或额度重置。例如设置每个设备累计额度为 5000 资源点，每天可用 1000 资源点。当设备 A 今天的使用资源点达到 1000 上限后，设备 A 今天将无法继续使用，需等到次日才能恢复使用，当设备 A 的累计使用资源点达到 5000 上限后，设备 A 将无法继续使用。

​

配置的优先级：若同时为单个设备和企业下所有设备配置了额度，则优先使用单个设备的额度。

​

生效时间：通过扣子编程的

管理设备配额

页面设置的针对企业下所有设备和自定义维度实体的额度，默认有效期为永不过期，即

started_at = 1970-01-01

至

ended_at = 9999-12-31

。若权益生效时间已过期，则该条配额规则会失效。

​

未配置额度的设备：未设置权益额度的设备，将默认无限制使用资源点。

​

接口限制

​

当权益配额的生效范围为企业下所有设备或企业下所有自定义维度的实体时，仅能创建一条累计可用额度和一条时间周期内可用额度。

​

增购

AI 智能通话许可（系统音色）

的企业，权益额度类型支持配置为

语音通话时长配额（系统音色）

，否则不生效，购买语音通话时长的详细步骤请参见

音视频费用

。

​

增购

AI 智能通话许可（复刻音色）

的企业，权益额度类型支持配置为

语音通话时长配额（复刻音色）

，否则不生效。

​

未增购 AI 智能通话许可的企业，权益额度类型仅支持资源点配额。

​

基础信息

​

​

请求方式

​

POST

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/commerce/benefit/limitations

​

权限

​

createBenefitLimitation

​

确保调用该接口使用的访问令牌开通了

createBenefitLimitation

权限，详细信息参考

鉴权方式

。

​

接口说明

​

创建终端用户的权益配额。

​

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

用于指定解析请求正文的格式，表明请求体为 JSON 格式数据。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

entity_type

​

String

​

必选

​

enterprise_all_devices

​

权益配额的生效范围，枚举值：

​

enterprise_all_devices

：权益配额对企业下的所有设备生效。

​

enterprise_all_custom_consumers

：权益配额对企业下所有自定义维度的实体生效。若某设备在设备信息中未上报 custom_consumers，则该设备无法生效权益额度。

​

single_device

：权益配额对单个设备生效。

​

single_custom_consumer

：权益配额对单个自定义维度的实体生效。

​

entity_id

​

String

​

可选

​

12345

​

该权益配额对哪个实体 ID 生效。

​

entity_type

为

single_device

时，

entity_id

需要设置为对应的 Device ID。

​

entity_type

为

single_custom_consumer

时，

entity_id

需要设置为对应的 custom consumer ID。

​

entity_type

为其他类型时，无需填写

entity_id

。

​

benefit_info

​

Object of

BenefitInfo

​

必选

​

{ "benefit_type": "resource_point", "active_mode": "absolute_time", "started_at": 1741708800, "ended_at": 253402300799, "limit": 100, "status": "valid" }

​

权益额度。

​

​

BenefitInfo

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

limit

​

Long

​

必选

​

100

​

可用的额度。

​

如果权益配额类型为

resource_point

，可用额度的单位为资源点。

​

如果权益配额类型为

voice_unified_duration_system

或

voice_unified_duration_custom

，可用额度的单位为秒。

​

benefit_type

​

String

​

必选

​

resource_point

​

权益配额类型，枚举值：

​

resource_point

：资源点配额。

​

voice_unified_duration_system

：

​

语音通话时长配额（系统音色）。

​

voice_unified_duration_custom

：

​

语音通话时长配额（复刻音色）。

​

说明

增购

AI 智能通话许可（系统音色）

的企业，配置的

voice_unified_duration_system

才生效，购买语音通话时长的详细步骤请参见

音视频费用

。

​

增购

AI 智能通话许可（复刻音色）

的企业，配置的

​

voice_unified_duration_custom

才生效。

​

未增购 AI 智能通话许可的企业，仅支持配置

​

resource_point

。

​

​

active_mode

​

String

​

必选

​

absolute_time

​

激活模式，当前仅支持设置为

absolute_time

模式，即绝对时间。

​

该模式下，权益生效时间由

started_at

和

ended_at

两个时间确定。

​

started_at

​

Long

​

必选

​

1753996800

​

该条配额规则的生效起始时间，Unixtime 时间戳格式，单位为秒。

​

ended_at

​

Long

​

必选

​

253402300799

​

该条配额规则的生效截止时间，Unixtime 时间戳格式，单位为秒。过期后，该条配额规则会失效。

​

status

​

String

​

可选

​

valid

​

设备权益的当前状态，枚举值：

​

valid

：正常使用。

​

frozen

：已冻结。

​

trigger_unit

​

String

​

可选

​

day

​

权益可用额度的重置周期，即额度按指定时间间隔恢复或重新计算。枚举值：

​

never

：（默认）不重置额度，适用于设置累计可用额度上限。

​

minute

：以分钟为周期重置额度。

​

hour

：以小时为周期重置额度。

​

day

：以天为周期重置额度。

​

trigger_time

​

Long

​

可选

​

1

​

权益配额重置周期的频率：

​

当

trigger_unit

为

never

时，

trigger_time

的值为 1，且无意义。

​

当

trigger_unit

为

minute

、

hour

或

day

时，

trigger_time

表示具体的刷新频率，例如：

trigger_unit=day

且

trigger_time = 1

，表示每日刷新配额。

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

CreateBenefitLimitationData

​

{ "benefit_id": 123***, "benefit_type": "resource_point", "active_mode": "absolute_time", "started_at": 1741708800, "ended_at": 1741708800, "limit": 100, "status": "valid" }

​

接口调用成功时，返回的详细数据信息。

​

detail

​

Object of

ResponseDetail

​

-

​

响应详情信息。

​

​

CreateBenefitLimitationData

​

​

参数

​

类型

​

示例

​

说明

​

benefit_info

​

Object of

BenefitInfo

​

-

​

权益额度。

​

​

BenefitInfo

​

​

参数

​

类型

​

示例

​

说明

​

limit

​

Long

​

100

​

可用的额度。

​

如果权益配额类型为

resource_point

，可用额度的单位为资源点。

​

如果权益配额类型为

voice_unified_duration_system

或

voice_unified_duration_custom

，可用额度的单位为秒。

​

benefit_type

​

String

​

resource_point

​

权益配额类型，枚举值：

​

resource_point

：资源点配额。

​

voice_unified_duration_system

：

​

语音通话时长配额（系统音色）。

​

voice_unified_duration_custom

：

​

语音通话时长配额（复刻音色）。

​

说明

增购

AI 智能通话许可（系统音色）

的企业，配置的

voice_unified_duration_system

才生效，购买语音通话时长的详细步骤请参见

音视频费用

。

​

增购

AI 智能通话许可（复刻音色）

的企业，配置的

​

voice_unified_duration_custom

才生效。

​

未增购 AI 智能通话许可的企业，仅支持配置

​

resource_point

。

​

​

active_mode

​

String

​

absolute_time

​

激活模式，当前仅支持设置为

absolute_time

模式，即绝对时间。

​

该模式下，权益生效时间由

started_at

和

ended_at

两个时间确定。

​

started_at

​

Long

​

1753996800

​

该条配额规则的生效起始时间，Unixtime 时间戳格式，单位为秒。

​

ended_at

​

Long

​

253402300799

​

该条配额规则的生效截止时间，Unixtime 时间戳格式，单位为秒。过期后，该条配额规则会失效。

​

entity_id

​

String

​

SN12345*********

​

该权益配额对哪个实体 ID 生效。仅在

entity_type

为

single_device

或

​

single_custom_consumer

时，会返回对应的实体 ID。

​

status

​

String

​

valid

​

设备权益的当前状态，枚举值：

​

valid

：正常使用。

​

frozen

：已冻结。

​

benefit_id

​

String

​

123

​

权益配额的 ID。

​

entity_type

​

String

​

enterprise_all_devices

​

权益配额的生效范围，枚举值：

​

enterprise_all_devices

：权益配额对企业下的所有设备生效。

​

enterprise_all_custom_consumers

：权益配额对企业下所有自定义维度的实体生效。若某设备在设备信息中未上报 custom_consumers，则该设备无法生效权益配额。

​

single_device

：权益配额对单个设备生效。

​

single_custom_consumer

：权益配额对单个自定义维度的实体生效。

​

trigger_unit

​

String

​

day

​

权益可用额度的重置周期，即额度按指定时间间隔恢复或重新计算。枚举值：

​

never

：（默认）不重置额度，适用于设置累计可用额度上限。

​

minute

：以分钟为周期重置额度。

​

hour

：以小时为周期重置额度。

​

day

：以天为周期重置额度。

​

trigger_time

​

Long

​

1

​

权益配额重置周期的频率：

​

当

trigger_unit

为

never

时，

trigger_time

的值为 1，且无意义。

​

当

trigger_unit

为

minute

、

hour

或

day

时，

trigger_time

表示具体的刷新频率，例如：

trigger_unit=day

且

trigger_time = 1

，表示每日刷新配额。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/commerce/benefit/limitations' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json'

​

{

​

"entity_type"

:

"single_device"

,

​

"entity_id"

:

"SN12345*********"

,

​

"benefit_info"

:

{

​

"benefit_type"

:

"resource_point"

,

​

"active_mode"

:

"absolute_time"

,

​

"started_at"

:

1741708800

,

​

"ended_at"

:

253402300799

,

​

"limit"

:

100

,

​

"status"

:

"valid"

​

}

​

}

​

返回示例

​

​

JSON

复制

{

​

"data"

:

{

​

"benefit_id"

:

123

***

,

​

"benefit_type"

:

"resource_point"

,

​

"active_mode"

:

"absolute_time"

,

​

"started_at"

:

1741708800

,

​

"ended_at"

:

253402300799

,

​

"limit"

:

100

,

​

"status"

:

"valid"

​

},

​

"code"

:

0

,

​

"msg"

:

""

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

绑定设备

下一篇

查询终端用户的权益配额
============================================================
# 查询终端用户的权益配额
来源: https://www.coze.cn/open/docs/developer_guides/get_device_quotas
============================================================

查询终端用户的权益配额

查询已配置的权益配额信息，包括权益配额、状态、激活模式等详细信息。

​

说明

套餐限制

：扣子企业旗舰版。

​

角色限制

：企业超级管理员和管理员可以调用该 API。

​

调用此 API 查询设备权益配额之前，需要确保企业下的设备已成功上报了设备信息，否则会导致权益配额对该设备无法生效，设备信息的配置方法可参考

设置设备信息

。

​

​

基础信息

​

​

请求方式

​

GET

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/commerce/benefit/limitations

​

权限

​

listBenefitLimitation

​

确保调用该接口使用的访问令牌开通了

listBenefitLimitation

权限，详细信息参考

鉴权方式

。

​

接口说明

​

查询已配置的权益额度信息。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

用于指定解析请求正文的格式，表明请求体为 JSON 格式数据。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

entity_type

​

String

​

必选

​

enterprise_all_devices

​

权益配额的生效范围，枚举值：

​

enterprise_all_devices

：权益配额对企业下的所有设备生效。

​

enterprise_all_custom_consumers

：权益配额对企业下所有自定义维度的实体生效。

​

single_device

：权益配额对单个设备生效。

​

single_custom_consumer

：权益配额对单个自定义维度的实体生效。

​

entity_id

​

String

​

可选

​

SN12345*********

​

该权益配额对哪个实体 ID 生效。

​

仅在

entity_type

为

single_device

或

​

single_custom_consumer

时，需填写entity_id，分别为对应的 Device ID 或 custom consumer ID。

​

entity_type

为其他类型时，无需填写entity_id。

​

benefit_type

​

String

​

必选

​

resource_point

​

权益配额类型，枚举值：

​

resource_point

：资源点配额。

​

voice_unified_duration_system

：

​

语音通话时长配额（系统音色）。

​

voice_unified_duration_custom

：

​

语音通话时长配额（复刻音色）。

​

status

​

String

​

可选

​

valid

​

设备权益的当前状态，枚举值：

​

valid

：（默认值）正常使用。

​

frozen

：已冻结。

​

page_token

​

String

​

可选

​

-

​

翻页标识，表示下一页的起始位置。当查询结果超过

page_size

时，返回的

page_token

可用于获取下一页数据。

​

首次请求不填或置空，后续翻页需带上上一次返回的 page_token。

​

page_size

​

Integer

​

可选

​

30

​

查询结果分页展示时，此参数用于设置每页返回的数据量。取值范围为 1~200，默认为 20。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

ListBenefitLimitationData

​

{ "benefit_id": 123***, "benefit_type": "resource_point", "active_mode": "absolute_time", "started_at": 1741708800, "ended_at": 1741708800, "limit": 100, "status": "valid" }

​

接口调用成功时，返回的详细数据信息。

​

detail

​

Object of

ResponseDetail

​

-

​

响应详情信息。

​

​

ListBenefitLimitationData

​

​

参数

​

类型

​

示例

​

说明

​

has_more

​

Boolean

​

true

​

是否还有下一页。

​

true：还有下一页。

​

false：没有下一页。

​

page_token

​

String

​

-

​

翻页标识。

​

benefit_infos

​

Array of

BenefitInfo

​

-

​

权益配额列表。

​

​

BenefitInfo

​

​

参数

​

类型

​

示例

​

说明

​

limit

​

Long

​

100

​

可用的额度。

​

如果权益配额类型为

resource_point

，可用额度的单位为资源点。

​

如果权益配额类型为

voice_unified_duration_system

或

voice_unified_duration_custom

，可用额度的单位为秒。

​

benefit_type

​

String

​

resource_point

​

权益配额类型，枚举值：

​

resource_point

：资源点配额。

​

voice_unified_duration_system

：

​

语音通话时长配额（系统音色）。

​

voice_unified_duration_custom

：

​

语音通话时长配额（复刻音色）。

​

说明

增购

AI 智能通话许可（系统音色）

的企业，配置的

voice_unified_duration_system

才生效，购买语音通话时长的详细步骤请参见

音视频费用

。

​

增购

AI 智能通话许可（复刻音色）

的企业，配置的

​

voice_unified_duration_custom

才生效。

​

未增购 AI 智能通话许可的企业，仅支持配置

​

resource_point

。

​

​

active_mode

​

String

​

absolute_time

​

激活模式，当前仅支持设置为

absolute_time

模式，即绝对时间。

​

该模式下，权益生效时间由

started_at

和

ended_at

两个时间确定。

​

started_at

​

Long

​

1753996800

​

该条配额规则的生效起始时间，Unixtime 时间戳格式，单位为秒。

​

ended_at

​

Long

​

253402300799

​

该条配额规则的生效截止时间，Unixtime 时间戳格式，单位为秒。过期后，该条配额规则会失效。

​

entity_id

​

String

​

SN12345*********

​

该权益配额对哪个实体 ID 生效。仅在

entity_type

为

single_device

或

​

single_custom_consumer

时，会返回对应的实体 ID。

​

status

​

String

​

valid

​

设备权益的当前状态，枚举值：

​

valid

：正常使用。

​

frozen

：已冻结。

​

entity_type

​

String

​

enterprise_all_devices

​

权益配额的生效范围，枚举值：

​

enterprise_all_devices

：权益配额对企业下的所有设备生效。

​

enterprise_all_custom_consumers

：权益配额对企业下所有自定义维度的实体生效。若某设备在设备信息中未上报 custom_consumers，则该设备无法生效权益配额。

​

single_device

：权益配额对单个设备生效。

​

single_custom_consumer

：权益配额对单个自定义维度的实体生效。

​

trigger_unit

​

String

​

day

​

权益可用额度的重置周期，即额度按指定时间间隔恢复或重新计算。枚举值：

​

never

：（默认）不重置额度，适用于设置累计可用额度上限。

​

minute

：以分钟为周期重置额度。

​

hour

：以小时为周期重置额度。

​

day

：以天为周期重置额度。

​

trigger_time

​

Long

​

1

​

权益配额重置周期的频率：

​

当

trigger_unit

为

never

时，

trigger_time

的值为 1，且无意义。

​

当

trigger_unit

为

minute

、

hour

或

day

时，

trigger_time

表示具体的刷新频率，例如：

trigger_unit=day

且

trigger_time = 1

，表示每日刷新配额。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v1/commerce/benefit/limitations?entity_type=enterprise_all_devices&entity_id=SN12345*********&benefit_type=resource_point' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3P****' \

​

--header 'Content-Type

:

application/json'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"data"

:

{

​

"has_more"

:

true

,

​

"page_token"

:

"next_page_token_123"

,

​

"benefit_infos"

:

[

​

{

​

"limit"

:

100

,

​

"status"

:

"valid"

,

​

"ended_at"

:

1804185600

,

​

"entity_id"

:

"SN12345*********"

,

​

"started_at"

:

1753996800

,

​

"active_mode"

:

"absolute_time"

,

​

"entity_type"

:

"enterprise_all_devices"

,

​

"benefit_type"

:

"resource_point"

,

​

"trigger_time"

:

1

,

​

"trigger_unit"

:

"never"

​

}

​

]

​

},

​

"detail"

:

{

​

"logid"

:

"20241210152726467C48D89D6DB2****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

创建终端用户权益额度

下一篇

更新终端用户的权益额度
============================================================
# 更新终端用户的权益额度
来源: https://www.coze.cn/open/docs/developer_guides/update_device_quotas
============================================================

更新终端用户的权益额度

更新终端用户的权益额度。当你

创建设备的权益额度

后，可以调用本 API 更新相关额度。

​

说明

套餐限制

：扣子企业旗舰版。

​

角色限制

：企业超级管理员和管理员可以调用该 API。

​

调用此 API 更新设备权益额度之前，需要确保企业下的设备已成功上报了设备信息，否则会导致权益额度对该设备无法生效，设备信息的配置方法可参考

设置设备信息

。

​

​

基础信息

​

​

请求方式

​

PUT

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/commerce/benefit/limitations/:benefit_id

​

权限

​

updateBenefitLimitation

​

确保调用该接口使用的访问令牌开通了

updateBenefitLimitation

权限，详细信息参考

鉴权方式

。

​

接口说明

​

更新终端用户的权益额度。

​

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

用于指定解析请求正文的格式，表明请求体为 JSON 格式数据。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

benefit_id

​

String

​

可选

​

123

​

权益 ID。你可以在

创建设备的权益额度

的返回参数中获取对应的权益 ID 的值。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

active_mode

​

String

​

可选

​

absolute_time

​

激活模式，当前仅支持设置为

absolute_time

模式，即绝对时间。

​

该模式下，权益生效时间由

started_at

和

ended_at

两个时间确定。

​

started_at

​

Long

​

可选

​

1743213600

​

该条配额规则的生效起始时间，Unixtime 时间戳格式，单位为秒。

​

ended_at

​

Long

​

可选

​

1743386400

​

该条配额规则的生效截止时间，Unixtime 时间戳格式，单位为秒。过期后，该条配额规则会失效。

​

limit

​

Long

​

可选

​

100

​

可用的资源点额度。

​

status

​

String

​

可选

​

valid

​

设备权益的当前状态，枚举值：

​

valid：（默认值）正常使用。

​

frozen：已冻结。

​

trigger_unit

​

String

​

可选

​

day

​

权益可用额度的重置周期，即额度按指定时间间隔恢复或重新计算：

​

never：不重置额度，适用于设置累计可用额度上限。

​

minute：以分钟为周期重置额度。

​

hour：以小时为周期重置额度。

​

day：以天为周期重置额度。

​

trigger_time

​

Long

​

可选

​

1

​

权益额度重置周期的频率：

​

当

trigger_unit

为

never

时，

trigger_time

的值为 1，且无意义。

​

当

trigger_unit

为

minute

、

hour

或

day

时，

trigger_time

表示具体的刷新频率，例如：

trigger_unit=day

且

trigger_time = 1

，表示每日刷新配额。

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

-

​

响应详情信息。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request PUT 'https

:

//api.coze.cn/v1/commerce/benefit/limitations/12345***' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json'

​

{

​

"benefit_id"

:

"12345***"

,

​

"active_mode"

:

"absolute_time"

,

​

"started_at"

:

1741708800

,

​

"ended_at"

:

1741708800

,

​

"limit"

:

100

,

​

"status"

:

"valid"

​

}

​

返回示例

​

​

JSON

复制

{

​

"data"

:

{

​

"benefit_id"

:

"12345***"

,

​

"benefit_type"

:

"resource_point"

,

​

"active_mode"

:

"absolute_time"

,

​

"started_at"

:

1741708800

,

​

"ended_at"

:

1741708800

,

​

"limit"

:

100

,

​

"status"

:

"valid"

​

},

​

"code"

:

0

,

​

"msg"

:

""

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

查询终端用户的权益配额

下一篇

导出终端用户账单
============================================================
# 导出终端用户账单
来源: https://www.coze.cn/open/docs/developer_guides/create_bill_task
============================================================

导出终端用户账单

导出终端用户的账单，用于

查看

终端用户的用量明细，包括：语音识别 ASR 的音频时长、语音合成 TTS 的字符数、语音合成 TTS 的对话次数、RTC 通话时长、金额等信息。

​

说明

仅扣子企业旗舰版的超级管理员和管理员可以调用该 API。

​

调用此 API 之前，需要确保企业下的设备已成功上报了设备信息，设备信息的配置方法可参考

设置设备信息

。

​

​

接口描述

​

调用此 API 后，后台将创建一个导出任务并返回任务 ID 和状态，你可以通过

查询账单文件

获取账单下载链接。

​

仅支持按天查询，例如查询 2025 年 3 月 27 日 00:00:00 至 23:59:59 的账单。查询周期默认为当天的 0 时至 24 时。

​

该 API 为异步接口，若账单数据量较大，可能需等待约 1 分钟才能获取账单 URL。

​

下载链接的有效期为 7 天，过期后需要重新导出账单。

​

基础信息

​

​

请求方式

​

POST

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/commerce/benefit/bill_tasks

​

权限

​

createBillDownloadTask

​

确保调用该接口使用的个人令牌开通了

createBillDownloadTask

权限，详细信息参考

鉴权方式

。

​

接口说明

​

导出终端用户的账单。

​

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。可在扣子编程生成，具体生成步骤及相关信息，详见准备工作文档。

​

Content-Type

​

application/json

​

用于指定解析请求正文的格式，表明请求体为 JSON 格式数据。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

started_at

​

Long

​

可选

​

1743004800

​

待导出账单的开始时间，格式为 Unix 时间戳，单位为秒。

​

仅支持设置为某天 0 点整的时间戳，例如，2025-03-27 00:00:00。如果填写的时间戳非 00:00:00，系统将自动调整为当天 00:00:00 的时间戳。

​

说明

暂不支持导出当日账单，因此起始时间不能设置为当天的时间。

​

只能导出 2025-03-13 及之后的数据。

​

​

ended_at

​

Long

​

可选

​

1743091199

​

待导出账单的截止时间，格式为 Unix 时间戳，单位为秒。

​

仅支持设置为某天 23:59:59 的时间戳，例如，2025-03-27 23:59:59。如果填写的时间戳非 23:59:59，系统将自动调整为当天 23:59:59 的时间戳。

​

说明

暂不支持导出当日账单，因此起始时间不能设置为当天的时间。

​

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

BillTaskInfo

​

\

​

接口调用成功时返回的任务详细信息。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

BillTaskInfo

​

​

参数

​

类型

​

示例

​

说明

​

status

​

String

​

running

​

任务当前状态：

​

init：任务初始化中。

​

running：账单数据生成中。

​

succeed：账单已生成，可下载导出文件。

​

failed：任务执行失败，可结合 msg 字段查看失败原因。

​

task_id

​

String

​

123

​

账单导出任务的唯一标识 ID，用于后续查询任务状态或获取导出文件。

​

ended_at

​

Long

​

1743091200

​

账单上的截止时间。

​

file_urls

​

Array of String

​

["

https://example.com/bill_1.csv

", "

https://example.com/bill_2.csv

"]

​

账单导出文件的链接列表，任务完成后，可通过这些链接下载账单文件。

​

如果账单中的数据量过大，扣子编程会将数据拆分为多个文件，每个文件最多包含 50 万行数据。

​

说明

账单文件中的字段说明请参见

账单推送回调事件

。

​

​

created_at

​

Long

​

1743213605

​

任务的创建时间，Unix 时间戳，单位为秒。

​

expires_at

​

Long

​

1743177600

​

任务的过期时间，默认账单将保留 7 天，超过此时间后，无法再下载账单文件。Unix 时间戳，单位为秒。

​

started_at

​

Long

​

1743004800

​

账单上的起始时间。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request POST 'https

:

//api.coze.cn/v1/commerce/benefit/bill_tasks' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json'

​

{

​

"started_at"

:

1743004800

,

​

"ended_at"

:

1743091200

​

}

​

返回示例

​

​

JSON

复制

{

​

"data"

:

{

​

"task_id"

:

123

***

,

​

"started_at"

:

1743004800

,

​

"ended_at"

:

1743091200

,

​

"created_at"

:

1743213605

,

​

"expires_at"

:

1743177600

,

​

"file_urls"

:

""

,

​

"status"

:

"running"

​

},

​

"code"

:

0

,

​

"msg"

:

""

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

更新终端用户的权益额度

下一篇

查询账单文件
============================================================
# 查询账单文件
来源: https://www.coze.cn/open/docs/developer_guides/billing_file
============================================================

查询账单文件

查询账单文件。

​

接口描述

​

当你

导出设备账单

后，可以通过本 API 查询账单文件，获取对应账单文件的 URL 链接，以便下载或查看已导出的账单数据。你可以通过账单文件

查看

智能硬件

设备

的用量明细，包括：语音识别 ASR 的音频时长、语音合成 TTS 的字符数、语音合成 TTS 的对话次数、RTC 通话时长、金额等信息。

​

说明

仅扣子企业旗舰版的超级管理员和管理员可以调用该 API。

​

调用此 API 之前，需要确保企业下的设备已成功上报了设备信息，设备信息的配置方法可参考

设置设备信息

。

​

​

接口限制

​

账单下载链接的有效期为 7 天，过期后需要调用

导出设备账单

API 重新导出账单。

​

只有当任务状态为

succeed

时，才会返回账单的下载链接。

​

基础信息

​

​

请求方式

​

GET

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/commerce/benefit/bill_tasks

​

权限

​

listBillDownloadTask

​

确保调用该接口使用的访问令牌开通了

listBillDownloadTask

权限，详细信息参考

鉴权方式

。

​

接口说明

​

查询账单文件。

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。可在扣子编程生成，具体生成步骤及相关信息，详见准备工作文档。

​

Content-Type

​

application/json

​

用于指定解析请求正文的格式，表明请求体为 JSON 格式数据。

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

task_ids

​

Array of String

​

可选

​

[123, 456]

​

账单导出任务 ID 列表，最多填写 100 个任务 ID。

​

若不填写该参数，默认查询最近 7 天内创建的账单导出任务。

​

page_num

​

Integer

​

可选

​

1

​

用于设置查询结果分页展示时的页码，最小值为 1，默认值为 1。

​

page_size

​

Integer

​

可选

​

20

​

用于设置查询结果分页展示时每页返回的数据量，取值范围为 1 ~ 200，默认值为 20。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

BillBusinessData

​

-

​

接口调用成功时返回的任务详细信息。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

BillBusinessData

​

​

参数

​

类型

​

示例

​

说明

​

total

​

Integer

​

12

​

当前查询条件下的总账单任务数。

​

task_infos

​

Array of

BillTaskInfo

​

-

​

包含多个账单导出任务信息的列表，每个任务信息包含任务 ID、时间范围、文件 URL 等详细内容。

​

​

BillTaskInfo

​

​

参数

​

类型

​

示例

​

说明

​

status

​

String

​

running

​

任务当前状态：

​

init：任务初始化中。

​

running：账单数据生成中。

​

succeed：账单已生成，可下载导出文件。

​

failed：任务执行失败，可结合 msg 字段查看失败原因。

​

task_id

​

String

​

123

​

账单导出任务的唯一标识 ID，用于后续查询任务状态或获取导出文件。

​

ended_at

​

Long

​

1743091200

​

账单上的截止时间。

​

file_urls

​

Array of String

​

["

https://example.com/bill_1.csv

", "

https://example.com/bill_2.csv

"]

​

账单导出文件的链接列表，任务完成后，可通过这些链接下载账单文件。

​

如果账单中的数据量过大，扣子编程会将数据拆分为多个文件，每个文件最多包含 50 万行数据。

​

说明

账单文件中的字段说明请参见

账单推送回调事件

。

​

​

created_at

​

Long

​

1743213605

​

任务的创建时间，Unix 时间戳，单位为秒。

​

expires_at

​

Long

​

1743177600

​

任务的过期时间，默认账单将保留 7 天，超过此时间后，无法再下载账单文件。Unix 时间戳，单位为秒。

​

started_at

​

Long

​

1743004800

​

账单上的起始时间。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v1/commerce/benefit/bill_tasks?page_num=1&page_size=50' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json'

​

​

返回示例

​

​

JSON

复制

{

​

"data"

:

{

​

"total"

:

1

,

​

"task_infos"

:

[

​

{

​

"task_id"

:

123

***

,

​

"started_at"

:

1743004800

,

​

"ended_at"

:

1743091200

,

​

"created_at"

:

1743213605

,

​

"expires_at"

:

1743177600

,

​

"file_urls"

:

[

"https://example.com/bill_1.csv"

,

"https://example.com/bill_2.csv"

],

​

"status"

:

"succeed"

​

}

​

]

​

},

​

"code"

:

0

,

​

"msg"

:

""

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

导出终端用户账单

下一篇

查询套餐权益
============================================================
# 查询套餐权益
来源: https://www.coze.cn/open/docs/developer_guides/get_benefit
============================================================

查询套餐权益

查询当前账号的套餐权益信息。

​

接口描述

​

你可以通过本 API 查询当前账号的以下套餐权益信息：

​

所属的套餐类型。

​

扩容管理页面中 API 扩容的信息，包括套餐默认的 API QPS、扩容新增的 API QPS 额度，以及当前实际生效的 API QPS 额度。

​

​

​

​

​

​

套餐权益内通过 MCP 方式调用付费插件的次数限制。

​

基础信息

​

​

请求方式

​

GET

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/commerce/benefit/benefits/get

​

​

权限

​

getBenefit

​

确保调用该接口使用的访问令牌开通了

getBenefit

权限，详细信息参考

鉴权方式

。

​

接口说明

​

查询套餐权益。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

benefit_type_list

​

Array of String

​

可选

​

api_run_qps,call_tool_limit

​

权益类型列表，多个类型用逗号分隔。支持的权益类型如下：

​

api_run_qps

： API 扩容的信息，你需要在

resource_id

中传入待查询的 API 类型。

​

call_tool_limit

：通过 MCP 方式调用付费插件的次数限制。

​

默认为空，即返回订阅的套餐类型，不含额外扩容的权益。

​

resource_id

​

String

​

可选

​

plugin

​

API 类型，当

benefit_type_list

为

api_run_qps

时，需要配置该参数。当前仅支持查询可扩容的 API 类型。枚举值：

​

plugin

：插件相关 API 的 QPS 限制。

​

chat

：对话相关的 API 的 QPS 限制。

​

workflow

：工作流相关的 API 的 QPS 限制。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

data

​

Object of

BenefitData

​

\

​

用户订阅的套餐类型和权益额度的详细信息。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

​

BenefitData

​

​

参数

​

类型

​

示例

​

说明

​

basic_info

​

Object of

BasicInfo

​

{"user_level":"enterprise"}

​

用户订阅的扣子套餐类型。

​

benefit_info

​

Array of

BenefitInfo

​

[{"basic":{"status":"valid","item_info":{"used":100,"total":1000,"end_at":1735689600,"start_at":1735689600,"strategy":"by_quota"}},"extra":[{"status":"valid","item_info":{"used":50,"total":500,"end_at":1735689600,"start_at":1735689600,"strategy":"by_quota"}}],"effective":{"status":"valid","item_info":{"used":200,"total":2000,"end_at":1735689600,"start_at":1735689600,"strategy":"by_quota"}},"resource_id":"plugin","benefit_type":"resource_point"}]

​

权益额度，包含用户当前享有的各项权益详情，如默认的权益、扩容权益及实际生效的权益等。

​

​

BasicInfo

​

​

参数

​

类型

​

示例

​

说明

​

user_level

​

String

​

enterprise

​

用户订阅的扣子套餐类型，枚举值：

​

free

：个人免费版。

​

pro_personal

：个人付费版。

​

team

：企业标准版。

​

enterprise

：企业旗舰版。

​

​

BenefitInfo

​

​

参数

​

类型

​

示例

​

说明

​

basic

​

Object of

BenefitTypeInfoItem

​

{"status":"valid","item_info":{"used":100,"total":1000,"end_at":1735689600,"start_at":1735689600,"strategy":"by_quota"}}

​

默认的权益信息，包含权益的状态、用量及权益配额 ID。

​

extra

​

Array of

BenefitTypeInfoItem

​

[{"status":"valid","item_info":{"used":50,"total":500,"end_at":1735689600,"start_at":1735689600,"strategy":"by_quota"}]

​

资源扩容新增的权益额度。如果未购买扩容服务，则该值为空。

​

effective

​

Object of

BenefitTypeInfoItem

​

{"status":"valid","item_info":{"used":200,"total":2000,"end_at":1735689600,"start_at":1735689600,"strategy":"by_quota"}}

​

当前实际生效的权益额度。

​

resource_id

​

String

​

753754678968821***

​

当前权益对应的资源 ID。当前仅如下 API 类型支持扩容。枚举值：

​

plugin

：插件相关 API 的 QPS 限制。对应的 API 包括

调用插件工具

、

询插件详情

。

​

chat

：对话相关 API 的 QPS 限制。对应的 API 包括：

发起对话

、

查看对话详情

、

查看对话消息详情

。

​

workflow

：工作流相关 API 的 QPS 限制。对应的 API 包括：

执行工作流

、

执行工作流（流式响应）

、

执行对话流

、

查询工作流异步执行结果

、

查询输出节点的执行结果

。

​

benefit_type

​

String

​

resource_point

​

权益配额类型，枚举值：

​

api_run_qps

：扩容管理页面中扩容的 API QPS。

​

call_tool_limit

：通过 MCP 方式调用付费插件的次数限制。

​

​

BenefitTypeInfoItem

​

​

参数

​

类型

​

示例

​

说明

​

status

​

String

​

valid

​

权益状态，表示当前权益的使用状态。枚举值：

​

valid

：正常使用。

​

frozen

：冻结使用。

​

cancel

：取消。

​

pending

：待生效。

​

invalid

：不可用。

​

auditing

：审核中。

​

expired

：已过期。

​

item_info

​

Object of

CommonCounter

​

{"used":100,"total":1000,"end_at":1735689600,"start_at":1735689600,"strategy":"by_quota"}

​

当前权益的使用量、总量、生效时间及资源使用策略。

​

​

CommonCounter

​

​

参数

​

类型

​

示例

​

说明

​

used

​

Double

​

100

​

当

strategy

为

ByQuota

时，表示当前权益的已使用量。若权益无相关用量数据则返回

0

。

​

total

​

Double

​

1000

​

当

strategy

为

ByQuota

时，表示当前权益的用量上限。

​

当

strategy

为

unlimit

或

forbidden

时，该值为 1。

​

end_at

​

Long

​

1735689600

​

权益的结束生效时间，以 Unix 时间戳格式表示，单位为秒。

​

start_at

​

Long

​

1735689600

​

权益的开始生效时间，以 Unix 时间戳格式表示，单位为秒。

​

strategy

​

String

​

by_quota

​

资源使用策略，表示当前权益的资源使用方式。枚举值：

​

unlimit

：不限制用量。

​

forbidden

：不支持调用，该套餐不支持该权益。

​

by_quota

：按额度限制使用。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

查询套餐类型

查询插件 API QPS限制

查询多个权益类型

​

JSON

复制

curl --location --request GET 'https

:

//api.coze.cn/v1/commerce/benefit/benefits/get' \

​

--header 'Authorization

:

Bearer pat_OYDacMzM3WyOWV3Dtj2bHRMymzxP****' \

​

--header 'Content-Type

:

application/json'

​

​

​

返回示例

​

查询套餐类型

查询插件 API QPS限制

​

JSON

复制

{

​

"msg"

:

""

,

​

"data"

:

{

​

"basic_info"

:

{

​

"user_level"

:

"enterprise"

​

}

​

},

​

"detail"

:

{

​

"logid"

:

"20251023180624A0C1***"

​

},

​

"code"

:

0

​

}

​

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

查询账单文件

下一篇

账单推送回调事件
============================================================
# 账单推送回调事件
来源: https://www.coze.cn/open/docs/developer_guides/billing_callback_message
============================================================

账单推送回调事件

如果

开发者订阅了账单推送回调，

用户与智能体对话结束后

，会收到资源点消耗的账单推送回调。订阅回调的具体操作请参见

​

订阅回调

。

​

说明

仅扣子付费套餐支持订阅账单推送事件。

​

对于音视频通话，扣子编程会先推送除音视频通话外的账单回调，音视频通话的账单回调则预计延迟 3 至 5 小时后推送。

​

​

回调结构体

​

消息通知回调的回调结构体 Body 中包括 header 和 event 两个字段。

​

header

参数的参数说明请参见

​

回调事件

。

​

Body 的 event 参数中包括以下参数：

​

​

字段

​

字段类型

​

说明

​

id

​

String

​

账单的 ID。

​

consume_time

​

Bigint

​

资源消耗发生的时间戳，Unix 时间戳，单位为秒。

​

record_root_id

​

String

​

root ID，标识

一次完整对话，用于关联对话全链路数据（包括但不限于智能体、插件、模型等多类型资源消耗记录）。通过该字段可追溯同一会话内的所有费用明细。

​

connector_id

​

String

​

渠道 ID。

标识资源消耗所属的渠道类型，具体如下

：

​

API：1024

​

ChatSDK：999

​

商店：10000010。

​

自定义渠道：自定义渠道 ID，获取方式可以参考

​

渠道入驻概述

。需要保证使用自定义渠道的创建者的访问令牌来进行访问。

​

connector_uid

​

String

​

渠道用户 ID，用于标识渠道内的终端用户身份。

​

device_id

​

String

​

设备 ID。

若上报的设备信息中未包含该字段，则值为空

。

​

custom_consumer

​

String

​

自定义维度的实体 ID，对应上报设备信息时

custom_consumer

参数中的值，具体请参见

​

上报设备信息

。

​

space_id

​

String

​

产生费用的实体所在的空间 ID。例如智能体所在的空间 ID。

​

root_entity_type

​

Bigint

​

产生费用的实体类型：

​

1：智能体（bot）

​

2：工作流（workflow）

​

3：插件（plugin）

​

4：应用（application）

​

5：模型类（model）

​

6：

语音类（voice）

​

root_entity_id

​

String

​

产生费用的实体 ID，例如智能体 ID、工作流 ID 等。

​

说明

若实体类型为

语音类（voice）或模型类（model）

，且未与智能体绑定（例如直接调用语音合成 API），则该字段值为空。

​

​

change_balance

​

String

​

本次对话消耗的资源点或语音通话时长。

​

未增购

AI 智能通话许可

的企业，默认消耗资源点。

​

增购

AI 智能通话许可

的企业，默认先消耗语音通话时长，单

位

为秒。

​

balance_type

​

Bigint

​

余额类型，枚举值：

​

2：resource_point：资源点。

​

3：voice_unified_duration_system，语音通话时长（系统音色），仅增购

AI 智能通话许可（系统音色）

的企业支持。

​

4：voice_unified_duration_custom，语音通话时长（复刻音色），仅增购

AI 智能通话许可（复刻音色）

的企业支持。

​

resource_type

​

Bigint

​

计费项类型：

​

1：模型类（model）

​

2：插件（plugin）

​

3：智能语音（voice），包括语音识别 ASR 和语音合成 TTS

​

4：

RTC

音视频通话

​

resource_id

​

String

​

计费项的 ID，

根据

resource_type

不同，对应的 resource_id 如下：

​

模型类（model）：模型 ID

​

插件（plugin）：插件 ID

​

语音类（voice）或 rtc：具体枚举值如下：

​

Tts_system_text_to_speech_chars：语音合成 - 系统音色文字转语音字数。

​

Asr_large_model_streaming_duration：语音识别 - 大模型流式语音识别时长。

​

Asr_large_model_recording_duration：语音识别 - 大模型录音文件识别时长。

​

Rtc_miniprogram_voice_call_duration：实时音视频 - 小程序语音通话时长。

​

Rtc_voice_call_duration：实时音视频 - 语音通话时长。

​

Rtc_dialog_ai_audio_duration：实时音视频 - 对话式 Al - 音频时长。

​

Rtc_video_call_4k_duration：实时音视频 - 视频通话时长（4K）。

​

Rtc_video_call_2k_duration：实时音视频 - 视频通话时长（2K）。

​

Rtc_video_call_1080p_duration：实时音视频 - 视频通话时长（1080P）。

​

Rtc_video_call_720p_duration：实时音视频 - 视频通话时长（720P）。

​

Rtc_video_call_360p_duration：实时音视频 - 视频通话时长（360P）。

​

model_id

​

String

​

模型 ID。

​

model_input_token

​

Bigint

​

模型输入 Token 数量。

​

model_output_token

​

Bigint

​

模型输出 Token 数量。

​

tts_char_num

​

Bigint

​

文字转语音的字符数。

​

tts_count

​

Bigint

​

文字转语音的调用次数， 即 TTS 小模型合成的次数。

​

asr_audio_length

​

Bigint

​

语音识别（ASR）的音频时长，单位为毫秒。

​

rtc_duration

​

Bigint

​

RTC 音视频通话时长，单位为毫秒。

​

rtc_begin_time

​

Bigint

​

语音通话开始时间，Unix 时间戳，单位为秒。

​

rtc_end_time

​

Bigint

​

语音通话结束时间，Unix 时间戳，单位为秒。

​

​

回

调结构体示例

​

账单推送回调的结构体示例如下：

​

​

​

JSON

复制

{

​

"header"

:

{

​

"event_type"

:

"benefit.usage"

,

​

"event_id"

:

"bc02c5cc-a4c6-4434-9f40-e5978e54ba02-751163889***"

,

​

"created_at"

:

1749042145635

,

​

"api_app_id"

:

"

7511638893163****

"

​

},

​

"event"

:

{

​

"id"

:

"684043e196f22aae6d2b4ba1"

,

​

"consume_time"

:

1749042145

,

​

"record_root_id"

:

"240482016171010"

,

​

"connector_id"

:

"10000010"

,

​

"connector_uid"

:

"1423241851***"

,

​

"device_id"

:

""

,

​

"custom_consumer"

:

""

,

​

"space_id"

:

"750363709788317****"

,

​

"root_entity_id"

:

"751197483247***"

,

​

"root_entity_type"

:

1

,

​

"change_balance"

:

"0.16"

,

​

"balance_type"

:

2

,

​

"resource_type"

:

1

,

​

"resource_id"

:

"1737521***"

,

​

"cost_account_id"

:

"210587***"

,

​

"rtc_begin_time"

:

0

,

​

"rtc_end_time"

:

0

,

​

"tts_char_num"

:

0

,

​

"rtc_duration"

:

0

,

​

"model_output_token"

:

62

,

​

"model_input_token"

:

42

,

​

"model_id"

:

"1737521813"

,

​

"asr_audio_length"

:

0

,

​

"tts_count"

:

0

​

}

​

}

​

​

响应回调

​

开发者服务器收到账单推送回调后，应在 3 秒内

响应

，并在响应中返回 HTTP 状态码 200。

​

相关文档

​

​

订阅回调

​

​

接收并处理回调

​

上一篇

查询套餐权益

下一篇

创建回调应用
============================================================
# 创建回调应用
来源: https://www.coze.cn/open/docs/developer_guides/create_callback_app
============================================================

创建回调应用

本 API 用于创建回调应用，支持创建普通回调应用和渠道回调应用。订阅扣子编程回调功能时需要创建回调应用。

​

接口说明

​

订阅回调

功能支持开发者通过配置回调应用实时获取扣子编程的事件通知。当

智能体发布

、

智能体删除

、

账单生成

等关键业务事件被触发时，扣子编程将向开发者指定的服务器地址发送回调消息。

​

回调分为普通回调和渠道回调，具体说明如下：

​

普通回调应用：开发者在扣子编程中创建回调应用，用于接收扣子编程触发的事件通知。当订阅的事件被触发时，扣子编程会向该回调地址推送回调消息。

​

渠道回调应用：当渠道入驻扣子编程后，开发者可以在该渠道中创建回调应用，用于接收该渠道中触发的事件通知。当订阅的事件被触发时，扣子编程会向渠道指定的回调地址推送回调消息。

​

接口限制

​

扣子个人版中，任何用户均可以创建普通回调应用。仅渠道创建者支持创建对应渠道的回调应用，统一接收该渠道中的回调消息。

​

扣子企业版（企业标准版、企业旗舰版）中，仅超级管理员和管理员可创建回调应用。

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/api_apps

​

​

权限

​

createApiApp

​

确保调用该接口使用的访问令牌开通了

createApiApp

权限，详细信息参考

鉴权方式

。

​

接口说明

​

创建回调应用。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

app_type

​

String

​

必选

​

normal

​

回调应用的类型。枚举值如下：

​

normal

：普通回调应用。

​

connector

：渠道回调应用。

​

name

​

String

​

可选

​

订单回调应用

​

回调应用的名称，当

app_type

为

normal

时需要传入该值。最多 128 个字符。

​

当

app_type

为

connector

时无需填写，扣子编程默认使用渠道名称作为渠道回调应用的名称。

​

connector_id

​

String

​

可选

​

1056899***

​

渠道的 ID，当

app_type

为

connector

时需要传入该值。

​

渠道 ID 的获取方式如下：在扣子编程左下角单击头像，在

账号设置

>

发布渠道

>

企业自定义渠道管理

页面查看渠道 ID。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

ApiApp

​

{"id":"74876004423701****","name":"智能客服机器人回调","app_type":"normal","callback_url":"

https://example.com/api/callback

","connector_id":"1056899***","verify_token":"abc123def456ghi789"}

​

返回扣子编程应用的详细信息，包括应用 ID、名称、类型、回调 URL 和验证令牌等。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含本次请求的详细日志信息，用于问题排查。如果遇到异常报错场景，且反复重试仍然报错，可以根据此日志 ID 联系扣子团队获取帮助。

​

​

ApiApp

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

7512045450401153075

​

回调应用的 ID。

​

name

​

String

​

智能客服机器人回调

​

回调应用的名称。

​

app_type

​

String

​

normal

​

回调应用的类型。枚举值如下：

​

normal

：普通回调应用。

​

connector

：渠道回调应用。

​

callback_url

​

String

​

https://example.com/api/callback

​

回调地址。后续该回调应用订阅的所有回调，均会在触发时向该回调地址发送回调数据。

​

connector_id

​

String

​

1056899***

​

自定义的渠道 ID。仅渠道回调应用会返回该参数。

​

verify_token

​

String

​

OYDacMzM3WyOWV3Dtj2bHRMymzxP****

​

扣子编程会为每个回调应用自动生成一个 Token，不支持手动修改或删除。

​

当扣子编程推送回调时，会携带 Token 签发的签名，用于验证推送的回调是否属于扣子编程推送的合法回调。开发者验证签名的具体操作请参见

接收并处理回调

。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

POST 'https

:

//api.coze.cn/v1/api_apps' \

​

--header 'Authorization

:

Bearer czs_hh19tcCx3qn05X7bG71AGzyD2DjrunJqaAeHORjqZCUydGLRqFhSXWr0SJa******' \

​

--header 'Content-Type

:

application/json'

​

{

"app_type"

:

"normal"

,

"name"

:

"sample api app"

}

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"data"

:

{

​

"id"

:

"752195368553526****"

,

​

"name"

:

"sample api app"

,

​

"app_type"

:

"normal"

,

​

"verify_token"

:

"XzHka769anqJdSfyndM5VM6jPTg2Lcel5YVBHMjfczpQhOR5e6taOt2y12z*****"

​

},

​

"detail"

:

{

​

"logid"

:

"20250714193129A38DEB6D6****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

账单推送回调事件

下一篇

修改回调应用
============================================================
# 修改回调应用
来源: https://www.coze.cn/open/docs/developer_guides/update_callback_app
============================================================

修改回调应用

修改回调应用的名称和回调地址。

​

接口限制

​

扣子个人版中，仅支持修改本人创建的回调应用。

​

扣子企业版中，仅超级管理员和管理员可修改回调应用。

​

基础信息

​

​

请求方式

​

PUT

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/api_apps/:api_app_id

​

​

权限

​

updateApiApp

​

确保调用该接口使用的访问令牌开通了

updateApiApp

权限，详细信息参考

鉴权方式

。

​

接口说明

​

修改回调应用。

​

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

api_app_id

​

String

​

必选

​

752688153695671****

​

待修改的回调应用的 ID。你可以通过

查询回调应用列表

API 获取回调应用的 ID。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

name

​

String

​

可选

​

智能客服回调应用

​

修改后的回调应用名称，用于标识修改后的回调应用身份或用途。

​

callback_url

​

String

​

可选

​

https://api.example.com/callback/updated

​

修改后的回调地址，用于接收扣子编程发送的事件通知。

​

扣子编程会向该地址发送包含

challenge

的 POST 请求进行校验，服务器需在 3 秒内原样返回

challenge

值以验证地址有效性。详情请参考

订阅回调

。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息，主要用于问题排查。如果遇到异常报错场景，且反复重试仍然报错，可以根据此字段中的

logid

联系扣子团队获取帮助。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

​

示例

​

请求示例

​

​

JSON

复制

PUT 'https

:

//api.coze.cn/v1/api_apps/752688153695671****' \

​

--header 'Authorization

:

Bearer czs_lvJ1wCpwGsRYM0pxzCDae0dnvoNTJTXWhivKUHN1xQ9ay8m8ob2frbNx5hbS*****' \

​

--header 'Content-Type

:

application/json'

​

{

"name"

:

"智能客服回调应用"

}

​

返回示例

​

​

JSON

复制

{

​

"detail"

:

{

​

"logid"

:

"2025071419450725A01236138****"

​

},

​

"code"

:

0

,

​

"msg"

:

""

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

创建回调应用

下一篇

查询回调应用列表
============================================================
# 查询回调应用列表
来源: https://www.coze.cn/open/docs/developer_guides/list_callback_app
============================================================

查询回调应用列表

查询回调应用列表。

​

接口限制

​

扣子个人版中，仅支持查看本人创建的回调应用。

​

扣子企业版中，仅超级管理员和管理员可以查看企业的回调应用列表。

​

基础信息

​

​

请求方式

​

GET

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/api_apps

​

​

权限

​

listApiApp

​

确保调用该接口使用的服务令牌开通了

listApiApp

权限，详细信息参考

鉴权方式

。

​

接口说明

​

查询回调应用列表。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

page_token

​

String

​

可选

​

""

​

分页查询时的翻页标识，表示下一页的起始位置。默认为空字符串

""

，即从第一页数据开始返回。如果要查询下一页，需要使用上一次返回的

next_page_token

作为这次请求的入参。

​

page_size

​

Integer

​

可选

​

20

​

每页返回的数据条数，用于分页查询。默认值：50。

​

取值范围：1 ~ 50。

​

app_type

​

String

​

可选

​

normal

​

回调应用的类型。默认为空，查看所有类型的回调应用。枚举值如下：

​

normal

：普通回调应用。

​

connector

：渠道回调应用。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

GetApiAppListOpenRespData

​

{"items":[{"id":"74876004423701****","name":"智能客服机器人回调","app_type":"normal","callback_url":"

https://example.com/api/callback

","verify_token":"OYDacMzM3WyOWV3Dtj2bHRMymzxP****"}],"has_more":true,"next_page_token":"next_page_token_value"}

​

返回的回调应用列表数据，包含分页信息。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含本次请求的日志信息，用于问题排查。

​

​

GetApiAppListOpenRespData

​

​

参数

​

类型

​

示例

​

说明

​

items

​

Array of

ApiApp

​

[{"id":"74876004423701****","name":"智能客服机器人回调","app_type":"normal","callback_url":"

https://example.com/api/callback

","verify_token":"OYDacMzM3WyOWV3Dtj2bHRMymzxP****"}]

​

回调应用列表，包含每个回调应用的详细信息。

has_more

​

Boolean

​

true

​

标识当前返回的回调应用列表是否还有更多数据未返回。

​

true

：还有更多未返回的回调应用。

​

false

：已返回所有数据。

​

next_page_token

​

String

​

1752492196

​

分页 token，用于获取下一页数据。第一页请求时传空，后续请求通过上一个响应返回的

next_page_token

获取下一页数据。

​

​

ApiApp

​

​

参数

​

类型

​

示例

​

说明

​

id

​

String

​

7512045450401153075

​

回调应用的 ID。

​

name

​

String

​

智能客服机器人回调

​

回调应用的名称。

​

app_type

​

String

​

normal

​

回调应用的类型。枚举值如下：

​

normal

：普通回调应用。

​

connector

：渠道回调应用。

​

callback_url

​

String

​

https://example.com/api/callback

​

回调地址。后续该回调应用订阅的所有回调，均会在触发时向该回调地址发送回调数据。

​

connector_id

​

String

​

1056899***

​

自定义的渠道 ID。仅渠道回调应用会返回该参数。

​

verify_token

​

String

​

OYDacMzM3WyOWV3Dtj2bHRMymzxP****

​

扣子编程会为每个回调应用自动生成一个 Token，不支持手动修改或删除。

​

当扣子编程推送回调时，会携带 Token 签发的签名，用于验证推送的回调是否属于扣子编程推送的合法回调。开发者验证签名的具体操作请参见

接收并处理回调

。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

​

示例

​

请求示例

​

​

JSON

复制

GET https

:

//api.coze.cn/v1/api_apps \

​

--header 'Authorization

:

Bearer czs_hh19tcCx3qn05X7bG71AGzyD2DjrunJqaAeHORjqZCUydGLRqFhSXWr*******' \

​

--header 'Content-Type

:

application/json'

​

​

返回示例

​

​

JSON

复制

{

​

"data"

:

{

​

"has_more"

:

false

,

​

"items"

:

[

​

{

​

"name"

:

"api app 1"

,

​

"verify_token"

:

"cZTAkNZMhfapeskz3beBaOvuxcSLqM5o2uQwgIHTgumCUFmDi54WRfIsB1****"

,

​

"callback_url"

:

"https://callback.example.com/callback"

,

​

"id"

:

"751230611020066****"

,

​

"app_type"

:

"normal"

​

},

​

{

​

"verify_token"

:

"qrwk0rqd843N4SKvyxoHY4yHSsvde0p8IWOH2ef0cR2FWahyxB1Evhl5y****"

,

​

"callback_url"

:

"https://callback.example.com/callback"

,

​

"id"

:

"751230611020070****"

,

​

"app_type"

:

"normal"

,

​

"name"

:

"api app 2"

​

}

​

]

​

},

​

"detail"

:

{

​

"logid"

:

"20250714193443C60E2B008BF****"

​

},

​

"code"

:

0

,

​

"msg"

:

""

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

修改回调应用

下一篇

删除回调应用
============================================================
# 删除回调应用
来源: https://www.coze.cn/open/docs/developer_guides/delete_callback_app
============================================================

删除回调应用

删除回调应用。

​

如果不再需要接收扣子编程回调，可以删除回调应用。一旦删除，该回调应用所订阅的所有回调事件触发时，将不再向该回调应用推送通知。

​

接口限制

​

扣子个人版中，仅支持删除本人创建的回调应用。

​

扣子企业版中，仅超级管理员和管理员可删除回调应用。

​

基础信息

​

​

请求方式

​

DELETE

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/api_apps/:api_app_id

​

​

权限

​

deleteApiApp

​

确保调用该接口使用的访问令牌开通了

deleteApiApp

权限，详细信息参考

鉴权方式

。

​

接口说明

​

删除回调应用。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

api_app_id

​

String

​

必选

​

75268815369567*****

​

待删除的回调应用的 ID。你可以通过

查询回调应用列表

API 获取回调应用的 ID。

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

DELETE 'https

:

//api.coze.cn/v1/api_apps/75268815369567*****' \

​

--header 'Authorization

:

Bearer pat_Elfvzxu8OofVLUS8tHwBDd4ZCfj7N3IAc1hr6tRdnqiDthUJpu2m1EeitXq*****' \

​

--header 'Content-Type

:

application/json'

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20250714194722A3C36B7A****"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

查询回调应用列表

下一篇

订阅回调事件
============================================================
# 订阅回调事件
来源: https://www.coze.cn/open/docs/developer_guides/subscribe_callback_message
============================================================

订阅回调事件

订阅回调事件。

​

接口描述

​

扣子编程当前支持的回调事件和使用限制请参考

回调事件

。

​

基础信息

​

​

请求方式

​

POST

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/api_apps/:api_app_id/events

​

​

权限

​

subscribeApiAppEvent

​

接口说明

​

订阅回调事件。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

api_app_id

​

String

​

必选

​

752690322532938****

​

回调应用的 ID。你可以通过

查询回调应用列表

API 获取回调应用的 ID。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

event_types

​

Array of String

​

必选

​

["bot.published"]

​

待订阅的回调事件列表，目前支持的事件类型包括：

​

bot.published

：智能体发布事件。

​

bot.deleted

：智能体删除事件。

​

bot.unpublished

：智能体下架事件。

​

benefit.usage

：账单推送回调。

​

benefit.plugin.scale.requested

：申请插件扩容事件。

​

benefit.plugin.scale.expired

：插件扩容到期事件。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息，主要用于问题排查。

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

POST 'https

:

//api.coze.cn/v1/api_apps/752690322532938****/events' \

​

--header 'Authorization

:

Bearer czs_l8wA17hHrFts8ebCe9RxrjDBJvJJhXyxHQK1I8hEcu8cGsQm8LPI6Xs4LHyjd****' \

​

--header 'Content-Type

:

application/json'

​

{

"event_types"

:

[

"bot.published"

,

"bot.deleted"

]}

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"detail"

:

{

​

"logid"

:

"20250714194855054D95BD7A6DA74233D7"

​

}

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

上一篇

删除回调应用

下一篇

查询已订阅的事件
============================================================
# 查询已订阅的事件
来源: https://www.coze.cn/open/docs/developer_guides/list_subscribed_callback_message
============================================================

查询已订阅的事件

查询回调应用中已订阅的事件。

​

接口限制

​

扣子个人版中，仅回调应用的创建者可以查看已订阅的事件。

​

扣子企业版中，仅超级管理员和管理员可以查看回调应用中已订阅的事件。

​

基础信息

​

​

请求方式

​

GET

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/api_apps/:api_app_id/events

​

​

权限

​

listApiApp

​

确保调用该接口使用的服务令牌开通了

listApiApp

权限，详细信息参考

鉴权方式

。

​

接口说明

​

查询回调应用中已订阅的事件。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer

$Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

api_app_id

​

String

​

可选

​

7512045450401153075***

​

回调应用的 ID。你可以通过

查询回调应用列表

API 获取回调应用的 ID。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

page_token

​

String

​

可选

​

\

​

分页查询时的翻页标识，表示下一页的起始位置。默认为

""

，即从第一页数据开始返回。如果要查询下一页，需要使用上一次返回的

next_page_token

作为这次请求的入参。

​

page_size

​

Integer

​

可选

​

20

​

每页返回的数据条数，用于分页查询。默认值：50。

​

取值范围：1 ~ 50。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

ListSubscribedApiAppEventOpenRespData

​

{"items":[{"name":"智能客服机器人回调","api_app_id":"752690322532938****","event_type":"bot.published","description":"智能客服机器人回调应用，用于处理用户与机器人的交互事件。"}],"has_more":true,"next_page_token":"eyJwYWdlX3Rva2VuIjoiMTIzNDU****"}

​

包含回调应用的信息列表及分页信息。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息的对象，主要用于记录请求的日志 ID 以便于排查问题。

​

​

ListSubscribedApiAppEventOpenRespData

​

​

参数

​

类型

​

示例

​

说明

​

items

​

Array of

ApiAppEventOpen

​

[{"name":"智能客服机器人回调","api_app_id":"cli_a1b2c3d4e5f6g7h8","event_type":"bot.published","description":"智能客服机器人回调应用，用于处理用户与机器人的交互事件。"}]

​

回调应用的信息列表，包含每个回调应用的名称、ID、事件类型和描述。

has_more

​

Boolean

​

true

​

标识当前返回的回调应用列表是否还有更多数据未返回。

​

true

：还有更多未返回的回调应用。

​

false

：已返回所有数据。

​

next_page_token

​

String

​

eyJwYWdlX3Rva2VuIjoiMTIzNDU****

​

翻页标识，表示下一页的起始位置。当

has_more

为

true

时，表示还有更多数据未返回，可以通过此令牌获取下一页数据。首次请求不填或置空，后续翻页需使用上一次返回的

next_page_token

。

​

​

ApiAppEventOpen

​

​

参数

​

类型

​

示例

​

说明

​

name

​

String

​

智能客服机器人回调应用

​

回调应用的名称。

​

api_app_id

​

String

​

752690322532938****

​

回调应用的 ID。

​

event_type

​

String

​

bot.published

​

回调事件类型，目前支持的事件类型包括：

​

bot.published

：智能体发布事件。

​

bot.deleted

：智能体删除事件。

​

bot.unpublished

：智能体下架事件。

​

benefit.usage

：账单推送回调。

​

benefit.plugin.scale.requested

：申请插件扩容事件。

​

benefit.plugin.scale.expired

：插件扩容到期事件。

​

description

​

String

​

智能客服机器人回调应用，用于处理用户与机器人的交互事件。

​

回调应用的描述信息，用于说明回调应用的功能或用途。

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

GET 'https

:

//api.coze.cn/v1/api_apps/752690322532938****/events' \

​

--header 'Authorization

:

Bearer czs_l8wA17hHrFts8ebCe9RxrjDBJvJJhXyxHQK1I8hEcu8cGsQm8LPI6Xs4LHyj*****' \

​

--header 'Content-Type

:

application/json'

​

{

"event_types"

:

[

"bot.published"

,

"bot.deleted"

]}

​

返回示例

​

​

JSON

复制

{

​

"data"

:

{

​

"has_more"

:

false

,

​

"items"

:

[

​

{

​

"description"

:

"智能体已被所有者删除"

,

​

"event_type"

:

"bot.deleted"

,

​

"api_app_id"

:

"752690322532938****"

,

​

"name"

:

"智能音箱回调应用"

​

}

​

]

​

},

​

"detail"

:

{

​

"logid"

:

"202507141951091846A5E****"

​

},

​

"code"

:

0

,

​

"msg"

:

""

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

订阅回调事件

下一篇

取消订阅事件
============================================================
# 取消订阅事件
来源: https://www.coze.cn/open/docs/developer_guides/unsubscribe_callback_message
============================================================

取消订阅事件

如果不再需要订阅某个回调事件，可以取消订阅。一旦取消订阅，对应回调事件触发时，将不再向该回调地址推送通知。

​

接口限制

​

扣子个人版中，仅回调应用的创建者能取消订阅对应回调应用中的事件。

​

扣子企业版（企业标准版、企业旗舰版）中，仅超级管理员和管理员可取消订阅事件。

​

基础信息

​

​

请求方式

​

DELETE

​

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/api_apps/:api_app_id/events

​

​

权限

​

unsubscribeApiAppEvent

​

确保调用该接口使用的服务令牌开通了

unsubscribeApiAppEvent

权限，详细信息参考

鉴权方式

。

​

接口说明

​

取消订阅事件。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $Access_Token

​

用于验证客户端身份的访问令牌。你可以在扣子编程中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Path

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

api_app_id

​

String

​

必选

​

3336789234***

​

回调应用的 ID。你可以通过

查询回调应用列表

API 获取回调应用的 ID。

​

​

Body

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

event_types

​

Array of String

​

必选

​

["bot.published"]

​

待取消订阅的回调事件类型，目前支持的事件类型包括：

​

bot.published

：智能体发布事件。

​

bot.deleted

：智能体删除事件。

​

bot.unpublished

：智能体下架事件。

​

benefit.usage

：账单推送回调。

​

benefit.plugin.scale.requested

：申请插件扩容事件。

​

benefit.plugin.scale.expired

：插件扩容到期事件。

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。0 表示调用成功，其他值表示调用失败，你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

detail

​

Object of

ResponseDetail

​

{"logid":"20241210152726467C48D89D6DB2****"}

​

包含请求的详细信息，主要用于问题排查。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

示例

​

请求示例

​

​

JSON

复制

DELETE 'https

:

//api.coze.cn/v1/api_apps/7526903225329385****/events' \

​

--header 'Authorization

:

Bearer czs_l8wA17hHrFts8ebCe9RxrjDBJvJJhXyxHQK1I8hEcu8cGsQm8LPI6Xs4LHyjd****' \

​

--header 'Content-Type

:

application/json'

​

{

"event_types"

:

[

"bot.published"

]}

​

返回示例

​

​

JSON

复制

{

​

"detail"

:

{

​

"logid"

:

"202507141950092C6B40*****"

​

},

​

"code"

:

0

,

​

"msg"

:

""

​

}

​

错误码

​

如果成功调用扣子编程的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

查询已订阅的事件

下一篇

【Deprecated】查看已发布智能体列表
============================================================
# 【Deprecated】查看已发布智能体列表
来源: https://www.coze.cn/open/docs/developer_guides/published_bots_list
============================================================

【Deprecated】查看已发布智能体列表

查看指定空间发布到 Agent as API 渠道的智能体列表。

​

说明

该 API 即将下线，建议替换为新版的 API

查看智能体列表

。

​

此接口仅支持查看已发布为 API 服务的智能体列表。对于创建后从未发布到 API 渠道的 Bot，可以在

扣子平台

中查看列表及配置。

​

​

基础信息

​

​

请求方式

​

GET

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/space/published_bots_list

​

权限

​

getPublishedBot

​

确保调用该接口使用的访问令牌开通了

getPublishedBot

权限，详细信息参考

鉴权方式

。

​

接口说明

​

调用接口查看指定空间发布到 Agent as API 渠道的智能体列表。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $AccessToken

​

用于验证客户端身份的访问令牌。你可以在扣子平台中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

space_id

​

String

​

必选

​

737620236629291****

​

智能体所在的空间的 Space ID。Space ID 是空间的唯一标识。

​

进入指定空间，空间页面 URL 中

space

参数后的数字就是 Space ID。例如

https://www.coze.cn/space/736163827687053****/bot

，Space ID

为736163827687053****

。

​

page_index

​

Integer

​

可选

​

1

​

分页查询时的页码。默认为 1，即从第一页数据开始返回。

​

page_size

​

Integer

​

可选

​

10

​

分页大小。默认为 20，即每页返回 20 条数据。

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

状态码。

​

0

代表调用成功。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

SpacePublishedBotsInfo

​

{ "space_bots": [ { "bot_id": "737965697151719****", "bot_name": "图片生成文本", "description": "根据图片生成文本", "icon_url": "

https://lf3-appstore-sign.oceancloudapi.com/ocean-cloud-tos/FileBizType.BIZ_BOT_ICON/default_bot_icon3.png?lk3s=50ccb0c5&x-expires=1718343510&x-signature=Y2dTjqx6Oa1RtevCZPe2

***", "publish_time": "1718212388" }, { "bot_id": "737946218936519****", "bot_name": "当代毕加索", "description": "根据用户描述自动生成毕加索油画风格的图片", "icon_url": "

https://lf26-appstore-sign.oceancloudapi.com/ocean-cloud-tos/FileBizType.BIZ_BOT_ICON/2667858400903179_17181861478

***

.jpeg?lk3s=50ccb0c5&x-expires=1718343510&x-signature=2FQ6%2FHmyswKDBdeTR

***", "publish_time": "1718209964" } ], "total": 2 }

​

智能体列表及总数信息。

​

detail

​

Object of

ResponseDetail

​

​

{ "logid": "20250106172024B5F607030EFFAD653960" }

​

返回详情。

​

​

SpacePublishedBotsInfo

​

​

参数

​

类型

​

示例

​

说明

​

total

​

Integer

​

5

​

智能体列表中的智能体总数。

​

space_bots

​

Array of

SpacePublishedBots

​

[ { "bot_id": "737965697151719****", "bot_name": "图片生成文本", "description": "根据图片生成文本", "icon_url": "

https://lf3-appstore-sign.oceancloudapi.com/ocean-cloud-tos/FileBizType.BIZ_BOT_ICON/default_bot_icon3.png?lk3s=50ccb0c5&x-expires=1718343510&x-signature=Y2dTjqx6Oa1RtevCZP

***", "publish_time": "1718212388" }, { "bot_id": "737946218936519****", "bot_name": "当代毕加索", "description": "根据用户描述自动生成毕加索油画风格的图片", "icon_url": "

https://lf26-appstore-sign.oceancloudapi.com/ocean-cloud-tos/FileBizType.BIZ_BOT_ICON/2667858400903179_17181861

***

.jpeg?lk3s=50ccb0c5&x-expires=1718343510&x-signature=2FQ6%2FHmyswKDBdeTROTO

***", "publish_time": "1718209964" } ]

​

指定空间发布到 Agent as API 渠道的智能体列表。

​

​

SpacePublishedBots

​

​

参数

​

类型

​

示例

​

说明

​

bot_id

​

String

​

737965697151719****

​

智能体的唯一标识。

​

bot_name

​

String

​

图片生成文本

​

智能体的名称。

​

description

​

String

​

根据图片生成文本

​

智能体的描述。

​

icon_url

​

String

​

https://lf3-appstore-sign.oceancloudapi.com/ocean-cloud-tos/FileBizType.BIZ_BOT_ICON/default_bot_icon3.png?lk3s=50ccb0c5&x-expires=1718343510&x-signature=Y2dTjqx6Oa1RtevCZPe27k4RKbs%3D

​

智能体的头像。

​

publish_time

​

String

​

1718212388

​

智能体的最近一次发布时间，格式为 10 位的 Unixtime 时间戳。此 API 返回的智能体列表按照此字段降序排列。

​

​

ResponseDetail

​

​

参数

​

类型

​

示例

​

说明

​

logid

​

String

​

20241210152726467C48D89D6DB2****

​

本次请求的日志 ID。如果遇到异常报错场景，且反复重试仍然报错，可以根据此 logid 及错误码联系扣子团队获取帮助。详细说明可参考

获取帮助和技术支持

。

​

​

​

示例

​

请求示例

​

​

JSON

复制

GET https

:

//api.coze.cn/v1/space/published_bots_list?space_id=737620236629291****

​

​

返回示例

​

​

JSON

复制

{

​

"code"

:

0

,

​

"msg"

:

""

,

​

"data"

:

{

​

"space_bots"

:

[

​

{

​

"bot_id"

:

"737965697151719****"

,

​

"bot_name"

:

"图片生成文本"

,

​

"description"

:

"根据图片生成文本"

,

​

"icon_url"

:

"https://lf3-appstore-sign.oceancloudapi.com/ocean-cloud-tos/FileBizType.BIZ_BOT_ICON/default_bot_icon3.png?lk3s=50ccb0c5&x-expires=1718343510&x-signature=Y2dTjqx6Oa1RtevCZPe27k4RKbs%3D"

,

​

"publish_time"

:

"1718212388"

​

},

​

{

​

"bot_id"

:

"737946218936519****"

,

​

"bot_name"

:

"当代毕加索"

,

​

"description"

:

"根据用户描述自动生成毕加索油画风格的图片"

,

​

"icon_url"

:

"https://lf26-appstore-sign.oceancloudapi.com/ocean-cloud-tos/FileBizType.BIZ_BOT_ICON/2667858400903179_1718186147899963557.jpeg?lk3s=50ccb0c5&x-expires=1718343510&x-signature=2FQ6%2FHmyswKDBdeTROTOn0IYyrA%3D"

,

​

"publish_time"

:

"1718209964"

​

}

​

],

​

"total"

:

2

​

}

​

}

​

错误码

​

如果成功调用扣子的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

​

上一篇

取消订阅事件

下一篇

获取已发布智能体的配置（即将下线）
============================================================
# 获取已发布智能体的配置（即将下线）
来源: https://www.coze.cn/open/docs/developer_guides/get_metadata
============================================================

获取已发布智能体的配置（即将下线）

获取指定智能体的配置信息，此智能体必须已发布到 Agent as API 渠道中。

​

此接口仅支持查看已发布为 API 服务的智能体。对于创建后从未发布到 API 渠道的智能体，可以在

扣子平台

中查看列表及配置。

​

说明

该 API 即将下线，建议替换为

查看智能体配置

API。

​

​

基础信息

​

​

请求方式

​

GET

请求地址

​

​

Plain Text

复制

https://api.coze.cn/v1/bot/get_online_info

​

权限

​

getMetadata

​

确保调用该接口使用的个人令牌开通了 getMedata 权限，详细信息参考

鉴权方式

。

​

接口说明

​

获取指定智能体的配置信息，此智能体必须已发布到 Agent as API 渠道中。

​

​

请求参数

​

Header

​

​

参数

​

取值

​

说明

​

Authorization

​

Bearer $AccessToken

​

用于验证客户端身份的访问令牌。你可以在扣子平台中生成访问令牌，详细信息，参考

准备工作

。

​

Content-Type

​

application/json

​

解释请求正文的方式。

​

​

Query

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

bot_id

​

String

​

必选

​

73428668*****

​

要查看的智能体 ID。

​

进入智能体的 开发页面，开发页面 URL 中

bot

参数后的数字就是智能体 ID。例如

https://www.coze.cn/space/341****/bot/73428668*****

，bot ID 为

73428668*****

。

​

Tip

确保该智能体的所属空间已经生成了访问令牌。

​

​

​

返回参数

​

​

参数

​

类型

​

示例

​

说明

​

code

​

Long

​

0

​

调用状态码。

​

0

表示调用成功。

​

其他值表示调用失败。你可以通过 msg 字段判断详细的错误原因。

​

msg

​

String

​

""

​

状态信息。API 调用失败时可通过此字段查看详细错误信息。

​

状态码为 0 时，msg 默认为空。

​

data

​

Object of

BotInfo

​

参考返回示例部分

​

响应的业务信息。

​

detail

​

Object of

ResponseDetail

​

{ "logid": "20250106172024B5F607030EFFAD653960" }

​

响应详情信息。

​

​

BotInfo

​

​

PromptInfo

​

​

PrefixPromptInfo

​

​

OnboardingInfoV2

​

​

PluginInfo

​

​

ApiInfo

​

​

ModelInfo

​

​

CommonKnowledge

​

​

KnowledgeInfo

​

​

Variable

​

​

MediaConfig

​

​

Voice

​

​

ShortcutCommandInfo

​

​

ShortcutCommandToolInfo

​

​

WorkflowInfo

​

​

BackgroundImageInfo

​

​

BackgroundImageDetail

​

​

CanvasPosition

​

​

GradientPosition

​

​

ResponseDetail

​

​

示例

​

请求示例

​

​

返回示例

​

​

错误码

​

如果成功调用扣子的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以参考

错误码

文档查看对应的解决方法。

​

上一篇

【Deprecated】查看已发布智能体列表

下一篇

错误码
============================================================
# 错误码
来源: https://www.coze.cn/open/docs/developer_guides/coze_error_codes
============================================================

错误码

如果成功调用扣子

编程

的 API，返回信息中 code 字段为 0。如果状态码为其他值，则表示接口调用失败。此时 msg 字段中包含详细错误信息，你可以根据下表查看对应的解决方法。

​

说明

如需获取帮助，请记录以下错误信息，并联系扣子技术支持，我们将协助您排查问题。

​

Response header 中的 X-Tt-Logid 字段值，例如

20240708143040790E78F9318B35A2910B

。你可以在使用 curl 发起请求时通过

-i

参数打印 Response header 完整内容。

​

Response Body 中的 code、msg 字段值，例如

{ "code": 700012006, "msg": "access token invalid" }

。

​

​

​

code

​

msg

​

说明

​

4000

​

请求参数错误

​

原因：请求参数错误，主要原因包括参数格式错误、必选参数缺失等。

​

解决方案：请参考 API 文档检查请求参数。

​

4001

​

Invalid chat（包括chat id错误，chat 找不到）

​

原因：指定对话不存在。主要原因包括 chat id 错误、当前账号无此 chat 的权限等。

​

解决方案：请检查 chat id 后重试。

​

4002

​

invalid conversation（包括conversation id错误，conversation 找不到）

​

原因：指定会话不存在。主要原因包括 conversation id 错误、当前账号无此 conversation 的权限等。

​

解决方案：请检查 conversation id 后重试。

​

4003

​

meta data 超过限制

​

​

原因：meta_data 字段的传参超出字段限制。

​

解决方案：请参考 API 文档检查请求参数。

​

4004

​

additional messages超过限制

​

​

原因：additional_messages 字段的传参超出字段限制。

​

解决方案：请参考 API 文档检查请求参数。

​

4005

​

invalid message（包括message id错误，message content错误）

​

原因：指定消息不存在。主要原因包括 message id 错误、当前账号无此 message 的权限、content 内容不符合要求等。

​

解决方案：请检查 message id 和 content 后重试。

​

4006

​

invalid bot（包括bot id错误，bot 找不到）

​

原因：指定智能体不存在。主要原因包括智能体id 错误、当前账号无此智能体的权限等。

​

解决方案：请检查智能体id 后重试。

​

4007

​

流false仅在自动保存为true时允许

​

原因：非流式响应下（stream=false），auto_save_history 必须设置为 true，即保存历史对话，否则无法查看对话状态和模型回复。

​

解决方案：修改请求参数设置，详细说明可参考

​

发起对话

。

​

4008

​

用户限流

​

​

原因：调用频率达到上限。当日智能体使用次数超过限制或 API 的 QPS 超出了限制。

​

解决方案：请稍后再试或明日再试。

​

4009

​

已达系统请求

上限，

请稍后重试

​

​

原因：当前使用人数过多。

​

解决方案：请稍后再试。

​

4010

​

当前问题请求的 prompt token 数量超过模型上限

​

​

原因：当前问题请求的 prompt token 数量超过模型上限。

​

解决方案：建议缩短问题长度后重试。

​

4011

​

当前账户的 Coze Token 余额不足

​

​

原因：当前账户的 Coze Token 余额不足。

​

解决方案：建议充值后重试。

​

4012

​

invalid model

​

原因：无效模型，可能原因包括模型从扣子编程下架等。

​

解决方案：建议更换智能体的模型之后重试。

​

4013

​

模型错误

​

原因：模型服务报错。

​

解决方案：建议稍后重试。

​

4014

​

问题无法回答

​

原因：智能体无法回答此问题。

​

解决方案：请更换问题后重试。

​

4015

​

bot 未发布到API

​

原因：此智能体未发布为 API 服务。

​

解决方案：请参考

​

准备工作

完成 API 调用前的准备工作。

​

4016

​

当前会话已有chat在运行

​

原因：当前会话中已有运行中的对话，请等待对话完成后再发起新的对话

。

​

解决方案：请更换会话后重试。

​

4019

​

火山Bot调用按量余额不足

​

原因：账号已欠费。

​

解决方案：为了不影响产品的正常使用，请及时充值。

​

4020

​

火山Bot调用超出RPM峰值

​

原因：当前 RPM 已超出购买的额度。

​

解决方案：为了不影响产品的正常使用，请增加 RPM 的额度。

​

4021

​

工作流未配置

​

原因：当前会话中已有运行中的对话，请等待对话完成后再发起新的对话。

​

解决方案：请更换会话后重试。

​

4022

​

模型欠费

​

原因：火山方舟模型服务已欠费。

​

解决方案：为了不影响产品的正常使用，请及时结清欠款恢复账号。

​

4028

​

Insufficient coze credits balance, please wait for the quota refresh or upgrade to paid version.

​

原因：个人版订阅套餐积分不足。

​

解决方案：增购积分或者升级订阅套餐。

​

4100

​

身份验证无效

​

原因：个人访问令牌（PAT）不正确。

​

解决方案：请检查后重试。

​

4101

​

没有权限访问该资源

​

原因：当前使用的个人访问令牌没有权限访问该资源。

​

解决方案：请检查个人访问令牌的权限后重试。

​

4102

​

命中风控拦截

​

原因：系统检测到异常活动。

​

解决方案：请稍后重试。若持续报错，请根据此错误码和 X-Tt-Logid 提交反馈，帮助我们快速定位问题。

​

4104

​

当前对话不支持取消

​

原因：

当前的对话状态为 completed、failed 或 requires_action

，不支持取消对话。

​

解决方案：确认对话 ID 和对话状态。

​

4105

​

内容包含敏感信息,请修改后重新提交

​

原因：当前发布智能体包含敏感信息。

​

解决方案：请检查智能体的人设及回复逻辑、开场白等配置，删除敏感词后重新尝试发布。

​

4200

​

资源未找到

​

原因：未找到该资源，主要原因包括资源 ID 错误、此资源并非由当前账号创建等。

​

解决方案：建议检查资源 ID 后重试。

​

4201

​

企业/团队人员已存在，请勿重复添加。

​

组织成员已经存在，请不要重复加入。

​

原因：待添加的人员已在目标企业 / 团队 / 组织中，重复发起添加操作。

​

解决方案：建议检查目标企业 / 团队 / 组织中是否已存在待添加人员，如已存在，请勿重复添加。

​

4300

​

上传文件时文件为空

​

原因：待上传的文件为空，主要原因为指定的文件名称或路径不存在、请求头 Content-Type 未指定为 multipart/form-data 等。

​

解决方案：建议参考 API 文档检查相关设置。

​

4301

​

文件上传时超过一个

​

原因：每次调用上传文件接口，只能上传一个文件。

​

解决方案：建议分批上传。

​

4302

​

文件上传大小超过限制

​

原因：待上传的文件大小超出接口限制。

​

解决方案：建议更换文件后重试。其他限制可参考

​

上传文件

。

​

4303

​

文件类型不支持

​

原因：文件格式问题，暂不支持上传此类型的文件。

​

解决方案：其他限制可参考

​

上传文件

。

​

4304

​

文件无效

​

原因：文件故障等问题。

​

解决方案：建议更换文件后重试。

​

4314

​

未找到执行记录

​

原因：没有找到指定工作流的该执行记录。

​

解决方案：建议更换 execute_id 或 workflow_id 后重试。

​

4315

​

执行已结束

​

原因：工作流执行结束，无法恢复运行。

​

解决方案：确认工作流 ID 是否正确。

​

5000

​

服务器内部错误

​

原因：服务端内部错误。

​

解决方案：请稍后重试。若持续报错，请根据此错误码提交反馈，帮助我们快速定位问题。

​

​

​

上一篇

获取已发布智能体的配置（即将下线）

下一篇

API 常见问题
============================================================
# API 常见问题
来源: https://www.coze.cn/open/docs/developer_guides/api_faq
============================================================

API 常见问题

调用非流式接口时，返回结果中为什么没有数据？

​

流式 API

：调用时会在返回结果中直接包含模型生成的内容。

​

非流式 API

：响应消息中

不会即时返回模型生成的内容

，需通过后续 API 查询结果。例如：调用

​

发起对话

API 时，如果设置 stream=false，你需要通过如下方法查询模型生成的内容：

​

a.

记录

​

发起对话

API 响应中返回的

chat_id

和

conversation_id

。

​

b.

调用

​

查看对话详情

API 确认本次对话处理已结束。

​

c.

调用

​

查看对话消息详情

API 查看模型回复的内容。

​

调用发起对话 API 时，工作流能异步运行吗？

​

调用

​

发起对话

API 可与智能体进行对话，如果智能体中绑定了工作流，调用该 API 运行智能体内的工作流时，工作流将以同步方式运行，且不支持配置为异步运行。

​

​

上一篇

错误码

下一篇

模型能力差异
============================================================
# 模型能力差异
来源: https://www.coze.cn/open/docs/developer_guides/model_api_param_support
============================================================

模型能力差异

调用

​

创建智能体

或

​

更新智能体

API 时，仅部分模型支持配置前缀缓存和深度思考相关参数，各模型对这些特定参数的支持情况如下表所示，其他参数为通用参数所有模型都支持。

​

​

模型名称

​

模型版本

​

prefix_prompt_info（前缀缓存提示词）

​

cache_type（Context API 前缀缓存）

​

parameters（Responses API 前缀缓存）

​

parameters（深度思考）

​

api_mode（Responses API）

​

top_p

​

temperature

​

豆包·编程

​

Doubao-Seed-Code

​

✔️

​

-

​

✔️

​

✔️

​

✔️

​

-

​

-

​

豆包・1.6・极致速度・250828

​

Doubao-seed-1.6-flash-250828

​

✔️

​

-

​

✔️

​

✔️

​

✔️

​

✔️

​

✔️

​

豆包・1.6・思考深度调节

​

doubao-seed-1-6-251015

​

✔️

​

-

​

✔️

​

✔️

​

✔️

​

✔️

​

✔️

​

豆包・1.6・lite・251015

​

doubao-seed-1.6-lite

​

✔️

​

-

​

✔️

​

-

​

✔️

​

✔️

​

✔️

​

豆包・1.6・极致速度・250715

​

Doubao-seed-1.6-flash-250715

​

✔️

​

-

​

✔️

​

✔️

​

✔️

​

✔️

​

✔️

​

豆包・1.6・极致速度

​

doubao-seed-1-6-flash-250615

​

✔️

​

-

​

✔️

​

✔️

​

✔️

​

✔️

​

✔️

​

豆包・1.6・深度思考・250715

​

Doubao-1.6-thinking-250715

​

✔️

​

-

​

✔️

​

-

​

✔️

​

-

​

-

​

豆包・1.6・深度思考

​

Doubao-Seed-1.6-thinking

​

✔️

​

-

​

✔️

​

-

​

✔️

​

-

​

-

​

豆包・1.6・自动深度思考

​

Doubao-Seed-1.6-250615

​

✔️

​

-

​

✔️

​

✔️

​

✔️

​

✔️

​

✔️

​

豆包・1.6・视觉理解・250815

​

doubao-seed-1-6-vision-250815

​

✔️

​

-

​

✔️

​

-

​

✔️

​

✔️

​

✔️

​

豆包・1.5・Pro・深度思考・128K

​

Doubao-1.5-thinking-pro/250415

​

-

​

-

​

-

​

-

​

-

​

✔️

​

✔️

​

豆包・1.5・Pro・32k

​

Doubao-1.5-pro-32k

​

✔️

​

✔️

​

-

​

-

​

-

​

✔️

​

✔️

​

豆包・1.5・Lite・32k

​

Doubao-1.5-lite-32k/250115

​

✔️

​

✔️

​

-

​

-

​

-

​

✔️

​

✔️

​

豆包・1.5・Pro・视觉理解・Lite

​

doubao-1.5-vision-lite-250315

​

-

​

-

​

-

​

-

​

-

​

✔️

​

✔️

​

豆包・1.5・Pro・视觉深度思考

​

doubao-1-5-thinking-vision-pro-250428

​

-

​

-

​

-

​

✔️

​

-

​

✔️

​

✔️

​

豆包・1.5・Pro・视觉推理・128K

​

Doubao-1.5-thinking-pro/m-250415

​

-

​

-

​

-

​

-

​

-

​

✔️

​

✔️

​

豆包・1.5・Pro・视觉理解 - 250328

​

doubao-1.5-vision-pro-250328

​

-

​

-

​

-

​

-

​

-

​

✔️

​

✔️

​

豆包・1.5・Pro・视觉理解

​

Doubao-1.5-pro-vision-32k/250115

​

-

​

-

​

-

​

-

​

-

​

✔️

​

✔️

​

豆包・1.5・Pro・角色扮演・250715

​

Doubao-1.5-pro-32k-character-250715

​

-

​

-

​

-

​

-

​

-

​

✔️

​

✔️

​

豆包・1.5・Pro・角色扮演

​

doubao-1-5-pro-32k-character-250228

​

-

​

-

​

-

​

-

​

-

​

✔️

​

✔️

​

豆包・GUI・Agent 模型

​

Doubao-1.5-UI-TARS

​

-

​

-

​

-

​

✔️

​

-

​

✔️

​

✔️

​

豆包・通用模型・Lite

​

Doubao-lite

​

-

​

-

​

-

​

-

​

-

​

✔️

​

✔️

​

DeepSeek-R1/250528

​

DeepSeek-R1/250528

​

-

​

-

​

-

​

-

​

-

​

✔️

​

✔️

​

DeepSeek-V3 工具调用

​

V3 functionCall 版本

​

-

​

-

​

-

​

-

​

-

​

✔️

​

✔️

​

DeepSeek-V3-0324

​

DeepSeek-chat

​

✔️

​

✔️

​

-

​

-

​

-

​

✔️

​

✔️

​

DeepSeek-V3.1

​

DeepSeek-V3.1

​

✔️

​

-

​

✔️

​

-

​

✔️

​

✔️

​

✔️

​

阶跃星辰・1.5v・视频理解

​

step-1.5v-mini

​

-

​

-

​

-

​

-

​

-

​

✔️

​

✔️

​

阶跃星辰・1v・图片理解

​

step-1v-8k

​

-

​

-

​

-

​

-

​

-

​

✔️

​

✔️

​

Kimi-K2-250905

​

Kimi-K2-250905

​

✔️

​

-

​

✔️

​

-

​

✔️

​

-

​

-

​

Kimi-8k

​

moonshot-v1-8k

​

-

​

-

​

-

​

-

​

-

​

✔️

​

✔️

​

Kimi-32k

​

moonshot-v1-32k

​

-

​

-

​

-

​

-

​

-

​

✔️

​

✔️

​

Kimi-128k

​

moonshot-v1-128k

​

-

​

-

​

-

​

-

​

-

​

✔️

​

✔️

​

​

​

​

​

​

​

上一篇

API 常见问题

下一篇

通过对话接口获取智能体回复
============================================================
# 通过对话接口获取智能体回复
来源: https://www.coze.cn/open/docs/developer_guides/get_chat_response
============================================================

通过对话接口获取智能体回复

​

获取智能体回复

​

调用对话接口后，服务端会处理请求并生成智能体回复。你可以通过以下方式获取智能体的回复详情。

​

​

获取方式

​

说明

​

通过流式响应实时显示智能体回复

​

如果客户端中需要打字机效果实时增量显示智能体回复，可以在调用发起对话接口时，设置流式响应（stream=true），并在客户端对话框中实时打印接口响应中的模型回复部分。

​

该场景下，客户端需要自行拼接响应内容。

​

仅解析流式响应的智能体回复部分

​

如果不需要增量流式显示智能体回复，只需要快速获取最终结果，可以在调用发起对话接口时，设置流式响应（stream=true），并在 Response 中，在事件

event:conversation.message.completed

中，取 type=answer 的事件，例如以下事件中，content 部分为智能体回复。

​

​

Plain Text

复制

event:conversation.message.completed

​

data:{"id":"738215949412347****","conversation_id":"738147352534297****","bot_id":"737946218936519****","role":"assistant","type":"answer","content":"2024 年 10 月 1 日是星期三。","content_type":"text","chat_id":"738215948713169****"}

​

​

对话结束后，事件

event:conversation.message.completed

中可能有多种消息类型，你可以按需解析。常见的消息类型可参考

​

消息示例

。

​

通过非流式响应主动查询智能体回复

​

你也可以参考以下流程主动查询智能体回复。

​

1.

调用

发起会话

接口，并设置 stream = false，auto_save_history=true，表示使用非流式响应，并记录历史消息。

​

你需要记录会话的 Conversation ID 和 Chat ID，用于后续查看详细信息。

​

2.

定期轮询

​

查看对话详情

接口，建议每次间隔 1 秒以上，直到会话状态流转为终态，即 status 为 completed 或 required_action。

​

3.

调用

​

查看对话消息详情

接口，查询模型生成的最终结果。

​

​

​

​

​

​

​

消息示例

​

文本格式智能体回复

​

data 字段中，type=answer，且 content_type=text 的消息为文本格式的智能体回复。示例如下：

​

​

JSON

复制

event

:

conversation.message.completed

​

data

:{

"id"

:

"739002977785765****"

,

"conversation_id"

:

"739002976985482****"

,

"bot_id"

:

"732868101392695****"

,

"role"

:

"assistant"

,

"type"

:

"answer"

,

"content"

:

"xxxx"

,

"content_type"

:

"text"

,

"chat_id"

:

"7390029769854844****"

}

​

​

卡片消息

​

data 字段中，type=answer，且 content_type=card 的消息为卡片格式的智能体回复。示例如下：

​

​

JSON

复制

event

:

conversation.message.completed

​

data

:{

"id"

:

"73900297849082****"

,

"conversation_id"

:

"7390029769854828****"

,

"bot_id"

:

"732868101392695****"

,

"role"

:

"assistant"

,

"type"

:

"answer"

,

"content"

:

"{\"card_type\":3,\"template_url\":\"xxx ....\"response_type\":\"card\"}"

,

"content_type"

:

"card"

,

"chat_id"

:

"739002976985484****"

}

​

​

知识库召回

​

data 字段中，type=verbose，且 content.msg_type = knowledge_recall 的消息为知识库召回的消息。示例如下：

​

​

JSON

复制

event

:

conversation.message.completed

​

data

:{

"id"

:

"739002976985487****"

,

"conversation_id"

:

"7390029769854828582"

,

"bot_id"

:

"732868101392695****"

,

"role"

:

"assistant"

,

"type"

:

"verbose"

,

"content"

:

"{\"msg_type\":\"knowledge_recall\",\"data\":\"xxxx\"}"

,

"content_type"

:

"text"

,

"chat_id"

:

"739002976985484****"

}

​

​

函数调用（Function call）

​

data 字段中，type=function_call 的消息为函数调用的结果。示例如下：

​

​

JSON

复制

event

:

conversation.message.completed

​

data

:{

"id"

:

"739002977785767****"

,

"conversation_id"

:

"739002976985482****"

,

"bot_id"

:

"732868101392695****"

,

"role"

:

"assistant"

,

"type"

:

"function_call"

,

"content"

:

"{\"name\":\"toutiaosousuo-search\",\"arguments\":{\"input_query\":\"B 站的热搜\"},\"plugin_id\":72811926238875****3,\"plugin_name\":\"toutiaosousuo\",\"api_id\":7288907006982012986,\"api_name\":\"search\",\"plugin_type\":1,\"thought\":\"需求为搜索 B 站的热搜并搜索这些热搜最新的动态新闻。第一步需要调用toutiaosousuo-search工具搜索 B 站的热搜\"}"

,

"content_type"

:

"text"

,

"chat_id"

:

"73900297698548****"

}

​

​

工具调用（tool_response）

​

data 字段中，type=tool_response 的消息为工具调用的结果。示例如下：

​

​

JSON

复制

event

:

conversation.message.completed

​

data

:{

"id"

:

"739002978490818****"

,

"conversation_id"

:

"739002976985482****"

,

"bot_id"

:

"732868101392695****"

,

"role"

:

"assistant"

,

"type"

:

"tool_response"

,

"content"

:

"xxx"

,

"content_type"

:

"card"

,

"chat_id"

:

"739002976985484****"

}

​

​

结束生成标识

​

data 字段中，type=verbose，且 content.msg_type = generate_answer_finish 的消息为模型生成结束的标识。示例如下：

​

​

JSON

复制

event

:

conversation.message.completed

​

data

:{

"id"

:

"739002981382787****"

,

"conversation_id"

:

"739002976985482****"

,

"bot_id"

:

"732868101392695****"

,

"role"

:

"assistant"

,

"type"

:

"verbose"

,

"content"

:

"{\"msg_type\":\"generate_answer_finish\",\"data\":\"{\\\"finish_reason\\\":0}\",\"from_module\":null,\"from_unit\":null}"

,

"content_type"

:

"text"

,

"chat_id"

:

"739002976985484****"

}

​

​

推荐

​

data 字段中，type=follow_up 的消息为智能体的用户问题建议。示例如下：

​

​

JSON

复制

event

:

conversation.message.completed

​

data

:{

"id"

:

"739002981382791****"

,

"conversation_id"

:

"739002976985482****"

,

"bot_id"

:

"732868101392695****"

,

"role"

:

"assistant"

,

"type"

:

"follow_up"

,

"content"

:

"总结一下B站崩了的具体情况"

,

"content_type"

:

"text"

,

"chat_id"

:

"739002976985484****"

}

​

​

​

上一篇

模型能力差异

下一篇

错误码 4100/4101 问题排查
============================================================
# 错误码 4100/4101 问题排查
来源: https://www.coze.cn/open/docs/developer_guides/troubleshooting_4100_4101
============================================================

错误码 4100/4101 问题排查

当调用 API 报错 4100 或 4101 时，表示当前使用的访问密钥不正确，或密钥不具备对应资源的权限。

​

问题排查流程如下：

​

​

​

​

​

​

​

问题排查步骤如下：

​

1.

检查访问密钥。

​

在此步骤中，检查密钥的权限、有效期和对应的工作空间。

​

对于 OAuth 访问密钥，参考

​

OAuth 应用管理

，检查授权流程是否完整且正确。

​

对于

个人访问密钥（PAT），你可以在

个人访问令牌

页面找到你使用的 PAT，并参考以下方式检查密钥。

​

​

检查项

​

说明

​

检查密钥权限

​

确认密钥已被授予指定接口要求的权限点，各个接口的权限点要求可参考 API 文档。例如：

​

​

​

​

​

​

检查密钥有效期

​

确认密钥未过期、状态为

有效

。

​

​

​

​

​

​

检查密钥工作空间

​

确认密钥授权工作空间中包括你调用的、知识库所在的空间。

​

​

​

​

​

​

说明

如果希望使用的、知识库位于其他人拥有的工作空间中，可以联系空间所有者获取一个有效的密钥。

​

​

​

2.

检查访问域名和请求 URL。

​

通过对应的 API 文档，确认当前使用的访问域名正确、URL 完整，包含了所有必选的请求 Query 参数。

​

​

​

​

​

​

3.

检查 Header 的 Authorization 传参。

​

确认请求 Header 中 Authorization 参数格式正确、完整、无多余字符。Authorization 参数格式为

Bearer {Access_Token}

，例如

Bearer pat_***

。

​

你也可以直接复制文档中的示例，并替换其中的访问密钥。

​

​

Shell

复制

curl --location --request GET 'https://

api.coze.cn

/v1/bot/get_online_info?bot_id=

7381****

' \

​

--header 'Authorization: Bearer

pat_***

' \

​

​

4.

检查其他必选字段的传参。

​

通过对应的 API 文档，确认已正确设置了请求中所有必选的参数。你也可以直接复制文档中的请求示例，并替换其中的参数值。

​

5.

对于

企业版用户

，如果通过以上步骤排查仍未解决问题，可以记录以下错误信息并联系扣子技术支持，我们将协助您排查问题。

​

Response header 中的 X-Tt-Logid 字段值，例如

20240708143040790E78F9318B35A2910B

。你可以在使用 curl 发起请求时通过

-i

参数打印 Response header 完整内容。

​

Response Body 中的 code、msg 字段值，例如

{ "code": 700012006, "msg": "access token invalid" }

。

​

​

​

上一篇

通过对话接口获取智能体回复

下一篇

如何实现会话隔离
============================================================
# 如何实现会话隔离
来源: https://www.coze.cn/open/docs/developer_guides/session_isolation
============================================================

如何实现会话隔离

使用扣子编程 OpenAPI 或 SDK 和扣子智能体或应用对话时，扣子编程会将使用同一个访问密钥的对话看做同一个用户。如果业务侧不同的用户使用同一个扣子编程访问密钥鉴权，用户看到的对话记录中可能会夹杂其他用户的对话历史。

​

但是在实际业务场景中，往往需要将不同业务侧用户的会话互相隔离开来，每个用户只能看到自己和智能体的对话历史。扣子编程 OAuth JWT 鉴权方式中，支持通过

session_name

参数实现会话隔离，避免智能体不同账号的消息内容互相可见。

​

会话隔离方案

​

目前仅 OAuth JWT 鉴权方式支持会话隔离。如果不同的用户使用同一个访问密钥，且需要在一个扣子账号下维护多个用户的对话，建议使用 JWT 方式鉴权，并设置会话隔离。

​

​

会话隔离级别

​

绑定到扣子账号下

​

绑定到扣子账号下的子级下

​

区别

​

一个扣子账号内无法隔离会话。

​

支持在一个扣子的账号下维护多个子用户的会话。

​

适用场景

​

访问产品的用户本身拥有扣子账号。

​

基于扣子编程 API 搭建的产品拥有自己的用户，这些用户没有扣子账号。

​

需要隔离这些用户之间的会话。

​

鉴权方式

​

可使用扣子编程目前支持的所有鉴权方式。详细信息可参考

​

鉴权方式概述

。

​

仅 OAuth 的 JWT 鉴权方式可实现会话隔离。但必须在 payload 中添加 session_name 字段。

​

隔离级别

​

渠道（默认） + 扣子账号 + Bot

​

渠道（默认）  + 扣子账号 + Bot + session_name

​

​

设置方式

​

如需实现会话隔离，需要在调用扣子编程 OpenAPI 或 SDK 时，使用 OAuth JWT 鉴权方式，并在签署 JWT 时，在 payload 字段中添加 session_name 字段。session_name 中应指定用户在业务侧的 UID，String 类型。UID 由业务侧自行定义，扣子编程仅透传这个字段并用于签署 JWT、区分不同

session_name

的会话。

​

签署 JWT 并设置

session_name

的具体步骤可参考

​

3 签署 JWT

。

​

设置示例

​

开发者搭建了一个智能体，并通过 Chat SDK 的方式嵌入到自建网站中，供网站的访问者使用。如果未设置会话隔离，那么网站中不同的访问者 A 和 B 在智能体对话框中可以查看到其他用户和智能体的对话记录。

​

开发者可以采用 JWT 方式实现会话隔离，并在 Chat SDK 中使用 JWT 访问密钥鉴权即可。

​

1.

获取业务侧的用户 UID。

​

从网站的账号系统中，获取网站用户 A 和 B 的 UID。此处我们假设 UID 分别为

USER_A

和

USER_B

。

​

2.

获取 JWT Token。

​

参考

​

OAuth JWT 授权（开发者）

文档实现 OAuth JWT 授权，并分别为用户 A 和 B 申请 JWT Token。在步骤

​

3 签署 JWT

中，Payload 中添加

session_name

字段，并将其设置为网站用户 A 或 B 的 UID。

​

用户 A 和 B 分别对应的 JWT Token：

​

​

Plain Text

复制

// 用户 A 的 JWT Token

​

czs_RQOhsc7vmUzK4bNgb7hn4wqOgRBYAO6xvpFHNbnl6RiQJX3cSXSguI

ahiuhwfw

****

​

​

// 用户 B 的 JWT Token

​

czs_

DJWOEF

7vmUzK4bNgb7hn4wqOgRBYAO6xvpFHNbnl6RiQJX3cSXSguIhFDzgy****

​

​

3.

设置 Chat SDK 鉴权参数。

​

参考

​

安装并使用 Chat SDK

接入 Chat SDK 时，在

​

步骤四：配置聊天框

中，auth 的 token 参数设置为网站用户对应的 Token，确保用户 A 和 用户 B 在和智能体对话时，分别使用的是自己的 JWT Token。

​

常见问题

​

为什么使用会话隔离时，设置了不同的 BotID，但返回的会话 ID 却相同？

​

可能原因

：

​

这通常是由于在代码中手动传入了相同的

conversationID

参数导致的。

​

解决方案

：

​

为确保会话 ID 的唯一性与隔离性，建议由系统自动生成会话 ID，避免手动在代码中设置

conversationID

参数。

​

使用 JWT 鉴权设置会话隔离时，不同会话间设置的用户变量是否会相互隔离？

​

会。设置

session_name

变量后，扣子编程会按照会话隔离的方式进行区分。不同会话间设置的用户变量将被自动隔离，互不影响。即使不同用户使用了相同的账号密钥，用户 A 与用户 B 的变量也会被独立存储，确保每个会话的用户变量完全隔离。

​

​

​

上一篇

错误码 4100/4101 问题排查

下一篇

升级企业版后更新 API 授权
============================================================
# 升级企业版后更新 API 授权
来源: https://www.coze.cn/open/docs/developer_guides/update_authorization
============================================================

升级企业版后更新 API 授权

从专业版、个人进阶版升级至企业后，往往需要将已创建的工作空间迁移到新的企业中，以便原有的智能体和扣子应用使用企业的高级权益。

如果你待迁移的智能体、扣子应用或工作流已发布到 API 渠道

，直接迁移工作空间会导致原有的 API 授权失效，线上用户调用 API 时会因鉴权失败而无法正常访问。

​

在这种场景下，企业的超级管理员需要在迁移工作空间之前，先修改业务代码中的鉴权部分，添加新老授权的兼容逻辑，保障平滑迁移，过程线上无感知。

​

说明

从原团队版、企业标准版升级至企业旗舰版时，无需迁移工作空间。

​

​

迁移 API 授权

​

注意事项

​

​

注意事项

​

说明

​

操作时段

​

如果智能体、应用或工作流已发布到生产环境、线上用户量较大，为了保障平滑迁移，建议选择服务流量较少的时段执行本步骤，例如深夜或凌晨时段。

​

权限设置

​

请确保已覆盖原授权的所有权限点，以免因权限不足导致 API 访问失败。

​

操作时，访问空间建议选择所有工作空间，确保空间迁移后访问令牌能访问该企业中的所有空间，包括后续创建的新空间。

​

API 方式创建会话

​

由于智能体等资源属于空间，API 方式创建的会话属于扣子用户，迁移空间之后，智能体无权限访问原个人账号下的会话，建议开发者创建新会话。创建方式可参考

​

创建会话

。

​

原 OAuth 应用

​

请勿禁用或删除

参考本文档完成改造的个人版 OAuth 应用，否则会影响在企业中的 OpenAPI 访问。

​

​

步骤一：确定授权类型

​

扣子提供了个人访问令牌、OBO 等多种授权类型，各种授权类型下，更新 API 授权的方式不同。你需要先确定自己的授权方式。

​

不同的扣子 OAuth 授权对应的授权类型和适用的客户端类型如下表所示。

​

​

授权类型

​

授权方式

​

客户端类型

​

个人访问令牌

​

​

添加个人访问令牌

​

无

​

OBO 授权

​

​

OAuth 授权码授权

​

Web 后端应用

​

​

​

OAuth PKCE

​

移动端/PC 桌面端/单页面应用

​

​

​

OAuth 设备授权

​

TV 端/设备应用/类命令行程序

​

AppAuth 授权

​

​

OAuth JWT 授权（开发者）

​

服务类应用

​

​

步骤二：更新 API 授权

​

AppAuth 授权场景

​

AppAuth 授权是指应用以自身身份去访问扣子编程的资源。例如，一个后端服务需要从扣子编程获取数据。

​

1 重新授权

OAuth 应用

​

企业的超级管理员或管理员在企业版下完成对待迁移的 OAuth 应用的授权。

​

1.

创建 OAuth 应用的扣子用户切换到个人版，并访问

扣子 API

＞

OAuth 应用

页面。

​

2.

找到待迁移的 OAuth 应用，并在

操作

列单击分享图标。

​

​

​

​

​

​

3.

将复制好的链接发送给企业的超级管理员或管理员，由其打开链接完成授权。

​

授权相关的设置方式如下：

​

授权范围选择企业

​

工作空间选择所有工作空间

​

​

​

​

​

​

4.

确认授权成功。

​

企业的超级管理员或管理员切换到企业中。在左侧导航栏单击

企业 API

，访问

应用安装管理

页面，确认授权成功。

​

​

​

​

​

​

2 更新授权代码

​

应用程序在请求 OpenAPI 时，需要同时获取个人版和企业版下的授权凭证，默认先基于个人版的凭证访问资源，如果返回请求无权限（4100 和 4101） 或资源不存在的错误码，则再次基于企业版的凭证访问资源。

​

1.

获取授权代码中需要填写的

个人账号 UID

和

企业 ID

。

​

​

账号

​

获取方式

​

示例

​

个人账号 UID

​

（personalAccountId）

​

必须是创建 OAuth 应用的扣子账号 UID。

​

在扣子编程左下角单击个人头像，并选择账号设置，在账号页面中查看 UID。

​

​

​

​

​

​

​

企业 ID

​

（enterpriseAccountId）

​

你可以在

组织管理

>

组织设置

页面查看企业 ID。

​

​

​

​

​

​

​

2.

更新授权代码。

​

以聊天接口为例，Go 语言代码改造方式如下，注意其中高亮部分：

​

​

Go

复制

package

main

​

​

import

(

​

"context"

​

"errors"

​

"fmt"

​

"github.com/coze-dev/coze-go"

​

"os"

​

)

​

​

func

main

()

{

​

// The default access is api.coze.com, but if you need to access api.coze.cn,

​

// please use base_url to configure the api endpoint to access

​

cozeAPIBase := os.Getenv(

"COZE_API_BASE"

)

​

jwtOauthClientID := os.Getenv(

"COZE_JWT_OAUTH_CLIENT_ID"

)

​

jwtOauthPrivateKey := os.Getenv(

"COZE_JWT_OAUTH_PRIVATE_KEY"

)

​

jwtOauthPrivateKeyFilePath := os.Getenv(

"COZE_JWT_OAUTH_PRIVATE_KEY_FILE_PATH"

)

​

jwtOauthPublicKeyID := os.Getenv(

"COZE_JWT_OAUTH_PUBLIC_KEY_ID"

)

​

botID := os.Getenv(

"PUBLISHED_BOT_ID"

)

​

uid := os.Getenv(

"USER_ID"

)

​

​

// Read private key from file

​

privateKeyBytes, err := os.ReadFile(jwtOauthPrivateKeyFilePath)

​

if

err !=

nil

{

​

fmt.Printf(

"Error reading private key file: %v\n"

, err)

​

return

​

}

​

jwtOauthPrivateKey =

string

(privateKeyBytes)

​

​

oauth

, err := coze.NewJWTOAuthClient(coze.NewJWTOAuthClientParam{

​

ClientID: jwtOauthClientID, PublicKey: jwtOauthPublicKeyID, PrivateKeyPEM: jwtOauthPrivateKey,

​

}, coze.WithAuthBaseURL(cozeAPIBase))

​

if

err !=

nil

{

​

fmt.Printf(

"Error creating JWT OAuth client: %v\n"

, err)

​

return

​

}

​

ctx

:= context.Background()

​

​

var

personalAccountId

int64

=

12345

// 个人版 账号 UID

​

var

enterpriseAccountId

int64

=

23456

// 企业版 账号 ID

​

​

// 获取个人版下的访问凭证

​

cozeCli := coze.NewCozeAPI(coze.NewJWTAuth(oauth, &coze.GetJWTAccessTokenReq{

​

AccountID:   &personalAccountId,

​

}), coze.WithBaseURL(cozeAPIBase))

​

// 获取企业版下的访问凭证

​

cozeCli4Enterprise := coze.NewCozeAPI(coze.NewJWTAuth(oauth, &coze.GetJWTAccessTokenReq{

​

EnterpriseID:   &enterpriseAccountId,

​

}), coze.WithBaseURL(cozeAPIBase))

​

​

req := &coze.CreateChatsReq{

​

BotID:  botID,

​

UserID: uid,

​

Messages: []*coze.Message{

​

coze.BuildUserQuestionText(

"What can you do?"

,

nil

),

​

},

​

}

​

​

// 先尝试通过个人版的凭证请求chat接口

​

resp, err := cozeCli.Chat.Create(ctx

, req

)

​

if

err ==

nil

{

​

fmt.Println(resp)

​

return

​

}

​

// 当请求个人版接口出现鉴权失败时, 再尝试基于企业版的凭证请求chat接口

​

cozeErr := coze.Error{}

​

if

errors.As(err, &cozeErr) {

​

// no permission error code

​

if

cozeErr.Code ==

4101

|| cozeErr.Code ==

4100

{

​

// no permission try chat with enterprise account

​

resp, err = cozeCli4Enterprise.Chat.Create(ctx, req)

​

if

err ==

nil

{

​

fmt.Println(resp)

​

return

​

}

​

}

​

}

​

fmt.Println(err)

​

}

​

​

3.

验证授权逻辑。

​

修改授权相关代码之后，建议确认代码中增加的逻辑准确、有效。例如在企业中新建空间和智能体，使用更新后的授权代码访问新智能体，对齐接口能力，验证通过之后再迁移工作空间。

​

3 迁移工作空间到企业

​

操作步骤可参考

​

功能简介

。成功迁移之后，后端服务如果使用旧的凭证请求扣子 OpenAPI，鉴权失败之后会自动切换为新的凭证，保证线上访问无影响。

​

个人访问令牌场景

​

如果你通过个人访问令牌来请求扣子 OpenAPI，那么可以创建新的个人访问令牌，并在代码中添加兼容逻辑。即在授权代码中同时添加旧的个人访问令牌和新的个人访问令牌，如果调用扣子 Open API 鉴权失败，则使用扣子企业版的个人访问令牌。

​

详细操作步骤如下：

​

1 创建新的个人访问令牌

​

1.

企业超级管理员或管理员切换到企业中。

​

2.

从左侧导航栏访问

企业 API

＞

个人访问令牌

页面。

​

3.

在页面右上角单击

创建访问令牌

。注意新令牌设置为企业内所有工作空间有效。

​

​

​

​

​

​

2 更新授权代码

​

在授权代码中添加旧的个人访问令牌和新的个人访问令牌，如果使用旧令牌调用扣子 Open API 鉴权失败，则自动切换为企业空间的新令牌。

​

修改授权相关代码之后，建议确认代码中增加的逻辑准确、有效。例如在企业中新建空间和智能体，使用更新后的授权代码访问新智能体，对齐接口能力，验证通过之后再迁移工作空间。

​

Go

语言代码示例如下，其中高亮部分为新增内容。

​

​

Go

复制

package

main

​

​

import

(

​

"context"

​

"errors"

​

"fmt"

​

"os"

​

​

"github.com/coze-dev/coze-go"

​

)

​

​

// How to use personal access token to init Coze client.

​

//

​

// Firstly, you need to access https://www.coze.com/open/oauth/pats (for the cn environment,

​

// visit https://www.coze.cn/open/oauth/pats).

​

//

​

// Click to add a new token. After setting the appropriate name, expiration time, and

​

// permissions, click OK to generate your personal access token. Please store it in a

​

// secure environment to prevent this personal access token from being disclosed.

​

func

main

()

{

​

cozeAPIToken := os.Getenv(

"COZE_API_TOKEN"

)

​

cozeAPIToken4Enterprise := os.Getenv(

"COZE_API_TOKEN_ENTERPRISE"

)

​

​

//

​

// The default access is api.coze.com, but if you need to access api.coze.cn,

​

// please use base_url to configure the api endpoint to access

​

//

​

cozeAPIBase := os.Getenv(

"COZE_API_BASE"

)

​

​

ctx := context.Background()

​

//

​

// The Coze SDK offers the TokenAuth class for constructing an Auth class based on a fixed

​

// access token. Meanwhile, the Coze class enables the passing in of an Auth class to build

​

// a coze client.

​

//

​

// Therefore, you can utilize the following code to initialize a coze client.

​

//

​

​

cozeCli := coze.NewCozeAPI(coze.NewTokenAuth(cozeAPIToken), coze.WithBaseURL(cozeAPIBase))

​

cozeCli4Enterprise := coze.NewCozeAPI(coze.NewTokenAuth(cozeAPIToken4Enterprise), coze.WithBaseURL(cozeAPIBase))

​

​

// Try chat with the bot under your personal account

​

resp, err := cozeCli.Chat.Create(ctx, &coze.CreateChatsReq{

​

// your chat request params

​

})

​

if

err ==

nil

{

​

fmt.Println(resp)

​

return

​

}

​

// Retry chat with the bot under your enterprise account

​

cozeErr := coze.Error{}

​

if

errors.As(err, &cozeErr) {

​

// Authentication or Authorization Deny

​

if

cozeErr.Code ==

4100

|| cozeErr.Code ==

4101

{

​

resp, err = cozeCli4Enterprise.Chat.Create(ctx, &coze.CreateChatsReq{

​

// your chat request params

​

})

​

if

err ==

nil

{

​

fmt.Println(resp)

​

return

​

}

​

}

​

}

​

fmt.Println(err)

​

}

​

​

3 迁移工作空间到企业

​

操作步骤可参考

​

功能简介

。成功迁移之后，后端服务如果使用旧的个人访问密钥请求扣子 OpenAPI，鉴权失败之后会自动切换为新的密钥，保证线上访问无影响。

​

说明

建议仅在测试环境、调试场景中使用个人访问令牌，并严格限制其使用范围和有效期，生产环境中建议避免使用个人访问令牌。

​

迁移成功且验证 API 访问正常之后，建议及时删除旧的个人访问令牌，以免令牌到期

后无法访问。

​

​

OBO 授权场景

​

OBO （On Behalf Of）授权是指应用以用户的身份去访问扣子编程的资源。例如，在 Web 后端应用、TV 端/设备应用/类命令行程序、移动端/PC 桌面端/单页面应用中，应用获取授权后，以用户的身份调用扣子编程的 API。

​

在 OBO 授权场景中，开发者需要添加授权失败场景的处理策略，即鉴权失败时重新触发授权，获取新的 Access Token。

​

1 更新授权代码

​

修改业务代码，设置后端服务在鉴权失败时重新触发授权，获取新的 Access Token。

​

修改授权相关代码之后，建议确认代码中增加的逻辑准确、有效。例如在企业中新建空间和智能体，使用更新后的授权代码访问新智能体，对齐接口能力，验证通过之后再迁移工作空间。

​

本文以 Go

语言 OAuth 授权码授权场景为例，具体实现请参考以下示例代码中高亮的部分。

​

​

Go

复制

package

main

​

​

import

(

​

"context"

​

"errors"

​

"fmt"

​

"net/http"

​

"os"

​

​

"github.com/coze-dev/coze-go"

​

)

​

​

// How to effectuate OpenAPI authorization through the OAuth authorization code method.

​

//

​

// Firstly, users need to access https://www.coze.com/open/oauth/apps. For the cn environment,

​

// users need to access https://www.coze.cn/open/oauth/apps to create an OAuth App of the type

​

// of Web application.

​

// The specific creation process can be referred to in the document:

​

// https://www.coze.com/docs/developer_guides/oauth_code. For the cn environment, it can be

​

// accessed at https://www.coze.cn/docs/developer_guides/oauth_code.

​

// After the creation is completed, the client ID, client secret, and redirect link, can be

​

// obtained. For the client secret, users need to keep it securely to avoid leakage.

​

​

func

main

()

{

​

redirectURI := os.Getenv(

"COZE_WEB_OAUTH_REDIRECT_URI"

)

​

clientSecret := os.Getenv(

"COZE_WEB_OAUTH_CLIENT_SECRET"

)

​

clientID := os.Getenv(

"COZE_WEB_OAUTH_CLIENT_ID"

)

​

ctx := context.Background()

​

​

// The default access is api.coze.com, but if you need to access api.coze.cn,

​

// please use base_url to configure the api endpoint to access

​

cozeAPIBase := os.Getenv(

"COZE_API_BASE"

)

​

if

cozeAPIBase ==

""

{

​

cozeAPIBase = coze.ComBaseURL

​

}

​

​

// The sdk offers the WebOAuthClient class to establish an authorization for Web OAuth.

​

// Firstly, it is required to initialize the WebOAuthApp with the client ID and client secret.

​

oauth, err := coze.NewWebOAuthClient(clientID, clientSecret, coze.WithAuthBaseURL(cozeAPIBase))

​

if

err !=

nil

{

​

fmt.Printf(

"Failed to create OAuth client: %v\n"

, err)

​

return

​

}

​

​

// Generate the authorization link and direct the user to open it.

​

oauthURL := oauth.GetOAuthURL(ctx, &coze.GetWebOAuthURLReq{

​

RedirectURI: redirectURI,

​

State:

"state"

,

​

})

​

fmt.Println(oauthURL)

​

​

// The space permissions for which the Access Token is granted can be specified. As following codes:

​

// oauthURL = oauth.GetOAuthURL(&coze.GetWebOAuthURLReq{

​

//     RedirectURI: redirectURI,

​

//     State:       "state",

​

//     WorkspaceID: &workspaceID,

​

// })

​

// fmt.Println(oauthURL)

​

​

// After the user clicks the authorization consent button, the coze web page will redirect

​

// to the redirect address configured in the authorization link and carry the authorization

​

// code and state parameters in the address via the query string.

​

//

​

// Get from the query of the redirect interface: query.get('code')

​

code :=

"mock code"

​

​

// After obtaining the code after redirection, the interface to exchange the code for a

​

// token can be invoked to generate the coze access_token of the authorized user.

​

resp, err := oauth.GetAccessToken(ctx, &coze.GetWebOAuthAccessTokenReq{

​

Code:        code,

​

RedirectURI: redirectURI,

​

})

​

if

err !=

nil

{

​

fmt.Printf(

"Failed to get access token: %v\n"

, err)

​

return

​

}

​

fmt.Println(resp)

​

​

// When the token expires, you can also refresh and re-obtain the token

​

resp, err = oauth.RefreshToken(ctx, resp.RefreshToken)

​

if

err !=

nil

{

​

fmt.Printf(

"Failed to refresh token: %v\n"

, err)

​

return

​

}

​

​

fmt.Printf(

"%+v\n"

, resp)

​

​

// you can get request log by getLogID method

​

fmt.Println(resp.LogID())

​

​

// use the access token to init Coze client

​

cozeCli := coze.NewCozeAPI(coze.NewTokenAuth(resp.AccessToken))

​

_, err = cozeCli.Chat.Create(ctx, &coze.CreateChatsReq{

​

// chat request params

​

})

​

if

err !=

nil

{

​

cozeErr := coze.Error{}

​

if

errors.As(err, &cozeErr) {

​

// no permission error code

​

if

cozeErr.Code ==

4101

|| cozeErr.Code ==

4100

{

​

// request user authorization

agin

​

// redirect to oauthURL

​

// call http.Redirect(w, r, oauthURL,

http.StatusFound)

​

}

​

}

​

}

​

_ = cozeCli

​

}

​

​

2 迁移工作空间到企业

​

操作步骤可参考

​

功能简介

。

​

3 重新触发授权

​

企业的超级管理员或管理员登录应用触发授权，然后在扣子编程重新安装应用，安装的步骤请参见

​

OAuth 应用管理

。

​

​

​

​

​

​

步骤三：线上观测

​

成功迁移工作空间之后，应实时监测线上服务的请求成功率，确保线上服务无异常。

​

如果线上授权相关逻辑持续稳定运行，可以酌情考虑线下原授权代码，切换为新的授权凭证来访问扣子 OpenAPI。

​

授权

企业

访问个人账号资源

​

购买扣子企业并

完成个人工作空间迁移后

，

因

会话、音色等账号级别的资源无法自动迁移，若希望

让企业下的访问令牌也能访问原个人空间中的账号级别的资源，

超级管理员或管理员可以手动授权企业版中的 Token 访问个人账号中的会话、音色等账号级资源。

​

1.

超级管理员或管理员切换到企业账号，创建个人访问令牌或 Oauth 应用，并授予会话管理等

账号层级

的权限，具体操作步骤请参见

​

OAuth JWT 授权（开发者）

和

​

添加个人访问令牌

。

​

​

​

​

​

​

说明

仅支持 PAT 和 AppAuth 授权，不支持 OBO 授权。

​

仅支持授权

账号层级

的权限，不支持授权

工作空间层级

的权限，你可以在授权对话框的权限列表中查看该权限的层级属性。

​

​

2.

超级管理员或管理员访问

个人账号资源授权

页面，可以查看本人创建的个人访问令牌，以及企业中创建的所有 AppAuth。

​

​

​

​

​

​

3.

单击操作列中的

授权

。

​

授权后，你可以使用该 Token 访问你个人账号下的账号级资源。

​

​

上一篇

如何实现会话隔离

下一篇

Chat SDK 概述
============================================================
# Chat SDK 概述
来源: https://www.coze.cn/open/docs/developer_guides/web_sdk_overview
============================================================

Chat SDK 概述

扣子

编程

Chat SDK 是一个 JavaScript 库，集成了

扣子

编程

OpenAPI 的对话、文件上传等能力，便于开发者高效、便捷、快速地搭建一个聊天应用。集成

扣子

编程

Chat SDK 之后，用户可通过网页悬浮窗方式与 AI 应用对话。

​

版本说明

​

自 1.0.0-beta.4 版本开始，

扣子

编程

提供全新的 Chat SDK 供开发者使用，改版后，Chat SDK 支持

扣子

编程

OpenAPI 的鉴权能力，开发者可按需选择是否鉴权及鉴权方式，例如指定个人访问令牌或 OAuth 访问密钥完成 Chat SDK 的鉴权。如果选择鉴权，开发者使用 Chat SDK 需传入访问密钥，

扣子

编程会识别不同用户身份，并保存各个用户的消息记录，即使用户更换终端设备或浏览器，仍可以通过访问关联的账户查看历史记录。全新版本的 Chat SDK 安装及使用方式，可查看

​

安装并使用 Chat SDK

。

​

1.0.0-beta.4 版本之前的 Chat SDK 为历史版本，开发者无需鉴权即可集成 SDK。历史版本 Chat SDK 仅提供基础的对话能力，安全性及扩展性较低，后续将不再维护和更新。历史版本的 Chat SDK 安装及使用方式，可查看

​

（历史版本）Chat SDK

。

​

效果预览

​

​

​

​

​

​

对应的示例代码可参考

​

示例

。

​

功能特性

​

除了基础的对话能力之外，Chat SDK 还提供多种定制化能力，支持多种鉴权模式，可调整聊天框的显示效果等多种配置。

​

说明

详细的功能点列表及配置方式可参考

​

步骤五：自定义聊天界面与交互

。

​

​

​

功能

​

说明

​

多形态支持

​

通过 Chat SDK，可以在你的应用程序中和扣子应用、智能体实时对话。

​

鉴权能力

​

通过

扣子

编程

访问令牌进行 OpenAPI 的鉴权，支持个人访问密钥（PAT）、普通 OAuth 访问密钥及入驻渠道的 OAuth 访问密钥。

​

用户识别

​

和 AI 应用对话的用户身份是用户在开发者网站上的身份。开发者可以向 Chat SDK 提供 AI 应用用户的身份信息，也可以在 Chat SDK 的 UI 中显示不同的用户信息，包括头像、用户名、ID 等。

​

交互能力

​

Chat SDK 为开发者提供了以下两种打开聊天窗的方式。

​

完全由 Chat SDK 接管，页面中会自动加载一个悬浮球，用户点击悬浮球会展示出聊天框。

​

为开发者提供显示隐藏聊天框的能力，开发者可根据情况自主决定聊天框的显示和隐藏。

​

展示效果

​

支持调整聊天框中展示的用户信息、UI 效果、悬浮球效果、底部文案等配置，例如对话窗口的应用图标、悬浮球的展示或隐藏、自定义底部文案、开启或关闭上传能力等。

​

会话隔离

​

Chat SDK 支持会话隔离，使每个用户只能看到自己和智能体的对话历史。使用扣子 OAuth JWT 鉴权方式获取密钥时设置 session_name 即可，详细说明可参考

​

如何实现会话隔离

。

​

​

使用限制

​

Chat SDK 暂不支持触发器、文件盒子、卡片部分功能（按钮唤起插件或工作流）等能力。

​

Chat SDK 暂不支持问答节点的卡片效果，用户需要手动复制问答节点的选项，并发送给智能体。

​

费用说明

​

扣子不同版本账号的 Chat SDK 使用限额存在差异。

​

个人免费版：Chat SDK 的免费额度为每个账号 100 次对话。一旦累计对话次数超过免费额度，此账号将无法继续使用扣子 Chat SDK。免费额度不适用于通过扣子编程、其他发布渠道或直接通过 API 发起的请求。

​

个人付费版（进阶版、高阶版、旗舰版）、企业版（企业标准版、企业旗舰版）：不限制通过 Chat SDK 发起对话的频率和次数。通过 Chat SDK 发起对话，本质上是调用

发起对话

API，根据输入和输出的 Token 数量扣减套餐中的积分，具体请参见

​

计费概述

。如果企业版中调用了方舟模型，会根据

方舟模型 Token 消耗

收取费用。

​

​

上一篇

升级企业版后更新 API 授权

下一篇

安装并使用 Chat SDK
============================================================
# 安装并使用 Chat SDK
来源: https://www.coze.cn/open/docs/developer_guides/install_web_sdk
============================================================

安装并使用 Chat SDK

本文介绍如何安装并使用扣子 Chat SDK，开发者可以参考本文档在自己开发的网站或 App 中快速实现智能对话功能。适用于智能客服、答疑助手或企业内部的 IT 支持机器人等场景。

​

前置条件

​

浏览器兼容性

​

Chat  SDK 的运行环境要求如下表所示。

​

​

浏览器

​

版本限制

​

Chrome

​

87.0 及以上

​

Edge

​

88.0 及以上

​

Safari

​

14.0 及以上

​

Firefox

​

78.0 及以上

​

​

获取访问密钥

​

访问密钥用于 Chat SDK 的身份认证与鉴权。根据使用场景选择合适的鉴权方式，各鉴权方式的区别请参见

​

鉴权方式概述

。

​

​

场景

​

推荐方案

​

说明

​

参考文档

​

开发调试

​

个人访问令牌（PAT）

​

快速跑通 Chat SDK 的整体流程。

​

​

添加个人访问令牌

​

生产环境

​

服务访问令牌（SAT）

​

操作更简单，能够有效简化授权流程，适合需要长期稳定访问且无需进行会话隔离的场景。

​

仅企业版（企业标准版、企业旗舰版）支持使用 SAT 鉴权。

​

​

添加服务访问令牌

​

​

OAuth 鉴权

​

支持渠道用户访问智能体、会话隔离（即智能体不同账号的消息内容互相隔离）。

​

​

OAuth 应用管理

​

​

OAuth JWT 授权（渠道场景）

​

​

权限要求

​

访问密钥需被授予以下权限，才能正常使用 Chat SDK 的各项能力。Chat SDK 所需的权限列表如下：

​

​

密钥类型

​

PAT /

SAT /普通 OAuth

​

渠道 OAuth 访问密钥

​

权限点

​

​

Bot管理

​

chat

​

getMetadata

​

会话管理

​

listConversation

​

createConversation

​

editConversation

​

对话

​

cancelChat

​

工作流

​

getMetadata

​

应用管理

​

getMetadata

​

文件

​

uploadFile

​

消息

​

listMessage

​

智能音视频

​

createTranscription

​

createSpeech

​

botChat

​

getMetadata

​

listConversation

​

createConversation

​

editConversation

​

uploadFile

​

listConversationMessage

​

cancelConversationChat

​

createTranscription

​

createSpeech

​

​

​

说明

渠道 OAuth 访问密钥的权限点是渠道类型的 OAuth 应用中设置的权限点，创建应用并授权的详细说明可参考

​

OAuth JWT 授权（渠道场景）

。

​

​

调试与体验 Chat SDK

​

你可以通过

Playground

调试与体验 Chat SDK 各配置项的功能和效果。

​

​

​

​

​

​

配置流程

​

步骤一：发布智能体或扣子应用

​

在智能体或 AI 应用的发布页面，选择 Chat SDK，并单击

发布

。发布的详细流程可参考：

​

​

发布为 Chat SDK

​

​

发布到 Chat SDK

​

步骤二：获取安装代码

​

进入发布页面复制 SDK 安装代码。

​

​

步骤三：安装 SDK

​

将步骤二中复制的安装代码粘贴到网页中，例如 <body> 标签内，通过

script

标签加载 Chat SDK 的 js 代码。

​

示例代码如下：

​

​

​

步骤四：初始化配置

​

通过调用 CozeWebSDK.WebChatClient

初始化客户端。当前页面中聊天框包括 PC 和移动端两种布局样式，在 PC 端中，聊天框位于页面右下角，移动端聊天框会铺满全屏。

​

智能体配置

​

调用 CozeWebSDK.WebChatClient 时，你需要配置

config

（智能体信息）和

auth

（鉴权信息）。

​

config

：必选参数，表示智能体的配置信息。

​

调用智能体时，需要设置以下参数：

​

​

auth

：表示鉴权方式。当未配置此参数时表示不鉴权。为了账号安全，建议配置鉴权。

​

​

初始化示例如下：

​

​

​

扣子应用配置

​

调用 CozeWebSDK.WebChatClient 时，你需要配置扣子应用的基础信息以及鉴权参数：

​

config

：必选参数，表示应用的配置信息。

​

​

auth

：表示鉴权方式。当未配置此参数时表示不鉴权。为了账号安全，建议配置鉴权。

​

​

示例如下：

​

​

步骤五：自定义聊天界面与交互

​

开发者可以按需调整对话框的多种展示效果，例如展示的用户信息、对话框 UI 效果、悬浮球展示、底部文案等。

​

你可以在 WebChatClient 方法中添加各种属性，实现对应的效果。目前支持的属性如下：

​

​

步骤六：销毁客户端

​

若需在页面卸载或特定场景下关闭 Chat SDK，可调用

destroy

方法销毁客户端，释放资源。

​

​

自定义聊天界面与交互

​

你可以配置对话框中的用户信息、布局、悬浮球、底部文案、顶部标题栏等 UI 元素，以满足品牌风格需求。

​

配置用户信息

​

userInfo

参数用于设置对话框中显示的用户信息，包括对话框中的用户头像和用户昵称。同时，此处指定的用户 ID 也会通过

​

发起对话

API 传递给扣子服务端。

​

​

​

​

​

​

​

配置示例如下：

​

​

基础 UI 配置

​

ui.base

参数用于添加聊天窗口的整体 UI 效果，包括应用图标、页面布局、语言属性等。

​

​

示例代码如下：

​

​

悬浮球

​

ui.asstBtn

参数用于控制是否在页面右下角展示悬浮球。默认展示，用户点击悬浮球后将弹出聊天窗口。

​

​

​

​

​

​

​

示例代码如下：

​

​

Chat SDK 悬浮球的位置默认在页面右下角，不支持移动，如果需要调整悬浮球的位置，你可以隐藏默认的悬浮球，自定义悬浮球的位置和样式，具体请参见

​

Chat SDK 悬浮球位置如何移动？

。

​

底部文案

​

聊天框底部会展示对话服务的提供方信息，默认为

Powered by coze. AI-generated content for reference only.

。开发者通过

ui.footer

参数隐藏此文案或改为其他文案，支持在文案中设置超链接。

​

底部文案默认展示效果如下：

​

​

​

​

​

​

footer

参数配置说明如下：

​

​

配置示例如下：

​

​

此配置的对应的展示效果如下：

​

​

​

​

​

​

顶部标题栏配置

​

聊天框顶部默认

展示智能体名称

、icon 及关闭按钮。展示效果类似如下：

​

​

​

​

​

​

您可以通过

ui.header

参数配置是否展示顶部标题栏和关闭按钮，header 参数配置说明如下：

​

​

配置示例如下：

​

​

聊天框

​

chatBot

参数用于控制聊天框的 UI 和基础能力，包括标题、大小、位置等基本属性，还可以指定是否支持在聊天框中上传文件。此参数同时提供多个回调方法，用于同步聊天框显示、隐藏等事件通知。

​

配置说明如下：

​

​

相关回调：

​

onHide：

当聊天框隐藏的时候，会回调该方法。

​

onShow:

当聊天框显示的时候，会回调该方法。

​

onBeforeShow:

聊天框显示前调用，如果返回了 false，则不会显示。支持异步函数。

​

onBeforeHide:

聊天框隐藏前调用，如果返回了 false，则不会隐藏。支持异步函数。

​

在以下示例中，聊天框标题为 Kids' Playmate | Snowy，并开启上传文件功能。

​

​

​

​

​

​

对应的代码示例如下：

​

​

通过 chatbot 的 el 参数设置组件的示例代码如下：

​

​

消息评价

​

你可以在

chatBot

参数中配置是否允许用户对智能体的回答进行评价（点赞 / 点踩），默认禁用评价功能。

​

​

​

​

​

​

​

示例代码如下：

​

​

会话列表

​

ui.conversations

参数用于控制是否展示会话列表功能。开启后，聊天框左上角会新增一个会话列表按钮，用户可借此查看历史对话、重新发起对话、创建新的会话、重命名或删除会话，实现便捷的会话管理。

​

​

​

示例代码如下：

​

​

相关操作

​

更新 SDK 版本

​

扣子 Chat SDK 将持续更新迭代，支持丰富的对话能力和展示效果。你可以在 Chat SDK 的 script 标签中指定 Chat SDK 的最新版本号，体验和使用最新的 Chat SDK 对话效果。

​

在以下代码中，将

{{version}}

部分替换为 Chat SDK 的最新版本号。

你

可以在

​

Chat SDK 发布历史

中查看最新版本号。

​

​

解绑 Chat SDK

​

如果不再需要通过 Chat SDK 使用 AI 应用，可以在发布页面点击

解绑

按钮。一旦

解绑

，智能体或应用就无法通过集成的 Web 应用程序使用。 如果您想恢复 Web 应用程序的访问，需要再次将智能体或应用发布为 Chat SDK。

​

​

完整示例代码

​

以下是一段完整的 Chat SDK 调用智能体的代码示例。

​

​

相关文档

​

如果需要将不同业务侧用户的会话互相隔离开来，每个用户只能看到自己和智能体的对话历史，请参见

​

如何实现会话隔离

。

​

上一篇

Chat SDK 概述

下一篇

Chat SDK 发布历史
============================================================
# Chat SDK 发布历史
来源: https://www.coze.cn/open/docs/developer_guides/web_sdk_changelog
============================================================

Chat SDK 发布历史

本文档介绍 Chat SDK 各个版本的主要功能。建议你使用最新版本以体验更便捷的配置、更安全的能力，更新 SDK 版本的方式可参考

​

更新 SDK 版本

。

​

​

版本号

​

版本说明

​

1.2.0-beta.20

​

上传文件时支持显示进度条。

​

修复首次进入 Chat SDK 时，会话列表未显示自动创建的新会话。

​

1.2.0-beta.19

​

修复会话切换偶现的 bug。

​

优化聊天框在 PC 模式下宽高的计算逻辑，配置

el

参数时，可自适应填充容器。

​

1.2.0-beta.18

​

发布渠道相关的逻辑优化。

​

1.2.0-beta.17

​

新增如下功能：

​

语音通话

：智能体或应用开启语音通话功能后，用户可在集成 Chat SDK 的聊天应用中进行语音通话。无需在 Chat SDK 中进行语音通话的配置。

​

会话列表

：新增

ui.conversations

参数，开发者可配置是否启用会话列表功能。

​

开启新会话

：新增

isNeedAddNewConversation

参数，开发者可配置是否在聊天框中显示开启新

会话

按钮。

​

消息追问

：新增

isNeedQuote

参数，开发者可配置是否支持对智能体或应用回复的消息进行追问。

​

1.2.0-beta.15

​

优化了图片预览功能，将图片预览地址从 blob 协议更新为 Base64 格式。

​

1.2.0-beta.14

​

修复了自定义卡片展示异常的问题。

​

1.2.0-beta.13

​

新增如下功能：

​

快捷指令：

支持智能体或应用中配置的快捷指令。

​

停止输出：在大模型回复过程中，新增了

停止输出

按钮。用户可以根据需要随时中断回复。

​

多模态消息：用户可以在聊天框中灵活组合发送文本、图片、文件和语音消息。

​

配置是否展示工具调用的过程：新增

isNeedFunctionCallMessage

参数，开发者可以配置是否展示工具调用的过程。

​

1.2.0-beta.11

​

修复了以下问题：删除历史消息功能概率性失效、应用背景图样式兼容性问题等。

​

1.2.0-beta.10

​

新增如下功能：

​

配置聊天框时新增

isNeedAudio

参数，用于配置智能体聊天窗口是否允许语音输入。

​

智能体配置中新增

botInfo.parameters

参数，用于给自定义参数赋值并传给对话流。

​

支持将智能体设置的背景图同步至 Chat SDK。

​

支持用专业格式显示数学公式、化学方程式等复杂符号。

​

1.2.0-beta.8

​

Chat SDK 的会话接口需要将用户已设置的

user_id

参数传给扣子服务端，来区分不同用户。

​

1.2.0-beta.6

​

修复了因 Token 过期导致聊天失败的问题。当前支持过期后自动刷新 Token。

​

1.2.0-beta.5

​

修复了移动端浏览器的兼容性问题。

​

1.2.0-beta.2

​

新增如下功能：

​

配置聊天框时新增支持

config.isIframe

参数，用于配置是否使用 iframe方式来打开聊天框。

​

配置属性时新增支持

ui.header

参数，用于控制是否展示顶部的标题栏和关闭按钮。

​

1.1.0-beta.0

​

Web SDK 更名为 Chat SDK。

​

支持通过 Chat SDK 调用扣子应用，展示扣子应用的聊天框。

​

1.0.0-beta.4

​

新版 Chat SDK，提供以下功能配置：

​

鉴权能力： 支持通过扣子访问令牌进行 OpenAPI 的鉴权，安全性更高。

​

用户识别：在 Chat SDK 的 UI 中显示不同的用户信息，包括头像、用户名、ID 等。

​

交互能力：丰富的交互能力，例如支持自定义设置打开聊天窗的方式

​

展示效果：支持调整聊天框中展示的用户信息、UI 效果、悬浮球效果、底部文案等配置

​

0.1.0-beta.5

​

历史版本的 Chat SDK，通过 componentProps 属性添加各种配置。

​

​

​

上一篇

安装并使用 Chat SDK

下一篇

（历史版本）Chat SDK
============================================================
# （历史版本）Chat SDK
来源: https://www.coze.cn/open/docs/developer_guides/web_sdk
============================================================

（历史版本）Chat SDK

扣子 Chat SDK是一个 JavaScript 库，您可以使用它将智能体集成到您的 Web 应用程序中。集成后，用户可从网页与智能体对话。

​

注意

1.0.0-beta.4 版本之前的 Chat SDK 为历史版本，开发者无需鉴权即可集成 SDK。历史版本 Chat SDK 仅提供基础的对话能力，安全性及扩展性较低，后续将不再维护和更新。推荐你使用最新版本的 Chat SDK

​

安装并使用 Chat SDK

，体验更安全、更友好的智能对话服务。

​

​

前提条件

​

已经在扣子平台创建了智能体。

​

安装 SDK

​

按照以下步骤通过将 JavaScript 库添加到您的 Web 应用程序来安装 SDK。

​

1.

登录

扣子

平台。

​

2.

查找要部署为 Web 服务的目标智能体。

​

3.

在

编排

页面，复制并保存当前页面 URL 的最后一个字符串。

​

这个是智能体id，将在以后的配置中使用。

​

4.

点击

发布

。

​

5.

在

发布

页面，选择 Chat SDK

选择并单击

发布。

​

发布 SDK 后才能在新的发布页面选择安装 SDK。

​

6.

回到智能体的编排页面，再次点击

发布

，进入

发布

页面。

​

7.

在

发布

页面，点击

安装

。

​

​

​

​

​

​

页面将展示智能体的安装代码。直接将代码粘贴到网页的 <body> 区域中即可。你也可以按需添加各种属性配置，支持属性可参考

​

初始化 SDK

。

​

说明

{{version}}

部分为 Chat SDK 的版本号，例如

0.1.0-beta.5

。

​

​

安装代码示例如下：

​

​

HTML

复制

<

script

src

=

"https://lf-cdn.coze.cn/obj/unpkg/flow-platform/chat-app-sdk/

{{version}}

/libs/cn/index.js"

></

script

>

​

<

script

>

​

new

CozeWebSDK

.

WebChatClient

({

​

config

: {

​

bot_id

:

'738176858****'

,

​

},

​

componentProps

: {

​

title

:

'Coze'

,

​

},

​

});

​

</

script

>

​

​

初始化 SDK

​

安装 Chat SDK 后，您现在可以初始化智能体客户端。将以下代码添加到您要初始化智能体客户端的页面中。

​

​

HTML

复制

<

script

>

​

new

CozeWebSDK

.

WebChatClient

(options);

​

</

script

>

​

​

options 参数包含 config 和 componentProps 两个属性，详细说明可参见下表。

​

​

属性

​

参数

​

是否必选

​

数据类型

​

描述

​

config

​

bot_id

​

必选

​

string

​

智能体ID。

​

进入智能体的 开发页面，开发页面 URL 中 bot 参数后的数字就是智能体ID。例如

https://www.coze.cn/space/341****/bot/73428668*****

，智能体ID 为

73428668*****

。

​

说明

确保该智能体已经发布为 Chat SDK。

​

​

componentProps

​

title

​

可选

​

string

​

智能体名字，如果没有配置，使用默认名：扣子 Bot。

​

​

icon

​

可选

​

string

​

智能体的显示图标，如果不设置，则使用默认扣子图标。

​

​

lang

​

可选

​

string

​

​

智能体的系统语言，例如智能体的工具提示。

​

en：（默认）英语

​

zh-CN：中文

​

​

​

​

​

​

​

layout

​

​

可选

​

string

​

智能体窗口的布局风格，支持设置为：

​

mobile：移动端风格。

​

pc：PC 端风格。

​

未设置此参数时，系统会自动识别设备，设置相应的布局风格。

​

​

width

​

可选

​

number

​

PC 端智能体窗口的宽度，单位为 px，默认为 460。

​

建议综合考虑各种尺寸的屏幕，设置一个合适的宽度。

​

仅在 layout = pc 时生效。

​

​

销毁 SDK 客户端

​

您可以添加一个 destroy 方法销毁智能体客户端。

​

​

HTML

复制

<

script

>

​

const

client =

new

CozeWebSDK

.

WebChatClient

(options);

​

client.

destroy

();

​

</

script

>

​

​

解绑智能体

​

如果你不需要智能体继续以 web 服务方式使用，在发布页面，点击

解绑

按钮。

​

说明

一旦

解绑

，智能体就无法通过集成的 Web 应用程序使用。 如果您想恢复 Web 应用程序的访问，需要再次将智能体发布为 Chat SDK。

​

​

示例

​

以下是一段完整的 Chat SDK 的代码示例。

​

​

HTML

复制

<!doctype

html

>

​

<

html

lang

=

"en"

>

​

<

head

>

​

<

style

>

​

/* 自定义悬浮入口的位置 */

​

#position_demo

{

​

position

: absolute;

​

right

:

10px

;

​

bottom

:

20px

;

​

}

​

</

style

>

​

</

head

>

​

<

body

>

​

<

h1

>

Hello Bot

</

h1

>

​

<

div

id

=

"position_demo"

></

div

>

​

//

{{version}}

为 Chat SDK 的版本号，例如

0.1.0-beta.5

。你可以在发布页面的安装代码中查看最新版本的version

​

<

script

src

=

"

https://lf-cdn.coze.cn/obj/unpkg/flow-platform/chat-app-sdk/

{{version}}

/libs/cn/index.js

"

></

script

>

​

<

script

>

​

const

bot_id =

'7330182852614******'

;

​

// 自定义智能体名称和icon

​

const

title =

'AI翻译助手'

;

​

const

icon =

'https://lf-bot-studio-plugin-resource.coze.cn/obj/bot-studio-platform-plugin-tos/artist/image/7e813aa2c7e14ebb9e2d1a989acfb128.png'

;

​

const

lang =

'zh-CN'

;

​

const

layout =

'pc'

;

​

const

width =

800

;

​

​

new

CozeWebSDK

.

WebChatClient

({

​

config

: {

​

bot_id,

​

},

​

componentProps

: {

​

title,

​

icon,

​

width,

​

},

​

el

:

document

.

getElementById

(

'position_demo'

),

​

});

​

</

script

>

​

</

body

>

​

</

html

>

​

​

在本地创建一个HTML文件，将上述代码复制进文件后，本地运行的效果如下所示。

​

说明

注意将 bot_id 替换为已经发布为 Chat SDK 的智能体的 ID，

{{version}}

替换为

发布

页面

安装

代码中的版本号。

​

​

其中：

​

图标 1 是

icon

参数值。

​

图标 2 是

title

参数值。

​

图标 3 是

lang

参数控制的语言配置。

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

​

上一篇

Chat SDK 发布历史

下一篇

Chat SDK 常见问题
============================================================
# Chat SDK 常见问题
来源: https://www.coze.cn/open/docs/developer_guides/chat_sdk_faq
============================================================

Chat SDK 常见问题

Chat SDK 如何实现会话隔离？

​

使用扣子 OpenAPI 或 SDK 和扣子智能体或应用对话时，扣子平台会将使用同一个访问密钥的对话看做同一个用户。如果业务侧不同的用户使用同一个扣子访问密钥鉴权，用户看到的对话记录中可能会夹杂其他用户的对话历史。

​

如需实现 Chat SDK 会话隔离，需要使用 OAuth JWT 鉴权方式，并在签署 JWT 时，在 payload 字段中添加 session_name 字段。session_name 中应指定用户在业务侧的 UID，String 类型。UID 由业务侧自行定义，扣子仅透传这个字段并用于签署 JWT、区分不同 session_name 的会话。详细说明可参考

​

如何实现会话隔离

。

​

可以通过 Web-view 的方式在小程序中加载 Chat SDK 吗？

​

不可以，web-view 方式无法加载第三方的域名。

​

建议在 Chat SDK config 属性中设置 isIframe = false，以非 iframe 的方式打开聊天框。通过该方式可以规避小程序中 webview 的域名限制。

​

为什么智能体发布到 Chat SDK 后，会获取到别人的聊天记录？

​

扣子智能体发布到 Chat SDK 后，如果打开时会获取到别人的聊天记录，即使已设置 userInfo 参数也无效，这通常是由于未进行会话隔离所导致的。为避免不同账号的聊天记录互相可见，需要进行会话隔离。思路如下：

​

1.

在使用 OAuth JWT 授权时，在 payload 字段中添加 session_name 字段，该字段值为用户的唯一标识，如用户 ID。

​

2.

在 ChatSDK 中，将

auth

的

token

参数设置为用户对应的 Token，确保每位用户在与智能体对话时，都使用各自的JWT Token。详细步骤可参考

​

如何实现会话隔离

。

​

为什么在移动端设置 isNeedAudio 为 true 后，仍无法使用语音输入功能？

​

移动端支持 isNeedAudio 参数的语音输入功能，若设置后不生效，请检查集成环境是否已使用 HTTPS 协议。该功能需要在 HTTPS 环境下使用。

​

Chat SDK 悬浮球位置如何移动？

​

Chat SDK 悬浮球的位置默认在页面右下角，不支持移动，如果需要调整悬浮球的位置，你可以隐藏默认的悬浮球，自定义悬浮球的位置和样式。实现方法如下：

​

1.

设置

ui.asstBtn.isNeed=false

，隐藏悬浮球。

​

​

TypeScript

复制

// 在WebChatClient参数中，添加ui.asstBtn配置

​

const

cozeWebSDK =

new

CozeWebSDK

.

WebChatClient

({

​

config

: {

​

botId

:

'740849137970326****'

,

​

isIframe

:

false

,

​

},

​

auth

: {

​

type

:

'token'

,

​

token

:

'pat_zxzSAzxawer234zASNElEGALlq7hcOqMcPFV3wEVDiqjrg****'

,

​

onRefreshToken

:

async

() =>

'pat_zxzSAzxawer2OqMcPFV3wEVDiqjrg****'

,

​

},

​

ui

: {

​

// 悬浮球配置

​

asstBtn

: {

​

isNeed

:

false

// 隐藏悬浮球

​

}

​

}

​

});

​

​

2.

自定义悬浮球按钮。

​

在页面任意位置添加自定义按钮，点击后调用 Chat SDK 方法打开聊天窗口。

​

​

HTML

复制

<!-- 自定义悬浮球按钮 -->

​

<

button

​

id

=

"custom-asst-btn"

​

style

=

"position: fixed; right: 50px; bottom: 50px; z-index: 9999;"

​

onclick

=

"cozeWebSDK.showChatBot();"

​

>

​

</

button

>

​

​

<

button

onclick

=

"cozeWebSDK.showChatBot();"

>

显示聊天框

</

button

>

​

<

button

onclick

=

"cozeWebSDK.hideChatBot();"

>

隐藏聊天框

</

button

>

​

</

body

>

​

​

使用 Chat SDK 发消息时提示“Your free quota has been used up”是什么原因？

​

个人免费版账号使用 Chat SDK 的免费额度为

100 次对话/账号

。即使你账号中还有剩余资源点，当累计对话次数超过该额度后，账号将无法继续使用扣子 Chat SDK。

​

使用 Chat SDK 为什么没有获取智能体的开场白？

​

若智能体中已设置开场白，且希望在 Chat SDK 中正常显示开场白，请确保将该智能体

同时发布至 API 渠道和 Chat SDK 渠道

。

​

若仅发布 Chat SDK 渠道而未发布 API 渠道，可能导致 Chat SDK 无法获取智能体的开场白配置。

​

​

上一篇

（历史版本）Chat SDK

下一篇

Python SDK 概述
============================================================
# Python SDK 概述
来源: https://www.coze.cn/open/docs/developer_guides/python_overview
============================================================

Python SDK 概述

Coze API SDK for Python 是一个扣子官方提供的 SDK 工具包，你可以通过 Python SDK 将扣子的 OpenAPI 集成到你的应用程序中。Coze Python SDK 支持所有扣子的官方鉴权方式，支持同步或异步函数调用，具备高度的灵活性和高可用性，显著提升 OpenAPI 的使用效率。你可以通过 pip 快速安装 Coze Python SDK，用你的访问密钥初始化 SDK，然后就可以开始安全、高效地通过 OpenAPI 访问你的 AI 智能体。

​

Coze Python SDK 针对流式响应的 API 进行了优化，返回 Stream 和 AsyncStream 对象以实现实时数据处理。同时，Coze Python SDK 遵循用户友好的设计风格，可简化你的开发工作，且适用于所有技能水平开发者使用。

​

源码地址

​

访问

GitHub

获取 Coze API SDK for Python 源码。

​

注意

从扣子 GitHub 仓库获取的源码和示例代码中，

base_url

默认设置为域名

COZE_COM_BASE_URL

，使用源码前应手动将其修改为域名

COZE_CN_BASE_URL

。

​

​

示例代码

​

Coze Python SDK 提供各种授权方式、各种使用方式的示例代码，便于开发者直接参考使用。

​

说明

Coze Python SDK 支持扣子所有 OpenAPI，对应的 API 文档可参考

​

API 介绍

。

​

示例代码将持续更新和补充，各种场景的 Coze Python SDK

最新版本

示例代码可参考

GitHub

。

​

​

常见场景的示例代码及说明如下：

​

​

模块

​

示例文件

​

说明

​

授权

​

examples/

auth_pat.py

​

通过个人访问密钥实现 OpenAPI 鉴权。

​

​

examples/

auth_oauth_web.py

​

通过 OAuth 授权码方式实现授权与 OpenAPI 鉴权。

​

​

examples/

auth_oauth_jwt.py

​

通过 OAuth JWT 方式实现授权与 OpenAPI 鉴权。

​

​

examples/

auth_oauth_pkce.py

​

通过 OAuth PKCE 方式实现授权与 OpenAPI 鉴权。

​

​

examples/

auth_oauth_device.py

​

通过 OAuth 设备码方式实现授权与 OpenAPI 鉴权。

​

对话

​

examples/

chat_no_stream.py

​

发起对话，响应方式为非流式响应。

​

​

examples/

chat_stream.py

​

发起对话，响应方式为流式响应。

​

​

examples/

chat_multimodal_stream.py

​

发起对话，对话中上传文件，并发送多模态内容。

​

​

examples/

chat_simple_audio.py

​

语音消息，对话时通过语音输入消息。

​

​

examples/

chat_oneonone_audio.py

​

实时语音通话。

​

​

examples/

chat_local_plugin.py

​

端插件。

​

会话

​

examples/

conversation.py

​

创建对话、向对话中添加消息以及清除对话内容等。

​

​

examples/

conversation_list.py

​

查询对话列表。

​

工作流

​

examples/

workflow_no_stream.py

​

运行工作流，响应方式为非流式响应。

​

​

examples/

workflow_stream.py

​

运行工作流，响应方式为流式响应，且工作流中包含问答节点。

​

​

examples/

workflow_async.py

​

异步运行工作流，并获取工作流运行结果。

​

​

​

examples/

workflow_chat_stream.py

​

运行对话流。

​

​

examples/

workflow_chat_multimode_stream.py

​

​

在对话流中上传图片，实现多模态交互。包括图片上传、流式响应处理及对话管理等操作。

​

智能体管理

​

examples/

bot_publish.py

​

创建一个草稿状态的智能体，更新智能体，并发布智能体为 API 服务。

​

工作空间

​

/examples/

workspaces_list.py

​

查询所有工作空间列表。

​

​

/examples/

workspaces_members_create.py

​

批量邀请用户加入指定的工作空间。

​

​

/examples/

workspaces_members_delete.py

​

批量移除工作空间中的成员。

​

知识库

​

examples/

dataset_create.py

​

创建知识库、上传知识库文件。

​

语音合成

​

examples/

audio.py

​

将文本转为语音，并将生成的语音保存为音频文件。

​

文件管理

​

examples/

files_upload.py

​

文件上传。

​

复制模板

​

examples/

template_duplicate.py

​

复制商店中的模板到指定工作空间。

​

用户

​

examples/

users_me.py

​

获取当前用户信息，如用户 ID、用户名等。

​

变量

​

examples/

variable_retrieve.py

​

获取用户变量的值。

​

​

examples/

variable_update.py

​

设置用户变量的值。

​

异常处理

​

examples/

exception.py

​

处理 API 异常。

​

日志处理

​

examples/

log.py

​

修改日志级别。

​

超时时间

​

examples/

timeout.py

​

配置超时时间，确保 API 请求在规定时间内完成。

​

​

异常处理

​

当调用 API 失败时，SDK 会抛出 CozeAPIError 异常；当 PKCE OAuth 出现异常时，SDK 会抛出 CozePKCEAuthError 异常；当对话或者工作流流式运行时返回非法的事件（event）时，SDK 会抛出 CozeInvalidEventError 异常。

​

所有的异常都继承自 CozeError。开发者可以根据自己的需求捕获对应的异常，其中 CozeAPIError 异常会获取到异常接口的错误码，API 错误码的相关说明及处理方式可参考

​

错误码

。

​

上一篇

Chat SDK 常见问题

下一篇

安装 Python SDK
============================================================
# 安装 Python SDK
来源: https://www.coze.cn/open/docs/developer_guides/python_installation
============================================================

安装 Python SDK

使用 Coze Python SDK 之前，你需要先参考本文档安装 Python SDK。

​

环境准备

​

Coze Python SDK 适用于Python 3.7 及以上版本。安装 Python SDK 之前，建议执行以下命令确认你已安装 3.7 及以上版本的 Python。

​

​

Bash

复制

# 查看 Python 版本

​

python --version

​

​

# 回显信息显示已安装 3.8.2 版本

​

Python 3.8.2

​

​

安装 SDK

​

你可以通过 pip 方式安装 Coze Python SDK，Python 3.7 以上版本已默认安装 pip。如果你使用的是 poetry 等依赖管理工具，也可以使用

poetry add cozepy

方式安装 SDK。对于其他依赖管理工具，可以参考对应工具的官方文档进行操作。本文档以 pip 方式安装 SDK 为例。

​

执行以下命令，安装 Coze Python SDK。

​

​

Bash

复制

pip install cozepy

​

​

说明

安装 Coze Python SDK 时，默认安装最新版本。你也可以

点击此处

查看 Coze Python SDK 已发布的所有历史版本。更多信息，请参见

README

。

​

​

上一篇

Python SDK 概述

下一篇

配置访问密钥
============================================================
# 配置访问密钥
来源: https://www.coze.cn/open/docs/developer_guides/python_access_token
============================================================

配置访问密钥

通过 Python SDK 方式调用扣子编程 OpenAPI 时，需要在 SDK 请求中配置访问密钥，用于身份信息认证和权限校验。扣子编程 OpenAPI 提供个人访问密钥和 OAuth 两种鉴权方式，你可以选择当前业务场景适合的鉴权方式，并获取对应的访问密钥。

​

对于 OAuth 授权码等授权方式，Coze Python SDK 已经封装了这部分代码，并处理了不同的返回错误代码，简化你的操作。

​

配置方式

​

扣子编程 OpenAPI 目前支持的鉴权方式如下。

​

​

访问密钥类型

​

鉴权方式

​

说明

​

示例文件

​

个人访问密钥（PAT）

​

个人访问密钥（PAT）

​

Personal Access Token，简称 PAT。扣子编程中生成的个人访问令牌。PAT 生成与使用便捷，适用于测试环境调试等场景。每个令牌可以关联多个空间，并开通指定的接口权限。生成方式可参考

​

添加个人访问令牌

。

​

examples/

auth_pat.py

​

服务访问令牌（SAT）

​

服务访问令牌（SAT）

​

Service Access Token（简称 SAT）是以服务身份创建的访问凭证，可

长期有效

访问扣子编程资源，通常用于服务/应用程序的身份验证和授权。生成方式可参考

​

添加服务访问令牌

。

​

SAT 的示例代码与 PAT 通用，可直接参考 PAT 的示例文件。

​

examples/

auth_pat.py

​

OAuth 认证

​

​

授权码授权

​

（Authorization Code Flow）

​

适用于有显著前后端之分的应用程序授权场景。其中前端模块负责与用户交互，后端服务处理前端请求，与扣子编程授权服务器和 OpenAPI 交互。 实现流程可参考

​

OAuth 授权码授权

。

​

examples/

auth_oauth_web.py

​

​

PKCE 授权

​

（Authorization Code Flow with PKCE）

​

应用程序无后端服务，所有操作都发生在应用程序的前端。 实现流程可参考

​

OAuth PKCE

。

​

examples/

auth_oauth_pkce.py

​

​

设备码授权

​

（Device Code Flow）

​

应用程序无后端服务，所有操作都发生在应用程序的 Command Line，且 Command Line 无法提供“同意授权”的操作。 实现流程可参考

​

OAuth 设备授权

。

​

examples/

auth_oauth_device.py

​

​

JWT 授权

​

（JWT Flow）

​

应用程序服务端直接调用扣子编程 OpenAPI。

​

应用程序后端服务代理应用程序自己的用户获取身份凭据，应用程序用户基于凭据直接访问 OpenAPI。 实现流程可参考

​

OAuth JWT 授权（开发者）

。

​

examples/

auth_oauth_jwt.py

​

​

配置个人访问密钥（PAT）

​

如果选择使用个人访问密钥鉴权，你需要先申请一个个人访问密钥，并添加指定空间和权限。操作步骤可参考

添加个人访问令牌

。

​

扣子编程建议你通过环境变量的方式管理访问密钥，避免在代码中通过硬编码方式进行编程，以免密钥泄露、引发安全风险。配置环境变量之后，您可以在不修改代码的情况下，将动态的鉴权参数传递到对应的函数，实现便捷安全的身份认证。

​

1.

设置环境变量。

​

其中 COZE_API_TOKEN 是扣子编程中申请的个人访问密钥。关于环境变量的详细说明可参考

Python 官方文档

。

​

​

Shell

复制

export COZE_API_TOKEN="

pat_****

"

​

​

2.

初始化客户端。

​

示例代码如下：

​

​

Python

复制

import

os

​

​

from

cozepy

import

Coze, TokenAuth, COZE_CN_BASE_URL

​

​

# 通过环境变量引入密钥，访问 coze.cn 服务

​

coze = Coze(auth=TokenAuth(os.getenv(

"COZE_API_TOKEN"

)), base_url=COZE_CN_BASE_URL)

​

​

配置 OAuth 授权码流程

​

如果选择使用 OAuth 授权码方式完成授权，可参考以下流程及示例代码。

​

1.

创建 OAuth 应用。

​

具体操作步骤可参考

​

OAuth 授权码授权

。成功创建 OAuth 应用后，你将获得客户端 ID、客户端密钥和重定向地址。你需要妥善保管客户端密钥，以免数据泄露引发安全风险。

​

2.

在代码中通过环境变量方式设置客户端 ID、客户端密钥和重定向地址。

​

​

Python

复制

import

os

​

from

cozepy

import

Coze, TokenAuth, WebOAuthApp, COZE_CN_BASE_URL

​

​

# Auth应用的客户端ID，创建 OAuth 应用时获取的客户端 ID。

​

web_oauth_client_id = os.getenv(

"COZE_WEB_OAUTH_CLIENT_ID"

)

​

# 客户端密钥

​

web_oauth_client_secret = os.getenv(

"COZE_WEB_OAUTH_CLIENT_SECRET"

)

​

​

# 访问 coze.cn 服务

​

web_oauth_app = WebOAuthApp(

​

client_id=web_oauth_client_id,

​

client_secret=web_oauth_client_secret,

​

base_url=COZE_CN_BASE_URL,

​

)

​

​

3.

授权码流程中，会自动生成一个扣子编程授权页面，然后将其发送给需要授权的用户。扣子用户可访问此链接，并根据页面提示完成授权流程。

​

​

Python

复制

# redirect link

​

web_oauth_redirect_uri = os.getenv(

"COZE_WEB_OAUTH_REDIRECT_URI"

)

​

​

# Generate the authorization link and direct the user to open it.

​

url = web_oauth_app.get_oauth_url(redirect_uri=web_oauth_redirect_uri)

​

​

4.

用户点击同意授权按钮后，扣子网页会将请求重定向到授权链接中配置的重定向地址，并通过 Query 在地址中携带授权码和状态参数。

​

通过授权码（OAuth code）调用 OpenAPI 接口即可获取 OAuth Access Token。示例代码如下：

​

​

Python

复制

# Open the authorization link in your browser and authorize this OAuth App

​

# After authorization, you will be redirected to the redirect_uri with a code and state

​

# You can use the code to get the access token

​

code =

'mock code'

​

​

# After obtaining the code after redirection, the interface to exchange the code for a

​

# token can be invoked to generate the coze access_token of the authorized user.

​

oauth_token = web_oauth_app.get_access_token(redirect_uri=web_oauth_redirect_uri, code=code)

​

​

# use the access token to init Coze client

​

coze = Coze(auth=TokenAuth(oauth_token.access_token), base_url=COZE_CN_BASE_URL)

​

​

# When the token expires, you can also refresh and re-obtain the token

​

oauth_token = web_oauth_app.refresh_access_token(oauth_token.refresh_token)

​

​

配置 OAuth PKCE 授权流程

​

如果选择使用 OAuth PKCE 方式完成授权，可参考以下流程及示例代码。

​

1.

创建 OAuth 应用。

​

具体操作步骤可参考

​

OAuth PKCE

。成功创建 OAuth 应用后，你将获得客户端 ID 和重定向地址。

​

2.

在代码中通过环境变量方式设置客户端 ID 和重定向地址。

​

​

Python

复制

import

os

​

​

from

cozepy

import

PKCEOAuthApp, COZE_CN_BASE_URL

​

​

# OAuth应用的客户端ID，创建 OAuth 应用时获取的客户端 ID。

​

pkce_oauth_client_id = os.getenv(

"COZE_PKCE_OAUTH_CLIENT_ID"

)

​

# 重定向地址，创建 OAuth 应用时指定的重定向 URL。

​

pkce_oauth_redirect_uri = os.getenv(

"COZE_WEB_OAUTH_REDIRECT_URI"

)

​

​

pkce_oauth_app = PKCEOAuthApp(client_id=pkce_oauth_client_id, base_url=COZE_CN_BASE_URL)

​

​

3.

在代码中实现 OAuth PKCE 授权流程、

​

客户端生成一个随机值 code_verifier，并根据指定算法将其转换为 code_challenge，算法通常使用 SHA-256 算法。然后基于回调地址、code_challenge 和 code_challenge_method，生成一个授权链接。

​

​

Python

复制

# In the SDK, we have wrapped up the code_challenge process of PKCE. Developers only need

​

# to select the code_challenge_method.

​

code_verifier =

"random code verifier"

​

url = pkce_oauth_app.get_oauth_url(

​

redirect_uri=web_oauth_redirect_uri,

​

code_verifier=code_verifier,

​

code_challenge_method=

"S256"

​

)

​

​

4.

完成授权。

​

开发者应该引导用户打开这个授权链接。当用户同意授权时，扣子编程会将页面重定向到开发者配置的回调地址，开发者可以获取这个 code，换取访问密钥。

​

​

Python

复制

# Open the authorization link in your browser and authorize this OAuth App

​

# After authorization, you can exchange code_verifier for access token

​

code =

'mock code'

​

​

# After obtaining the code after redirection, the interface to exchange the code for a

​

# token can be invoked to generate the

coze

access_token of the authorized user.

​

oauth_token = pkce_oauth_app.get_access_token(

​

redirect_uri=web_oauth_redirect_uri, code=code, code_verifier=code_verifier

​

)

​

​

# use the access token to init Coze client

​

coze = Coze(auth=TokenAuth(oauth_token.access_token), base_url=COZE_CN_BASE_URL)

​

​

# When the token expires, you can also refresh and re-obtain the token

​

oauth_token = pkce_oauth_app.refresh_access_token(oauth_token.refresh_token)

​

​

配置 OAuth 设备码授权流程

​

如果选择使用 OAuth 设备码方式完成授权，可参考以下流程及示例代码。

​

1.

创建 OAuth 应用。

​

具体操作步骤可参考

​

OAuth 设备授权

。成功创建 OAuth 应用后，你将获得客户端 ID。

​

2.

在代码中通过环境变量方式设置客户端 ID。

​

​

Python

复制

import

os

​

from

cozepy

import

Coze, TokenAuth, DeviceOAuthApp, COZE_CN_BASE_URL

​

​

# OAuth应用的客户端ID，创建 OAuth 应用时获取的客户端 ID。

​

device_oauth_client_id = os.getenv(

"COZE_DEVICE_OAUTH_CLIENT_ID"

)

​

​

device_oauth_app = DeviceOAuthApp(client_id=device_oauth_client_id, base_url=COZE_CN_BASE_URL)

​

​

3.

通过 OAuth 设备码授权流程获得访问密钥。

​

应用程序需要调用扣子编程 OpenAPI 生成设备代码，以获取 user_code 和 device_code。通过 user_code 生成授权链接，并引导用户打开该链接、填写 user_code、同意授权。应用程序调用扣子编程 OpenAPI，通过 device_code 生成访问密钥。

​

如果用户尚未授权或拒绝了授权，接口将抛出异常并返回特定的错误代码。用户同意授权后，接口将成功并返回访问密钥。

​

​

Python

复制

# First, you need to request the server to obtain the device code required in the device auth flow

​

device_code = device_oauth_app.get_device_code()

​

​

# The returned device_code contains an authorization link. Developers need to guide users

​

# to open up this link.

​

# open device_code.verification_url

​

​

4.

应用程序还需要使用 device_code 来轮询扣子编程 OpenAPI 以获取访问密钥。

​

Coze Python SDK已经封装了这部分代码，并处理了不同的返回错误代码。开发者只需要调用 get_access_token 即可。

​

​

Python

复制

try

:

​

oauth_token = device_oauth_app.get_access_token(

​

device_code=device_code.device_code,

​

poll=

True

,

​

)

​

except

CozePKCEAuthError

as

e:

​

if

e.error == CozePKCEAuthErrorType.ACCESS_DENIED:

​

# The user rejected the authorization.

​

# Developers need to guide the user to open the authorization link again.

​

pass

​

elif

e.error == CozePKCEAuthErrorType.EXPIRED_TOKEN:

​

# The token has expired. Developers need to guide the user to open

​

# the authorization link again.

​

pass

​

else

:

​

# Other errors

​

pass

​

​

raise

# for example, re-raise the error

​

​

# use the access token to init Coze client

​

coze = Coze(auth=TokenAuth(oauth_token.access_token), base_url=COZE_CN_BASE_URL)

​

​

# When the token expires, you can also refresh and re-obtain the token

​

oauth_token = device_oauth_app.refresh_access_token(oauth_token.refresh_token)

​

​

配置 OAuth JWT 授权流程

​

如果选择使用 OAuth JWT 方式完成授权，可参考以下流程及示例代码。

​

1.

创建 OAuth 应用并授权。

​

具体操作步骤可参考

​

OAuth JWT 授权（开发者）

。成功创建 OAuth 应用后，你将获得客户端 ID、公钥和私钥。你需要妥善保管公钥和私钥，以免数据泄露引发安全风险。

​

2.

在代码中通过环境变量方式设置客户端 ID、公钥和私钥。

​

​

Python

复制

import

os

​

from

cozepy

import

Coze, TokenAuth, JWTOAuthApp, COZE_CN_BASE_URL

​

​

# OAuth应用的客户端ID，创建 OAuth 应用时获取的客户端 ID。

​

jwt_oauth_client_id = os.getenv(

"COZE_JWT_OAUTH_CLIENT_ID"

)

​

# OAuth 应用的私钥，创建 OAuth 应用时获取的私钥。

​

jwt_oauth_private_key =

os.getenv(

"COZE_JWT_OAUTH_PRIVATE_KEY"

)

​

# OAuth 应用的

公钥指纹

，可以在

OAuth 应用

页面找到这个应用，在

操作

列单击编辑图标，进入

配置

页面查看公钥指纹。

​

jwt_oauth_public_key_id = os.getenv(

"COZE_JWT_OAUTH_PUBLIC_KEY_ID"

)

​

​

jwt_oauth_app = JWTOAuthApp(

​

client_id=jwt_oauth_client_id,

​

private_key=jwt_oauth_private_key,

​

public_key_id=jwt_oauth_public_key_id,

​

base_url=COZE_CN_BASE_URL

​

)

​

​

3.

应用程序通过公钥和私钥签署 JWT，并通过扣子编程提供的 API 获取访问密钥。

​

Coze Python SDK 封装了这一过程，你只需要在OAuth JWT 流程中使用 get_access_token 来获取访问密钥即可。

​

​

Python

复制

# The jwt process does not require any other operations, you can directly apply for a token

​

oauth_token = jwt_oauth_app.get_access_token(ttl=

3600

)

​

​

# use the access token to init Coze client

​

coze = Coze(auth=TokenAuth(oauth_token.access_token), base_url=COZE_CN_BASE_URL)

​

​

# The jwt oauth process does not support refreshing tokens. When the token expires,

​

# just directly call get_access_token to generate a new token.

​

​

上一篇

安装 Python SDK

下一篇

快速开始
============================================================
# 快速开始
来源: https://www.coze.cn/open/docs/developer_guides/python_getting_started
============================================================

快速开始

本文介绍如何使用扣子编程 Python SDK 完成扣子编程的常用操作，例如如何初始化 SDK、创建一个智能体草稿、发布智能体为 API 服务、和智能体对话等。

​

说明

初始化之前，请确认已完成以下操作：

​

已安装扣子编程 Python SDK。更多信息，可参见

​

安装 Python SDK

。

​

已实现授权流程，并通过环境变量等方式配置了访问密钥。详细说明可参考

​

配置访问密钥

。

​

请确保扣子编程 Python SDK 版本已升级至

0.17.0

及之后版本，以免调用

​

发起对话

或

​

执行对话流

API 失败。

​

​

初始化 SDK

​

初始化扣子编程 client 之后，才可以向扣子编程服务端发送 OpenAPI 请求。初始化时推荐通过环境变量动态获取访问密钥，以免硬编码引发数据安全风险。

​

初始化代码如下：

​

​

Python

复制

import

os

​

​

from

cozepy

import

Coze, TokenAuth, COZE_CN_BASE_URL

​

# 扣子编程建议你通过环境变量的方式管理访问密钥，关于环境变量的详细说明可参考

Python 官方文档

。

​

coze = Coze(auth=TokenAuth(os.getenv(

"coze_api_token"

)), base_url=COZE_CN_BASE_URL)

​

​

创建并发布智能体为 API 服务

​

通过 API 方式和智能体对话之前，你需要先创建一个智能体，并将其发布为 API 服务。你可以通过扣子编程平台或调用相关的 API 实现智能体的创建和发布。

​

通过扣子编程创建和发布智能体的操作请参见

​

搭建一个 AI 助手智能体

、

​

发布智能体为 API 服务

。

​

通过 API 创建和发布智能体的接口文档请参见

​

创建智能体

、

​

发布智能体

。

​

说明

调用 API 创建智能体时，部分配置对应的 API 参数暂未开放，你只能为智能体添加知识库等有限的配置。

​

​

示例代码如下：

​

完整的示例代码，请参见

examples/

bot_publish.py

示例源码

。

​

​

Python

复制

import

os

# noqa

​

from

pathlib

import

Path

​

​

# Get an access_token through personal access token oroauth.

​

coze_api_token = os.getenv(

"COZE_API_TOKEN"

)

​

​

from

cozepy

import

Coze, TokenAuth, BotPromptInfo, Message, ChatEventType, MessageContentType

# noqa

​

​

# Init the Coze client

​

coze = Coze(auth=TokenAuth(token=coze_api_token), base_url=COZE_CN_BASE_URL)

​

​

# Call the upload file interface to get the avatar id.

​

avatar = coze.files.upload(file=Path(

"/path/avatar.jpg"

))

​

​

# Invoke the create interface to create a bot in the draft status.

​

bot = coze.bots.create(

​

# The bot should exist under a space and your space id needs configuration.

​

space_id=

"workspace

id"

,

​

# Bot name

​

name=

"translator bot"

,

​

# Bot avatar

​

icon_file_id=avatar.

id

,

​

# Bot system prompt

​

prompt_info=BotPromptInfo(prompt=

"your are a translator, translate the following text from English to Chinese"

),

​

)

​

​

# Call the publish interface to publish the bot on the api channel.

​

coze.bots.publish(bot_id=bot.bot_id)

​

​

# Call the coze.chat.stream method to create a chat. The create method is

a

streaming

​

# chat and will return a Chat Iterator. Developers should iterate the iterator to get

​

# chat event and handle them.

​

for

event

in

coze.chat.stream(

​

# The published bot's id

​

bot_id=bot.bot_id,

​

# biz user id, maybe random string

​

user_id=

"user id"

,

​

# user input

​

additional_messages=[Message.build_user_question_text(

"chinese"

)],

​

):

​

if

(

​

event.event == ChatEventType.CONVERSATION_MESSAGE_DELTA

​

and

event.message.content.

type

== MessageContentType.TEXT

​

):

​

print

(event.message.content, end=

""

)

​

​

发起对话

​

​

发起对话

接口用于向指定智能体发起一次对话，支持在对话时添加对话的上下文消息，以便智能体基于历史消息做出合理的回复。开发者可以按需选择响应方式，即流式或非流式响应，响应方式决定了开发者获取智能体回复的方式。

​

流式响应

：智能体在生成回复的同时，将回复消息以数据流的形式逐条发送给客户端。处理结束后，服务端会返回拼接后完整的智能体回复。详细说明可参考

流式响应

。

​

非流式响应

：无论对话是否处理完毕，立即发送响应消息。开发者可以通过接口

查看对话详情

确认本次对话处理结束后，再调用

查看对话消息详情

接口查看模型回复等完整响应内容。详细说明可参考

非流式响应

。

​

本文档以流式响应为例，演示通过 API 方式和智能体对话相关示例代码。你也可以查看 Coze Python SDK

示例代码目录

，查看发起对话接口的其他实现方式，例如非流式响应、对话中发送多模态内容等。

​

示例代码如下：

​

​

Python

复制

import

os

# noqa

​

​

# Get an access_token through personal access token oroauth.

​

coze_api_token = os.getenv(

"COZE_API_TOKEN"

)

​

​

from

cozepy

import

Coze, TokenAuth, Message, ChatStatus, MessageContentType, ChatEventType

# noqa

​

​

# Init the Coze client through

the

access_token.

​

coze = Coze(auth=TokenAuth(token=coze_api_token), base_url=COZE_CN_BASE_URL)

​

​

# Create a bot instance in Coze, copy the last number from the web link as the bot's ID.

​

bot_id =

"bot id"

​

# The user id identifies the identity of a user. Developers can use a custom business

ID

​

# or a random string.

​

user_id =

"user id"

​

​

# Call the coze.chat.stream method to create a chat. The create method is

a

streaming

​

# chat and will return a Chat Iterator. Developers should iterate the iterator to get

​

# chat event and handle them.

​

for

event

in

coze.chat.stream(

​

bot_id=bot_id, user_id=user_id, additional_messages=[Message.build_user_question_text(

"How are you?"

)]

​

):

​

if

event.event == ChatEventType.CONVERSATION_MESSAGE_DELTA:

​

message = event.message

​

print

(

f"role=

{message.role}

, content=

{message.content}

"

)

​

​

上一篇

配置访问密钥

下一篇

Node.js SDK 概述
============================================================
# Node.js SDK 概述
来源: https://www.coze.cn/open/docs/developer_guides/nodejs_overview
============================================================

Node.js SDK 概述

扣子

Node.js SDK 是

扣子

官方提供的开发工具包，旨在帮助开发者轻松将

扣子

的 AI 能力集成到应用程序中。Node.js SDK 适合各类开发者使用，无论是初学者还是专业开发人员，都能快速上手并实现所需功能。

​

核心特性

​

以下是 Node.js SDK 的一些核心特性，帮助你更好地了解其功能和优势：

​

全面的 API 支持：完整支持

扣子

开放平台的所有 API。

​

多样化的认证方式：支持 PAT、和授权码、JWT、Device、PKCE OAuth 等多种认证方式

。

​

流式响应优化：针对聊天和工作流提供实时数据流支持。

​

跨平台兼容：同时支持 Node.js（≥14）和主流浏览器环境。

​

灵活配置选项：提供超时、自定义请求头、中断等配置项。

​

技术优势

​

Node.js SDK 具备以下技术优势：

​

简单易用：提供直观的 API 接口设计，降低使用门槛。

​

类型安全：完整的 TypeScript 类型定义，提供更好的开发体验。

​

错误处理：统一的错误处理机制，便于调试和问题排查。

​

实时响应：针对流式 API 优化，支持实时数据处理。

​

源码地址

​

访问

GitHub

获取 Node.js SDK 源码。

​

注意

从扣子 GitHub 仓库获取的源码和示例代码中，

base_url

默认设置为域名

COZE_COM_BASE_URL

，使用源码前应手动将其修改为域名

COZE_CN_BASE_URL

。

​

​

示例代码

​

Node.js SDK 提供各种授权方式、各种使用方式的示例代码，便于开发者直接参考使用。

​

说明

Coze Node.js SDK 支持扣子所有 OpenAPI，对应的 API 文档可参考

​

API 介绍

。

​

示例代码将持续更新和补充，各种场景的 Coze Node.js SDK

最新版本

示例代码可参考

GitHub

。

​

​

常见场景的示例代码及说明如下：

​

​

模块

​

示例文件

​

说明

​

授权

​

auth/auth-pat.ts

​

通过个人访问密钥实现 OpenAPI 鉴权。

​

​

auth/auth-oauth-web.ts

​

通过 OAuth 授权码方式实现 OpenAPI 鉴权。

​

​

auth/auth-oauth-jwt.ts

​

通过 OAuth JWT 方式实现 OpenAPI 鉴权。

​

​

auth/auth-oauth-jwt-channel.ts

​

通过 OAuth JWT 渠道方式实现 OpenAPI 鉴权

​

​

auth/auth-oauth-pkce.ts

​

通过 OAuth PKCE 方式实现 OpenAPI 鉴权。

​

​

auth/auth-oauth-device.ts

​

通过 OAuth 设备码方式实现 OpenAPI 鉴权。

​

对话

​

chat.ts

​

​

发起对话，包含：

​

流式对话响应。

​

非流式对话响应。

​

取消对话。

​

​

chat-with-file.ts

​

发起对话，对话中上传文件，并发送多模态内容。

​

​

chat-local-plugin.ts

​

端插件。

​

工作流

​

​

workflow.ts

​

执行工作流，包含：

​

流式工作流响应。

​

非流式工作流响应。

​

智能体管理

​

bot.ts

​

​

智能体操作，包含：

​

创建智能体。

​

更新智能体。

​

发布智能体为 API 服务。

​

获取智能体列表。

​

获取单个智能体详情。

​

工作空间

​

workspace.ts

​

查询工作空间列表。

​

文件上传

​

file.ts

​

文件上传，包含：

​

文件上传。

​

获取文件详情。

​

会话与消息管理

​

conversation.ts

​

会话与消息管理，包含：

​

创建会话。

​

创建、更新、删除消息。

​

获取会话下的消息列表。

​

知识库管理

​

datasets.ts

​

知识库管理，包含：

​

创建、查询、更新和删除知识库。

​

上传文本和图片类型的知识库文件。

​

更新图片知识库的描述。

​

变量

​

variables.ts

​

变量管理，包含：

​

获取用户变量的值。

​

设置用户变量的值。

​

语音

​

voice.ts

​

ASR、TTS 与音色相关功能，包含：

​

音色克隆。

​

语音合成，将文本转为语音，并将生成的语音保存为音频文件。

​

查询音色列表。

​

语音识别，将指定音频文件转录为文本。

​

WebSocket语音

​

chat.ts

​

WebSocket 语音通话。

​

​

speech.ts

​

语音合成，将文本转为语音，并将生成的语音保存为音频文件。

​

​

transcriptions.ts

​

语音识别，将指定音频文件转录为文本。

​

声纹识别

​

voiceprint.ts

​

声纹识别，包含

​

创建、查询和修改声纹组。

​

创建、查询、更新、删除声纹特征。

​

声纹特征比对。

​

复制模板

​

templates.ts

​

复制商店中的模板到指定工作空间。

​

用户

​

users-me.ts

​

获取当前用户信息，如用户 ID、用户名等。

​

代理

​

proxy/proxy-example.ts

​

通过代理服务器访问扣子 API。

​

异常处理

​

error-handle.ts

​

处理 API 异常。

​

网络请求配置

​

request-options.ts

​

支持大部分 axios 配置。

​

​

异常处理

​

Node.js SDK 提供了完善的异常处理机制，所有异常类都继承自 CozeError 基类。当 API 调用失败时，Node.js SDK 会抛出相应的异常类型，便于开发者进行错误处理和调试。Node.js SDK 封装了以下常见的异常类型：

​

​

异常类

​

HTTP 状态码

​

说明

​

BadRequestError

​

400

​

请求参数错误。通常是参数格式、类型或值域不符合要求。

​

AuthenticationError

​

401

​

身份认证失败，可能是 token 无效或已过期。

​

PermissionDeniedError

​

403

​

权限不足，当前身份无权访问目标资源。

​

NotFoundError

​

404

​

资源不存在，请求的 API 接口或资源未找到。

​

RateLimitError

​

429

​

请求频率超限，需要降低 API 调用频率。

​

TimeoutError

​

408

​

请求超时，服务器在预期时间内未收到完整请求。

​

GatewayError

​

502

​

网关错误，上游服务暂时不可用。

​

InternalServerError

​

500

​

服务器内部错误，平台服务出现异常。

​

​

​

上一篇

快速开始

下一篇

安装 Node.js SDK
============================================================
# 安装 Node.js SDK
来源: https://www.coze.cn/open/docs/developer_guides/nodejs_install
============================================================

安装 Node.js SDK

使用 Node.js SDK 之前，需要先参考本文档安装 Node.js SDK。

​

环境准备

​

Node.js SDK 适用于 Node.js 14 及以上版本，支持大部分的

主流浏览器

。安装 Node.js SDK 之前，建议执行以下命令确认已安装 Node.js 14 及以上版本。

​

​

Bash

复制

# View the Node.js version

​

node --version

​

​

# Returned information shows the 18.19.1 version installed

​

v18.19.1

​

​

安装 Node.js SDK

​

可以使用 npm 或 pnpm 等包管理工具安装 Node.js SDK。执行以下命令，安装 Node.js SDK。

​

注意

Node.js SDK 依赖 axios 请求库。如果项目中未安装 axios，请安装该请求库。

​

安装 Node.js SDK 时，默认安装最新版本。可以

点击此处

查看 Node.js SDK 已发布的所有历史版本。更多信息，请参见

README

。

​

​

​

Bash

复制

npm install @coze/api

​

​

# Install axios

​

npm install axios

​

​

​

上一篇

Node.js SDK 概述

下一篇

配置访问密钥
============================================================
# 配置访问密钥
来源: https://www.coze.cn/open/docs/developer_guides/nodejs_access_token
============================================================

配置访问密钥

通过 Node.js SDK 方式调用扣子编程

OpenAPI 时

，需要在 SDK 请求中配置访问密钥，用于身份信息认证和权限校验。扣子编程

OpenAPI 提

供个人访问密钥和 OAuth 两种鉴权方式。可以选择当前业务场景适合的鉴权方式，并获取对应的访问密钥。

​

对于 OAuth 授权码等授权方式，Node.js SDK 已经封装了这部分代码，并处理了不同的返回错误代码，简化你的操作。

​

配置方式

​

扣子编程

OpenAPI 目前支持的鉴权方式如下。

​

​

访问密钥类型

​

鉴权方式

​

说明

​

示例文件

​

个人访问密钥（PAT）

​

个人访问密钥（PAT）

​

​

Personal Access Token，简称 PAT。扣子编程中生成的个人访问令牌。PAT 生成与使用便捷，适用于测试环境调试等场景。每个令牌可以关联多个空间，并开通指定的接口权限。生成方式可参考

​

添加个人访问令牌

。

​

auth/auth-pat.ts

​

服务访问令牌（SAT）

​

服务访问令牌（SAT）

​

Service Access Token（简称 SAT）是以服务身份创建的访问凭证，可

长期有效

访问扣子资源，通常用于服务/应用程序的身份验证和授权。生成方式可参考

​

添加服务访问令牌

。

​

SAT 的示例代码与 PAT 通用，可直接参考 PAT 的示例文件。

​

auth/auth-pat.ts

​

OAuth 认证

​

​

授权码授权

​

( Authorization Code Flow)

​

适用于有显著前后端之分的应用程序授权场景。其中前端模块负责与用户交互，后端服务处理前端请求，与扣子编程

授权服务器和 OpenAPI 交互。

​

auth/auth-oauth-web.ts

​

​

PKCE 授权

​

( Authorization Code Flow with PKCE)

​

应用程序无后端服务，所有操作都发生在应用程序的前端。

​

auth/auth-oauth-pkce.ts

​

​

设备码授权

​

( Device Code Flow)

​

应用程序无后端服务，所有操作都发生在应用程序的 Command Line，且 Command Line 无法提供“同意授权”的操作。

​

auth/auth-oauth-device.ts

​

​

JWT 授权

​

( JWT Flow)

​

应用程序服务端直接调用扣子编程

OpenAPI。

​

应用程序后端服务代理应用程序自己的用户获取身份凭据，应用程序用户基于凭据直接访问 OpenAPI。

​

auth/auth-oauth-jwt-channel.ts

​

​

配置个人访问密钥（PAT）

​

如果选择使用个人访问密钥鉴权，需要先申请一个个人访问密钥，并添加指定空间和权限。操作步骤可参考

​

添加个人访问令牌

。

​

建议通过环境变量的方式管理访问密钥，避免在代码中通过硬编码方式进行编程，以免密钥泄露、引发安全风险。配置环境变量之后，可以在不修改代码的情况下，将动态的鉴权参数传递到对应的函数，实现便捷安全的身份认证。

​

使用个人访问密钥：

​

1.

设置环境变量。其中

COZE_API_TOKEN

是在扣子编程中申请的个人访问密钥。

​

​

Bash

复制

export

COZE_API_TOKEN=pat_****

​

​

2.

初始化客户端。

​

​

JavaScript

复制

import

{

CozeAPI

,

COZE_CN_BASE_URL

}

from

'@coze/api'

;

​

​

// Import token using the environment variable

​

const

token = process.

env

.

COZE_API_TOKEN

||

"input your coze api token"

​

​

// Create a client instance

​

const

client =

new

CozeAPI

({

​

baseURL

:

COZE_CN_BASE_URL

,

//扣子 OpenAPI 的 Endpoint。

​

token

: token,

//扣子个人访问令牌。

​

});

​

​

3.

出于安全考虑，Node.js SDK 默认不允许在浏览器环境中使用 PAT 认证。如果确实需要在浏览器中使用 PAT（不推荐），可以通过配置强制启用。

​

​

JavaScript

复制

import

{

CozeAPI

,

COZE_CN_BASE_URL

}

from

'@coze/api'

;

​

​

// Import token using the environment variable

​

const

token = process.

env

.

COZE_API_TOKEN

||

"input your coze api token"

​

​

// Access the coze.com service

​

const

client =

new

CozeAPI

({

​

baseURL

:

COZE_CN_BASE_URL

,

​

token

: token,

​

allowPersonalAccessTokenInBrowser

:

true

,

// Allow the browers to use PAT

​

});

​

​

配置 OAuth 授权码流程

​

如果选择使用 OAuth 授权码方式完成授权，可参考以下流程及示例代码。

​

1.

创建 OAuth 应用。

​

具体操作步骤可参考

​

OAuth 授权码授权

。成功创建 OAuth 应用后，可获得客户端 ID、客户端密钥和重定向地址。请妥善保管客户端密钥，以免数据泄露引发安全风险。

​

2.

在代码中通过环境变量方式获取客户端 ID、客户端密钥和重定向地址。

​

​

JavaScript

复制

// 导入扣子API工具：授权URL生成、token获取、刷新等方法

​

import

{

​

CozeAPI

,

​

getWebAuthenticationUrl,

// 生成授权页面URL的工具函数

​

getWebOAuthToken,

// 用授权码换token的工具函数

​

refreshOAuthToken,

// 刷新token的工具函数

​

COZE_CN_BASE_URL

​

}

from

'@coze/api'

;

​

​

// 从环境变量获取OAuth应用参数

​

const

clientId = process.

env

.

COZE_CLIENT_ID

;

// OAuth应用的客户端ID，创建 OAuth 应用时获取的客户端 ID。

​

const

clientSecret = process.

env

.

COZE_CLIENT_SECRET

;

// 客户端密钥，请妥善保管该密钥。

​

const

redirectUrl = process.

env

.

COZE_REDIRECT_URL

;

// 重定向地址，创建 OAuth 应用时指定的重定向 URL。

​

const

baseURL =

COZE_CN_BASE_URL

;

// 扣子 OpenAPI 的 Endpoint。

​

​

3.

根据授权码流程，调用

​

获取授权页面 URL

等接口实现授权码流程。

​

授权码流程中，会自动生成一个

扣子

授权页面，然后将其发送给需要授权的用户。

扣子

用户可访问此链接，并根据页面提示完成授权流程。

​

​

JavaScript

复制

// Generate the authentication URL using the provided parameters

​

const

authUrl =

getWebAuthenticationUrl

({

​

clientId,

​

redirectUrl,

​

baseURL,

​

state

:

'123'

,

// Set a state parameter for user data

​

});

​

​

4.

用户点击同意授权按钮后，

扣子

网页会将请求重定向到授权链接中配置的重定向地址，并通过 Query 在地址中携带授权码和状态参数。

​

通过授权码（OAuth code）调用

​

获取 OAuth Access Token

接口即可获取 OAuth Access Token。示例代码如下：

​

​

JavaScript

复制

// Get the authorization code from url query

​

const

code =

await

getCodeFromQuery

();

​

console

.

log

(

'Received code:'

, code);

​

​

// Exchange the authorization code for an OAuth token

​

const

oauthToken =

await

getWebOAuthToken

({

​

clientId,

// OAuth应用的客户端ID，创建 OAuth 应用时获取的客户端 ID。

​

clientSecret,

// 客户端密钥，请妥善保管该密钥。

​

redirectUrl,

// 重定向地址，创建 OAuth 应用时指定的重定向 URL。

​

baseURL,

// 扣子 OpenAPI 的 Endpoint。

​

code,

​

});

​

​

// Initialize a new Coze API client using the obtained access token

​

const

client =

new

CozeAPI

({

​

baseURL,

​

token

: oauthToken.

access_token

,

​

});

​

​

// Refresh the OAuth token using the refresh token obtained earlier

​

const

refreshedOAuthToken =

await

refreshOAuthToken

({

​

clientId,

​

refreshToken

: oauthToken.

refresh_token

,

​

clientSecret,

​

baseURL,

​

});

​

​

配置 OAuth PKCE 授权流程

​

如果选择使用 OAuth PKCE 方式完成授权，可参考以下流程及示例代码。

​

1.

创建 OAuth 应用。

​

具体操作步骤可参考

​

OAuth PKCE

。成功创建 OAuth 应用后，可获得客户端 ID 和重定向地址。

​

2.

在代码中通过环境变量方式设置客户端 ID 和重定向地址。

​

​

JavaScript

复制

// 导入PKCE相关工具

​

import

{

​

CozeAPI

,

​

getPKCEAuthenticationUrl,

// 生成PKCE授权URL和codeVerifier

​

getPKCEOAuthToken,

// 用授权码和codeVerifier换取token

​

refreshOAuthToken,

// 刷新token

​

COZE_CN_BASE_URL

,

​

}

from

'@coze/api'

;

​

​

const

clientId = process.

env

.

COZE_CLIENT_ID

;

//OAuth应用的客户端ID，创建 OAuth 应用时获取的客户端 ID。

​

const

redirectUrl = process.

env

.

COZE_REDIRECT_URL

;

//重定向地址，创建 OAuth 应用时指定的重定向 URL。

​

const

baseURL =

COZE_CN_BASE_URL

;

//扣子 OpenAPI 的 Endpoint。

​

​

3.

在代码中实现 OAuth PKCE 授权流程。

​

客户端生成一个随机值

code_verifier

，并根据指定算法将其转换为

code_challenge

，算法通常使用 SHA-256 算法。然后基于回调地址、

code_challenge

和

code_challenge_method

，生成一个授权链接。

​

​

JavaScript

复制

// Generate the PKCE authentication URL and code verifier

​

const

{ url, codeVerifier } =

await

getPKCEAuthenticationUrl

({

​

clientId,

​

redirectUrl,

​

baseURL,

​

state

:

'123'

,

// Set a state parameter for user data

​

});

​

​

4.

完成授权。

​

引导用户打开这个授权链接。当用户同意授权时，扣子编程

会将页面重定向到开发者配置的回调地址，开发者可以获取这个 code，换取访问密钥。

​

​

JavaScript

复制

// Get the authorization code from url query

​

const

code =

await

getCodeFromQuery

();

​

console

.

log

(

'Received code:'

, code);

​

​

// Exchange the authorization code for an OAuth token using PKCE

​

const

oauthToken =

await

getPKCEOAuthToken

({

​

clientId,

//OAuth应用的客户端ID，创建 OAuth 应用时获取的客户端 ID。

​

redirectUrl,

//重定向地址，创建 OAuth 应用时指定的重定向 URL。

​

baseURL,

//扣子 OpenAPI 的 Endpoint。

​

code,

// 获取的授权码。

​

codeVerifier,

// 应用程序生成的临时密钥，应用程序通过临时密钥和授权码获取 OAuth 访问令牌。

​

});

​

​

// Initialize a new Coze API client using the obtained access token

​

const

client =

new

CozeAPI

({

​

baseURL,

​

token

: oauthToken.

access_token

,

​

});

​

​

// Example of how to use the client (commented out)

​

// e.g. client.chat.stream(...);

​

​

// Refresh the OAuth token using the refresh token obtained earlier

​

const

refreshedOAuthToken =

await

refreshOAuthToken

({

​

clientId,

​

refreshToken

: oauthToken.

refresh_token

,

​

baseURL,

​

});

​

​

配置 OAuth 设备码授权流程

​

如果选择使用 OAuth 设备码方式完成授权，可参考以下流程及示例代码。

​

1.

创建 OAuth 应用。

​

具体操作步骤可参考

​

OAuth 设备授权

。成功创建 OAuth 应用后，可获得客户端 ID。

​

2.

在代码中通过环境变量方式设置客户端 ID。

​

​

JavaScript

复制

import

{

APIError

,

CozeAPI

, getDeviceCode, getDeviceToken,

COZE_CN_BASE_URL

}

from

'@coze/api'

;

​

​

const

clientId = process.

env

.

COZE_CLIENT_ID

;

//OAuth应用的客户端ID，创建 OAuth 应用时获取的客户端 ID。

​

const

baseURL =

COZE_CN_BASE_URL

;

​

​

3.

通过 OAuth 设备码授权流程获得访问密钥。

​

应用程序需要调用

扣子

OpenAPI 生成设备代码，以获取

user_code

和

device_code

。通过

user_code

生成授权链接，并引导用户打开该链接、填写

user_code

、同意授权。应用程序调用

扣子

OpenAPI，通过

device_code

生成访问密钥。

​

如果用户尚未授权或拒绝了授权，接口将抛出异常并返回特定的错误代码。用户同意授权后，接口将成功并返回访问密钥。

​

​

JavaScript

复制

// Get the device code

​

const

deviceCode =

await

getDeviceCode

({

​

baseURL,

​

clientId,

​

});

​

// Instruct the user to visit the verification URI and enter the user code

​

console

.

log

(

​

`please open

${deviceCode.verification_uri}

and input the code

${deviceCode.user_code}

`

,

​

);

​

​

4.

应用程序

还需要使用

device_code

来轮询

扣子

OpenAPI 以获取访问密钥，接口已经做了封装，设置 poll = true 即可。

​

​

JavaScript

复制

const

deviceToken =

await

getDeviceToken

({

​

baseURL,

​

clientId,

​

deviceCode

: deviceCode.

device_code

,

​

poll

:

true

,

​

});

​

​

5.

最后，当 Token 失效时，可以通过 refreshOAuthToken 刷新 Token

​

​

JavaScript

复制

// Refresh the access token if it expires

​

const

refreshToken = deviceToken.

refresh_token

;

​

const

refreshTokenResult =

await

refreshOAuthToken

({

​

baseURL,

​

clientId,

​

refreshToken,

​

});

​

​

配置 OAuth JWT 授权流程

​

如果选择使用 OAuth JWT 方式完成授权，可参考以下流程及示例代码。

​

1.

创建 OAuth 应用并授权。

​

具体操作步骤可参考

​

OAuth JWT 授权（开发者）

。成功创建 OAuth 应用后，可获得客户端 ID、公钥和私钥。妥善保管公钥和私钥，以免数据泄露引发安全风险。

​

2.

在代码中通过环境变量方式设置客户端 ID、公钥和私钥。

​

​

JavaScript

复制

import

{ fileURLToPath }

from

'node:url'

;

​

import

{ dirname, join }

from

'node:path'

;

​

import

fs

from

'fs'

;

​

​

import

jwt

from

'jsonwebtoken'

;

​

import

{

CozeAPI

, getJWTToken,

COZE_CN_BASE_URL

}

from

'@coze/api'

;

​

​

const

baseURL =

COZE_CN_BASE_URL

;

​

const

appId = process.

env

.

COZE_APP_ID

;

//OAuth应用的客户端ID，创建 OAuth 应用时获取的客户端 ID。

​

const

keyid = process.

env

.

COZE_KEY_ID

;

//OAuth 应用的

公钥指纹

，可以在

OAuth 应用

页面找到这个应用，在

操作

列单击编辑图标，进入

配置

页面查看公钥指纹。

​

const

aud = process.

env

.

COZE_AUD

;

//扣子 API 的 Endpoint，即

api.coze.cn

。

​

​

3.

应用程序通过公钥和私钥签署 JWT，并通过

扣子

提供的 API 获取访问密钥。

​

​

JavaScript

复制

// Read the private key from a file

​

const

__filename =

fileURLToPath

(

import

.

meta

.

url

);

​

const

__dirname =

dirname

(__filename);

​

const

privateKey = fs

​

.

readFileSync

(

join

(__dirname,

'../../tmp/private_key.pem'

))

​

.

toString

();

​

​

const

result =

await

getJWTToken

({

​

baseURL,

//扣子 OpenAPI 的 Endpoint。

​

appId,

//OAuth应用的客户端ID，创建 OAuth 应用时获取的客户端 ID。

​

aud,

//扣子 API 的 Endpoint，即

api.coze.cn

。

​

keyid,

//OAuth 应用的

公钥指纹。

​

privateKey,

// 用于签署 JWT 的本地私钥。

​

});

​

console

.

log

(

'getJWTToken'

, result);

​

​

// Initialize a new Coze API client using the obtained access token

​

const

client =

new

CozeAPI

({ baseURL,

token

: result.

access_token

});

​

​

// Example of how to use the client (commented out)

​

// e.g. client.chat.stream(...);

​

​

上一篇

安装 Node.js SDK

下一篇

快速开始
============================================================
# 快速开始
来源: https://www.coze.cn/open/docs/developer_guides/nodejs_getting_started
============================================================

快速开始

本文介绍如何使用 Node.js SDK 完成

扣子编程

的常用操作。例如初始化 Node.js SDK、创建一个智能体草稿、发布智能体为 API 服务、和智能体对话等。

​

准备工作

​

已安装 Node.js SDK。更多信息，可参见

​

安装 Node.js SDK

。

​

已实现授权流程，并通过环境变量方式配置了访问密钥。详细说明可参考

​

配置访问密钥

。

​

初始化 Node.js SDK

​

初始化 Coze client 之后，才可以向

扣子编程

服务端发送 OpenAPI 请求。初始化时推荐通过环境变量动态获取访问密钥，以免硬编码引发数据安全风险。

​

初始化代码如下：

​

​

JavaScript

复制

import

{

CozeAPI

,

COZE_CN_BASE_URL

}

from

'@coze/api'

;

​

​

// Import token using the environment variable

​

const

token = process.

env

.

COZE_API_TOKEN

||

"input your coze api token"

​

​

// Instantiate Coze API client

​

const

client =

new

CozeAPI

({

​

baseURL

:

COZE_CN_BASE_URL

,

​

token

: token,

​

});

​

​

创建并发布智能体为 API 服务

​

通过 API 方式和智能体对话之前，需要先创建一个智能体，并将其发布为 API 服务。可以在

扣子编程

中创建智能体并发布，也可以通过调用相关的 API 实现。调用 API 创建智能体时，部分配置对应的 API 参数暂未开放，只能为智能体添加知识库等有限的配置。创建智能体的操作步骤可参考

​

搭建一个 AI 助手智能体

，将智能体发布为 API 服务的操作步骤可参考

​

发布智能体为 API 服务

。

​

创建智能体的完整示例代码

，参见

GitHub 示例

。

​

相关 API 接口描述，请参见：

​

​

创建智能体

。

​

​

发布智能体

。

​

示例代码如下：

​

​

JavaScript

复制

import

{

CozeAPI

,

ChatEventType

,

ChatStatus

,

COZE_CN_BASE_URL

}

from

'@coze/api'

;

​

​

const

token = process.

env

.

COZE_API_TOKEN

;

​

const

spaceId = process.

env

.

COZE_SPACE_ID

;

​

const

baseURL =

COZE_CN_BASE_URL

;

​

​

const

client =

new

CozeAPI

(

{

​

baseURL

,

​

token

,

​

})

;

​

​

// Invoke the create API to create a bot in the draft status

.

​

const

bot =

await

client.

bots

.

create

(

{

​

space_id

: spaceId

,

​

name

:

'

翻译

专家

'

,

​

description

:

​

'

能帮你进行

中英互译的专业翻译人员

'

,

​

prompt_info

:

{

​

prompt

:

​

'

你是一名翻译人员，请将以下文本从

英语

翻译

成汉语

'

,

​

}

,

​

})

;

​

​

​

// Call the publish API to publish the bot on the API channel

.

​

const

publishedBot =

await

client.

bots

.

publish

(

{

​

bot_id

: bot.

bot_id

,

​

connector_ids

: [

'API'

]

,

​

})

;

​

​

发起对话

​

​

发起对话

接口用于向指定智能体发起一次对话。支持在对话时添加对话的上下文消息，以便智能体基于历史消息做出合理的回复。开发者可以按需选择响应方式，即流式或非流式响应。响应方式决定了开发者获取智能体回复的方式。

​

流式响应

：智能体在生成回复的同时，将回复消息以数据流的形式逐条发送给客户端。处理结束后，服务端会返回拼接后完整的智能体回复。详细说明可参考

​

流式响应

。

​

非流式响应

：无论对话是否处理完毕，立即发送响应消息。开发者可以通过接口

​

查看对话详情

口确认本次对话处理结束后，再调用

​

查看对话消息详情

接口查看模型回复等完整响应内容。详细说明可参考

​

非流式响应

。

​

本文档以流式响应为例，演示通过 API 方式和智能体对话相关实例代码。可以查看 Node.js SDK

示例代码目录

，查看 chat 接口的其他实现方式。例如，非流式响应、对话中发送多模态内容等。

​

示例代码如下：

​

​

JavaScript

复制

import

{

CozeAPI

,

Ch

atEventType

,

ChatStatus

,

COZE_CN_BASE_URL

,

RoleType

}

from

'@coze/api'

;

​

​

const

token = process.

env

.

COZE_API_TOKEN

;

​

const

botId = process.

env

.

COZE_BOT_ID

;

​

const

baseURL =

COZE_CN_BASE_URL

;

​

​

const

client =

new

CozeAPI

({

​

baseURL,

​

token,

​

});

​

​

​

const

stream =

await

client.

chat

.

stream

({

​

bot_id

: botId

,

​

additional_messages

: [

​

{

​

role

:

RoleType

.

User

,

​

content

:

'

你好

'

,

​

content_type

:

'text'

,

​

},

​

],

​

});

​

​

for

await

(

const

part

of

stream) {

​

if

(part.

event

===

ChatEventType

.

CONVERSATION_MESSAGE_DELTA

) {

​

process.

stdout

.

write

(part.

data

.

content

);

// Real-time response

​

}

​

}

​

​

​

上一篇

配置访问密钥

下一篇

Java SDK 概述
============================================================
# Java SDK 概述
来源: https://www.coze.cn/open/docs/developer_guides/java_overview
============================================================

Java SDK 概述

Coze API SDK for Java 是一个扣子官方提供的 SDK 工具包，你可以通过 Java SDK 将扣子的 OpenAPI 集成到你的应用程序中。Coze Java SDK 支持所有扣子的官方鉴权方式，具备高度的灵活性和高可用性，显著提升 OpenAPI 的使用效率。你可以通过 maven 仓库快速安装 Coze Java SDK，用你的访问密钥初始化 SDK，然后就可以开始安全、高效地通过 OpenAPI 访问你的 AI 智能体。

​

Coze Java SDK 遵循用户友好的设计风格，可简化你的开发工作，且适用于所有技能水平开发者使用。

​

源码地址

​

访问

GitHub

获取 Coze API SDK for Java 源码。

​

注意

从扣子 GitHub 仓库获取的源码和示例代码中，

base_url

默认设置为域名

COZE_COM_BASE_URL

，使用源码前应手动将其修改为域名

COZE_CN_BASE_URL

。

​

​

示例代码

​

Coze Java SDK 提供各种授权方式、各种使用方式的示例代码，便于开发者直接参考使用。

​

说明

Coze Java SDK 支持扣子所有 OpenAPI，对应的 API 文档可参考

​

API 介绍

。

​

示例代码将持续更新和补充，各种场景的 Coze Java SDK

最新版本

示例代码可参考

GitHub

。

​

​

常见场景的示例代码及说明如下：

​

​

模块

​

示例文件

​

说明

​

授权

​

TokenAuthExample.java

​

通过个人访问密钥实现 OpenAPI 鉴权。

​

​

WebOAuthExample.java

​

通过 OAuth 授权码方式实现授权与 OpenAPI 鉴权。

​

​

JWTsOauthExample.java

​

通过 OAuth JWT 方式实现授权与 OpenAPI 鉴权。

​

​

PKCEOauthExample.java

​

通过 OAuth PKCE 方式实现授权与 OpenAPI 鉴权。

​

​

DevicesOAuthExample.java

​

通过 OAuth 设备码方式实现授权与 OpenAPI 鉴权。

​

对话

​

ChatExample.java

​

发起对话，响应方式为非流式响应。

​

​

StreamChatExample.java

​

发起对话，响应方式为流式响应。

​

​

ChatWithImageExample.java

​

发起对话，对话中上传文件，并发送多模态内容。

​

​

SubmitToolOutputExample.java

​

端插件。

​

会话与消息管理

​

CreateConversationExample.java

​

创建会话。

​

​

ListConversationsExample.java

​

查询会话列表。

​

​

MessageCrudExample.java

​

创建、更新、删除消息。

​

​

MessageListExample.java

​

查询指定对话中的消息列表。

​

工作流

​

RunWorkflowExample.java

​

运行工作流，响应方式为非流式响应。

​

​

StreamWorkflowExample.java

​

运行工作流，响应方式为流式响应，且工作流中包含问答节点。

​

​

StreamWorkflowChatExample.java

​

运行对话流。

​

​

AsyncRunWorkflowExample.java

​

异步运行工作流。

​

智能体管理

​

BotPublishExample.java

​

创建一个草稿状态的智能体，更新智能体，并发布智能体为 API 服务。

​

语音

​

AudioRoomsCreateExample.java

​

RTC 音视频通话场景中，创建音视频房间。

​

​

SpeechCreateExample.java

​

语音合成，将文本转为语音，并将生成的语音保存为音频文件。

​

​

CreateTranscriptionExample.java

​

语音识别，将指定音频文件转录为文本。

​

​

VoiceCloneExample.java

​

克隆音色。

​

​

VoiceListExample.java

​

查询音色列表。

​

WebSocket 语音通话

​

ChatExample.java

​

WebSocket 语音通话。

​

​

WebsocketAudioSpeechExample.java

​

语音合成，将文本转为语音，并将生成的语音保存为音频文件。

​

​

WebsocketTranscriptionsExample.java

​

语音识别，将指定音频文件转录为文本。

​

工作空间

​

ListWorkspaceExample.java

​

查询工作空间列表。

​

知识库

​

DatasetCrudExample.java

​

创建、更新和删除知识库。

​

​

DatasetListExample.java

​

查询指定工作空间下的知识库。

​

​

datasets/image

​

图片知识库管理，包含：

​

上传图片类型的知识库文件。

​

更新知识库的图片描述。

​

查看知识库图片列表。

​

​

datasets/document

​

文本知识库管理，包含：

​

上传文本类型的知识库文件。

​

查询、修改和删除文本知识库文件。

​

文件

​

FileExample.java

​

文件上传，包含：

​

文件上传。

​

获取文件详情。

​

变量

​

VariableExample.java

​

变量管理，包含：

​

获取用户变量的值。

​

设置用户变量的值。

​

复制模板

​

TemplateDuplicateExample.java

​

复制商店中的模板到指定工作空间。

​

账单和权益额度

​

benefit/bill/CrudExample.java

​

导出账单并查询账单文件。

​

​

benefit/limitations/CrudExample.java

​

创建、查询、更新硬件设备的权益额度。

​

异常处理

​

HandlerExceptionExample.java

​

处理 API 异常。

​

客户端管理

​

HandlerExceptionExample.java

​

修改日志级别。

​

​

SetRequestTimeoutExample.java

​

设置请求超时时间。

​

​

InitServiceExample.java

​

初始化客户端。

​

​

异常处理

​

当调用 API 失败时，SDK 会抛出

CozeAPIException

异常；当鉴权失败的时候，SDK 会抛出

CozeAuthException

异常。开发者可以根据自己的需求捕获对应的异常，其中

CozeAPIException

异常会获取到异常接口的错误码，API 错误码的相关说明及处理方式可参考

​

错误码

。

​

上一篇

快速开始

下一篇

安装 Java SDK
============================================================
# 安装 Java SDK
来源: https://www.coze.cn/open/docs/developer_guides/java_installation
============================================================

安装 Java SDK

使用 Coze Java SDK 之前，你需要先参考本文档安装 Java SDK。

​

环境准备

​

Coze Java SDK 适用于Java 1.8 及以上版本。安装 Java SDK 之前，建议执行以下命令确认你已安装 1.8及以上版本的 Java。

​

​

Bash

复制

# 查看 Java 版本

​

java -version

​

​

# 回显信息显示已安装 1.8.0_372 版本

​

openjdk version

"1.8.0_372"

​

OpenJDK Runtime Environment (build 1.8.0_372-bre_2023_04_25_03_23-b00)

​

OpenJDK 64-Bit Server VM (build 25.372-b00, mixed mode)

​

​

安装 SDK

​

说明

安装 Coze Java SDK 时，默认安装最新版本。你也可以

点击此处

查看 Coze Java SDK 已发布的所有历史版本。更多信息，请参见

README

。

​

​

你可以通过以下方式安装 Coze Java SDK。

​

在 Maven 项目中添加依赖

​

在 Maven 工程中使用 Coze Java SDK，只需在

pom.xml

中加入相应依赖即可。以在 <dependencies> 中加入依赖为例：

​

​

XML

复制

<

dependency

>

​

<

groupId

>

com.coze

</

groupId

>

​

<

artifactId

>

coze-api

</

artifactId

>

​

<

version

>

LATEST

</

version

>

​

</

dependency

>

​

​

在 Gradle 中添加依赖

​

在项目的根目录下打开

build.gradle

文件，在

dependencies

模块中添加 Coze Java SDK 的依赖。

​

​

Groovy

复制

dependencies {

​

implementation

'com.coze:coze-api:+'

​

}

​

​

上一篇

Java SDK 概述

下一篇

配置访问密钥
============================================================
# 配置访问密钥
来源: https://www.coze.cn/open/docs/developer_guides/java_access_token
============================================================

配置访问密钥

通过 Java SDK 方式调用扣子编程 OpenAPI 时，需要在 SDK 请求中配置访问密钥，用于身份信息认证和权限校验。扣子编程 OpenAPI 提供个人访问密钥和 OAuth 两种鉴权方式，你可以选择当前业务场景适合的鉴权方式，并获取对应的访问密钥。

​

对于 OAuth 授权码等授权方式，Coze Java SDK 已经封装了这部分代码，并处理了不同的返回错误代码，简化你的操作。

​

配置方式

​

扣子编程 OpenAPI 目前支持的鉴权方式如下。

​

​

访问密钥类型

​

鉴权方式

​

说明

​

示例文件

​

个人访问密钥（PAT）

​

个人访问密钥（PAT）

​

Personal Access Token，简称 PAT。扣子编程中生成的个人访问令牌。PAT 生成与使用便捷，适用于测试环境调试等场景。每个令牌可以关联多个空间，并开通指定的接口权限。生成方式可参考

添加个人访问令牌

。

​

TokenAuthExample.java

​

服务访问令牌（SAT）

​

服务访问令牌（SAT）

​

Service Access Token（简称 SAT）是以服务身份创建的访问凭证，可

长期有效

访问扣子编程资源，通常用于服务/应用程序的身份验证和授权。SAT 与 OAuth JWT 鉴权方式相比，具有更长的有效期（可设置为永久有效），操作简单，能够有效简化授权流程。生成方式可参考

​

添加服务访问令牌

。

​

SAT 的示例代码与 PAT 通用，可直接参考 PAT 的示例文件。

​

​

OAuth 认证

​

​

授权码授权

​

（Authorization Code Flow）

​

适用于有显著前后端之分的应用程序授权场景。其中前端模块负责与用户交互，后端服务处理前端请求，与扣子授权服务器和 OpenAPI 交互。 实现流程可参考

​

OAuth 授权码授权

。

​

WebOAuthExample.java

​

​

PKCE 授权

​

（Authorization Code Flow with PKCE）

​

应用程序无后端服务，所有操作都发生在应用程序的前端。 实现流程可参考

​

OAuth PKCE

。

​

PKCEOauthExample.java

​

​

设备码授权

​

（Device Code Flow）

​

应用程序无后端服务，所有操作都发生在应用程序的 Command Line，且 Command Line 无法提供“同意授权”的操作。 实现流程可参考

​

OAuth 设备授权

。

​

DevicesOAuthExample.java

​

​

JWT 授权

​

（JWT Flow）

​

应用程序服务端直接调用扣子编程 OpenAPI。

​

应用程序后端服务代理应用程序自己的用户获取身份凭据，应用程序用户基于凭据直接访问 OpenAPI。 实现流程可参考

​

OAuth JWT 授权（开发者）

。

​

JWTsOauthExample.java

​

​

配置个人访问密钥（PAT）

​

如果选择使用个人访问密钥鉴权，你需要先申请一个个人访问密钥，并添加指定空间和权限。操作步骤可参考

添加个人访问令牌

。完整的示例代码请参见

TokenAuthExample.java

。

​

扣子编程建议你通过环境变量的方式管理访问密钥，避免在代码中通过硬编码方式进行编程，以免密钥泄露、引发安全风险。配置环境变量之后，您可以在不修改代码的情况下，将动态的鉴权参数传递到对应的函数，实现便捷安全的身份认证。

​

1.

设置环境变量。

​

其中 COZE_API_TOKEN 是扣子编程中申请的个人访问密钥。

​

​

Shell

复制

export COZE_API_TOKEN=pat_****

​

​

2.

初始化客户端。

​

示例代码如下：

​

​

Java

复制

import

com.coze.openapi.service.auth.TokenAuth;

​

import

com.coze.openapi.service.config.Consts;

​

import

com.coze.openapi.service.service.CozeAPI;

​

import

okhttp3.OkHttpClient;

​

​

public

class

InitClientExample

{

​

public

static

void

main

(String[] args)

{

​

// 从环境变量中获取个人访问密钥（PAT）

​

// 推荐使用环境变量管理密钥，避免硬编码导致泄露

​

String

token

=

System.getenv(

"COZE_API_TOKEN"

);

​

​

// 创建TokenAuth对象，传入PAT作为身份认证凭据

​

TokenAuth

authCli

=

new

TokenAuth

(token);

​

​

// 构建CozeAPI客户端实例，配置连接参数

​

CozeAPI

coze

=

​

new

CozeAPI

.Builder()

​

.baseURL(Consts.COZE_CN_BASE_URLCOZE_COM_BASE_URL)

// 设置扣子编程OpenAPI的 Endpoint

​

.auth(authCli)

// 绑定鉴权对象，用于请求时的身份验证

​

.client(

new

OkHttpClient

.Builder().build())

// 配置HTTP客户端（使用默认OkHttpClient）

​

.build();

// 完成客户端初始化

​

}

​

}

​

​

配置 OAuth 授权码流程

​

如果选择使用 OAuth 授权码方式完成授权，可参考以下流程及示例代码。完整的示例代码请参见

WebOAuthExample.java

。

​

1.

创建 OAuth 应用。

​

具体操作步骤可参考

​

OAuth 授权码授权

。成功创建 OAuth 应用后，你将获得客户端 ID、客户端密钥和重定向地址。你需要妥善保管客户端密钥，以免数据泄露引发安全风险。

​

2.

在代码中通过环境变量方式设置客户端 ID、客户端密钥和重定向地址。

​

​

Java

复制

public

class

PKCEOauthExample

{

​

public

static

void

main

(String[] args)

{

​

// 从环境变量中获取PKCE OAuth应用的重定向地址，创建PKCE类型OAuth应用时配置的前端回调地址

​

String

redirectURI

=

System.getenv(

"COZE_PKCE_OAUTH_REDIRECT_URI"

);

​

​

// 从环境变量中获取PKCE OAuth应用的客户端ID，创建PKCE类型OAuth应用时平台生成的唯一标识符

​

String

clientID

=

System.getenv(

"COZE_PKCE_OAUTH_CLIENT_ID"

);

​

​

// 创建PKCEOAuthClient实例，配置应用信息

​

PKCEOAuthClient

oauth

=

​

new

PKCEOAuthClient

.PKCEOAuthBuilder()

​

.clientID(clientID)

// 传入客户端ID，即从环境变量获取的PKCE应用客户端ID

​

// 设置扣子授权服务器端点，由扣子编程固定提供的授权服务地址

​

.baseURL(Consts.COZE_CN_BASE_URLCOZE_COM_BASE_URL)

​

.build();

​

​

​

/*

​

* 生成PKCE授权链接

​

* 1. SDK自动生成code_verifier和code_challenge

​

* 2. 授权链接包含code_challenge和回调地址，用于引导用户授权

​

*/

​

// 生成授权链接及code_verifier，返回包含授权URL和code_verifier的响应对象

​

GetPKCEAuthURLResp

oauthURL

=

​

oauth.genOAuthURL(

​

redirectURI,

// 重定向地址，即从环境变量获取的PKCE应用回调地址

​

"state"

,

// 状态参数，用于防CSRF攻击，自定义字符串

​

// 指定code_challenge的生成算法，固定使用SHA-256算法（S256）

​

PKCEOAuthClient.CodeChallengeMethod.S256

​

);

​

System.out.println(oauthURL);

​

​

// 打印SDK生成的code_verifier，SDK自动生成的随机字符串，用于后续换取令牌时验证

​

System.out.println(oauthURL.getCodeVerifier());

​

​

// 打印用户需要访问的授权链接，用户授权页面的URL，从GetPKCEAuthURLResp对象获取

​

System.out.println(oauthURL.getAuthorizationURL());

​

​

​

/*

​

* 用户授权后，扣子会重定向到redirectURI，并在Query中携带code（授权码）

​

*/

​

// 模拟从重定向地址Query中获取的授权码，用户授权后从redirectURI的Query参数（code）中提取

​

String

code

=

"mock code"

;

​

​

/*

​

* 用授权码和code_verifier换取访问令牌

​

* 必须传入genOAuthURL返回的code_verifier，否则验证失败

​

*/

​

OAuthToken

resp

=

oauth.getAccessToken(code, redirectURI, oauthURL.getCodeVerifier());

​

System.out.println(resp);

// 打印令牌信息

​

​

// 使用access_token初始化Coze客户端

​

CozeAPI

coze

=

​

new

CozeAPI

.Builder()

​

// 用access_token创建鉴权对象，access_token从OAuthToken对象获取

​

.auth(

new

TokenAuth

(resp.getAccessToken()))

​

.baseURL(cozeAPIBase)

// 设置OpenAPI服务端点

​

.build();

​

​

// 令牌过期时，使用refresh_token刷新，refresh_token从OAuthToken对象获取

​

resp = oauth.refreshToken(resp.getRefreshToken());

​

}

​

}

​

​

3.

授权码流程中，会自动生成一个扣子编程授权页面，然后将其发送给需要授权的用户。扣子用户可访问此链接，并根据页面提示完成授权流程。

​

​

Java

复制

String

oauthURL

=

oauth.getOAuthURL(redirectURI,

null

)

;

​

System.out.println(oauthURL)

;

​

​

/

*

​

* To restrict access to a specific WorkSpace, you can specify the WorkSpaceID when obtaining the URL.

​

oauthURL = oauth.getOAuthURL(redirectURI, null, "workspaceID")

;

​

System.out.println(oauthURL)

;

​

* *

/

​

​

4.

用户点击同意授权按钮后，扣子编程网页会将请求重定向到授权链接中配置的重定向地址，并通过 Query 在地址中携带授权码和状态参数。

​

通过授权码（OAuth code）调用 OpenAPI 接口即可获取 OAuth Access Token。示例代码如下：

​

​

Java

复制

/*

​

* 授权流程说明：

​

* 1. 前端引导用户访问扣子授权页面，用户完成授权后，扣子会重定向到redirectURI

​

* 2. 重定向地址的Query参数中会携带code（授权码）和state（状态参数，用于防CSRF）

​

* 3. 后端从Query中提取code，用于换取访问令牌

​

*/

​

// 模拟从重定向地址的Query中获取到的授权码，用户授权后从redirectURI的Query参数（code）中提取

​

String

code

=

"mock code"

;

​

​

/*

​

* 用授权码换取访问令牌（access_token）

​

* 调用getAccessToken方法，传入code和redirectURI（需与授权时使用的地址一致）

​

*/

​

OAuthToken

resp

=

oauth.getAccessToken(code, redirectURI);

​

System.out.println(resp);

// 打印令牌信息，包含访问令牌、过期时间等

​

​

/*

​

* 获取请求日志ID，用于问题排查，从令牌响应对象中通过getLogID()方法获取

​

*/

​

System.out.println(resp.getLogID());

​

​

// 使用获取到的access_token初始化Coze客户端

​

CozeAPI

coze

=

​

new

CozeAPI

.Builder()

​

// 用access_token创建鉴权对象，access_token从OAuthToken对象的getAccessToken()方法获取

​

.auth(

new

TokenAuth

(resp.getAccessToken()))

​

// 设置OpenAPI服务端点，由扣子编程固定提供的OpenAPI访问地址

​

.baseURL(cozeAPIBase)

​

.build();

​

​

/*

​

* 令牌过期时，使用refresh_token刷新令牌，refresh_token从OAuthToken对象的getRefreshToken()方法获取

​

*/

​

resp = oauth.refreshToken(resp.getRefreshToken());

​

​

配置 OAuth PKCE 授权流程

​

如果选择使用 OAuth PKCE 方式完成授权，可参考以下流程及示例代码。完整的示例代码请参见

PKCEOauthExample.java

。

​

1.

创建 OAuth 应用。

​

具体操作步骤可参考

​

OAuth PKCE

。成功创建 OAuth 应用后，你将获得客户端 ID 和重定向地址。

​

2.

在代码中通过环境变量方式设置客户端 ID 和重定向地址。

​

​

Java

复制

public

static

void

main

(String[] args)

{

​

// 从环境变量中获取PKCE OAuth应用的重定向地址，创建PKCE类型OAuth应用时配置的前端回调地址

​

String

redirectURI

=

System.getenv(

"COZE_PKCE_OAUTH_REDIRECT_URI"

);

​

​

// 从环境变量中获取PKCE OAuth应用的客户端ID，创建PKCE类型OAuth应用时平台生成的唯一标识符

​

String

clientID

=

System.getenv(

"COZE_PKCE_OAUTH_CLIENT_ID"

);

​

​

// 创建PKCEOAuthClient实例，配置应用信息

​

PKCEOAuthClient

oauth

=

​

new

PKCEOAuthClient

.PKCEOAuthBuilder()

​

.clientID(clientID)

// 传入客户端ID，即从环境变量获取的PKCE应用客户端ID

​

// 设置扣子授权服务器端点，由扣子编程固定提供的授权服务地址

​

.baseURL(Consts.COZE_CN_BASE_URLCOZE_COM_BASE_URL)

​

.build();

​

​

3.

在代码中实现 OAuth PKCE 授权流程。

​

客户端生成一个随机值 code_verifier，并根据指定算法将其转换为 code_challenge，算法通常使用 SHA-256 算法。然后基于回调地址、code_challenge 和 code_challenge_method，生成一个授权链接。

​

其中 code_verifier 会由 SDK 生成，并与 URL 一起返回给调用方。

​

​

Java

复制

GetPKCEAuthURLResp

oauthURL

=

​

oauth.genOAuthURL(redirectURI,

"state"

, PKCEOAuthClient.CodeChallengeMethod.S256);

​

System.out.println(oauthURL);

​

//

The code verifier generated by the SDK

​

System.out.println(oauthURL.getCodeVerifier());

​

// URL that users need to click.

​

System.out.println(oauthURL.getAuthorizationURL());

​

​

4.

完成授权。

​

开发者应该引导用户打开这个授权链接。当用户同意授权时，扣子编程会将页面重定向到开发者配置的回调地址，开发者可以获取这个 code，换取访问密钥。

​

​

Java

复制

/*

​

After the user clicks the authorization consent button, the coze web page will redirect

​

to the redirect address configured in the authorization link and carry the authorization

​

code and state parameters in the address via the query string.

​

​

Get from the query of the redirect interface: query.get('code')

​

* */

​

String

code

=

"mock code"

;

​

​

/*

​

After obtaining the code after redirection, the interface to exchange the code for a

​

token can be invoked to generate the coze access_token of the authorized user.

​

The developer should use code verifier returned by genOAuthURL() method

​

* */

​

OAuthToken

resp

=

oauth.getAccessToken(code, redirectURI, oauthURL.getCodeVerifier());

​

System.out.println(resp);

​

​

// use the access token to init Coze client

​

CozeAPI

coze

=

​

new

CozeAPI

.Builder()

​

.auth(

new

TokenAuth

(resp.getAccessToken()))

​

.baseURL(cozeAPIBase)

​

.build();

​

// When the token expires, you can also refresh and re-obtain the token

​

resp = oauth.refreshToken(resp.getRefreshToken());

​

​

配置 OAuth 设备码授权流程

​

如果选择使用 OAuth 设备码方式完成授权，可参考以下流程及示例代码。完整的示例代码请参见

DevicesOAuthExample.java

。

​

1.

创建 OAuth 应用。

​

具体操作步骤可参考

​

OAuth 设备授权

。成功创建 OAuth 应用后，你将获得客户端 ID。

​

2.

在代码中通过环境变量方式设置客户端 ID。

​

​

Java

复制

public

static

void

main

(String[] args)

{

​

// 从环境变量获取设备授权的客户端ID，创建设备码类型OAuth应用时平台生成的唯一标识符

​

String

clientID

=

System.getenv(

"COZE_DEVICE_OAUTH_CLIENT_ID"

);

​

​

// 创建设备授权客户端实例

​

DeviceOAuthClient

oauth

=

​

new

DeviceOAuthClient

.DeviceOAuthBuilder()

​

.clientID(clientID)

// 传入客户端ID，即从环境变量获取的设备应用客户端ID

​

// 设置授权服务器端点，由扣子编程固定提供的授权服务地址

​

.baseURL(Consts.COZE_CN_BASE_URLCOZE_COM_BASE_URL)

​

.build();

​

​

3.

通过 OAuth 设备码授权流程获得访问密钥。

​

应用程序需要调用扣子编程 OpenAPI 生成设备代码，以获取 user_code 和 device_code。通过 user_code 生成授权链接，并引导用户打开该链接、填写 user_code、同意授权。应用程序调用扣子编程 OpenAPI，通过 device_code 生成访问密钥。

​

如果用户尚未授权或拒绝了授权，接口将抛出异常并返回特定的错误代码。用户同意授权后，接口将成功并返回访问密钥。

​

SDK 已经拼接了 URL，直接将 SDK 返回的 URL 交给用户打开即可。

​

​

Java

复制

/*

​

* 第一步：获取设备码和用户码

​

*/

​

// 获取设备码响应对象，包含设备码、用户码、授权URL等信息

​

DeviceAuthResp

codeResp

=

oauth.getDeviceCode();

​

System.out.println(codeResp);

// 打印设备码相关信息

​

​

// 设备码，用于轮询访问令牌，从DeviceAuthResp对象的getDeviceCode()方法获取

​

System.out.println(codeResp.getDeviceCode());

​

​

// 用户需要访问的授权页面URL，用户输入user_code的页面地址，从DeviceAuthResp获取

​

System.out.println(codeResp.getVerificationURL());

​

​

4.

应用程序还需要使用 device_code 来轮询扣子编程 OpenAPI 以获取访问密钥。

​

Coze SDK for Java 已经封装了这部分代码，并处理了不同的返回错误代码。开发者只需要调用 get_access_token 即可。

​

​

Java

复制

/*

​

* 第二步：轮询获取访问令牌

​

*/

​

try

{

​

// 轮询获取访问令牌，传入device_code和自动轮询标识（true为自动处理）

​

OAuthToken

resp

=

oauth.getAccessToken(codeResp.getDeviceCode(),

true

);

​

System.out.println(resp);

// 用户授权成功后返回的访问令牌

​

​

// 用access_token初始化Coze客户端

​

CozeAPI

coze

=

​

new

CozeAPI

.Builder()

​

.auth(

new

TokenAuth

(resp.getAccessToken()))

// 传入访问令牌

​

.baseURL(cozeAPIBase)

// 设置OpenAPI服务端点

​

.build();

​

​

// 令牌过期时刷新，refresh_token从OAuthToken对象获取

​

resp = oauth.refreshToken(resp.getRefreshToken());

​

​

}

catch

(CozeAuthException e) {

​

// 处理授权失败的情况

​

if

(AuthErrorCode.ACCESS_DENIED.equals(e.getCode())) {

​

// 用户拒绝授权，需引导用户重新操作

​

System.out.println(

"access denied"

);

​

}

else

if

(AuthErrorCode.EXPIRED_TOKEN.equals(e.getCode())) {

​

// 令牌过期，需重新获取设备码并引导用户授权

​

System.out.println(

"expired token"

);

​

}

else

{

​

e.printStackTrace();

​

}

​

}

catch

(Exception e) {

​

e.printStackTrace();

​

}

​

​

配置 OAuth JWT 授权流程

​

如果选择使用 OAuth JWT 方式完成授权，可参考以下流程及示例代码。完整的示例代码请参见

JWTsOauthExample.java

。

​

1.

创建 OAuth 应用并授权。

​

具体操作步骤可参考

​

OAuth JWT 授权（开发者）

。成功创建 OAuth 应用后，你将获得客户端 ID、公钥和私钥。你需要妥善保管公钥和私钥，以免数据泄露引发安全风险。

​

2.

在代码中通过环境变量方式设置客户端 ID、公钥和私钥。

​

​

Java

复制

​

String

jwtOauthClientID

=

System.getenv(

"COZE_JWT_OAUTH_CLIENT_ID"

);

// 从环境变量获取JWT授权的客户端ID，创建JWT类型OAuth应用时平台生成的唯一标识符

​

String

jwtOauthPrivateKey

=

System.getenv(

"COZE_JWT_OAUTH_PRIVATE_KEY"

);

// 从环境变量获取 OAuth 应用的私钥，用于签署JWT，可以在

OAuth 应用

页面找到这个应用，在

操作

列单击编辑图标，进入

配置

页面下载私钥文件

​

String

jwtOauthPrivateKeyFilePath

=

System.getenv(

"COZE_JWT_OAUTH_PRIVATE_KEY_FILE_PATH"

);

// 从环境变量获取私钥文件路径，私钥文件在本地的存储路径，开发者自行指定

​

String

jwtOauthPublicKeyID

=

System.getenv(

"COZE_JWT_OAUTH_PUBLIC_KEY_ID"

);

// 从环境变量获取 OAuth 应用的公钥ID，可以在

OAuth 应用

页面找到这个应用，在

操作

列单击编辑图标，进入

配置

页面查看公钥指纹。

​

​

JWTOAuthClient

oauth

=

null

;

​

try

{

​

jwtOauthPrivateKey =

​

new

String

(

​

Files.readAllBytes(Paths.get(jwtOauthPrivateKeyFilePath)), StandardCharsets.UTF_8);

​

}

catch

(IOException e) {

​

e.printStackTrace();

​

}

​

​

/*

​

The jwt oauth type requires using private to be able to issue a jwt token, and through

​

the jwt token, apply for an access_token from the coze service. The sdk encapsulates

​

this procedure, and only needs to use get_access_token to obtain the access_token under

​

the jwt oauth process.

​

Generate the authorization token

​

The default ttl is 900s, and developers can customize the expiration time, which can be

​

set up to 24 hours at most.

​

* */

​

try

{

​

oauth =

​

new

JWTOAuthClient

.JWTOAuthBuilder()

​

.clientID(jwtOauthClientID)

//OAuth应用的客户端ID，创建 OAuth 应用时获取的客户端 ID。

​

.privateKey(jwtOauthPrivateKey)

// OAuth 应用的私钥。

​

.publicKey(jwtOauthPublicKeyID)

//OAuth 应用的

公钥指纹。

​

.baseURL(Consts.

COZE_CN_BASE_URL

)

//扣子 OpenAPI 的 Endpoint。

​

.build();

​

}

catch

(Exception e) {

​

e.printStackTrace();

​

return

;

​

}

​

​

3.

应用程序通过公钥和私钥签署 JWT，并通过扣子编程提供的 API 获取访问密钥。

​

Coze SDK for Java 封装了这一过程，你只需要在OAuth JWT 流程中使用 get_access_token 来获取访问密钥即可。

​

​

Java

复制

try

{

​

OAuthToken

resp

=

oauth.getAccessToken()

;

​

System.out.println(resp)

;

​

}

catch

(Exception e)

{

​

e.printStackTrace()

;

​

}

​

/

*

​

The jwt oauth process does not support refreshing tokens. When the token expires

,

​

just

directly call get_access_token to generate a new token

.

​

* *

/

​

CozeAPI

coze

=

new

CozeAPI

.Builder().auth(

new

JWTOAuth

(oauth)).baseURL(Consts.

COZE_CN_BASE_URL

).build()

;

​

// you can also specify the scope and session for i

t

​

​

上一篇

安装 Java SDK

下一篇

快速开始
============================================================
# 快速开始
来源: https://www.coze.cn/open/docs/developer_guides/java_getting_started
============================================================

快速开始

本文介绍如何使用 Coze Java SDK 完成扣子编程的常用操作，例如如何初始化 SDK、创建一个智能体草稿、发布智能体为 API 服务、和智能体对话等。

​

说明

初始化之前，请确认已完成以下操作：

​

已安装 Coze Java SDK。更多信息，可参见

​

安装 Java SDK

。

​

已实现授权流程，并通过环境变量等方式配置了访问密钥。详细说明可参考

​

配置访问密钥

。

​

​

初始化 SDK

​

初始化 Coze client 之后，才可以向扣子编程服务端发送 OpenAPI 请求。初始化时推荐通过环境变量动态获取访问密钥，以免硬编码引发数据安全风险。

​

初始化代码如下：

​

​

Java

复制

import

com.coze.openapi.service.auth.TokenAuth;

​

import

com.coze.openapi.service.config.Consts;

​

import

com.coze.openapi.service.service.CozeAPI;

​

​

import

okhttp3.OkHttpClient;

​

​

public

class

InitClientExample

{

​

public

static

void

main

(String[] args)

{

​

// Get an access_token through personal access token or oauth.

​

// Coze suggest that you manage access keys through environment variables.

​

String

token

=

System.getenv(

"

COZE_API_TOKEN

"

);

​

TokenAuth

authCli

=

new

TokenAuth

(token);

​

​

CozeAPI

coze

=

​

new

CozeAPI

.Builder()

​

.baseURL(Consts.

COZE_CN_BASE_URL

)

​

.auth(authCli)

​

.client(

new

OkHttpClient

.Builder().build())

​

.build();

​

}

​

}

​

​

创建并发布智能体为 API 服务

​

通过 API 方式和智能体对话之前，你需要先创建一个智能体，并将其发布为 API 服务。你可以在扣子编程中创建智能体并发布，也可以通过调用相关的 API 实现。调用 API 创建智能体时，部分配置对应的 API 参数暂未开放，你只能为智能体添加知识库等有限的配置。创建智能体的操作步骤可参考

​

搭建一个 AI 助手智能体

，将智能体发布为 API 服务的操作步骤可参考

​

发布智能体为 API 服务

。

​

完整示例代码，请参见

GitHub 示例

。

​

相关 API 接口描述，请参见：

​

​

创建智能体

​

​

发布智能体

​

示例代码如下：

​

​

Java

复制

package

example.bot;

​

​

import

java.util.Arrays;

​

​

import

com.coze.openapi.client.bots.*;

​

import

com.coze.openapi.client.bots.model.BotOnboardingInfo;

​

import

com.coze.openapi.client.bots.model.BotPromptInfo;

​

import

com.coze.openapi.client.files.UploadFileReq;

​

import

com.coze.openapi.client.files.UploadFileResp;

​

import

com.coze.openapi.service.auth.TokenAuth;

​

import

com.coze.openapi.service.service.CozeAPI;

​

​

/*

​

This example is for describing how to create a bot, update a bot and publish a bot to the API.

​

The document for those interface:

​

* */

​

public

class

BotPublishExample

{

​

​

public

static

void

main

(String[] args)

{

​

// Get an access_token through personal access token or oauth.

​

String

token

=

System.getenv(

"COZE_API_TOKEN"

);

​

TokenAuth

authCli

=

new

TokenAuth

(token);

​

​

// Init the Coze client through the access_token.

​

CozeAPI

coze

=

​

new

CozeAPI

.Builder()

​

.baseURL(Consts.

COZE_CN_BASE_URL

)

​

.auth(authCli)

​

.readTimeout(

10000

)

​

.build();

​

;

​

​

/*

​

* step one, create a bot

​

* */

​

String

workspaceID

=

System.getenv(

"WORKSPACE_ID"

);

​

​

// set the prompt of your bot

​

BotPromptInfo

promptInfo

=

new

BotPromptInfo

(

"your prompt"

);

​

​

// set the onboarding info of your bot

​

BotOnboardingInfo

onboardingInfo

=

​

BotOnboardingInfo.builder()

​

.prologue(

"the prologue of your bot"

)

​

.suggestedQuestions(Arrays.asList(

"question 1"

,

"question 2"

))

​

.build();

​

// Call the upload file interface to get the avatar id.

​

String

avatarPath

=

System.getenv(

"IMAGE_FILE_PATH"

);

​

UploadFileResp

avatarInfo

=

coze.files().upload(UploadFileReq.of(avatarPath));

​

System.out.println(avatarInfo);

​

​

// build the request

​

CreateBotReq

createReq

=

​

CreateBotReq.builder()

​

.spaceID(workspaceID)

​

.description(

"the description of your bot"

)

​

.name(

"the name of your bot"

)

​

.promptInfo(promptInfo)

​

.onboardingInfo(onboardingInfo)

​

.iconFileID(avatarInfo.getFileInfo().getID())

​

.build();

​

​

// Invoke the creation interface to create a bot in the draft status, and you can get the bot

​

// id.

​

CreateBotResp

createResp

=

coze.bots().create(createReq);

​

String

botID

=

createResp.getBotID();

​

System.out.println(createResp);

​

​

/*

​

* step two, update the bot, you can update the bot after being created

​

* in this example, we will update the avatar of the bot

​

*/

​

PublishBotReq

publishReq

=

​

PublishBotReq.builder().botID(botID).connectorIDs(Arrays.asList(

"1024"

)).build();

​

​

}

​

}

​

​

发起对话

​

​

发起对话

接口用于向指定智能体发起一次对话，支持在对话时添加对话的上下文消息，以便智能体基于历史消息做出合理的回复。开发者可以按需选择响应方式，即流式或非流式响应，响应方式决定了开发者获取智能体回复的方式。

​

流式响应

：智能体在生成回复的同时，将回复消息以数据流的形式逐条发送给客户端。处理结束后，服务端会返回拼接后完整的智能体回复。详细说明可参考

流式响应

。

​

非流式响应

：无论对话是否处理完毕，立即发送响应消息。开发者可以通过接口

查看对话详情

确认本次对话处理结束后，再调用

查看对话消息详情

接口查看模型回复等完整响应内容。详细说明可参考

非流式响应

。

​

本文档以流式响应为例，演示通过 API 方式和智能体对话相关实例代码。你也可以查看 Coze Java SDK

示例代码目录

，查看发起对话接口的其他实现方式，例如非流式响应、对话中发送多模态内容等。

​

示例代码如下：

​

​

Java

复制

/* (C)2024 */

​

package

example.chat;

​

​

import

java.util.Collections;

​

​

import

com.coze.openapi.client.chat.CreateChatReq;

​

import

com.coze.openapi.client.chat.model.ChatEvent;

​

import

com.coze.openapi.client.chat.model.ChatEventType;

​

import

com.coze.openapi.client.connversations.message.model.Message;

​

import

com.coze.openapi.service.auth.TokenAuth;

​

import

com.coze.openapi.service.service.CozeAPI;

​

​

import

io.reactivex.Flowable;

​

​

/*

​

* This example is about how to use the streaming interface to start a chat request

​

* and handle chat events

​

* */

​

public

class

StreamChatExample

{

​

​

public

static

void

main

(String[] args)

{

​

​

// Get an access_token through personal access token or oauth.

​

String

token

=

System.getenv(

"COZE_API_TOKEN"

);

​

String

botID

=

System.getenv(

"PUBLISHED_BOT_ID"

);

​

String

userID

=

System.getenv(

"USER_ID"

);

​

​

TokenAuth

authCli

=

new

TokenAuth

(token);

​

​

// Init the Coze client through the access_token.

​

CozeAPI

coze

=

​

new

CozeAPI

.Builder()

​

.baseURL(Consts.

COZE_CN_BASE_URL

)

​

.auth(authCli)

​

.readTimeout(

10000

)

​

.build();

​

;

​

​

/*

​

* Step one, create chat

​

* Call the coze.chat().stream() method to create a chat. The create method is a streaming

​

* chat and will return a Flowable ChatEvent. Developers should iterate the iterator to get

​

* chat event and handle them.

​

* */

​

CreateChatReq

req

=

​

CreateChatReq.builder()

​

.botID(botID)

​

.userID(userID)

​

.messages(Collections.singletonList(Message.buildUserQuestionText(

"What can you do?"

)))

​

.build();

​

​

Flowable<ChatEvent> resp = coze.chat().stream(req);

​

resp.blockingForEach(

​

event -> {

​

if

(ChatEventType.CONVERSATION_MESSAGE_DELTA.equals(event.getEvent())) {

​

System.out.print(event.getMessage().getContent());

​

}

​

if

(ChatEventType.CONVERSATION_CHAT_COMPLETED.equals(event.getEvent())) {

​

System.out.println(

"Token usage:"

+ event.getChat().getUsage().getTokenCount());

​

}

​

});

​

System.out.println(

"done"

);

​

coze.shutdownExecutor();

​

}

​

}

​

​

上一篇

配置访问密钥

下一篇

Go SDK 概述
============================================================
# Go SDK 概述
来源: https://www.coze.cn/open/docs/developer_guides/go_overview
============================================================

Go SDK 概述

Coze API Go SDK 是由扣子官方提供的一个 SDK 工具包。你可以通过 Go SDK 将 Coze 的 OpenAPI 集成到你的应用程序中。Go SDK 支持 Coze 提供的所有官方鉴权方法，具有高度灵活性和高可用性，可以显著提升 OpenAPI 的使用效率。通过使用访问密钥初始化 SDK，可以高效、安全地通过 OpenAPI 访问你的 AI 智能体。

​

Coze API Go SDK 遵循用户友好的设计风格，可简化你的开发工作，适合所有技能水平开发者使用。

​

源码地址

​

访问

GitHub

获取 Coze API Go SDK 源码。

​

注意

从扣子 GitHub 仓库获取的源码和示例代码中，

base_url

默认设置为域名

CozeComBaseURL

，使用源码前应手动将其修改为域名

CozeCnBaseURL

。

​

​

示例代码

​

Coze Go SDK 提供各种授权方式、各种使用方式的示例代码，便于开发者直接参考使用。

​

说明

Coze Go SDK 支持扣子所有 OpenAPI，对应的 API 文档可参考

​

API 介绍

。

​

示例代码将持续更新和补充，各种场景的 Coze Go SDK

最新版本

示例代码可参考

GitHub

。

​

​

常见场景的示例代码及说明如下：

​

​

模块

​

示例文件

​

说明

​

授权

​

pat_example.go

​

通过个人访问密钥实现 OpenAPI 鉴权。

​

​

web_oauth_example.go

​

通过 OAuth 授权码方式实现授权与 OpenAPI 鉴权。

​

​

jwt_example.go

​

通过 OAuth JWT 方式实现授权与 OpenAPI 鉴权。

​

​

pkce_example.go

​

通过 OAuth PKCE 方式实现授权与 OpenAPI 鉴权。

​

​

device_example.go

​

通过 OAuth 设备码方式实现授权与 OpenAPI 鉴权。

​

对话

​

non_stream_chat_example.go

​

发起对话，响应方式为非流式响应。

​

​

stream_chat_example.go

​

发起对话，响应方式为流式响应。

​

​

multi_modal_chat_example.go

​

发起对话，对话中上传文件，并发送多模态内容。

​

​

submit_tool_output_example.go

​

对话时调用端插件。

​

会话和消息

​

conversation_example.go

​

创建对话、向对话中添加消息以及清除对话内容等。

​

​

list_conversation_example.go

​

查询对话列表。

​

​

create_update_delete_message_example.go

​

创建、更新和删除消息

​

工作流

​

non_stream_run_example.go

​

运行工作流，响应方式为非流式响应。

​

​

stream_run_example.go

​

运行工作流，响应方式为流式响应，且工作流中包含问答节点。

​

​

async_workflow_run_example.go

​

异步运行工作流，并获取工作流运行结果。

​

​

workflow_stream_chat_example.go

​

运行对话流。

​

智能体管理

​

publish_bot_example.go

​

创建一个草稿状态的智能体，更新智能体，并发布智能体为 API 服务。

​

WebSocket 语音

​

websockets_audio_chat_example.go

​

WebSocket 语音通话。

​

​

websockets_speech_example.go

​

语音合成，将文本转为语音，并将生成的语音保存为音频文件。

​

​

websockets_transcriptions_example.go

​

语音识别，将指定音频文件转录为文本。

​

语音

​

audio_rooms_create_main.go

​

RTC 音视频通话场景中，创建音视频房间。

​

​

audio_speech_create_example.go

​

语音合成，将文本转为语音，并将生成的语音保存为音频文件。

​

​

audio_transcription_create_example.go

​

语音识别，将指定音频文件转录为文本。

​

​

audio_voices_clone_example.go

​

克隆音色。

​

​

audio_voices_list_example.go

​

查询音色列表。

​

工作空间

​

list_workspace_example.go

​

查询所有工作空间列表。

​

知识库

​

dataset_documents_example.go

​

知识库管理，包含：

​

创建、查询、更新和删除知识库。

​

上传文本和图片类型的知识库文件。

​

更新图片知识库的描述。

​

查看知识库图片列表。

​

文件管理

​

files_examples.go

​

文件上传。

​

文件夹

​

folders_examples.go

​

查询文件夹列表和文件夹详情。

​

异常处理

​

handle_error_example.go

​

处理 API 异常。

​

客户端管理

​

init_client_example.go

​

修改日志级别。

​

​

​

初始化客户端。

​

获取日志

​

get_log_id_example.go

​

获取日志。

​

​

异常处理

​

当调用 API 失败时，SDK 会返回

Error

。当鉴权失败的时候，

SDK 会抛出

AuthError

。开发者可以根据自己的需求捕获对应的异常，其中

Error

会获取到异常接口的错误码，API 错误码的相关说明及处理方式可参考

​

错误码

。

​

上一篇

快速开始

下一篇

安装 Go SDK
============================================================
# 安装 Go SDK
来源: https://www.coze.cn/open/docs/developer_guides/go_installation
============================================================

安装 Go SDK

使用 Coze API Go SDK 之前，你需要先参考本文档安装 Go SDK。

​

环境准备

​

Coze API Go SDK 适用于 Go 1.8 及以上版本。安装 Go SDK 之前，建议执行以下命令确认你已安装 1.8及以上版本的 Go。

​

​

Bash

复制

# 查看 Go 版本

​

go version

​

​

# 回显信息显示已安装 1.18.10 版本

​

go version go1.18.10 darwin/amd64

​

​

安装 SDK

​

说明

安装 Coze API Go SDK 时，默认安装最新版本。你也可以

点击此处

查看 Coze API Go SDK 已发布的所有历史版本。更多信息，请参见

README

。

​

​

可以通过以下方式安装 Coze API Go SDK。

​

​

Bash

复制

go get github.com/coze-dev/coze-go

​

​

​

上一篇

Go SDK 概述

下一篇

配置访问密钥
============================================================
# 配置访问密钥
来源: https://www.coze.cn/open/docs/developer_guides/go_access_token
============================================================

配置访问密钥

通过 Go SDK 调用扣子编程 OpenAPI 时，需要在请求中配置访问密钥，以进行身份验证和权限校验。扣子编程 OpenAPI 提供了两种鉴权方式：个人访问密钥（PAT）和 OAuth。开发者可以根据当前业务场景选择合适的鉴权方式，并获取相应的访问密钥。

​

对于 OAuth 授权码等复杂的授权方式，Coze API Go SDK 已经封装了相关的逻辑，并处理了不同的错误返回代码，从而简化开发者的操作。

​

配置方式

​

扣子编程 OpenAPI 目前支持的鉴权方式如下。

​

​

访问密钥类型

​

鉴权方式

​

说明

​

示例文件

​

个人访问密钥

​

个人访问密钥

​

Personal Access Token，简称 PAT。扣子编程中生成的个人访问令牌。PAT 生成与使用便捷，适用于测试环境调试等场景。每个令牌可以关联多个空间，并开通指定的接口权限。生成方式可参考

​

添加个人访问令牌

。

​

pat_example.go

​

服务访问令牌（SAT）

​

服务访问令牌（SAT）

​

Service Access Token（简称 SAT）是以服务身份创建的访问凭证，可

长期有效

访问扣子编程资源，通常用于服务/应用程序的身份验证和授权。生成方式可参考

​

添加服务访问令牌

。

​

SAT 的示例代码与 PAT 通用，可直接参考 PAT 的示例文件。

​

pat_example.go

​

OAuth 认证

​

​

授权码授权

​

（Authorization Code Flow）

​

适用于有显著前后端之分的应用程序授权场景。其中前端模块负责与用户交互，后端服务处理前端请求，与扣子编程授权服务器和 OpenAPI 交互。 实现流程可参考

​

OAuth 授权码授权

。

​

web_oauth_example.go

​

​

PKCE 授权

​

（Authorization Code Flow with PKCE）

​

应用程序无后端服务，所有操作都发生在应用程序的前端。 实现流程可参考

​

OAuth PKCE

。

​

pkce_example.go

​

​

设备码授权

​

（Device Code Flow）

​

应用程序无后端服务，所有操作都发生在应用程序的 Command Line，且 Command Line 无法提供“同意授权”的操作。 实现流程可参考

​

OAuth 设备授权

。

​

device_example.go

​

​

JWT 授权

​

（JWT Flow）

​

应用程序服务端直接调用扣子编程 OpenAPI。

​

应用程序后端服务代理应用程序自己的用户获取身份凭据，应用程序用户基于凭据直接访问 OpenAPI。 实现流程可参考

​

OAuth JWT 授权（开发者）

。

​

jwt_example.go

​

​

配置个人访问密钥（PAT）

​

如果选择使用个人访问密钥进行鉴权，首先需要申请一个个人访问密钥，并为其添加指定的空间和权限。操作步骤可参考

​

添加个人访问令牌

。

​

建议通过环境变量来管理访问密钥，以避免在代码中硬编码，从而防止密钥泄露和潜在的安全风险。配置环境变量后，你可以在不修改代码的情况下将动态的鉴权参数传递到相应的函数中，从而实现便捷且安全的身份认证。

​

1.

设置环境变量。

​

其中 COZE_API_TOKEN 是扣子编程中申请的个人访问密钥。

​

​

Shell

复制

export COZE_API_TOKEN=pat_****

​

​

2.

初始化客户端。

​

示例代码如下：

​

​

Go

复制

func

main

()

{

​

// Get an access token using the personal access token or oauth.

​

token := os.Getenv(

"COZE_API_TOKEN"

)

​

authCli := coze.NewTokenAuth(token)

​

​

/*

​

* The default access is api.coze.com, but if you need to access api.coze.cn

​

* please use baseUrl to configure the API endpoint to access

​

*/

​

cozeCli := coze.NewCozeAPI(authCli, coze.WithBaseURL(

coze.

CozeCnBaseURL

))

​

}

​

​

配置 OAuth 授权码流程

​

如果选择使用 OAuth 授权码方式完成授权，可参考以下流程及示例代码。

​

1.

创建 OAuth 应用。

​

具体操作步骤可参考

​

OAuth 授权码授权

。成功创建 OAuth 应用后，你将获得客户端 ID、客户端密钥和重定向地址。客户端密钥需要妥善保管，以避免因泄露而导致的安全风险。

​

2.

在代码中通过环境变量方式设置客户端 ID、客户端密钥和重定向地址。

​

​

Go

复制

//从环境变量获取重定向地址、客户端 ID、客户端密钥

​

func

main

()

{

​

redirectURI := os.Getenv(

"COZE_WEB_OAUTH_REDIRECT_URI"

)

// 重定向地址是创建OAuth应用时配置的回调地址，用户授权后会跳转至此地址

​

clientSecret := os.Getenv(

"COZE_WEB_OAUTH_CLIENT_SECRET"

)

// 客户端密钥是创建OAuth应用时扣子编程生成的密钥，用于验证应用身份，需妥善保管

​

clientID := os.Getenv(

"COZE_WEB_OAUTH_CLIENT_ID"

)

// 客户端ID是创建OAuth应用时扣子编程生成的唯一标识，用于区分不同应用

​

ctx

:= context.Background(

)

​

​

// The sdk offers the WebOAuthClient class to establish an authorization for Web OAuth

.

​

// Firstly, it is required to initialize the WebOAuthApp with the client ID and client secret

.

​

oauth, err := coze.NewWebOAuthClient(clientID, clientSecret, coze.WithAuthBaseURL(coze.

CozeCnBaseURL

)

)

​

if

err !=

nil

{

​

fmt.Printf(

"Failed to create OAuth client: %v\n"

, err

)

​

retur

n

​

}

​

}

​

​

3.

授权码流程中，会自动生成一个扣子编程授权页面，然后将其发送给需要授权的用户。扣子用户可访问此链接，并根据页面提示完成授权流程。

​

​

Go

复制

// Generate the authorization link and direct the user to open it

.

​

oauthURL := oauth.GetOAuthURL(ctx, &coze.GetWebOAuthURLReq

{

​

RedirectURI: redirectURI

,

​

State:

"state"

,

​

}

)

​

fmt.Println(oauthURL

)

​

​

// To restrict access to a specific WorkSpace, you can specify the WorkSpaceID when obtaining the URL.

​

// oauthURL = oauth.GetOAuthURL(&coze.GetWebOAuthURLReq

{

​

//  RedirectURI: redirectURI

,

​

//  State:       "state"

,

​

//  WorkspaceID: &workspaceID

,

​

// }

)

​

// fmt.Println(oauthURL

)

​

​

4.

用户点击同意授权按钮后，扣子网页会将请求重定向到授权链接中配置的重定向地址。此时，地址中会通过查询参数（Query）携带授权码和状态参数。

​

通过授权码（OAuth code）调用 GetAccessToken 接口即可获取 OAuth Access Token。示例代码如下：

​

​

Go

复制

// After the user clicks the authorization consent button, the coze web page will redirec

t

​

// to the redirect address configured in the authorization link and carry the authorizatio

n

​

// code and state parameters in the address via the query string

.

​

/

/

​

// Get from the query of the redirect interface: query.get('code'

)

​

code :=

"mock code

"

​

​

// After obtaining the code after redirection, the interface to exchange the code for

a

​

// token can be invoked to generate the

C

oze

access_token of the authorized user

.

​

resp, err := oauth.GetAccessToken(ctx, &coze.GetWebOAuthAccessTokenReq

{

​

Code:        code

,

​

RedirectURI: redirectURI

,

​

}

)

​

if

err !=

nil

{

​

fmt.Printf(

"Failed to get access token: %v\n"

, err

)

​

retur

n

​

}

​

fmt.Println(resp

)

​

​

// When the token expires, you can also refresh and re-obtain the toke

n

​

resp, err = oauth.RefreshToken(ctx, resp.RefreshToken

)

​

if

err !=

nil

{

​

fmt.Printf(

"Failed to refresh token: %v\n"

, err

)

​

retur

n

​

}

​

​

fmt.Printf(

"%+v\n"

, resp

)

​

​

// you can get request log by getLogID metho

d

​

fmt.Println(resp.LogID()

)

​

​

// use the access token to init Coze clien

t

​

cozeCli := coze.NewCozeAPI(coze.NewTokenAuth(resp.AccessToken), coze.WithBaseURL(coze.

CozeCnBaseURL

)

)

​

_ = cozeCl

i

​

​

配置 OAuth PKCE 授权流程

​

如果选择使用 OAuth PKCE 方式完成授权，可参考以下流程及示例代码。

​

1.

创建 OAuth 应用。

​

具体操作步骤可参考

​

OAuth PKCE

。成功创建 OAuth 应用后，你将获得客户端 ID 和重定向地址。

​

2.

在代码中通过环境变量方式设置客户端 ID 和重定向地址。

​

​

Go

复制

//从环境变量获取重定向地址、客户端 ID

​

redirectURI := os.Getenv(

"COZE_PKCE_OAUTH_REDIRECT_URI"

)

// 重定向地址是创建PKCE类型OAuth应用时配置的前端回调地址

​

clientID := os.Getenv(

"COZE_PKCE_OAUTH_CLIENT_ID"

)

// 客户端ID是创建PKCE类型OAuth应用时扣子编程生成的唯一标识

​

​

/

/

​

// The default access is api.coze.com, but if you need to access api.coze.cn

,

​

// please use base_url to configure the api endpoint to acces

s

​

​

oauth

, err := coze.NewPKCEOAuthClient(clientID, coze.WithAuthBaseURL(coze.

CozeCnBaseURL

)

)

​

if

err !=

nil

{

​

fmt.Printf(

"Failed to create OAuth client: %v\n"

, err

)

​

retur

n

​

}

​

​

3.

在代码中实现 OAuth PKCE 授权流程。

​

客户端生成一个随机值

code_verifier

，并使用指定算法（通常为 SHA-256 算法）将其转换为

code_challenge

。然后，基于回调地址、

code_challenge

和

code_challenge_method

，生成一个授权链接。

​

在此过程中，

code_verifier

由 SDK 生成，并与生成的授权链接一同返回给调用方。

​

​

Go

复制

// In the SDK, we have wrapped up the code_challenge process of PKCE.

​

// Developers only need to select the code_challenge_method.

​

oauthURL, err := oauth.GenOAuthURL(&coze.GetPKCEAuthURLReq{

​

RedirectURI: redirectURI,

​

State:

"state"

,

​

Method:      coze.CodeChallengeMethodS256.Ptr(),

​

})

​

if

err !=

nil

{

​

fmt.Printf(

"Failed to generate OAuth URL: %v\n"

, err)

​

return

​

}

​

// URL that users need to click.

​

fmt.Println(oauthURL.AuthorizationURL)

​

//

The code verifier generated by the SDK

​

fmt.Println(oauthURL.CodeVerifier)

​

​

// Specify the workspaceID to limit the scope of the token

​

// oauthURL, err := oauth.GenOAuthURL(&coze.GetPKCEOAuthURLReq{

​

//        RedirectURI: redirectURI, State: "state",

​

//        Method: coze.CodeChallengeMethodS256.Ptr(),

​

//        WorkspaceID: &workspace_id,

​

//     })

​

// if err != nil {

​

//  fmt.Printf("Failed to generate OAuth URL with workspaces: %v\n", err)

​

//  return

​

// }

​

// fmt.Println(oauthURL.AuthorizationURL)

​

//  fmt.Println(oauthURL.CodeVerifier)

​

​

4.

完成授权。

​

开发者应该引导用户打开生成的授权链接。当用户同意授权时，扣子编程会将页面重定向到开发者配置的回调地址。在这个回调请求中，开发者可以获取到授权码

code

。

​

在获取

code

后，为了交换访问令牌，开发者需要调用

GetAccessToken

方法。在调用此方法时，需要将之前 SDK 生成的

code_verifier

一同作为参数传入。

​

​

Go

复制

// After the user clicks the authorization consent button

,

​

// the coze web page will redirect to the redirect address configured in the authorization lin

k

​

// and carry the authorization code and state parameters

in

the address via the query string

.

​

// Get from the query of the redirect interface : query.get('code'

)

​

code :=

"mock code

"

​

codeVerifier := oauthURL.CodeVerifie

r

​

// After obtaining the code after redirection, the interface to exchange the code for

a

​

// token can be invoked to generate the

coze

access_token of the authorized user

.

​

// The developer should use code verifier returned by genOAuthURL() metho

d

​

resp, err := oauth.GetAccessToken(ctx, &coze.GetPKCEAccessTokenReq

{

​

Code: code

,

​

RedirectURI: redirectURI,

​

CodeVerifier: codeVerifier}

)

​

if

err !=

nil

{

​

fmt.Printf(

"Failed to get access token: %v\n"

, err

)

​

retur

n

​

}

​

fmt.Printf(

"%+v\n"

, resp

)

​

​

// use the access token to init Coze clien

t

​

cozeCli := coze.NewCozeAPI(coze.NewTokenAuth(resp.AccessToken), coze.WithBaseURL(coze.

CozeCnBaseURL

)

)

​

_ = cozeCl

i

​

​

// When the token expires, you can also refresh and re-obtain the toke

n

​

resp, err = oauth.RefreshToken(ctx, resp.RefreshToken

)

​

if

err !=

nil

{

​

fmt.Printf(

"Failed to refresh token: %v\n"

, err

)

​

retur

n

​

}

​

fmt.Println(resp

)

​

​

配置 OAuth 设备码授权流程

​

如果选择使用 OAuth 设备码方式完成授权，可参考以下流程及示例代码。

​

1.

创建 OAuth 应用。

​

具体操作步骤可参考

​

OAuth 设备授权

。成功创建 OAuth 应用后，你将获得客户端 ID。

​

2.

在代码中通过环境变量方式设置客户端 ID。

​

​

Go

复制

func

main

()

{

​

clientID := os.Getenv(

"COZE_DEVICE_OAUTH_CLIENT_ID"

)

// 从环境变量获取客户端ID，客户端ID是创建设备码类型OAuth应用时平台生成的唯一标识

​

​

// The default access is api.coze.com, but if you need to access api.coze.cn

,

​

// please use base_url to configure the api endpoint to acces

s

​

ctx

:= context.Background(

)

​

​

oauth, err := coze.NewDeviceOAuthClient(clientID, coze.WithAuthBaseURL(coze.

CozeCnBaseURL

)

)

​

if

err !=

nil

{

​

fmt.Printf(

"Failed to create OAuth client: %v\n"

, err

)

​

retur

n

​

}

​

}

​

​

3.

通过 OAuth 设备码授权流程，可以获得访问密钥。

​

应用程序需要调用 扣子编程 OpenAPI 来生成设备代码，获取

UserCode

和

DeviceCode

。使用

UserCode

生成授权链接，然后引导用户打开该链接。在页面中，用户需要输入

UserCode

并同意授权。用户同意授权后，应用程序再次调用扣子编程 OpenAPI，通过提供的

DeviceCode

来生成访问密钥。

​

SDK 已经拼接了 URL，只需将 SDK 返回的 URL 交给用户进行操作即可。

​

​

Go

复制

// First, make a call to obtain 'GetDeviceCode'

​

​

codeResp, err := oauth.GetDeviceCode(ctx,

nil

)

​

if

err !=

nil

{

​

fmt.Printf(

"Failed to get device code: %v\n"

, err)

​

return

​

}

​

fmt.Printf(

"%+v\n"

, codeResp)

​

fmt.Println(codeResp.LogID())

​

// The returned device_code contains an authorization link. Developers need to guide users

​

// to open up this link.

​

// open codeResp.getVerificationUri

​

​

fmt.Printf(

"Please open url: %s\n"

, codeResp.VerificationURL)

​

​

// 也可以指定 workspace，限制生效范围

​

// codeResp, err = oauth.GetDeviceCode(ctx, &coze.GetDeviceOAuthCodeReq{

​

//  WorkspaceID: &workspaceID,

​

// })

​

​

4.

在通过设备码授权流程中，应用程序需要使用

DeviceCode

来轮询扣子编程 OpenAPI，以获取访问密钥。

​

Coze API Go SDK 已经封装了这部分的逻辑，并处理了不同的错误返回代码。开发者只需调用

GetAccessToken

方法即可。

​

​

Go

复制

resp, err := oauth.GetAccessToken(ctx, &coze.GetDeviceOAuthAccessTokenReq{

​

DeviceCode: codeResp.DeviceCode,

​

Poll:

true

,

​

})

​

if

err !=

nil

{

​

authErr, ok := coze.

AsAuthError

(err)

​

if

!ok {

​

fmt.Printf(

"Failed to get access token: %v\n"

, err)

​

return

​

}

​

switch

authErr.Code {

​

case

coze.AccessDenied:

​

// The user rejected the authorization.

​

// Developers need to guide the user to open the authorization link again.

​

fmt.Println(

"access denied"

)

​

case

coze.ExpiredToken:

​

// The token has expired. Developers need to guide the user to open

​

// the authorization link again.

​

fmt.Println(

"expired token"

)

​

default

:

​

fmt.Printf(

"Unexpected error: %v\n"

, err)

​

​

return

​

}

​

}

​

fmt.Printf(

"%+v\n"

, resp)

​

​

配置 OAuth JWT 授权流程

​

如果选择使用 OAuth JWT 方式完成授权，可参考以下流程及示例代码。

​

1.

创建 OAuth 应用并授权。

​

具体操作步骤可参考

​

OAuth JWT 授权（开发者）

。成功创建 OAuth 应用后，你将获得客户端 ID、公钥和私钥。你需要妥善保管公钥和私钥，以免数据泄露引发安全风险。

​

2.

在代码中通过环境变量方式设置客户端 ID、公钥和私钥。

​

​

Go

复制

// The default access is api.coze.com, but if you need to access api.coze.cn,

​

// please use base_url to configure the api endpoint to access

​

cozeAPIBase := os.Getenv(

"COZE_API_BASE"

)

​

jwtOauthClientID := os.Getenv(

"COZE_JWT_OAUTH_CLIENT_ID"

)

// 从环境变量获取JWT授权的客户端ID，创建JWT类型OAuth应用时平台生成的唯一标识符

​

jwtOauthPrivateKey := os.Getenv(

"COZE_JWT_OAUTH_PRIVATE_KEY"

)

// 从环境变量获取 OAuth 应用的私钥，用于签署JWT，可以在

OAuth 应用

页面找到这个应用，在

操作

列单击编辑图标，进入

配置

页面下载私钥文件

​

jwtOauthPrivateKeyFilePath := os.Getenv(

"COZE_JWT_OAUTH_PRIVATE_KEY_FILE_PATH"

)

// 从环境变量获取私钥文件路径，私钥文件在本地的存储路径，开发者自行指定

​

jwtOauthPublicKeyID := os.Getenv(

"COZE_JWT_OAUTH_PUBLIC_KEY_ID"

)

//OAuth 应用的

公钥指纹

，可以在

OAuth 应用

页面找到这个应用，在

操作

列单击编辑图标，进入

配置

页面查看公钥指纹。

​

​

// Read private key from file

​

privateKeyBytes, err := os.ReadFile(jwtOauthPrivateKeyFilePath)

​

if

err !=

nil

{

​

fmt.Printf(

"Error reading private key file: %v\n"

, err)

​

}

​

jwtOauthPrivateKey =

string

(privateKeyBytes)

​

​

// The jwt oauth type requires using private to be able to issue a jwt token, and through the jwt token,

​

// apply for an access_token from the coze service.The sdk encapsulates this procedure,

​

// and only needs to use get_access_token to obtain the access_token under the jwt oauth process.

​

// Generate the authorization token The default ttl is 900s, and developers can customize the expiration time,

​

// which can be set up to 24 hours at most.

​

oauth, err := coze.NewJWTOAuthClient(coze.NewJWTOAuthClientParam{

​

ClientID: jwtOauthClientID, PublicKey: jwtOauthPublicKeyID, PrivateKeyPEM: jwtOauthPrivateKey,

​

}, coze.WithAuthBaseURL(cozeAPIBase))

​

if

err !=

nil

{

​

fmt.Printf(

"Error creating JWT OAuth client: %v\n"

, err)

​

}

​

​

3.

应用程序通过公钥和私钥签署 JWT，并通过扣子编程提供的 API 获取访问密钥。

​

Coze API Go SDK 封装了这一过程，你只需要在OAuth JWT 流程中使用 get_access_token 来获取访问密钥即可。

​

​

Go

复制

resp, err := oauth.GetAccessToken(ctx,

nil

)

​

if

err !=

nil

{

​

fmt.Printf(

"Error getting access token: %v\n"

, err)

​

return

​

}

​

fmt.Printf(

"Access token response: %+v\n"

, resp)

​

fmt.Println(resp.LogID())

​

​

上一篇

安装 Go SDK

下一篇

快速开始
============================================================
# 快速开始
来源: https://www.coze.cn/open/docs/developer_guides/go_getting_started
============================================================

快速开始

本文介绍如何使用 Coze API Go SDK 完成扣子编程的常用操作，例如如何初始化 SDK、创建一个智能体草稿、发布智能体为 API 服务、和智能体对话等。

​

准备工作

​

初始化 SDK 前，请确认已完成以下操作：

​

已安装 Coze API Go SDK。详见

​

安装 Go SDK

。

​

已实现授权流程，并通过环境变量方式配置了访问密钥。详细说明可参考

​

配置访问密钥

。

​

说明

请确保扣子编程 Go SDK 版本已升级至

v0.0.0-20250604025746-0d3b62f445d2

及之后版本，以免调用

​

发起对话

或

​

执行对话流

API 失败。

​

​

初始化 SDK

​

初始化 Coze client 之后，才可以向扣子编程服务端发送 OpenAPI 请求。初始化时推荐通过环境变量动态获取访问密钥，以免硬编码引发数据安全风险。

​

初始化代码如下：

​

​

Go

复制

// This examples demonstrates how to initialize the Coze client with different configurations.

​

func

main

()

{

​

// Get an access_token through personal access token or oauth.

​

token := os.Getenv(

"COZE_API_TOKEN"

)

​

authCli := coze.NewTokenAuth(token)

​

​

// 1. Initialize with default configuration

​

cozeCli1 := coze.NewCozeAPI(authCli)

​

fmt.Println(

"client 1:"

, cozeCli1)

​

​

// 2. Initialize with custom base URL

​

cozeAPIBase := os.Getenv(

"COZE_API_BASE"

)

​

cozeCli2 := coze.NewCozeAPI(authCli, coze.WithBaseURL(cozeAPIBase))

​

fmt.Println(

"client 2:"

, cozeCli2)

​

​

// 3. Initialize with custom HTTP client

​

customClient := &http.Client{

​

Timeout:

30

* time.Second,

​

Transport: &http.Transport{

​

MaxIdleConns:

100

,

​

MaxIdleConnsPerHost:

100

,

​

IdleConnTimeout:

90

* time.Second,

​

},

​

}

​

cozeCli3 := coze.NewCozeAPI(authCli,

​

coze.WithBaseURL(cozeAPIBase),

​

coze.WithHttpClient(customClient),

​

)

​

fmt.Println(

"client 3:"

, cozeCli3)

​

}

​

​

创建并发布智能体为 API 服务

​

通过 API 方式和智能体对话之前，你需要先创建一个智能体，并将其发布为 API 服务。你可以在扣子编程中创建智能体并发布，也可以通过调用相关的 API 实现。调用 API 创建智能体时，部分配置对应的 API 参数暂未开放，你只能为智能体添加知识库等有限的配置。创建智能体的操作步骤可参考

​

搭建一个低代码智能体

。将智能体发布为 API 服务的操作步骤可参考

​

发布为 API 服务

。

​

关于创建草稿智能体的完整示例代码，请参见

GitHub 示例

。

​

相关 API 接口描述，请参见：

​

​

创建智能体

。

​

​

发布智能体

。

​

示例代码如下：

​

​

Go

复制

// This examples is for describing how to create a bot, update a bot and publish a bot to the API.

​

func

main

()

{

​

// Get an access_token through personal access token or oauth.

​

token := os.Getenv(

"COZE_API_TOKEN"

)

​

authCli := coze.NewTokenAuth(token)

​

​

// Init the Coze client through the access_token.

​

cozeCli := coze.NewCozeAPI(authCli, coze.WithBaseURL(os.Getenv(

"COZE_API_BASE"

)))

​

​

// step one, create a bot

​

workspaceID := os.Getenv(

"WORKSPACE_ID"

)

​

​

// Call the upload file interface to get the avatar id.

​

avatarPath := os.Getenv(

"IMAGE_FILE_PATH"

)

​

ctx := context.Background()

​

file, err := os.Open(avatarPath)

​

if

err !=

nil

{

​

fmt.Println(

"Error opening file:"

, err)

​

return

​

}

​

uploadReq := &coze.UploadFilesReq{

​

File: file,

​

}

​

avatarInfo, err := cozeCli.Files.Upload(ctx, uploadReq)

​

if

err !=

nil

{

​

fmt.Println(

"Error uploading avatar:"

, err)

​

return

​

}

​

fmt.Println(avatarInfo)

​

​

// build the request

​

createResp, err := cozeCli.Bots.Create(ctx, &coze.CreateBotsReq{

​

SpaceID:     workspaceID,

​

Description:

"the description of your bot"

,

​

Name:

"the name of your bot"

,

​

PromptInfo: &coze.BotPromptInfo{

​

Prompt:

"your prompt"

,

​

},

​

OnboardingInfo: &coze.BotOnboardingInfo{

​

Prologue:

"the prologue of your bot"

,

​

SuggestedQuestions: []

string

{

"question 1"

,

"question 2"

},

​

},

​

IconFileID: avatarInfo.FileInfo.ID,

​

})

​

if

err !=

nil

{

​

fmt.Println(

"Error creating bot:"

, err)

​

return

​

}

​

botID := createResp.BotID

​

fmt.Println(createResp)

​

fmt.Println(createResp.LogID())

​

​

//

​

// step two, update the bot, you can update the bot after being created

​

// in this examples, we will update the avatar of the bot

​

​

publishResp, err := cozeCli.Bots.Publish(ctx, &coze.PublishBotsReq{

​

BotID:        botID,

​

ConnectorIDs: []

string

{

"1024"

},

​

})

​

if

err !=

nil

{

​

fmt.Println(

"Error publishing bot:"

, err)

​

return

​

}

​

fmt.Println(publishResp)

​

fmt.Println(publishResp.LogID())

​

​

//

​

// step three, you can also modify the bot configuration and republish it.

​

// in this examples, we will update the avatar of the bot

​

​

newFile, err := os.Open(os.Getenv(

"IMAGE_FILE_PATH"

))

​

if

err !=

nil

{

​

fmt.Println(

"Error opening file:"

, err)

​

return

​

}

​

newUploadReq := &coze.UploadFilesReq{

​

File: newFile,

​

}

​

newAvatarInfo, err := cozeCli.Files.Upload(ctx, newUploadReq)

​

if

err !=

nil

{

​

fmt.Println(

"Error uploading new avatar:"

, err)

​

return

​

}

​

fmt.Println(newAvatarInfo)

​

fmt.Println(newAvatarInfo.LogID())

​

​

// Update bot

​

updateResp, err := cozeCli.Bots.Update(ctx, &coze.UpdateBotsReq{

​

BotID:      botID,

​

IconFileID: newAvatarInfo.FileInfo.ID,

​

})

​

if

err !=

nil

{

​

fmt.Println(

"Error updating bot:"

, err)

​

return

​

}

​

fmt.Println(updateResp.LogID())

​

​

// Republish bot

​

publishResp, err = cozeCli.Bots.Publish(ctx, &coze.PublishBotsReq{

​

BotID:        botID,

​

ConnectorIDs: []

string

{

"1024"

},

​

})

​

if

err !=

nil

{

​

fmt.Println(

"Error republishing bot:"

, err)

​

return

​

}

​

fmt.Println(publishResp)

​

fmt.Println(publishResp.LogID())

​

}

​

​

发起对话

​

​

发起对话

接口用于向指定智能体发起一次对话，支持在对话时添加对话的上下文消息，以便智能体基于历史消息做出合理的回复。开发者可以按需选择响应方式，即流式或非流式响应，响应方式决定了开发者获取智能体回复的方式。

​

流式响应

：智能体在生成回复的同时，将回复消息以数据流的形式逐条发送给客户端。处理结束后，服务端会返回拼接后完整的智能体回复。详细说明可参考

​

流式响应

。

​

非流式响应

：无论对话是否处理完毕，立即发送响应消息。开发者可以通过接口

​

查看对话详情

。查看对话详情确认本次对话处理结束后，再调用

​

查看对话消息详情

接口查看模型回复等完整响应内容。详细说明可参考

​

非流式响应

。

​

本文档以流式响应为例，演示通过 API 方式和智能体对话相关实例代码。你也可以查看

Coze Go SDK 示例代码目录

，查看 chat 接口的其他实现方式，例如非流式响应、对话中发送多模态内容等。

​

示例代码如下：

​

​

Go

复制

package

main

​

​

import

(

​

"context"

​

"errors"

​

"fmt"

​

"io"

​

"os"

​

"time"

​

​

"github.com/coze-dev/coze-go"

​

)

​

​

func

main

()

{

​

ctx, cancel := context.WithTimeout(context.Background(),

10

*time.Second)

​

defer

cancel()

​

​

// Get an access_token through personal access token or oauth.

​

token := os.Getenv(

"COZE_API_TOKEN"

)

​

botID := os.Getenv(

"PUBLISHED_BOT_ID"

)

​

userID := os.Getenv(

"USER_ID"

)

​

​

authCli := coze.NewTokenAuth(token)

​

​

// Init the Coze client through the access_token.

​

cozeCli := coze.NewCozeAPI(authCli, coze.WithBaseURL(os.Getenv(

"COZE_API_BASE"

)))

​

​

//

​

// Step one, create chats

​

// Call the coze.chats().stream() method to create a chats. The create method is a streaming

​

// chats and will return a Flowable ChatEvent. Developers should iterate the iterator to get

​

// chats event and handle them.

​

// //

​

req := &coze.CreateChatsReq{

​

BotID:  botID,

​

UserID: userID,

​

Messages: []*coze.Message{

​

coze.BuildUserQuestionText(

"What can you do?"

,

nil

),

​

},

​

}

​

​

resp, err := cozeCli.Chat.Stream(ctx, req)

​

if

err !=

nil

{

​

fmt.Printf(

"Error starting chats: %v\n"

, err)

​

return

​

}

​

​

defer

resp.Close()

​

for

{

​

event, err := resp.Recv()

​

if

errors.Is(err, io.EOF) {

​

fmt.Println(

"Stream finished"

)

​

break

​

}

​

if

err !=

nil

{

​

fmt.Println(err)

​

break

​

}

​

if

event.Event == coze.ChatEventConversationMessageDelta {

​

fmt.Print(event.Message.Content)

​

}

else

if

event.Event == coze.ChatEventConversationChatCompleted {

​

fmt.Printf(

"Token usage:%d\n"

, event.Chat.Usage.TokenCount)

​

}

else

{

​

fmt.Printf(

"\n"

)

​

}

​

}

​

​

fmt.Printf(

"done, log:%s\n"

, resp.LogID())

​

}

​

​

上一篇

配置访问密钥

下一篇

安装并使用 Web SDK
============================================================
# 安装并使用 Web SDK
来源: https://www.coze.cn/open/docs/developer_guides/ui_builder_web_sdk
============================================================

安装并使用 Web SDK

本文介绍如何安装并使用扣子 Web SDK，开发者可以参考本文档在自己开发的网站中快速添加一个 AI 应用，为网站集成智能服务。

​

功能简介

​

Web SDK 是一个轻量级 JavaScript 库，旨在帮助开发者快速将扣子编程上搭建的低代码应用（包括用户界面和业务逻辑）快速、无缝地集成到网站或 Web 页面中。

​

核心优势

：

​

无缝集成：

将已发布的低代码应用作为独立组件嵌入 Web 页面。

​

开箱即用：

集成后，低代码应用的 UI 和逻辑

无需二次开发

即可运行。

​

快速部署：

通过简单的代码引入，可在几分钟内完成集成。

​

场景示例

：

​

Web SDK 适用于需要在各类网站或 Web 页面中快速集成完整 AI 应用的场景，例如：

​

在内部业务系统中嵌入业务流程 AI 辅助工具，例如报销单填写助手等。

​

在电商平台嵌入交易辅助工具，例如 AI 导购/推荐助手等。

​

在内容平台嵌入内容处理工具，例如文本生成、信息提炼工具等。

​

体验 UI Builder

​

你可以在

扣子 Playground 的 Web SDK

页面体验 Web SDK 的使用效果。

​

​

​

​

​

​

​

​

​

​

​

​

准备工作

​

环境要求

​

Web SDK 的浏览器兼容性及运行环境要求如下表所示。

​

​

浏览器

​

版本限制

​

Chrome

​

87.0 及以上

​

Edge

​

88.0 及以上

​

Safari

​

14.0 及以上

​

Firefox

​

78.0 及以上

​

​

获取访问密钥

​

访问密钥用于 Web SDK 的身份认证与鉴权。扣子编程提供多种类型的鉴权方式，你可以根据使用场景选择对应的鉴权方式：

​

体验或调试场景

：建议开发者生成一个短期的个人访问令牌（PAT），快速跑通 Web SDK 的整体流程。 具体步骤请参见

添加个人访问令牌

。

​

线上环境

：线上环境应使用 OAuth 鉴权或 SAT 鉴权，详细说明请参考

鉴权方式概述

。

​

权限要求

​

访问密钥必须被授予指定的权限，才能使用 Web SDK 的各项能力。Web SDK 所需的权限列表如下：

​

​

密钥类型

​

PAT / SAT /普通 OAuth

​

渠道 OAuth 访问密钥

​

权限点

​

​

Bot管理

​

chat

​

会话管理

​

listConversation

​

createConversation

​

editConversation

​

对话

​

cancelChat

​

文件

​

uploadFile

​

消息

​

listMessage

​

工作流

​

getMetadata

​

智能音视频

​

createTranscription

​

botChat

​

listConversation

​

createConversation

​

editConversation

​

uploadFile

​

listConversationMessage

​

cancelConversationChat

​

createTranscription

​

​

​

​

​

快速开始

​

步骤一：发布并获取安装代码

​

1.

将应用发布为 Web SDK，具体步骤请参见

​

发布为 Web SDK

。

​

2.

在低代码应用的编排页面单击右上角的

版本记录

图标，选择指定版本的

更多

图标，选择

发布结果

。

​

3.

确认 Web SDK 发布成功后，单击

安装指引

。

​

​

​

​

​

​

4.

根据页面提示复制安装代码。此代码将在后续安装 Web SDK 时使用。

​

​

​

​

​

​

步骤二：安装 SDK

​

将步骤一中复制好的安装代码粘贴到网页的 <body> 标签内，当页面加载时，Web SDK 的 JavaScript 代码会被自动加载并初始化。

​

​

XML

复制

<

body

>

​

<!-- 页面内容 -->

​

​

<!-- 粘贴安装代码 -->

​

<

div

id

=

"app"

></

div

>

​

<

script

type

=

"text/javascript"

>

​

var

webSdkScript =

document

.

createElement

(

'script'

);

​

webSdkScript.

src

=

'https://lf-cdn.coze.cn/obj/unpkg/flow-platform/builder-web-sdk/0.1.0/dist/umd/index.js'

;

​

document

.

head

.

appendChild

(webSdkScript);

​

webSdkScript.

onload

=

function

() {

​

new

CozeWebSDK

.

AppWebSDK

({

​

"token"

:

"pat_********"

,

​

"appId"

:

"753014795353776***"

,

​

"container"

:

"#app"

,

​

"userInfo"

: {

​

"id"

:

""

,

​

"url"

:

""

,

​

"nickname"

:

"User"

​

}

​

});

​

}

​

</

script

>

​

</

body

>

​

​

步骤三：配置客户端属性

​

你需要配置 Web SDK 的初始化参数、用户信息和 UI 效果。

​

客户端属性示例代码

​

配置 Web SDK 客户端属性的示例代码如下：

​

​

TypeScript

复制

const

cozeWebSDK =

new

CozeWebSDK

.

AppWebSDK

({

​

token

:

'pat_zxzSAzxawer234zASNElEglZxcmWJ5ouCcq12gsAAsqJGALlq7hcOqMcPFV3wEVDiqjrg****'

,

​

appId

:

'740849137970326****'

,

​

container

:

'#app'

,

​

// 用户信息

​

userInfo

: {

​

id

:

'12345'

,

​

url

:

'https://lf-coze-web-cdn.coze.cn/obj/coze-web-cn/obric/coze/favicon.***.png'

,

​

nickname

:

'小明'

,

​

},

​

ui

: {

​

className

:

'my-client'

​

}

​

})

​

​

初始化配置

​

配置 Web SDK 的初始化参数，包括访问密钥、低代码应用 ID 和渲染的容器。

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

token

​

String

​

必选

​

pat_zxzSAzxawer234zASNElEglZxcm***

​

指定使用的访问密钥。

​

调试场景可直接使用准备工作中添加的访问密钥；正式上线时建议通过 SAT 或 OAuth 实现鉴权逻辑，并将获取的访问密钥填写在此处。

​

appId

​

String

​

必选

​

740849137970326****

​

低代码应用的 ID。

在低代码应用编排页面的

URL 中，project-ide 参数之后的字符串就是 appId。

​

container

​

String

​

必选

​

#app

​

​

网页中承载 Web SDK 所有交互内容的元素

的 CSS 选择器，Web SDK 会将其所有交互内容渲染至该元素内部。

​

例如：Web SDK 的安装代码中定义了承载元素

<div id="app"></div>

，则

container

的值为

#app

。

​

​

用户信息

​

userInfo

参数用于配置和低代码应用对话的用户的信息，包含用户头像、昵称和用户 ID，用于在应用交互中标识用户。

​

你可以通过引用变量的方式在应用中动态获取用户的头像和昵称，具体请参见

​

引用变量

。

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

url

​

String

​

必选

​

https://example.com/avatars/user123.png

​

用户头像的 URL 地址，必须是一个可公开访问的地址。SDK 会通过该地址加载并显示用户头像。

​

​

nickname

​

String

​

必选

​

小明

​

用户的昵称，将在应用界面中显示，用于区分不同的对话用户。

​

id

​

String

​

可选

​

user_123456

​

用户的 ID，即用户在你的网站或应用中的账号 ID。未指定时，Web SDK 会自动为用户分配一个用户 ID。

​

该参数用于在对话时标识具体的用户。

​

​

UI 效果

​

Web SDK 初始化后，会在页面中生成一个用于承载应用内容的 iframe 元素，

ui.className

的值会被添加到该 iframe 的

class

属性中。开发者可通过这个类名，自定义该 iframe 的显示样式，实现与页面整体风格的适配。

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

className

​

String

​

可选

​

coze-app-sdk

​

为 Web SDK 渲染到页面中的 iframe 元素指定 CSS 类名，开发者可以通过这个类名，自定义样式。

​

不配置时，iframe 使用 Web SDK 的默认样式。

​

例如，若设置为

coze-app-sdk

，则可在 CSS 中通过

.coze-app-sdk

选择器定义该 iframe 的样式，具体示例请参见

​

完整示例代码

。

​

​

步

骤四：销毁客户端

​

当用户关闭或退出应用时，调用

destroy

方法销毁客户端以

释放资源、清理界面

。

​

​

TypeScript

复制

<script>

​

const

client =

new

CozeWebSDK

.

AppWebSDK

(options);

​

client.

destroy

();

​

</script>

​

​

完整示例代码

​

以下是一段完整的 Web SDK 的代码示例。

​

index.html

index.js

main.css

​

HTML

复制

<!DOCTYPE

html

>

​

<

html

lang

=

"en"

>

​

<

head

>

​

<

meta

charset

=

"utf-8"

>

​

<!-- 引入自定义样式文件，用于设置页面基础样式及Web SDK iframe的自定义样式 -->

​

<

link

rel

=

"stylesheet"

href

=

"./main.css"

/>

​

</

head

>

​

<

body

>

​

<!-- 引入扣子Web SDK的核心JS库 -->

​

<

div

id

=

'app'

></

div

>

​

<

script

src

=

"https://lf-cdn.coze.cn/obj/unpkg/flow-platform/builder-web-sdk/0.1.0/dist/umd/index.js"

></

script

>

​

<!-- 引入自定义JS文件，用于配置 Web SDK属性-->

​

<

script

src

=

"./index.js"

></

script

>

​

</

body

>

​

</

html

>

​

​

​

常见问题

​

Chat SDK 和 Web SDK 有什么区别？

​

Chat SDK 和 Web SDK 均为扣子编程提供的 SDK，区别如下：

​

支持的应用类型不同

​

Web SDK：仅支持

低代码应用

，且用户界面为 Web 端，不支持小程序端。

​

Chat SDK：支持

智能体

和

低代码应用

两种类型，支持小程序端。

​

功能特性差异

​

Web SDK：低代码应用发布 Web SDK 时，会将低代码应用的

用户界面（UI）和业务逻辑

完整打包发布，集成后可直接在网站中呈现应用的现成交互界面，开发者无需二次开发页面。

​

Chat SDK：低代码应用发布 Chat SDK 时，仅包含智能体/低代码应用中的对话流、对话容器部分（Chatbot 类），不包含应用户界面，主要用于实现用户与 AI 智能体或应用的对话相关功能。

​

​

上一篇

快速开始

下一篇

安装并使用 Card SDK
============================================================
# 安装并使用 Card SDK
来源: https://www.coze.cn/open/docs/developer_guides/card_sdk
============================================================

安装并使用 Card SDK

本文介绍如何安装并使用扣子 Card SDK，开发者可以参考本文档自定义智能体对话消息中的卡片效果。

​

功能简介

​

为了助力开发者打造更具个性化与交互性的消息展示体验，扣子提供 Card SDK。借助该 SDK，开发者可以灵活地定义卡片的结构和内容，并将渲染后的卡片集成到你自行实现的聊天应用中。

​

卡片是一种特殊的消息展示方式，它以结构化的布局和丰富的视觉元素呈现信息。与传统的纯文本消息相比，卡片可以包含图片、按钮、列表等多种元素，使得信息更加直观、易读。这不仅显著提升了用户体验，还提高了信息传递效率，增强了交互性。

​

效果预览

​

​

​

​

​

​

功能简介

​

​

功能

​

说明

​

自定义内容格式

​

Card SDK 提供了强大的自定义功能，允许开发者根据具体需求定义卡片的布局和内容。开发者可以通过配置卡片的 DSL（Domain Specific Language，领域特定语言）数据，指定卡片中各个元素的类型、样式和交互逻辑。无论是简单的文本卡片，还是包含图片、按钮和列表的复杂卡片，都可以通过Card SDK 轻松实现。

​

自定义卡片样式

​

Card SDK 还允许开发者自定义卡片中按钮、图片等组件的渲染逻辑，实现个性化的样式和交互效果。通过

customComponentMap

接口，开发者可以为每个组件定义独特的渲染函数，从而实现更加丰富的视觉效果和交互行为。开发者可以根据具体的业务需求，设计出个性化的卡片样式。

​

​

浏览器兼容性

​

Card

SDK

的运行环境要求如下表所示。

​

​

操作系统

​

浏览器

​

版本限制

​

PC

​

Chrome

​

87.0 及以上

​

​

Edge

​

100.0 及以上

​

​

Safari

​

14.0 及以上

​

​

Firefox

​

79.0 及以上

​

Android

​

Chrome

​

100.0 及以上

​

​

Edge

​

100.0 及以上

​

iOS

​

​

Chrome

​

87.0 及以上

​

​

Safari

​

14.0 及以上

​

​

配置流程

​

步骤一：发布智能体

​

在智能体的发布页面，选择 Chat SDK，并单击

发布

。发布的详细流程可参考

​

发布到 Chat SDK

。

​

步骤二：安装 Card SDK

​

创建一个新的 HTML 页面，并将以下代码添加到 <body>

的 <s

cript> 标签中，保存并运行后会自动加载 Card SDK 的 JavaScript 代码。

​

说明

示例代码中的版本号（1.2.0-beta.8）需要替换为 Chat SDK 最新的版本号，版本信息请参见

​

Chat SDK 发布历史

。

​

​

​

JavaScript

复制

let

c =

document

.

createElement

(

'script'

);

​

c.

src

=

'https://lf-cdn.coze.cn/obj/unpkg/flow-platform/chat-app-sdk/1.2.0-beta.13/libs/cn/ui.js'

;

​

document

.

body

.

appendChild

(c);

​

​

步

骤三

：配置卡片属性

​

示例代码

​

以下是基于 React 框架编写的示例代码，用于渲染卡片布局。

​

​

JavaScript

复制

import

React

, { useCallback, useEffect, useRef }

from

'react'

;

​

​

// 定义 CozeCard 组件，用于创建和管理 CozeWebSDK.WebCardRuntime 实例

​

const

CozeCard

= () => {

​

// 使用 useRef 创建一个可变的引用对象，用于保存 CozeWebSDK.WebCardRuntime 实例

​

const

clientRef =

useRef

();

​

​

// 使用 useCallback 缓存函数，避免组件重新渲染时函数重新创建

​

const

genCard =

useCallback

(

(

elem

) =>

{

​

// 如果传入的元素为空，直接返回

​

if

(!elem) {

​

return

;data

​

}

​

// 如果之前已经存在 CozeWebSDK.WebCardRuntime 实例，先销毁它

​

if

(clientRef.

current

) {

​

clientRef.

current

.

destroy

();

​

}

​

// 创建新的 CozeWebSDK.WebCardRuntime 实例并保存到 clientRef 中

​

clientRef.

current

=

new

CozeWebSDK

.

WebCardRuntime

({

​

// 指定要渲染的 DOM 元素

​

el

: elem,

​

// 自定义组件映射，定义特定组件的渲染逻辑

​

customComponentMap

: {

​

// 自定义 NewImage 组件的渲染逻辑

​

'@flowpd/cici-components/NewImage'

:

(

{ name, element, props }

) =>

{

​

// 打印开发调试信息

​

console

.

log

(

"[dev]"

, { name, element, props });

​

// 设置元素的 HTML 内容

​

element.

innerHTML

=

`Test`

;

​

// 设置元素的宽度

​

element.

style

.

width

=

'100px'

;

​

// 设置元素的高度

​

element.

style

.

height

=

'100px'

;

​

// 设置元素的背景颜色

​

element.

style

.

background

=

'red'

;

​

// 返回一个销毁函数，用于处理组件卸载时的清理工作

​

return

() =>

{

​

// destroy, 例如react 等问题

​

};

​

},

​

// 自定义 ColumnLayout1_2 组件的渲染逻辑

​

'@flowpd/cici-components/ColumnLayout1_2'

:

(

{ name, element, props, renderChildren }

) =>

{

​

// 从 props 中解构出 Columns 属性

​

const

{

Columns

} = props;

​

// 遍历 Columns 数组，渲染每个子元素

​

Columns

.

map

(

(

column

) =>

{

​

const

{ content } = column;

​

const

elem =

renderChildren

(

content

());

​

element.

appendChild

(elem);

​

});

​

// 打印开发调试信息

​

console

.

log

(

"[dev]"

, { name, element, props });

​

// 设置元素的背景颜色

​

element.

style

.

background

=

'yellow'

;

​

// 设置元素的显示方式为弹性布局

​

element.

style

.

display

=

'flex'

;

​

},

​

},

​

// 运行时配置选项

​

runtimeOptions

: {

​

// 解析后的 JSON 数据，定义组件的结构和属性

​

dsl

:

JSON

.

parse

(

​

'{"elements":{"7c1EN9VHwU":{"id":"7c1EN9VHwU","name":"FlowpdCiciComponentsColumnLayout1_2","type":"@flowpd/cici-components/ColumnLayout1_2","props":{"Columns":[{"children":["DQKOI54sJV"],"config":{"vertical":"top","width":"auto"},"type":"slot"},{"children":["FE8Y2GcSwb","L3gNU6QxiI"],"config":{"vertical":"top","weight":2,"width":"weighted"},"type":"slot"}],"action":"enableUrl","backgroundColor":"transparent","enableClickEvent":true,"url":{"type":"expression","value":"{{url}}"}},"directives":{}},"DQKOI54sJV":{"id":"DQKOI54sJV","name":"FlowpdCiciComponentsNewImage","type":"@flowpd/cici-components/NewImage","props":{"action":"enableUrl","crop":"aspectFill","enableClickEvent":false,"enableCrop":false,"fixedSize":"medium","mode":"fixed","ratio":"1:1","src":{"type":"expression","value":"{{image}}"}},"directives":{}},"FE8Y2GcSwb":{"id":"FE8Y2GcSwb","name":"FlowpdCiciComponentsText","type":"@flowpd/cici-components/Text","props":{"action":"enableUrl","color":"neutral-100","content":{"type":"expression","value":"{{title}}"},"enableClickEvent":false,"enableLines":true,"fontSize":"large","fontWeight":"bold","lines":1,"textAlign":"left"},"directives":{}},"L3gNU6QxiI":{"id":"L3gNU6QxiI","name":"FlowpdCiciComponentsText","type":"@flowpd/cici-components/Text","props":{"action":"enableUrl","color":"neutral-70","content":{"type":"expression","value":"{{content}}"},"enableClickEvent":false,"enableLines":true,"fontSize":"small","fontWeight":"normal","lines":2,"textAlign":"left"},"directives":{}},"root":{"id":"root","name":"Root","type":"@flowpd/cici-components/PageContainer","children":["7c1EN9VHwU"],"directives":{}}},"rootID":"root","variables":{"content":{"ID":"content","name":"content","defaultValue":"26/22℃ 无持续风向3-4级 28/24℃ 无持续风向<3级 30/25℃ 无持续风向<3级 26/22℃ 无持续风向3-4级 28/24℃ 无持续风向<3级 30/25℃ 无持续风向<3级"},"image":{"ID":"image","name":"image","defaultValue":""},"title":{"ID":"title","name":"title","defaultValue":"【深圳天气预报15天_深圳天气预报15天查询】-中国天气网"},"url":{"ID":"url","name":"url"}}}'

​

),

​

// 是否只读

​

readonly

:

false

,

​

// 是否强制远程加载

​

remoteForce

:

false

,

​

// 主题样式

​

theme

:

'dark'

,

​

// 语言设置

​

lang

:

'en'

,

​

// 渲染完成后的回调函数

​

afterRender

:

() =>

{

​

console

.

log

(

'[dev] afterRender'

);

​

},

​

},

​

});

​

}, []);

​

​

// 使用 useEffect 处理组件卸载时的清理工作

​

useEffect

(

() =>

{

​

// 返回一个清理函数，在组件卸载时销毁 CozeWebSDK.WebCardRuntime 实例

​

return

() =>

{

​

clientRef.

current

?.

destroy

();

​

};

​

}, []);

​

​

// 返回组件的 JSX 结构

​

return

(

​

<>

​

{/* 定义一个按钮，点击时更新运行时的主题为 light */}

​

<

button

​

onClick

=

{()

=>

{

​

clientRef.current?.updateRuntimeOptions({

​

theme: 'light',

​

});

​

}}

​

>

​

ChangeTheme

​

</

button

>

​

{/* 定义一个 div 元素，使用 ref 绑定 genCard 函数，用于初始化 CozeWebSDK.WebCardRuntime 实例 */}

​

<

div

ref

=

{elem

=>

genCard(elem)} style={{

​

margin: '10px',

​

width: '500px'

​

}} />

​

</>

​

);

​

};

​

​

// 定义 TestCardDemo 组件，用于渲染两个 CozeCard 组件

​

const

TestCardDemo

:

React

.

FC

=

() =>

{

​

return

(

​

<

div

>

​

<

CozeCard

/>

​

<

CozeCard

/>

​

</

div

>

​

);

​

};

​

​

// 导出 TestCardDemo 组件，供其他模块使用

​

export

default

TestCardDemo

;

​

​

卡片参数

​

卡片初始化和个性化配置

的关键参数说明如下表所示。

​

​

参数

​

类型

​

是否必选

​

说明

​

el

​

HTML Element

​

必选

​

卡片需要渲染的 HTML 元素。

​

customComponentMap

​

Object

​

必选

​

自定义组件样式，其中 key 为组件的名称。你可以从 data 字段的卡片配置中获取组件名称。例如：@flowpd/cici-components/NewImage。

​

runtimeOptions

​

Object

​

可选

​

运行时的选项。

​

runtimeOptions.dsl

​

Object

​

可选

​

DSL 数据，定义卡片的结构和内容。

​

runtimeOptions.remoteForce

​

Boolean

​

可选

​

是否每次都从远程拉取组件。

​

true

：每次自动拉取。

​

false

：不自动拉取。

​

runtimeOptions.debug

​

Boolean

​

可选

​

是否打印报错信息。

​

true

：打印。

​

false

：不打印。

​

runtimeOptions.readonly

​

Boolean

​

可选

​

是否开启只读模式，只读模式下卡片的交互效果不生效，例如无法跳转到其他网页等。

​

runtimeOptions.lang

​

String

​

可选

​

设置卡片内容的语言。例如 zh。

​

runtimeOptions.theme

​

String

​

可选

​

卡片的深浅模式。

​

light

：浅色模式。

​

dark

：深色模式。

​

runtimeOptions.afterRender

​

Function

​

可选

​

回调函数，在组件加载成功时自动触发。

​

runtimeOptions.onError

​

Function

​

可选

​

回调函数，在渲染卡片失败时自动触发。

​

runtimeOptions.eventCallbacks

​

Object

​

可选

​

交互事件的回调函数，包括：

​

onElementOut（targetElemtent, linkurl）=> void

：当鼠标从卡片链接上移出的时候，触发此函数。

​

onElementOver（targetElemtent, linkurl）=> void

：当鼠标在卡片链接上移动的时候，触发此函数。

​

sendMsg

：当点击发送消息按钮时触发此函数。

​

previewImage（{url}）=> void

：当点击图片的时候触发此函数。

​

​

自定义卡片组件的样式

​

卡片中的组件使用默认的展示效果，你也可以通过 Card SDK 的

customComponentMap

接口自定义组件的渲染逻辑，实现个性化的样式和交互效果。

​

customComponentMap

接口的结构如下：

​

​

TypeScript

复制

type

DestoryFunc

=

() =>

void

;

​

type

RenderCustomComponentFunc

=

(

params: {

​

name:

string

,

​

element: HTMLDivElement,

​

props: Record<

string

,

any

>,

​

renderChildren: (node: React.ReactNode) => HTMLDivElement}

​

) =>

DestoryFunc

|

void

;

​

​

interface

{

​

customComponentMap?:

Record

<

string

,

RenderCustomComponentFunc

>;

​

}

​

​

说明：

​

RenderCustomComponentFunc

是用于渲染卡片组件的渲染函数。你需要自行实现该函数，函数会接收到卡片组件传递的参数，并返回一个销毁函数。RenderCustomComponentFunc 支持的属性设置如下：

​

​

参数

​

类型

​

是否必选

​

示例

​

说明

​

name

​

String

​

必选

​

@flowpd/cici-components/NewImage

​

元素的名称，通常用于标识和描述元素。

​

element

​

Object

​

必选

​

{ style: { width: '100px', height: '100px' } }

​

指定挂载自定义组件的 HTML 元素，默认为一个空的 <div> 容器。

​

props

​

Object

​

必选

​

props:

​

{

​

blockId:{

element.id

}

​

children: {子节点}

​

lang: zh

​

cardState： （dsl.status || {})

​

...elementProps (处理后的）

​

}

​

渲染组件时使用的属性，你可以从浏览器的开发者工具中查看 props 属性的值。

​

renderChildren

​

Function

​

必选

​

-

​

渲染子组件的方法。如果组件中有子组件，可以使用 renderChildren 函数将子组件渲染到指定的 HTML 元素中。

​

​

RenderCustomComponentFunc

的返回值是一个销毁函数，不需要某个组件时可以调用此函数销毁组件。你可以根据业务场景按需选择是否销毁组件。

​

设置样式的示例代码

​

以下是通过

customComponentMap

接口为组件 @flowpd/cici-components/NewImage 定制样式的示例代码。

​

​

JavaScript

复制

customComponentMap

: {

​

'@flowpd/cici-components/NewImage'

:

(

{ name, element, props }

) =>

{

​

element.

style

.

width

=

'100px'

;

​

element.

style

.

height

=

'100px'

;

​

const

renderRoot =

createRoot

(element);

//使用react渲染组件

​

renderRoot.

render

(

<

div

style

=

{{

​

width:

'

100

%',

​

height:

'

100

%',

​

background:

'

red

',

​

}}>

​

Image Test

​

</

div

>

);

​

return

() =>

{

​

renderRoot.

unmount

();

//销毁函数

​

}

​

}

​

}

​

​

常见问题

​

Card SDK 可以在 Chat SDK 中使用吗？

​

集成 Chat SDK 后无需再集成 Card SDK。Chat SDK 本身已内置对卡片功能的支持，无需额外集成 Card SDK。如果你的聊天应用中未使用 Chat SDK，但需要实现卡片效果，可以直接使用 Card SDK 将渲染后的卡片集成到你自行实现的聊天应用中。

​

​

​

上一篇

安装并使用 Web SDK