# 通过对话接口获取智能体回复

> 来源: https://www.coze.cn/open/docs/developer_guides/get_chat_response

| 获取方式​ | 说明​ |
| 通过流式响应实时显示智能体回复​ | 如果客户端中需要打字机效果实时增量显示智能体回复，可以在调用发起对话接口时，设置流式响应（stream=true），并在客户端对话框中实时打印接口响应中的模型回复部分。​该场景下，客户端需要自行拼接响应内容。​ |
| 仅解析流式响应的智能体回复部分​ | 如果不需要增量流式显示智能体回复，只需要快速获取最终结果，可以在调用发起对话接口时，设置流式响应（stream=true），并在 Response 中，在事件event:conversation.message.completed中，取 type=answer 的事件，例如以下事件中，content 部分为智能体回复。​​Plain Text复制event:conversation.message.completed​data:{"id":"738215949412347****","conversation_id":"738147352534297****","bot_id":"737946218936519****","role":"assistant","type":"answer","content":"2024 年 10 月 1 日是星期三。","content_type":"text","chat_id":"738215948713169****"}​​对话结束后，事件event:conversation.message.completed中可能有多种消息类型，你可以按需解析。常见的消息类型可参考​消息示例。​ |
| 通过非流式响应主动查询智能体回复​ | 你也可以参考以下流程主动查询智能体回复。​1.调用发起会话接口，并设置 stream = false，auto_save_history=true，表示使用非流式响应，并记录历史消息。​你需要记录会话的 Conversation ID 和 Chat ID，用于后续查看详细信息。​2.定期轮询​查看对话详情接口，建议每次间隔 1 秒以上，直到会话状态流转为终态，即 status 为 completed 或 required_action。​3.调用​查看对话消息详情接口，查询模型生成的最终结果。​​​​​​ |


- 你需要记录会话的 Conversation ID 和 Chat ID，用于后续查看详细信息。 ​



- 文本格式智能体回复 ​

- data 字段中，type=answer，且 content_type=text 的消息为文本格式的智能体回复。示例如下： ​

- ​ JSON 复制 event : conversation.message.completed ​ data :{ "id" : "739002977785765****" , "conversation_id" : "739002976985482****" , "bot_id" : "732868101392695****" , "role" : "assistant" , "type" : "answer" , "content" : "xxxx" , "content_type" : "text" , "chat_id" : "7390029769854844****" } ​ ​

- 卡片消息 ​

- data 字段中，type=answer，且 content_type=card 的消息为卡片格式的智能体回复。示例如下： ​

- ​ JSON 复制 event : conversation.message.completed ​ data :{ "id" : "73900297849082****" , "conversation_id" : "7390029769854828****" , "bot_id" : "732868101392695****" , "role" : "assistant" , "type" : "answer" , "content" : "{\"card_type\":3,\"template_url\":\"xxx ....\"response_type\":\"card\"}" , "content_type" : "card" , "chat_id" : "739002976985484****" } ​ ​

- 知识库召回 ​

- data 字段中，type=verbose，且 content.msg_type = knowledge_recall 的消息为知识库召回的消息。示例如下： ​

- ​ JSON 复制 event : conversation.message.completed ​ data :{ "id" : "739002976985487****" , "conversation_id" : "7390029769854828582" , "bot_id" : "732868101392695****" , "role" : "assistant" , "type" : "verbose" , "content" : "{\"msg_type\":\"knowledge_recall\",\"data\":\"xxxx\"}" , "content_type" : "text" , "chat_id" : "739002976985484****" } ​ ​

- 函数调用（Function call） ​

- data 字段中，type=function_call 的消息为函数调用的结果。示例如下： ​

- ​ JSON 复制 event : conversation.message.completed ​ data :{ "id" : "739002977785767****" , "conversation_id" : "739002976985482****" , "bot_id" : "732868101392695****" , "role" : "assistant" , "type" : "function_call" , "content" : "{\"name\":\"toutiaosousuo-search\",\"arguments\":{\"input_query\":\"B 站的热搜\"},\"plugin_id\":72811926238875****3,\"plugin_name\":\"toutiaosousuo\",\"api_id\":7288907006982012986,\"api_name\":\"search\",\"plugin_type\":1,\"thought\":\"需求为搜索 B 站的热搜并搜索这些热搜最新的动态新闻。第一步需要调用toutiaosousuo-search工具搜索 B 站的热搜\"}" , "content_type" : "text" , "chat_id" : "73900297698548****" } ​ ​

- 工具调用（tool_response） ​

- data 字段中，type=tool_response 的消息为工具调用的结果。示例如下： ​

- ​ JSON 复制 event : conversation.message.completed ​ data :{ "id" : "739002978490818****" , "conversation_id" : "739002976985482****" , "bot_id" : "732868101392695****" , "role" : "assistant" , "type" : "tool_response" , "content" : "xxx" , "content_type" : "card" , "chat_id" : "739002976985484****" } ​ ​

- 结束生成标识 ​

- data 字段中，type=verbose，且 content.msg_type = generate_answer_finish 的消息为模型生成结束的标识。示例如下： ​

- ​ JSON 复制 event : conversation.message.completed ​ data :{ "id" : "739002981382787****" , "conversation_id" : "739002976985482****" , "bot_id" : "732868101392695****" , "role" : "assistant" , "type" : "verbose" , "content" : "{\"msg_type\":\"generate_answer_finish\",\"data\":\"{\\\"finish_reason\\\":0}\",\"from_module\":null,\"from_unit\":null}" , "content_type" : "text" , "chat_id" : "739002976985484****" } ​ ​

- 推荐 ​

- data 字段中，type=follow_up 的消息为智能体的用户问题建议。示例如下： ​

- ​ JSON 复制 event : conversation.message.completed ​ data :{ "id" : "739002981382791****" , "conversation_id" : "739002976985482****" , "bot_id" : "732868101392695****" , "role" : "assistant" , "type" : "follow_up" , "content" : "总结一下B站崩了的具体情况" , "content_type" : "text" , "chat_id" : "739002976985484****" } ​ ​